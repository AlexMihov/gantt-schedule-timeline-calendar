const t="chart-timeline-grid-row-cell",e="chart-timeline-items-row-item";let i,s,n,a,o,c,r,h;function l(t,e){const s=i(t,e);c.isSelecting?(h.style.display="block",h.style.left=c.selectionArea.x+"px",h.style.top=c.selectionArea.y+"px",h.style.width=c.selectionArea.width+"px",h.style.height=c.selectionArea.height+"px"):h.style.display="none";const n=o`
    <div class=${r} style=${h}></div>
  `;return o`
    ${s}${n}
  `}const d="config.plugin.Selection";function u(){return{enabled:!0,isSelecting:!1,pointerState:"up",initialPosition:{x:0,y:0},currentPosition:{x:0,y:0},selectionArea:{x:0,y:0,width:0,height:0},selecting:{[e]:[],[t]:[]},selected:{[e]:[],[t]:[]},events:{down:null,move:null,up:null}}}class p{constructor(t,e){this.unsub=[],this.vido=t,this.state=t.state,this.api=t.api,this.options=e,this.data=u(),this.unsub.push(this.state.subscribe("config.plugin.TimelinePointer",t=>{this.poitnerData=t,this.onPointerData()})),this.updateData(),this.unsub.push(this.state.subscribe(d,t=>{this.data=t}))}destroy(){this.unsub.forEach(t=>t())}updateData(){this.state.update(d,Object.assign({},this.data))}getItemsUnderSelectionArea(){return[]}getSelectionArea(){const t={x:0,y:0,width:0,height:0},e=Object.assign({},this.poitnerData.initialPosition),i=Object.assign({},this.poitnerData.currentPosition),s=i.x-e.x,n=i.y-e.y;return s>=0?(t.x=e.x,t.width=s):(t.x=i.x,t.width=Math.abs(s)),n>=0?(t.y=e.y,t.height=n):(t.y=i.y,t.height=Math.abs(n)),t}collectLinkedItems(t,e=[]){if(t.linkedWith&&t.linkedWith.length){const i=this.state.get("config.chart.items");for(const s of t.linkedWith){const t=i[s];e.push(t),this.collectLinkedItems(t,e)}}return e}onPointerData(){if(this.poitnerData.isMoving&&"chart-timeline-grid-row-cell"===this.poitnerData.targetType){this.data.isSelecting=!0,this.data.selectionArea=this.getSelectionArea(),0===this.getItemsUnderSelectionArea().length&&(this.state.update("config.chart.items.*.selected",!1),this.data.selected[e].length=0)}else if(this.poitnerData.isMoving&&"chart-timeline-items-row-item"===this.poitnerData.targetType){this.data.isSelecting=!1,this.data.selectionArea=this.getSelectionArea(),this.data.currentPosition=this.poitnerData.currentPosition,this.data.initialPosition=this.poitnerData.initialPosition;const t=this.poitnerData.targetData,i=this.collectLinkedItems(t,[t]);this.data.selected[e]=i,this.state.update("config.chart.items.*.selected",!1);for(const t of i)this.state.update(`config.chart.items.${t.id}.selected`,!0)}else this.poitnerData.isMoving||(this.data.isSelecting=!1);this.data.events=this.poitnerData.events,this.data.pointerState=this.poitnerData.pointerState,this.updateData()}}function g(t={}){return t=function(t){const e={enabled:!0,grid:!1,items:!0,rows:!1,horizontal:!0,vertical:!0,selecting(){},deselecting(){},selected(){},deselected(){},canSelect:(t,e,i)=>e,canDeselect:(t,e,i)=>[]};return t=Object.assign(Object.assign({},e),t)}(t),function(e){const g=new p(e,t);return e.state.update(d,u()),e.state.update("config.wrappers.ChartTimelineItems",t=>function(t,e){return i=t,s=e,n=s.api,a=s.state,o=s.html,r=n.getClass("chart-selection"),h=new s.StyleMap({display:"none"}),s.onDestroy(a.subscribe("config.plugin.Selection",t=>{c=t,s.update()})),l}(t,e)),function(){g.destroy()}}}export{g as Plugin};
