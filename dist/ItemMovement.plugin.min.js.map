{"version":3,"file":"ItemMovement.plugin.min.js","sources":["../src/plugins/ItemMovement.plugin.ts"],"sourcesContent":["/**\n * ItemMovement plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nexport interface Options {\n  moveable?: boolean | string;\n  resizeable?: boolean | string;\n  resizerContent?: string;\n  collisionDetection?: boolean;\n  outOfBorders?: boolean;\n  snapStart?: (timeStart: number, startDiff: number, item: object) => number;\n  snapEnd?: (timeEnd: number, endDiff: number, item: object) => number;\n  ghostNode?: boolean;\n}\n\nexport default function ItemMovement(options: Options = {}) {\n  const defaultOptions = {\n    moveable: true,\n    resizeable: true,\n    resizerContent: '',\n    collisionDetection: true,\n    outOfBorders: false,\n    snapStart(timeStart, startDiff) {\n      return timeStart + startDiff;\n    },\n    snapEnd(timeEnd, endDiff) {\n      return timeEnd + endDiff;\n    },\n    ghostNode: true\n  };\n  options = { ...defaultOptions, ...options };\n\n  const movementState = {};\n\n  /**\n   * Add moving functionality to items as action\n   *\n   * @param {HTMLElement} node DOM Node\n   * @param {Object} data\n   */\n  function action(element: HTMLElement, data) {\n    if (!options.moveable && !options.resizeable) {\n      return;\n    }\n    let state;\n    let api;\n\n    function isMoveable(data) {\n      let moveable = options.moveable;\n      if (data.item.hasOwnProperty('moveable') && moveable) {\n        moveable = data.item.moveable;\n      }\n      if (data.row.hasOwnProperty('moveable') && moveable) {\n        moveable = data.row.moveable;\n      }\n      return moveable;\n    }\n\n    function isResizeable(data) {\n      let resizeable = options.resizeable && (!data.item.hasOwnProperty('resizeable') || data.item.resizeable === true);\n      if (data.row.hasOwnProperty('resizeable') && resizeable) {\n        resizeable = data.row.resizeable;\n      }\n      return resizeable;\n    }\n\n    function getMovement(data) {\n      const itemId = data.item.id;\n      if (typeof movementState[itemId] === 'undefined') {\n        movementState[itemId] = { moving: false, resizing: false };\n      }\n      return movementState[itemId];\n    }\n\n    function createGhost(data, ev, ganttLeft, ganttTop) {\n      const movement = getMovement(data);\n      if (!options.ghostNode || typeof movement.ghost !== 'undefined') {\n        return;\n      }\n      const ghost = element.cloneNode(true) as HTMLElement;\n      const style = getComputedStyle(element);\n      const compensation = state.get('config.scroll.compensation');\n      ghost.style.position = 'absolute';\n      ghost.style.left = ev.x - ganttLeft - movement.itemLeftCompensation + 'px';\n      const itemTop = ev.y - ganttTop - element.offsetTop - compensation + parseInt(style['margin-top']);\n      movement.itemTop = itemTop;\n      ghost.style.top = ev.y - ganttTop - itemTop + 'px';\n      ghost.style.width = style.width;\n      ghost.style['box-shadow'] = '10px 10px 6px #00000020';\n      const height = element.clientHeight + 'px';\n      ghost.style.height = height;\n      ghost.style['line-height'] = element.clientHeight - 18 + 'px';\n      ghost.style.opacity = '0.6';\n      ghost.style.transform = 'scale(1.05, 1.05)';\n      state.get('_internal.elements.chart-timeline').appendChild(ghost);\n      movement.ghost = ghost;\n      return ghost;\n    }\n\n    function moveGhost(data, ev) {\n      if (options.ghostNode) {\n        const movement = getMovement(data);\n        const left = ev.x - movement.ganttLeft - movement.itemLeftCompensation;\n        movement.ghost.style.left = left + 'px';\n        movement.ghost.style.top =\n          ev.y - movement.ganttTop - movement.itemTop + parseInt(getComputedStyle(element)['margin-top']) + 'px';\n      }\n    }\n\n    function destroyGhost(itemId) {\n      if (!options.ghostNode) {\n        return;\n      }\n      if (typeof movementState[itemId] !== 'undefined' && typeof movementState[itemId].ghost !== 'undefined') {\n        state.get('_internal.elements.chart-timeline').removeChild(movementState[itemId].ghost);\n        delete movementState[itemId].ghost;\n      }\n    }\n\n    function getSnapStart(data) {\n      let snapStart = options.snapStart;\n      if (typeof data.item.snapStart === 'function') {\n        snapStart = data.item.snapStart;\n      }\n      return snapStart;\n    }\n\n    function getSnapEnd(data) {\n      let snapEnd = options.snapEnd;\n      if (typeof data.item.snapEnd === 'function') {\n        snapEnd = data.item.snapEnd;\n      }\n      return snapEnd;\n    }\n\n    state = data.state;\n    api = data.api;\n\n    const resizerHTML = `<div class=\"${api.getClass('chart-timeline-items-row-item-resizer')}\">${\n      options.resizerContent\n    }</div>`;\n    // @ts-ignore\n    element.insertAdjacentHTML('beforeend', resizerHTML);\n    const resizerEl = element.querySelector(\n      '.gantt-schedule-timeline-calendar__chart-timeline-items-row-item-resizer'\n    ) as HTMLElement;\n    if (!isResizeable(data)) {\n      resizerEl.style.visibility = 'hidden';\n    } else {\n      resizerEl.style.visibility = 'visible';\n    }\n\n    function labelMouseDown(ev) {\n      ev.stopPropagation();\n      if (ev.button !== 0) {\n        return;\n      }\n      const movement = getMovement(data);\n      movement.moving = true;\n      const item = state.get(`config.chart.items.${data.item.id}`);\n      const chartLeftTime = state.get('_internal.chart.time.leftGlobal');\n      const timePerPixel = state.get('_internal.chart.time.timePerPixel');\n      const ganttRect = state.get('_internal.elements.chart-timeline').getBoundingClientRect();\n      movement.ganttTop = ganttRect.top;\n      movement.ganttLeft = ganttRect.left;\n      movement.itemX = Math.round((item.time.start - chartLeftTime) / timePerPixel);\n      movement.itemLeftCompensation = ev.x - movement.ganttLeft - movement.itemX;\n      createGhost(data, ev, ganttRect.left, ganttRect.top);\n    }\n\n    function resizerMouseDown(ev) {\n      ev.stopPropagation();\n      if (ev.button !== 0) {\n        return;\n      }\n      const movement = getMovement(data);\n      movement.resizing = true;\n      const item = state.get(`config.chart.items.${data.item.id}`);\n      const chartLeftTime = state.get('_internal.chart.time.leftGlobal');\n      const timePerPixel = state.get('_internal.chart.time.timePerPixel');\n      const ganttRect = state.get('_internal.elements.chart-timeline').getBoundingClientRect();\n      movement.ganttTop = ganttRect.top;\n      movement.ganttLeft = ganttRect.left;\n      movement.itemX = (item.time.end - chartLeftTime) / timePerPixel;\n      movement.itemLeftCompensation = ev.x - movement.ganttLeft - movement.itemX;\n    }\n\n    function isCollision(rowId, itemId, start, end) {\n      if (!options.collisionDetection) {\n        return false;\n      }\n      const time = state.get('_internal.chart.time');\n      if (options.outOfBorders && (start < time.from || end > time.to)) {\n        return true;\n      }\n      let diff = api.time.date(end).diff(start, 'milliseconds');\n      if (Math.sign(diff) === -1) {\n        diff = -diff;\n      }\n      if (diff <= 1) {\n        return true;\n      }\n      const row = state.get('config.list.rows.' + rowId);\n      for (const rowItem of row._internal.items) {\n        if (rowItem.id !== itemId) {\n          if (start >= rowItem.time.start && start <= rowItem.time.end) {\n            return true;\n          }\n          if (end >= rowItem.time.start && end <= rowItem.time.end) {\n            return true;\n          }\n          if (start <= rowItem.time.start && end >= rowItem.time.end) {\n            return true;\n          }\n        }\n      }\n      return false;\n    }\n\n    function movementX(ev, row, item, zoom, timePerPixel) {\n      const movement = getMovement(data);\n      const left = ev.x - movement.ganttLeft - movement.itemLeftCompensation;\n      moveGhost(data, ev);\n      const leftMs = state.get('_internal.chart.time.leftGlobal') + left * timePerPixel;\n      const add = leftMs - item.time.start;\n      const originalStart = item.time.start;\n      const finalStartTime = getSnapStart(data)(item.time.start, add, item);\n      const finalAdd = finalStartTime - originalStart;\n      const collision = isCollision(row.id, item.id, item.time.start + finalAdd, item.time.end + finalAdd);\n      if (finalAdd && !collision) {\n        state.update(`config.chart.items.${data.item.id}.time`, function moveItem(time) {\n          time.start += finalAdd;\n          time.end = getSnapEnd(data)(time.end, finalAdd, item) - 1;\n          return time;\n        });\n      }\n    }\n\n    function resizeX(ev, row, item, zoom, timePerPixel) {\n      if (!isResizeable(data)) {\n        return;\n      }\n      const time = state.get('_internal.chart.time');\n      const movement = getMovement(data);\n      const left = ev.x - movement.ganttLeft - movement.itemLeftCompensation;\n      const leftMs = time.leftGlobal + left * timePerPixel;\n      const add = leftMs - item.time.end;\n      if (item.time.end + add < item.time.start) {\n        return;\n      }\n      const originalEnd = item.time.end;\n      const finalEndTime = getSnapEnd(data)(item.time.end, add, item) - 1;\n      const finalAdd = finalEndTime - originalEnd;\n      const collision = isCollision(row.id, item.id, item.time.start, item.time.end + finalAdd);\n      if (finalAdd && !collision) {\n        state.update(`config.chart.items.${data.item.id}.time`, time => {\n          time.start = getSnapStart(data)(time.start, 0, item);\n          time.end = getSnapEnd(data)(time.end, finalAdd, item) - 1;\n          return time;\n        });\n      }\n    }\n\n    function movementY(ev, row, item, zoom, timePerPixel) {\n      moveGhost(data, ev);\n      const movement = getMovement(data);\n      const top = ev.y - movement.ganttTop;\n      const visibleRows = state.get('_internal.list.visibleRows');\n      const compensation = state.get('config.scroll.compensation');\n      let index = 0;\n      for (const currentRow of visibleRows) {\n        if (currentRow.top + compensation > top) {\n          if (index > 0) {\n            return index - 1;\n          }\n          return 0;\n        }\n        index++;\n      }\n      return index;\n    }\n\n    function documentMouseMove(ev) {\n      const movement = getMovement(data);\n      let item, rowId, row, zoom, timePerPixel;\n      if (movement.moving || movement.resizing) {\n        item = state.get(`config.chart.items.${data.item.id}`);\n        rowId = state.get(`config.chart.items.${data.item.id}.rowId`);\n        row = state.get(`config.list.rows.${rowId}`);\n        zoom = state.get('config.chart.time.zoom');\n        timePerPixel = state.get('_internal.chart.time.timePerPixel');\n      }\n      const moveable = isMoveable(data);\n      if (movement.moving) {\n        if (moveable === true || moveable === 'x' || (Array.isArray(moveable) && moveable.includes(rowId))) {\n          movementX(ev, row, item, zoom, timePerPixel);\n        }\n        if (!moveable || moveable === 'x') {\n          return;\n        }\n        let visibleRowsIndex = movementY(ev, row, item, zoom, timePerPixel);\n        const visibleRows = state.get('_internal.list.visibleRows');\n        if (typeof visibleRows[visibleRowsIndex] === 'undefined') {\n          if (visibleRowsIndex > 0) {\n            visibleRowsIndex = visibleRows.length - 1;\n          } else if (visibleRowsIndex < 0) {\n            visibleRowsIndex = 0;\n          }\n        }\n        const newRow = visibleRows[visibleRowsIndex];\n        const newRowId = newRow.id;\n        const collision = isCollision(newRowId, item.id, item.time.start, item.time.end);\n        if (newRowId !== item.rowId && !collision) {\n          if (!Array.isArray(moveable) || moveable.includes(newRowId)) {\n            if (!newRow.hasOwnProperty('moveable') || newRow.moveable) {\n              state.update(`config.chart.items.${item.id}.rowId`, newRowId);\n            }\n          }\n        }\n      } else if (movement.resizing && (typeof item.resizeable === 'undefined' || item.resizeable === true)) {\n        resizeX(ev, row, item, zoom, timePerPixel);\n      }\n    }\n\n    function documentMouseUp(ev) {\n      const movement = getMovement(data);\n      if (movement.moving || movement.resizing) {\n        ev.stopPropagation();\n      }\n      movement.moving = false;\n      movement.resizing = false;\n      for (const itemId in movementState) {\n        movementState[itemId].moving = false;\n        movementState[itemId].resizing = false;\n        destroyGhost(itemId);\n      }\n    }\n    element.addEventListener('mousedown', labelMouseDown);\n    resizerEl.addEventListener('mousedown', resizerMouseDown, { capture: true });\n    document.addEventListener('mousemove', documentMouseMove, { capture: true, passive: true });\n    document.addEventListener('mouseup', documentMouseUp, { capture: true, passive: true });\n\n    return {\n      update(node, changedData) {\n        if (!isResizeable(data) && resizerEl.style.visibility === 'visible') {\n          resizerEl.style.visibility = 'hidden';\n        } else if (isResizeable(data) && resizerEl.style.visibility === 'hidden') {\n          resizerEl.style.visibility = 'visible';\n        }\n      },\n      destroy(node, data) {\n        element.removeEventListener('mousedown', labelMouseDown);\n        resizerEl.removeEventListener('mousedown', resizerMouseDown);\n        document.removeEventListener('mousemove', documentMouseMove);\n        document.removeEventListener('mouseup', documentMouseUp);\n        resizerEl.remove();\n      }\n    };\n  }\n\n  return function initialize(vido) {\n    vido.state.update('config.actions.chart-timeline-items-row-item', actions => {\n      actions.push(action);\n      return actions;\n    });\n  };\n}\n"],"names":["ItemMovement","options","defaultOptions","moveable","resizeable","resizerContent","collisionDetection","outOfBorders","snapStart","timeStart","startDiff","snapEnd","timeEnd","endDiff","ghostNode","movementState","action","element","data","state","api","isResizeable","item","hasOwnProperty","row","getMovement","itemId","id","moving","resizing","moveGhost","ev","movement","left","x","ganttLeft","itemLeftCompensation","ghost","style","top","y","ganttTop","itemTop","parseInt","getComputedStyle","destroyGhost","get","removeChild","getSnapStart","getSnapEnd","resizerHTML","getClass","insertAdjacentHTML","resizerEl","querySelector","labelMouseDown","stopPropagation","button","chartLeftTime","timePerPixel","ganttRect","getBoundingClientRect","itemX","Math","round","time","start","createGhost","cloneNode","compensation","position","offsetTop","width","height","clientHeight","opacity","transform","appendChild","resizerMouseDown","end","isCollision","rowId","from","to","diff","date","sign","rowItem","_internal","items","documentMouseMove","zoom","isMoveable","Array","isArray","includes","movementX","add","originalStart","finalAdd","collision","update","moveItem","visibleRowsIndex","movementY","visibleRows","index","currentRow","length","newRow","newRowId","resizeX","leftGlobal","originalEnd","documentMouseUp","visibility","addEventListener","capture","document","passive","[object Object]","node","changedData","removeEventListener","remove","initialize","vido","actions","push"],"mappings":"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"}