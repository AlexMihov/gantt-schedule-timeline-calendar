{"version":3,"file":"calendar-scroll.plugin.umd.js","sources":["../node_modules/@neuronet.io/vido/src/helpers.ts","../src/plugins/calendar-scroll.plugin.ts"],"sourcesContent":["/**\n * Schedule - a throttle function that uses requestAnimationFrame to limit the rate at which a function is called.\n *\n * @param {function} fn\n * @returns {function}\n */\nexport function schedule(fn: (argument) => void | any) {\n  let frameId = 0;\n  function wrapperFn(argument) {\n    if (frameId) {\n      return;\n    }\n    function executeFrame() {\n      frameId = 0;\n      fn.apply(undefined, [argument]);\n    }\n    frameId = requestAnimationFrame(executeFrame);\n  }\n  return wrapperFn;\n}\n\n/**\n * Is object - helper function to determine if specified variable is an object\n *\n * @param {any} item\n * @returns {boolean}\n */\nfunction isObject(item) {\n  return item && typeof item === 'object' && item.constructor && item.constructor.name === 'Object';\n}\n\n/**\n * Merge deep - helper function which will merge objects recursively - creating brand new one - like clone\n *\n * @param {object} target\n * @params {[object]} sources\n * @returns {object}\n */\nexport function mergeDeep(target, ...sources) {\n  const source = sources.shift();\n  if (isObject(target) && isObject(source)) {\n    for (const key in source) {\n      if (isObject(source[key])) {\n        if (typeof source[key].clone === 'function') {\n          target[key] = source[key].clone();\n        } else {\n          if (typeof target[key] === 'undefined') {\n            target[key] = {};\n          }\n          target[key] = mergeDeep(target[key], source[key]);\n        }\n      } else if (Array.isArray(source[key])) {\n        target[key] = new Array(source[key].length);\n        let index = 0;\n        for (let item of source[key]) {\n          if (isObject(item)) {\n            if (typeof item.clone === 'function') {\n              target[key][index] = item.clone();\n            } else {\n              target[key][index] = mergeDeep({}, item);\n            }\n          } else {\n            target[key][index] = item;\n          }\n          index++;\n        }\n      } else {\n        target[key] = source[key];\n      }\n    }\n  }\n  if (!sources.length) {\n    return target;\n  }\n  return mergeDeep(target, ...sources);\n}\n\n/**\n * Clone helper function\n *\n * @param source\n * @returns {object} cloned source\n */\nexport function clone(source) {\n  if (typeof source.actions !== 'undefined') {\n    const actns = source.actions.map((action) => {\n      const result = { ...action };\n      const props = { ...result.props };\n      delete props.state;\n      delete props.api;\n      delete result.element;\n      result.props = props;\n      return result;\n    });\n    source.actions = actns;\n  }\n  return mergeDeep({}, source);\n}\n\nexport default {\n  mergeDeep,\n  clone,\n  schedule,\n};\n","/**\n * CalendarScroll plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   AGPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nimport { ScrollTypeHorizontal, Vido, Scroll } from '../gstc';\nimport DeepState from 'deep-state-observer';\nimport { Api } from '../api/api';\nimport { mergeDeep } from '@neuronet.io/vido/src/helpers';\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport interface Options {\n  enabled: boolean;\n  bodyClassName: string;\n}\n\nconst defaultOptions = {\n  enabled: true,\n  bodyClassName: 'gstc-scrolling',\n};\n\nexport function Plugin(options: Options = defaultOptions) {\n  let vido: Vido, api: Api, state: DeepState;\n  let enabled = options.enabled;\n\n  class ChartAction {\n    private moving = false;\n    private initialPoint: Point;\n    private initialDataIndex: Point = { x: 0, y: 0 };\n\n    constructor(element: HTMLElement) {\n      this.pointerDown = this.pointerDown.bind(this);\n      this.pointerUp = this.pointerUp.bind(this);\n      this.pointerMove = vido.schedule(this.pointerMove.bind(this));\n      element.addEventListener('pointerdown', this.pointerDown);\n      document.addEventListener('pointermove', this.pointerMove, { passive: true });\n      document.addEventListener('pointerup', this.pointerUp);\n      element.style.cursor = 'grab';\n    }\n\n    public destroy(element: HTMLElement) {\n      element.removeEventListener('pointerdown', this.pointerDown);\n      document.removeEventListener('pointermove', this.pointerMove);\n      document.removeEventListener('pointerup', this.pointerUp);\n    }\n\n    private resetInitialPoint(ev: PointerEvent) {\n      this.initialPoint = { x: ev.screenX, y: ev.screenY };\n    }\n\n    private pointerDown(ev: PointerEvent) {\n      if (!enabled) return;\n      document.body.classList.add(options.bodyClassName);\n      this.moving = true;\n      this.resetInitialPoint(ev);\n      const scroll: Scroll = state.get('config.scroll');\n      this.initialDataIndex = { x: scroll.horizontal.dataIndex || 0, y: scroll.vertical.dataIndex || 0 };\n    }\n\n    private pointerUp(ev: PointerEvent) {\n      if (!enabled) return;\n      document.body.classList.remove(options.bodyClassName);\n      if (this.moving) {\n        this.moving = false;\n      }\n    }\n\n    private handleHorizontalMovement(diff: Point, ev: PointerEvent) {\n      const time = state.get('$data.chart.time');\n      if (diff.x > 0) {\n        // go backward - move dates forward\n        if (this.initialDataIndex.x === 0) {\n          return this.resetInitialPoint(ev);\n        }\n        const allDates = time.allDates[time.level];\n        let i = this.initialDataIndex.x - 1;\n        let width = 0;\n        for (; i > 0; i--) {\n          const date = allDates[i];\n          width += date.width;\n          if (width >= diff.x) break;\n        }\n        api.setScrollLeft(i, time);\n      } else if (diff.x < 0) {\n        // go forward - move dates backward\n        let i = this.initialDataIndex.x;\n        const hScroll = state.get('config.scroll.horizontal') as ScrollTypeHorizontal;\n        const allDates = time.allDates[time.level];\n        if (i - 1 >= allDates.length - hScroll.lastPageCount) {\n          return this.resetInitialPoint(ev);\n        }\n        let width = 0;\n        for (let len = allDates.length; i < len; i++) {\n          const date = allDates[i];\n          width += date.width;\n          if (-width <= diff.x) break;\n        }\n        if (i - 1 >= allDates.length - hScroll.lastPageCount) {\n          return;\n        }\n        api.setScrollLeft(i, time);\n      }\n    }\n\n    private pointerMove(ev: PointerEvent) {\n      if (!enabled || !this.moving) return;\n      const diffX = ev.screenX - this.initialPoint.x;\n      const diffY = ev.screenY - this.initialPoint.y;\n      const diff: Point = { x: diffX, y: diffY };\n      this.handleHorizontalMovement(diff, ev);\n    }\n  }\n\n  return function initialize(vidoInstance) {\n    vido = vidoInstance;\n    api = vido.api;\n    state = vido.state;\n    const pluginPath = 'config.plugin.CalendarScroll';\n    const currentOptions = vidoInstance.state.get(pluginPath);\n    if (currentOptions) {\n      options = mergeDeep({}, options, currentOptions);\n    }\n    state.update(pluginPath, options);\n    state.subscribe('config.plugin.CalendarScroll.enabled', (value) => (enabled = value));\n    state.update('config.actions.chart-calendar', (chartActions) => {\n      chartActions.push(ChartAction);\n      return chartActions;\n    });\n    return function destroy() {\n      state.update('config.actions.chart-calendar', (chartActions) => {\n        return chartActions.filter((action) => action !== ChartAction);\n      });\n    };\n  };\n}\n"],"names":[],"mappings":";;;;;;EAAA;;;;;;EAqBA;;;;;;EAMA,SAAS,QAAQ,CAAC,IAAI;MACpB,OAAO,IAAI,IAAI,OAAO,IAAI,KAAK,QAAQ,IAAI,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,WAAW,CAAC,IAAI,KAAK,QAAQ,CAAC;EACpG,CAAC;EAED;;;;;;;WAOgB,SAAS,CAAC,MAAM,EAAE,GAAG,OAAO;MAC1C,MAAM,MAAM,GAAG,OAAO,CAAC,KAAK,EAAE,CAAC;MAC/B,IAAI,QAAQ,CAAC,MAAM,CAAC,IAAI,QAAQ,CAAC,MAAM,CAAC,EAAE;UACxC,KAAK,MAAM,GAAG,IAAI,MAAM,EAAE;cACxB,IAAI,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,EAAE;kBACzB,IAAI,OAAO,MAAM,CAAC,GAAG,CAAC,CAAC,KAAK,KAAK,UAAU,EAAE;sBAC3C,MAAM,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC,KAAK,EAAE,CAAC;mBACnC;uBAAM;sBACL,IAAI,OAAO,MAAM,CAAC,GAAG,CAAC,KAAK,WAAW,EAAE;0BACtC,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC;uBAClB;sBACD,MAAM,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;mBACnD;eACF;mBAAM,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,EAAE;kBACrC,MAAM,CAAC,GAAG,CAAC,GAAG,IAAI,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC;kBAC5C,IAAI,KAAK,GAAG,CAAC,CAAC;kBACd,KAAK,IAAI,IAAI,IAAI,MAAM,CAAC,GAAG,CAAC,EAAE;sBAC5B,IAAI,QAAQ,CAAC,IAAI,CAAC,EAAE;0BAClB,IAAI,OAAO,IAAI,CAAC,KAAK,KAAK,UAAU,EAAE;8BACpC,MAAM,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,KAAK,EAAE,CAAC;2BACnC;+BAAM;8BACL,MAAM,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,GAAG,SAAS,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;2BAC1C;uBACF;2BAAM;0BACL,MAAM,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC;uBAC3B;sBACD,KAAK,EAAE,CAAC;mBACT;eACF;mBAAM;kBACL,MAAM,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;eAC3B;WACF;OACF;MACD,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;UACnB,OAAO,MAAM,CAAC;OACf;MACD,OAAO,SAAS,CAAC,MAAM,EAAE,GAAG,OAAO,CAAC,CAAC;EACvC;;EC3EA;;;;;;;;;EAyBA,MAAM,cAAc,GAAG;MACrB,OAAO,EAAE,IAAI;MACb,aAAa,EAAE,gBAAgB;GAChC,CAAC;WAEc,MAAM,CAAC,UAAmB,cAAc;MACtD,IAAI,IAAU,EAAE,GAAQ,EAAE,KAAgB,CAAC;MAC3C,IAAI,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC;MAE9B,MAAM,WAAW;UAKf,YAAY,OAAoB;cAJxB,WAAM,GAAG,KAAK,CAAC;cAEf,qBAAgB,GAAU,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;cAG/C,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;cAC/C,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;cAC3C,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;cAC9D,OAAO,CAAC,gBAAgB,CAAC,aAAa,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;cAC1D,QAAQ,CAAC,gBAAgB,CAAC,aAAa,EAAE,IAAI,CAAC,WAAW,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;cAC9E,QAAQ,CAAC,gBAAgB,CAAC,WAAW,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;cACvD,OAAO,CAAC,KAAK,CAAC,MAAM,GAAG,MAAM,CAAC;WAC/B;UAEM,OAAO,CAAC,OAAoB;cACjC,OAAO,CAAC,mBAAmB,CAAC,aAAa,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;cAC7D,QAAQ,CAAC,mBAAmB,CAAC,aAAa,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;cAC9D,QAAQ,CAAC,mBAAmB,CAAC,WAAW,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;WAC3D;UAEO,iBAAiB,CAAC,EAAgB;cACxC,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC,OAAO,EAAE,CAAC,EAAE,EAAE,CAAC,OAAO,EAAE,CAAC;WACtD;UAEO,WAAW,CAAC,EAAgB;cAClC,IAAI,CAAC,OAAO;kBAAE,OAAO;cACrB,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;cACnD,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;cACnB,IAAI,CAAC,iBAAiB,CAAC,EAAE,CAAC,CAAC;cAC3B,MAAM,MAAM,GAAW,KAAK,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;cAClD,IAAI,CAAC,gBAAgB,GAAG,EAAE,CAAC,EAAE,MAAM,CAAC,UAAU,CAAC,SAAS,IAAI,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,QAAQ,CAAC,SAAS,IAAI,CAAC,EAAE,CAAC;WACpG;UAEO,SAAS,CAAC,EAAgB;cAChC,IAAI,CAAC,OAAO;kBAAE,OAAO;cACrB,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;cACtD,IAAI,IAAI,CAAC,MAAM,EAAE;kBACf,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;eACrB;WACF;UAEO,wBAAwB,CAAC,IAAW,EAAE,EAAgB;cAC5D,MAAM,IAAI,GAAG,KAAK,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;cAC3C,IAAI,IAAI,CAAC,CAAC,GAAG,CAAC,EAAE;;kBAEd,IAAI,IAAI,CAAC,gBAAgB,CAAC,CAAC,KAAK,CAAC,EAAE;sBACjC,OAAO,IAAI,CAAC,iBAAiB,CAAC,EAAE,CAAC,CAAC;mBACnC;kBACD,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;kBAC3C,IAAI,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,CAAC,GAAG,CAAC,CAAC;kBACpC,IAAI,KAAK,GAAG,CAAC,CAAC;kBACd,OAAO,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;sBACjB,MAAM,IAAI,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;sBACzB,KAAK,IAAI,IAAI,CAAC,KAAK,CAAC;sBACpB,IAAI,KAAK,IAAI,IAAI,CAAC,CAAC;0BAAE,MAAM;mBAC5B;kBACD,GAAG,CAAC,aAAa,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;eAC5B;mBAAM,IAAI,IAAI,CAAC,CAAC,GAAG,CAAC,EAAE;;kBAErB,IAAI,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC;kBAChC,MAAM,OAAO,GAAG,KAAK,CAAC,GAAG,CAAC,0BAA0B,CAAyB,CAAC;kBAC9E,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;kBAC3C,IAAI,CAAC,GAAG,CAAC,IAAI,QAAQ,CAAC,MAAM,GAAG,OAAO,CAAC,aAAa,EAAE;sBACpD,OAAO,IAAI,CAAC,iBAAiB,CAAC,EAAE,CAAC,CAAC;mBACnC;kBACD,IAAI,KAAK,GAAG,CAAC,CAAC;kBACd,KAAK,IAAI,GAAG,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE;sBAC5C,MAAM,IAAI,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;sBACzB,KAAK,IAAI,IAAI,CAAC,KAAK,CAAC;sBACpB,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,CAAC;0BAAE,MAAM;mBAC7B;kBACD,IAAI,CAAC,GAAG,CAAC,IAAI,QAAQ,CAAC,MAAM,GAAG,OAAO,CAAC,aAAa,EAAE;sBACpD,OAAO;mBACR;kBACD,GAAG,CAAC,aAAa,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;eAC5B;WACF;UAEO,WAAW,CAAC,EAAgB;cAClC,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,MAAM;kBAAE,OAAO;cACrC,MAAM,KAAK,GAAG,EAAE,CAAC,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;cAC/C,MAAM,KAAK,GAAG,EAAE,CAAC,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;cAC/C,MAAM,IAAI,GAAU,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC;cAC3C,IAAI,CAAC,wBAAwB,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;WACzC;OACF;MAED,OAAO,SAAS,UAAU,CAAC,YAAY;UACrC,IAAI,GAAG,YAAY,CAAC;UACpB,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC;UACf,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;UACnB,MAAM,UAAU,GAAG,8BAA8B,CAAC;UAClD,MAAM,cAAc,GAAG,YAAY,CAAC,KAAK,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;UAC1D,IAAI,cAAc,EAAE;cAClB,OAAO,GAAG,SAAS,CAAC,EAAE,EAAE,OAAO,EAAE,cAAc,CAAC,CAAC;WAClD;UACD,KAAK,CAAC,MAAM,CAAC,UAAU,EAAE,OAAO,CAAC,CAAC;UAClC,KAAK,CAAC,SAAS,CAAC,sCAAsC,EAAE,CAAC,KAAK,MAAM,OAAO,GAAG,KAAK,CAAC,CAAC,CAAC;UACtF,KAAK,CAAC,MAAM,CAAC,+BAA+B,EAAE,CAAC,YAAY;cACzD,YAAY,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;cAC/B,OAAO,YAAY,CAAC;WACrB,CAAC,CAAC;UACH,OAAO,SAAS,OAAO;cACrB,KAAK,CAAC,MAAM,CAAC,+BAA+B,EAAE,CAAC,YAAY;kBACzD,OAAO,YAAY,CAAC,MAAM,CAAC,CAAC,MAAM,KAAK,MAAM,KAAK,WAAW,CAAC,CAAC;eAChE,CAAC,CAAC;WACJ,CAAC;OACH,CAAC;EACJ;;;;;;;;;;;;"}