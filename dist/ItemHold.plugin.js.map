{"version":3,"file":"ItemHold.plugin.js","sources":["../src/plugins/ItemHold.plugin.ts"],"sourcesContent":["/**\n * ItemHold plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   AGPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nexport interface Options {\n  time?: number;\n  movementThreshold?: number;\n  action?: (element: HTMLElement, data: any) => void;\n}\n\nexport default function ItemHold(options: Options = {}) {\n  let api;\n  const defaultOptions = {\n    time: 1000,\n    movementThreshold: 2,\n    action(element, data) {}\n  };\n  options = { ...defaultOptions, ...options };\n\n  const holding = {};\n  const pointer = { x: 0, y: 0 };\n\n  function onPointerDown(item, element, event) {\n    if (typeof holding[item.id] === 'undefined') {\n      holding[item.id] = { x: event.x, y: event.y };\n      event.stopPropagation();\n      event.preventDefault();\n      setTimeout(() => {\n        if (typeof holding[item.id] !== 'undefined') {\n          let exec = true;\n          const xMovement = Math.abs(holding[item.id].x - pointer.x);\n          const yMovement = Math.abs(holding[item.id].y - pointer.y);\n          if (xMovement > options.movementThreshold) {\n            exec = false;\n          }\n          if (yMovement > options.movementThreshold) {\n            exec = false;\n          }\n          delete holding[item.id];\n          if (exec) {\n            options.action(element, item);\n          }\n        }\n      }, options.time);\n    }\n  }\n\n  function onPointerUp(itemId) {\n    if (typeof holding[itemId] !== 'undefined') {\n      delete holding[itemId];\n    }\n  }\n\n  function action(element, data) {\n    function elementPointerDown(event) {\n      onPointerDown(data.item, element, event);\n    }\n    element.addEventListener('pointerdown', elementPointerDown);\n    function pointerUp() {\n      onPointerUp(data.item.id);\n    }\n\n    document.addEventListener('pointerup', pointerUp);\n    function onPointerMove(event) {\n      pointer.x = event.x;\n      pointer.y = event.y;\n    }\n\n    document.addEventListener('pointermove', onPointerMove);\n    return {\n      update(element, changedData) {\n        data = changedData;\n      },\n      destroy(element, data) {\n        document.removeEventListener('pointerup', onPointerUp);\n        document.removeEventListener('poitnermove', onPointerMove);\n        element.removeEventListener('pointerdown', elementPointerDown);\n      }\n    };\n  }\n\n  return function initialize(vido) {\n    api = vido.api;\n    vido.state.update('config.actions.chart-timeline-items-row-item', actions => {\n      actions.push(action);\n      return actions;\n    });\n  };\n}\n"],"names":[],"mappings":"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"}