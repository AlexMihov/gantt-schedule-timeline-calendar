{"version":3,"file":"ItemHold.plugin.min.js","sources":["../src/plugins/ItemHold.plugin.ts"],"sourcesContent":["/**\n * ItemHold plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nexport interface Options {\n  time?: number;\n  movementThreshold?: number;\n  action?: (element: HTMLElement, data: any) => void;\n}\n\nexport default function ItemHold(options: Options = {}) {\n  let api;\n  const defaultOptions = {\n    time: 1000,\n    movementThreshold: 2,\n    action(element, data) {}\n  };\n  options = { ...defaultOptions, ...options };\n\n  const holding = {};\n  const pointer = { x: 0, y: 0 };\n\n  function onPointerDown(item, element, event) {\n    if (typeof holding[item.id] === 'undefined') {\n      const normalized = api.normalizePointerEvent(event);\n      holding[item.id] = { x: normalized.x, y: normalized.y };\n      event.stopPropagation();\n      event.preventDefault();\n      setTimeout(() => {\n        if (typeof holding[item.id] !== 'undefined') {\n          let exec = true;\n          const xMovement = Math.abs(holding[item.id].x - pointer.x);\n          const yMovement = Math.abs(holding[item.id].y - pointer.y);\n          if (xMovement > options.movementThreshold) {\n            exec = false;\n          }\n          if (yMovement > options.movementThreshold) {\n            exec = false;\n          }\n          delete holding[item.id];\n          if (exec) {\n            options.action(element, item);\n          }\n        }\n      }, options.time);\n    }\n  }\n\n  function onPointerUp(itemId) {\n    if (typeof holding[itemId] !== 'undefined') {\n      delete holding[itemId];\n    }\n  }\n\n  function action(element, data) {\n    function elementPointerDown(event) {\n      onPointerDown(data.item, element, event);\n    }\n    element.addEventListener('mousedown', elementPointerDown);\n    element.addEventListener('touchstart', elementPointerDown);\n    function pointerUp() {\n      onPointerUp(data.item.id);\n    }\n\n    document.addEventListener('mouseup', pointerUp);\n    document.addEventListener('touchend', pointerUp);\n    function onPointerMove(event) {\n      const normalized = api.normalizePointerEvent(event);\n      pointer.x = normalized.x;\n      pointer.y = normalized.y;\n    }\n\n    document.addEventListener('mousemove', onPointerMove);\n    document.addEventListener('touchmove', onPointerMove);\n    return {\n      update(element, changedData) {\n        data = changedData;\n      },\n      destroy(element, data) {\n        document.removeEventListener('mouseup', onPointerUp);\n        document.removeEventListener('mousemove', onPointerMove);\n        element.removeEventListener('mousedown', elementPointerDown);\n        document.removeEventListener('touchend', onPointerUp);\n        document.removeEventListener('touchmove', onPointerMove);\n        element.removeEventListener('touchstart', elementPointerDown);\n      }\n    };\n  }\n\n  return function initialize(vido) {\n    api = vido.api;\n    vido.state.update('config.actions.chart-timeline-items-row-item', actions => {\n      actions.push(action);\n      return actions;\n    });\n  };\n}\n"],"names":["ItemHold","options","api","defaultOptions","time","movementThreshold","[object Object]","element","data","holding","pointer","x","y","onPointerUp","itemId","action","elementPointerDown","event","onPointerDown","item","id","normalized","normalizePointerEvent","stopPropagation","preventDefault","setTimeout","exec","xMovement","Math","abs","yMovement","pointerUp","onPointerMove","addEventListener","document","changedData","removeEventListener","initialize","vido","state","update","actions","push"],"mappings":";;;;;;;;;qBAgBwBA,SAASC,EAAmB,IAClD,IAAIC,EACJ,MAAMC,EAAiB,CACrBC,KAAM,IACNC,kBAAmB,EACnBC,OAAOC,EAASC,MAElBP,iCAAeE,GAAmBF,GAElC,MAAMQ,EAAU,GACVC,EAAU,CAAEC,EAAG,EAAGC,EAAG,GA4B3B,SAASC,YAAYC,QACY,IAApBL,EAAQK,WACVL,EAAQK,GAInB,SAASC,OAAOR,EAASC,GACvB,SAASQ,mBAAmBC,IAjC9B,SAASC,cAAcC,EAAMZ,EAASU,GACpC,QAAgC,IAArBR,EAAQU,EAAKC,IAAqB,CAC3C,MAAMC,EAAanB,EAAIoB,sBAAsBL,GAC7CR,EAAQU,EAAKC,IAAM,CAAET,EAAGU,EAAWV,EAAGC,EAAGS,EAAWT,GACpDK,EAAMM,kBACNN,EAAMO,iBACNC,WAAW,KACT,QAAgC,IAArBhB,EAAQU,EAAKC,IAAqB,CAC3C,IAAIM,GAAO,EACX,MAAMC,EAAYC,KAAKC,IAAIpB,EAAQU,EAAKC,IAAIT,EAAID,EAAQC,GAClDmB,EAAYF,KAAKC,IAAIpB,EAAQU,EAAKC,IAAIR,EAAIF,EAAQE,GACpDe,EAAY1B,EAAQI,oBACtBqB,GAAO,GAELI,EAAY7B,EAAQI,oBACtBqB,GAAO,UAEFjB,EAAQU,EAAKC,IAChBM,GACFzB,EAAQc,OAAOR,EAASY,KAG3BlB,EAAQG,OAYXc,CAAcV,EAAKW,KAAMZ,EAASU,GAIpC,SAASc,YACPlB,YAAYL,EAAKW,KAAKC,IAKxB,SAASY,cAAcf,GACrB,MAAMI,EAAanB,EAAIoB,sBAAsBL,GAC7CP,EAAQC,EAAIU,EAAWV,EACvBD,EAAQE,EAAIS,EAAWT,EAKzB,OAhBAL,EAAQ0B,iBAAiB,YAAajB,oBACtCT,EAAQ0B,iBAAiB,aAAcjB,oBAKvCkB,SAASD,iBAAiB,UAAWF,WACrCG,SAASD,iBAAiB,WAAYF,WAOtCG,SAASD,iBAAiB,YAAaD,eACvCE,SAASD,iBAAiB,YAAaD,eAChC,CACL1B,OAAOC,EAAS4B,GACd3B,EAAO2B,GAET7B,QAAQC,EAASC,GACf0B,SAASE,oBAAoB,UAAWvB,aACxCqB,SAASE,oBAAoB,YAAaJ,eAC1CzB,EAAQ6B,oBAAoB,YAAapB,oBACzCkB,SAASE,oBAAoB,WAAYvB,aACzCqB,SAASE,oBAAoB,YAAaJ,eAC1CzB,EAAQ6B,oBAAoB,aAAcpB,sBAKhD,OAAO,SAASqB,WAAWC,GACzBpC,EAAMoC,EAAKpC,IACXoC,EAAKC,MAAMC,OAAO,+CAAgDC,IAChEA,EAAQC,KAAK3B,QACN0B"}