/**
 * ItemHold plugin
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
 * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar
 */
function t(t={}){t={...{time:1e3,movementThreshold:2,action(t,e){}},...t};const e={},n={x:0,y:0};function i(t){void 0!==e[t]&&delete e[t]}function o(o,s){function r(i){!function(i,o,s){void 0===e[i.id]&&(e[i.id]={x:s.x,y:s.y},setTimeout(()=>{if(void 0!==e[i.id]){let s=!0,r=e[i.id].x-n.x;-1===Math.sign(r)&&(r=-r);let a=e[i.id].y-n.y;-1===Math.sign(a)&&(a=-a),r>t.movementThreshold&&(s=!1),a>t.movementThreshold&&(s=!1),delete e[i.id],s&&t.action(o,i)}},t.time))}(s.item,o,i)}function a(t){n.x=t.x,n.y=t.y}return o.addEventListener("mousedown",r),document.addEventListener("mouseup",(function(){i(s.item.id)})),document.addEventListener("mousemove",a),{update(t,e){s=e},destroy(t,e){document.removeEventListener("mouseup",i),document.removeEventListener("mousemove",a),t.removeEventListener("mousedown",r)}}}return function(t,e){t.update("config.actions.chart-timeline-items-row-item",t=>(t.push(o),t))}}
/**
 * ItemMovement plugin
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
 * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar
 */function e(t={}){t={moveable:!0,resizeable:!0,resizerContent:"",collisionDetection:!0,outOfBorders:!1,snapStart:(t,e)=>t+e,snapEnd:(t,e)=>t+e,ghostNode:!0,...t};const e={};function n(n,i){let o,s,r=n.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content");if(!t.moveable&&!t.resizeable)return;function a(e){let n=t.resizeable&&(!e.item.hasOwnProperty("resizeable")||!0===e.item.resizeable);return e.row.hasOwnProperty("resizeable")&&n&&(n=e.row.resizeable),n}function m(t){const n=t.item.id;return void 0===e[n]&&(e[n]={moving:!1,resizing:!1}),e[n]}function c(e,n){if(t.ghostNode){const t=m(e),i=n.x-t.ganttLeft-t.itemLeftCompensation,s=o.get("config.scroll.compensation");t.ghost.style.left=i+"px",t.ghost.style.top=n.y-t.ganttTop-t.itemTop+s+"px"}}function l(n){t.ghostNode&&(void 0!==e[n]&&void 0!==e[n].ghost&&(o.get("_internal.elements.gantt").removeChild(e[n].ghost),delete e[n].ghost),r.style.opacity="1")}function d(e){let n=t.snapStart;return"function"==typeof e.item.snapStart&&(n=e.item.snapStart),n}function u(e){let n=t.snapEnd;return"function"==typeof e.item.snapEnd&&(n=e.item.snapEnd),n}o=i.state;const g=`<div class="${(s=i.api).getClass("chart-timeline-items-row-item-content-resizer")}">${t.resizerContent}</div>`;r.insertAdjacentHTML("beforeend",g);const f=r.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content-resizer");function p(e){if(e.stopPropagation(),0!==e.button)return;r=n.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content");const s=m(i);s.moving=!0;const a=o.get(`config.chart.items.${i.item.id}`),c=o.get("_internal.chart.time.leftGlobal"),l=o.get("_internal.chart.time.timePerPixel"),d=o.get("_internal.elements.gantt").getBoundingClientRect();s.ganttTop=d.top,s.ganttLeft=d.left,s.itemX=Math.round((a.time.start-c)/l),s.itemLeftCompensation=e.x-s.ganttLeft-s.itemX,function(e,n,i,s){const a=m(e);if(!t.ghostNode||void 0!==a.ghost)return;const c=r.cloneNode(!0),l=getComputedStyle(r);c.style.position="absolute",c.style.left=n.x-i-a.itemLeftCompensation+"px";const d=n.y-s-e.row.top-r.offsetTop;a.itemTop=d,c.style.top=n.y-s-d+"px",c.style.width=l.width,c.style["box-shadow"]="10px 10px 6px #00000020";const u=r.clientHeight+"px";c.style.height=u,c.style["line-height"]=u,c.style.opacity="0.75",o.get("_internal.elements.gantt").appendChild(c),a.ghost=c}(i,e,d.left,d.top)}function h(t){if(t.stopPropagation(),0!==t.button)return;const e=m(i);e.resizing=!0;const n=o.get(`config.chart.items.${i.item.id}`),s=o.get("_internal.chart.time.leftGlobal"),r=o.get("_internal.chart.time.timePerPixel"),a=o.get("_internal.elements.gantt").getBoundingClientRect();e.ganttTop=a.top,e.ganttLeft=a.left,e.itemX=(n.time.end-s)/r,e.itemLeftCompensation=t.x-e.ganttLeft-e.itemX}function v(e,n,i,r){if(!t.collisionDetection)return!1;const a=o.get("_internal.chart.time");if(t.outOfBorders&&(i<a.from||r>a.to))return!0;let m=s.time.date(r).diff(i,"milliseconds");if(-1===Math.sign(m)&&(m=-m),m<=1)return!0;const c=o.get("config.list.rows."+e);for(const t of c._internal.items)if(t.id!==n){if(i>=t.time.start&&i<=t.time.end)return!0;if(r>=t.time.start&&r<=t.time.end)return!0;if(i<=t.time.start&&r>=t.time.end)return!0}return!1}function y(e){const n=m(i);let s,r,l,g,f;(n.moving||n.resizing)&&(e.stopPropagation(),s=o.get(`config.chart.items.${i.item.id}`),r=o.get(`config.chart.items.${i.item.id}.rowId`),l=o.get(`config.list.rows.${r}`),g=o.get("config.chart.time.zoom"),f=o.get("_internal.chart.time.timePerPixel"));const p=function(e){let n=t.moveable;return e.item.hasOwnProperty("moveable")&&n&&(n=e.item.moveable),e.row.hasOwnProperty("moveable")&&n&&(n=e.row.moveable),n}(i);if(n.moving){if((!0===p||"x"===p||Array.isArray(p)&&p.includes(r))&&function(t,e,n,s,r){t.stopPropagation();const a=m(i),l=t.x-a.ganttLeft-a.itemLeftCompensation;c(i,t);const g=o.get("_internal.chart.time.leftGlobal")+l*r-n.time.start,f=n.time.start,p=d(i)(n.time.start,g,n)-f,h=v(e.id,n.id,n.time.start+p,n.time.end+p);p&&!h&&o.update(`config.chart.items.${i.item.id}.time`,(function(t){return t.start+=p,t.end=u(i)(t.end,p,n)-1,t}))}(e,l,s,0,f),!p||"x"===p)return;let t=function(t,e,n,s,r){t.stopPropagation(),c(i,t);const a=m(i),l=t.y-a.ganttTop,d=o.get("_internal.list.visibleRows"),u=o.get("config.scroll.compensation");let g=0;for(const t of d){if(t.top+u>l)return g>0?g-1:0;g++}return g}(e);const n=o.get("_internal.list.visibleRows");void 0===n[t]&&(t>0?t=n.length-1:t<0&&(t=0));const a=n[t],g=a.id,h=v(g,s.id,s.time.start,s.time.end);g===s.rowId||h||Array.isArray(p)&&!p.includes(g)||a.hasOwnProperty("moveable")&&!a.moveable||o.update(`config.chart.items.${s.id}.rowId`,g)}else!n.resizing||void 0!==s.resizeable&&!0!==s.resizeable||function(t,e,n,s,r){if(t.stopPropagation(),!a(i))return;const c=o.get("_internal.chart.time"),l=m(i),g=t.x-l.ganttLeft-l.itemLeftCompensation,f=c.leftGlobal+g*r-n.time.end;if(n.time.end+f<n.time.start)return;const p=n.time.end,h=u(i)(n.time.end,f,n)-1-p,y=v(e.id,n.id,n.time.start,n.time.end+h);h&&!y&&o.update(`config.chart.items.${i.item.id}.time`,t=>(t.start=d(i)(t.start,0,n),t.end=u(i)(t.end,h,n)-1,t))}(e,l,s,0,f)}function w(t){const n=m(i);(n.moving||n.resizing)&&t.stopPropagation(),n.moving=!1,n.resizing=!1;for(const t in e)e[t].moving=!1,e[t].resizing=!1,l(t)}return a(i)?f.style.visibility="visible":f.style.visibility="hidden",r.addEventListener("mousedown",p),f.addEventListener("mousedown",h,{capture:!0}),document.addEventListener("mousemove",y,{capture:!0,passive:!0}),document.addEventListener("mouseup",w,{capture:!0,passive:!0}),{update(t,e){a(i=e)?f.style.visibility="visible":f.style.visibility="hidden"},destroy(t,e){r.removeEventListener("mousedown",p),f.removeEventListener("mousedown",h),document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",w),f.remove()}}}return function(t,e){t.update("config.actions.chart-timeline-items-row-item",t=>(t.push(n),t))}}
/**
 * SaveAsImage plugin
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
 * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar
 */function n(t={}){function e(e){const n=e.target,i=n.clientWidth,o=n.clientHeight,s=unescape(encodeURIComponent(n.outerHTML));let r="";for(const t of document.styleSheets)if("gstc"===t.title)for(const e of t.rules)r+=e.cssText;const a=`<svg xmlns="http://www.w3.org/2000/svg" width="${i}" height="${o}" viewBox="0 0 ${i} ${o}">\n      <foreignObject x="0" y="0" width="${i}" height="${o}">\n        <div xmlns="http://www.w3.org/1999/xhtml">\n          ${r=`<style>* {${t.style}} ${r}</style>`}\n          ${s}\n        </div>\n      </foreignObject>\n    </svg>`,m=document.createElement("canvas");m.width=i,m.height=o;const c=m.getContext("2d");c.fillStyle="white",c.fillRect(0,0,i,o);const l="data:image/svg+xml;base64,"+btoa(a),d=new Image;d.onload=function(){c.drawImage(d,0,0),function(t,e){const n=document.createElement("a");n.href=t,n.download=e,document.body.appendChild(n),n.click()}(m.toDataURL("image/jpeg",1),t.filename)},d.src=l}return t={style:"font-family: sans-serif;",filename:"gantt-schedule-timeline-calendar.jpeg",options:t},function(t,n){t.subscribe("_internal.elements.main",t=>{t&&t.addEventListener("save-as-image",e)})}}
/**
 * GridSelection plugin
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
 * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar
 */function i(){return function(t,e){t.update("config.actions.chart-timeline-grid-row-block",t=>t)}}export{i as GridSelection,t as ItemHold,e as ItemMovement,n as SaveAsImage};
//# sourceMappingURL=plugins.js.map
