/**
 * ItemsHold plugin
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0
 */
function e(e={}){e={...{time:1e3,movementThreshold:2,action(e,t){}},...e};const t={},n={x:0,y:0};function i(e){void 0!==t[e]&&delete t[e]}function o(o,s){function r(i){!function(i,o,s){void 0===t[i.id]&&(t[i.id]={x:s.x,y:s.y},setTimeout(()=>{if(void 0!==t[i.id]){let s=!0,r=t[i.id].x-n.x;-1===Math.sign(r)&&(r=-r);let m=t[i.id].y-n.y;-1===Math.sign(m)&&(m=-m),r>e.movementThreshold&&(s=!1),m>e.movementThreshold&&(s=!1),delete t[i.id],s&&e.action(o,i)}},e.time))}(s.item,o,i)}function m(e){n.x=e.x,n.y=e.y}return o.addEventListener("mousedown",r),document.addEventListener("mouseup",(function(){i(s.item.id)})),document.addEventListener("mousemove",m),{destroy(e,t){document.removeEventListener("mouseup",i),document.removeEventListener("mousemove",m),e.removeEventListener("mousedown",r)}}}return function(e,t){e.update("config.actions.chart-timeline-items-row-item",e=>(e.push(o),e))}}
/**
 * ItemMovement plugin
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0
 */function t(e={}){e={moveable:!0,resizeable:!0,resizerContent:"",collisionDetection:!0,outOfBorders:!1,snapStart:(e,t)=>e+t,snapEnd:(e,t)=>e+t,ghostNode:!0,...e};const t={};function n(n,i){const o=n.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content");if(!e.moveable&&!e.resizeable)return;let s=e.moveable;i.item.hasOwnProperty("moveable")&&s&&(s=i.item.moveable),i.row.hasOwnProperty("moveable")&&s&&(s=i.row.moveable);let r=e.resizeable&&(!i.item.hasOwnProperty("resizeable")||!0===i.item.resizeable);i.row.hasOwnProperty("resizeable")&&r&&(r=i.row.resizeable);const m=i.api;let a=e.snapStart;"function"==typeof i.item.snapStart&&(a=item.snapStart);let l=e.snapEnd;if("function"==typeof i.item.snapEnd&&(l=i.item.snapEnd),r){const t=`<div class="${m.getClass("chart-timeline-items-row-item-content-resizer")}">${e.resizerContent}</div>`;o.insertAdjacentHTML("beforeend",t)}const c=o,d=c.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content-resizer"),f=i.state;void 0===t[i.item.id]&&(t[i.item.id]={moving:!1,resizing:!1});const g=t[i.item.id];function u(t){if(e.ghostNode){const e=t.x-g.ganttLeft-g.itemLeftCompensation;g.ghost.style.left=e+"px",g.ghost.style.top=t.y-g.ganttTop-g.itemTop+"px"}}function h(n){e.ghostNode&&(void 0!==t[n]&&void 0!==t[n].ghost&&(f.get("_internal.elements.gantt").removeChild(t[n].ghost),delete t[n].ghost),o.style.opacity="1")}function p(n){if(0!==n.button)return;g.moving=!0;const s=f.get(`config.chart.items.${i.item.id}`),r=f.get("_internal.chart.time.leftGlobal"),m=f.get("_internal.chart.time.timePerPixel"),a=f.get("_internal.elements.gantt").getBoundingClientRect();g.ganttTop=a.top,g.ganttLeft=a.left,g.itemX=Math.round((s.time.start-r)/m),g.itemLeftCompensation=n.x-g.ganttLeft-g.itemX,function(n,s,r,m){if(!e.ghostNode||void 0!==t[n].ghost)return;const a=o.cloneNode(!0),l=getComputedStyle(o);a.style.position="absolute",a.style.left=s.x-r-g.itemLeftCompensation+"px";const c=s.y-m-i.row.top-o.offsetTop;g.itemTop=c,a.style.top=s.y-m-c+"px",a.style.width=l.width,a.style["box-shadow"]="10px 10px 6px #00000020";const d=o.clientHeight+"px";a.style.height=d,a.style["line-height"]=d,a.style.opacity="0.75",f.get("_internal.elements.gantt").appendChild(a),t[n].ghost=a}(i.item.id,n,a.left,a.top)}function v(e){if(0!==e.button)return;e.stopPropagation(),g.resizing=!0;const t=f.get(`config.chart.items.${i.item.id}`),n=f.get("_internal.chart.time.leftGlobal"),o=f.get("_internal.chart.time.timePerPixel"),s=f.get("_internal.elements.gantt").getBoundingClientRect();g.ganttTop=s.top,g.ganttLeft=s.left,g.itemX=(t.time.end-n)/o,g.itemLeftCompensation=e.x-g.ganttLeft-g.itemX}function y(t,n,i,o){if(!e.collisionDetection)return!1;const s=f.get("_internal.chart.time");if(e.outOfBorders&&(i<s.from||o>s.to))return!0;let r=m.time.date(o).diff(i,"milliseconds");if(-1===Math.sign(r)&&(r=-r),r<=1)return!0;const a=f.get("config.list.rows."+t);for(const e of a._internal.items)if(e.id!==n){if(i>=e.time.start&&i<=e.time.end)return!0;if(o>=e.time.start&&o<=e.time.end)return!0;if(i<=e.time.start&&o>=e.time.end)return!0}return!1}function w(e){let t,n,o,r,m;if((g.moving||g.resizing)&&(t=f.get(`config.chart.items.${i.item.id}`),n=f.get(`config.chart.items.${i.item.id}.rowId`),o=f.get(`config.list.rows.${n}`),r=f.get("config.chart.time.zoom"),m=f.get("_internal.chart.time.timePerPixel")),g.moving){if((!0===s||"x"===s||Array.isArray(s)&&s.includes(n))&&function(e,t,n,o,s){const r=e.x-g.ganttLeft-g.itemLeftCompensation;u(e);const m=f.get("_internal.chart.time.leftGlobal")+r*s-n.time.start,c=n.time.start,d=a(n.time.start,m,n)-c,h=y(t.id,n.id,n.time.start+d,n.time.end+d);d&&!h&&f.update(`config.chart.items.${i.item.id}.time`,(function(e){return e.start+=d,e.end=l(e.end,d,n)-1,e}))}(e,o,t,0,m),!s||"x"===s)return;let r=function(e,t,n,i,o){u(e);const s=e.y-g.ganttTop,r=f.get("_internal.list.visibleRows");let m=0;for(const e of r){if(e.top>s)return m>0?m-1:0;m++}return m}(e);const c=f.get("_internal.list.visibleRows");void 0===c[r]&&(r>0?r=c.length-1:r<0&&(r=0));const d=c[r],h=d.id,p=y(h,t.id,t.time.start,t.time.end);h===t.rowId||p||Array.isArray(s)&&!s.includes(h)||d.hasOwnProperty("moveable")&&!d.moveable||f.update(`config.chart.items.${t.id}.rowId`,h)}else!g.resizing||void 0!==t.resizeable&&!0!==t.resizeable||function(e,t,n,o,s){const r=f.get("_internal.chart.time"),m=e.x-g.ganttLeft-g.itemLeftCompensation,c=r.leftGlobal+m*s-n.time.end;if(n.time.end+c<n.time.start)return;const d=n.time.end,u=l(n.time.end,c,n)-1-d,h=y(t.id,n.id,n.time.start,n.time.end+u);u&&!h&&f.update(`config.chart.items.${i.item.id}.time`,e=>(e.start=a(e.start,0,n),e.end=l(e.end,u,n)-1,e))}(e,o,t,0,m)}function b(e){g.moving=!1,g.resizing=!1;for(const e in t)t[e].moving=!1,t[e].resizing=!1,h(e)}return s&&c.addEventListener("mousedown",p),r&&d.addEventListener("mousedown",v),document.addEventListener("mousemove",w),document.addEventListener("mouseup",b),{destroy(e,t){s&&c.removeEventListener("mousedown",p),r&&d.removeEventListener("mousedown",v),document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",b),r&&o.removeChild(d)}}}return function(e,t){e.update("config.actions.chart-timeline-items-row-item",e=>(e.push(n),e))}}
/**
 * SaveAsImage plugin
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0
 */function n(e={}){function t(t){const n=t.target,i=n.clientWidth,o=n.clientHeight,s=unescape(encodeURIComponent(n.outerHTML));let r="";for(const e of document.styleSheets)if("gstc"===e.title)for(const t of e.rules)r+=t.cssText;const m=`<svg xmlns="http://www.w3.org/2000/svg" width="${i}" height="${o}" viewBox="0 0 ${i} ${o}">\n      <foreignObject x="0" y="0" width="${i}" height="${o}">\n        <div xmlns="http://www.w3.org/1999/xhtml">\n          ${r=`<style>* {${e.style}} ${r}</style>`}\n          ${s}\n        </div>\n      </foreignObject>\n    </svg>`,a=document.createElement("canvas");a.width=i,a.height=o;const l=a.getContext("2d");l.fillStyle="white",l.fillRect(0,0,i,o);const c="data:image/svg+xml;base64,"+btoa(m),d=new Image;d.onload=function(){l.drawImage(d,0,0),function(e,t){const n=document.createElement("a");n.href=e,n.download=t,document.body.appendChild(n),n.click()}(a.toDataURL("image/jpeg",1),e.filename)},d.src=c}return e={style:"font-family: sans-serif;",filename:"gantt-schedule-timeline-calendar.jpeg",options:e},function(e,n){e.subscribe("_internal.elements.main",e=>{e&&e.addEventListener("save-as-image",t)})}}export{e as ItemHold,t as ItemMovement,n as SaveAsImage};
//# sourceMappingURL=plugins.js.map
