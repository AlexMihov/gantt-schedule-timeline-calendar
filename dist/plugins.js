/**
 * ItemHold plugin
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
 * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar
 */
function t(t={}){t={...{time:1e3,movementThreshold:2,action(t,e){}},...t};const e={},i={x:0,y:0};function n(t){void 0!==e[t]&&delete e[t]}function o(o,s){function r(n){!function(n,o,s){void 0===e[n.id]&&(e[n.id]={x:s.x,y:s.y},setTimeout(()=>{if(void 0!==e[n.id]){let s=!0,r=e[n.id].x-i.x;-1===Math.sign(r)&&(r=-r);let l=e[n.id].y-i.y;-1===Math.sign(l)&&(l=-l),r>t.movementThreshold&&(s=!1),l>t.movementThreshold&&(s=!1),delete e[n.id],s&&t.action(o,n)}},t.time))}(s.item,o,n)}function l(t){i.x=t.x,i.y=t.y}return o.addEventListener("mousedown",r),document.addEventListener("mouseup",(function(){n(s.item.id)})),document.addEventListener("mousemove",l),{update(t,e){s=e},destroy(t,e){document.removeEventListener("mouseup",n),document.removeEventListener("mousemove",l),t.removeEventListener("mousedown",r)}}}return function(t){t.state.update("config.actions.chart-timeline-items-row-item",t=>(t.push(o),t))}}
/**
 * ItemMovement plugin
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
 * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar
 */function e(t={}){t={moveable:!0,resizeable:!0,resizerContent:"",collisionDetection:!0,outOfBorders:!1,snapStart:(t,e)=>t+e,snapEnd:(t,e)=>t+e,ghostNode:!0,...t};const e={};function i(i,n){let o,s,r=i.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content");if(!t.moveable&&!t.resizeable)return;function l(e){let i=t.resizeable&&(!e.item.hasOwnProperty("resizeable")||!0===e.item.resizeable);return e.row.hasOwnProperty("resizeable")&&i&&(i=e.row.resizeable),i}function c(t){const i=t.item.id;return void 0===e[i]&&(e[i]={moving:!1,resizing:!1}),e[i]}function a(e,i){if(t.ghostNode){const t=c(e),n=i.x-t.ganttLeft-t.itemLeftCompensation,s=o.get("config.scroll.compensation");t.ghost.style.left=n+"px",t.ghost.style.top=i.y-t.ganttTop-t.itemTop+s+"px"}}function m(i){t.ghostNode&&(void 0!==e[i]&&void 0!==e[i].ghost&&(o.get("_internal.elements.chart-timeline").removeChild(e[i].ghost),delete e[i].ghost),r.style.opacity="1")}function d(e){let i=t.snapStart;return"function"==typeof e.item.snapStart&&(i=e.item.snapStart),i}function u(e){let i=t.snapEnd;return"function"==typeof e.item.snapEnd&&(i=e.item.snapEnd),i}o=n.state;const g=`<div class="${(s=n.api).getClass("chart-timeline-items-row-item-content-resizer")}">${t.resizerContent}</div>`;r.insertAdjacentHTML("beforeend",g);const f=r.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content-resizer");function h(e){if(e.stopPropagation(),0!==e.button)return;r=i.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content");const s=c(n);s.moving=!0;const l=o.get(`config.chart.items.${n.item.id}`),a=o.get("_internal.chart.time.leftGlobal"),m=o.get("_internal.chart.time.timePerPixel"),d=o.get("_internal.elements.chart-timeline").getBoundingClientRect();s.ganttTop=d.top,s.ganttLeft=d.left,s.itemX=Math.round((l.time.start-a)/m),s.itemLeftCompensation=e.x-s.ganttLeft-s.itemX,function(e,i,n,s){const l=c(e);if(!t.ghostNode||void 0!==l.ghost)return;const a=r.cloneNode(!0),m=getComputedStyle(r);a.style.position="absolute",a.style.left=i.x-n-l.itemLeftCompensation+"px";const d=i.y-s-e.row.top-r.offsetTop;l.itemTop=d,a.style.top=i.y-s-d+"px",a.style.width=m.width,a.style["box-shadow"]="10px 10px 6px #00000020";const u=r.clientHeight+"px";a.style.height=u,a.style["line-height"]=u,a.style.opacity="0.75",o.get("_internal.elements.chart-timeline").appendChild(a),l.ghost=a}(n,e,d.left,d.top)}function p(t){if(t.stopPropagation(),0!==t.button)return;const e=c(n);e.resizing=!0;const i=o.get(`config.chart.items.${n.item.id}`),s=o.get("_internal.chart.time.leftGlobal"),r=o.get("_internal.chart.time.timePerPixel"),l=o.get("_internal.elements.chart-timeline").getBoundingClientRect();e.ganttTop=l.top,e.ganttLeft=l.left,e.itemX=(i.time.end-s)/r,e.itemLeftCompensation=t.x-e.ganttLeft-e.itemX}function v(e,i,n,r){if(!t.collisionDetection)return!1;const l=o.get("_internal.chart.time");if(t.outOfBorders&&(n<l.from||r>l.to))return!0;let c=s.time.date(r).diff(n,"milliseconds");if(-1===Math.sign(c)&&(c=-c),c<=1)return!0;const a=o.get("config.list.rows."+e);for(const t of a._internal.items)if(t.id!==i){if(n>=t.time.start&&n<=t.time.end)return!0;if(r>=t.time.start&&r<=t.time.end)return!0;if(n<=t.time.start&&r>=t.time.end)return!0}return!1}function y(e){const i=c(n);let s,r,m,g,f;(i.moving||i.resizing)&&(e.stopPropagation(),s=o.get(`config.chart.items.${n.item.id}`),r=o.get(`config.chart.items.${n.item.id}.rowId`),m=o.get(`config.list.rows.${r}`),g=o.get("config.chart.time.zoom"),f=o.get("_internal.chart.time.timePerPixel"));const h=function(e){let i=t.moveable;return e.item.hasOwnProperty("moveable")&&i&&(i=e.item.moveable),e.row.hasOwnProperty("moveable")&&i&&(i=e.row.moveable),i}(n);if(i.moving){if((!0===h||"x"===h||Array.isArray(h)&&h.includes(r))&&function(t,e,i,s,r){t.stopPropagation();const l=c(n),m=t.x-l.ganttLeft-l.itemLeftCompensation;a(n,t);const g=o.get("_internal.chart.time.leftGlobal")+m*r-i.time.start,f=i.time.start,h=d(n)(i.time.start,g,i)-f,p=v(e.id,i.id,i.time.start+h,i.time.end+h);h&&!p&&o.update(`config.chart.items.${n.item.id}.time`,(function(t){return t.start+=h,t.end=u(n)(t.end,h,i)-1,t}))}(e,m,s,0,f),!h||"x"===h)return;let t=function(t,e,i,s,r){t.stopPropagation(),a(n,t);const l=c(n),m=t.y-l.ganttTop,d=o.get("_internal.list.visibleRows"),u=o.get("config.scroll.compensation");let g=0;for(const t of d){if(t.top+u>m)return g>0?g-1:0;g++}return g}(e);const i=o.get("_internal.list.visibleRows");void 0===i[t]&&(t>0?t=i.length-1:t<0&&(t=0));const l=i[t],g=l.id,p=v(g,s.id,s.time.start,s.time.end);g===s.rowId||p||Array.isArray(h)&&!h.includes(g)||l.hasOwnProperty("moveable")&&!l.moveable||o.update(`config.chart.items.${s.id}.rowId`,g)}else!i.resizing||void 0!==s.resizeable&&!0!==s.resizeable||function(t,e,i,s,r){if(t.stopPropagation(),!l(n))return;const a=o.get("_internal.chart.time"),m=c(n),g=t.x-m.ganttLeft-m.itemLeftCompensation,f=a.leftGlobal+g*r-i.time.end;if(i.time.end+f<i.time.start)return;const h=i.time.end,p=u(n)(i.time.end,f,i)-1-h,y=v(e.id,i.id,i.time.start,i.time.end+p);p&&!y&&o.update(`config.chart.items.${n.item.id}.time`,t=>(t.start=d(n)(t.start,0,i),t.end=u(n)(t.end,p,i)-1,t))}(e,m,s,0,f)}function w(t){const i=c(n);(i.moving||i.resizing)&&t.stopPropagation(),i.moving=!1,i.resizing=!1;for(const t in e)e[t].moving=!1,e[t].resizing=!1,m(t)}return l(n)?f.style.visibility="visible":f.style.visibility="hidden",r.addEventListener("mousedown",h),f.addEventListener("mousedown",p,{capture:!0}),document.addEventListener("mousemove",y,{capture:!0,passive:!0}),document.addEventListener("mouseup",w,{capture:!0,passive:!0}),{update(t,e){l(n=e)?f.style.visibility="visible":f.style.visibility="hidden"},destroy(t,e){r.removeEventListener("mousedown",h),f.removeEventListener("mousedown",p),document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",w),f.remove()}}}return function(t){t.state.update("config.actions.chart-timeline-items-row-item",t=>(t.push(i),t))}}
/**
 * SaveAsImage plugin
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
 * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar
 */function i(t={}){function e(e){const i=e.target,n=i.clientWidth,o=i.clientHeight,s=unescape(encodeURIComponent(i.outerHTML));let r="";for(const t of document.styleSheets)if("gstc"===t.title)for(const e of t.rules)r+=e.cssText;const l=`<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${o}" viewBox="0 0 ${n} ${o}">\n      <foreignObject x="0" y="0" width="${n}" height="${o}">\n        <div xmlns="http://www.w3.org/1999/xhtml">\n          ${r=`<style>* {${t.style}} ${r}</style>`}\n          ${s}\n        </div>\n      </foreignObject>\n    </svg>`,c=document.createElement("canvas");c.width=n,c.height=o;const a=c.getContext("2d");a.fillStyle="white",a.fillRect(0,0,n,o);const m="data:image/svg+xml;base64,"+btoa(l),d=new Image;d.onload=function(){a.drawImage(d,0,0),function(t,e){const i=document.createElement("a");i.href=t,i.download=e,document.body.appendChild(i),i.click()}(c.toDataURL("image/jpeg",1),t.filename)},d.src=m}return t={style:"font-family: sans-serif;",filename:"gantt-schedule-timeline-calendar.jpeg",options:t},function(t){t.state.subscribe("_internal.elements.main",t=>{t&&t.addEventListener("save-as-image",e)})}}var n=function(t){var e=[],i=null,n=function(){for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];e=o,i||(i=requestAnimationFrame((function(){i=null,t.apply(void 0,e)})))};return n.cancel=function(){i&&(cancelAnimationFrame(i),i=null)},n};
/**
 * Selection plugin
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
 * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar
 */function o(t={}){let e,i,o;const s={style:{},grid:!1,items:!0,rows:!1,horizontal:!0,vertical:!0,selected(){},deselected(){}};let r,l,c;t={...t,...s};let a={fromX:-1,fromY:-1,toX:-1,toY:-1,startX:-1,startY:-1,selecting:!1};const m="config.plugin.selection",d="gantt-schedule-timeline-caledar__plugin-selection-rect",u=document.createElement("div");u.classList.add(d),u.style.visibility="hidden",u.style.left="0px",u.style.top="0px",u.style.width="0px",u.style.height="0px",u.style.background="rgba(0, 119, 192, 0.2)",u.style.border="2px dashed rgba(0, 119, 192, 0.75)",u.style.position="absolute",u.style["user-select"]="none",u.style["pointer-events"]="none";for(const e in t.style)u.style[e]=t.style[e];function g(t,o){if(!(r=i.get("_internal.elements.chart-timeline")).querySelector("."+d)){r.insertAdjacentElement("beforeend",u);const t=r.getBoundingClientRect();c=t.left,l=t.top}function s(t){0===t.button&&(a.selecting=!0,a.fromX=t.x-c,a.fromY=t.y-l,a.startX=a.fromX,a.startY=a.fromY,i.update(m,{selecting:{"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]},selcted:{"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]}}),i.update("_internal.chart.grid.rowsWithBlocks",t=>{for(const e of t)for(const t of e.blocks)t.selected=!1,t.selecting=!1;return t}),e.update())}function g(t,e){let i=!1,n=!1;return(t.left>=e.left&&t.left<=e.right||t.right>=e.left&&t.right<=e.right||t.left<=e.left&&t.right>=e.right)&&(i=!0),(t.top>=e.top&&t.top<=e.bottom||t.bottom>=e.top&&t.bottom<=e.bottom||t.top<=e.top&&t.bottom>=e.bottom)&&(n=!0),i&&n}function f(t){if(!a.selecting)return;if(t.x-c===a.fromX||t.y-l===a.fromY)return;t.stopPropagation(),function(t){const e=t.x-c,i=t.y-l;e<=a.startX?(a.fromX=e,a.toX=a.startX):(a.fromX=a.startX,a.toX=e),i<=a.startY?(a.fromY=i,a.toY=a.startY):(a.fromY=a.startY,a.toY=i)}(t),u.style.left=a.fromX+"px",u.style.top=a.fromY+"px",u.style.visibility="visible",u.style.width=a.toX-a.fromX+"px",u.style.height=a.toY-a.fromY+"px";const e=function(t,e,n){const o=[],s=e[n+"s"];for(const e of s){g(e.getBoundingClientRect(),t)&&o.push(e.vido.id)}const r=i.get(`${m}.selecting.${n}s`);for(const t of r);return o}(u.getBoundingClientRect(),i.get("_internal.elements"),"chart-timeline-grid-row-block");i.update(`${m}.selecting`,{"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":e,"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]}),i.update("_internal.chart.grid.rowsWithBlocks",t=>{for(const i of t)for(const t of i.blocks)e.includes(t.id)?t.selecting=!0:t.selecting=!1;return t})}function h(t){if(!a.selecting)return;t.stopPropagation(),a.selecting=!1,u.style.visibility="hidden";const e={};i.update(m,t=>(e.selected={...t.selecting},e.selecting={"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]},e));const n=e.selected;i.update("_internal.chart.grid.rowsWithBlocks",t=>{for(const e of t)for(const t of e.blocks)n["chart-timeline-grid-row-blocks"].includes(t.id)?t.selected=!0:t.selected=!1;return t})}return t.addEventListener("mousedown",s),t.addEventListener("mousemove",n(f)),document.body.addEventListener("mouseup",h),{destroy(){document.body.removeEventListener("mouseup",h),t.removeEventListener("mousemove",f),t.removeEventListener("mousedown",s)}}}function f(t,e){const i=o.getClass("chart-timeline-grid-row-block")+"--selecting",n=o.getClass("chart-timeline-grid-row-block")+"--selected";return e.selecting?t.classList.add(i):t.classList.remove(i),e.selected?t.classList.add(n):t.classList.remove(n),{update(t,e){e.selecting?t.classList.add(i):t.classList.remove(i),e.selected?t.classList.add(n):t.classList.remove(n)},destroy(t,e){t.classList.remove(i),t.classList.remove(n)}}}function h(t){return i.get("config.plugin.selection").selected["chart-timeline-grid-row-blocks"].find(e=>e===t.id)?t.selected=!0:t.selected=!1,t}return function(t){i=(e=t).state,o=e.api,void 0===i.get(m)&&i.update(m,{selecting:{"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]},selected:{"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]}}),i.update("config.actions.chart-timeline",t=>(t.push(g),t)),i.update("config.actions.chart-timeline-grid-row-block",t=>(t.push(f),t)),i.update("config.chart.grid.block.onCreate",t=>(t.push(h),t))}}export{t as ItemHold,e as ItemMovement,i as SaveAsImage,o as Selection};
//# sourceMappingURL=plugins.js.map
