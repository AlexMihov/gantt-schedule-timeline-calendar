/**
 * Gantt-Schedule-Timeline-Calendar
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0
 */
function t(t={}){t={...{time:1e3,movementThreshold:2,action(t,e){}},...t};const e={},n={x:0,y:0};const i=[],o=[];function s(s,r){function a(){var t;t=r.item.id,void 0!==e[t]&&delete e[t]}function m(t){n.x=t.x,n.y=t.y}return s.addEventListener("mousedown",i=>{!function(i,o,s){void 0===e[i.id]&&(e[i.id]={x:s.x,y:s.y},setTimeout(()=>{if(void 0!==e[i.id]){let s=!0,r=e[i.id].x-n.x;-1===Math.sign(r)&&(r=-r);let a=e[i.id].y-n.y;-1===Math.sign(a)&&(a=-a),r>t.movementThreshold&&(s=!1),a>t.movementThreshold&&(s=!1),delete e[i.id],s&&t.action(o,i)}},t.time))}(r.item,s,i)}),i.push(a),document.addEventListener("mouseup",a),o.push(m),document.addEventListener("mousemove",m),{destroy(t,e){i.forEach(t=>document.removeEventListener("mouseup",t)),o.forEach(t=>document.removeEventListener("mousemove",t))}}}return function(t,e){t.update("config.actions.chart-gantt-items-row-item",t=>(t.push(s),t))}}
/**
 * Gantt-Schedule-Timeline-Calendar
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0
 */function e(t={}){(t={moveable:!0,resizeable:!0,resizerContent:"",collisionDetection:!0,outOfBorders:!1,snapStart:[],snapEnd:[],ghostNode:!0,...t}).snapStart=t.snapStart.slice(),t.snapEnd=t.snapEnd.slice();const e={};function n(n,i){const o=n.querySelector(".gantt-schedule-timeline-calendar__chart-gantt-items-row-item-content");if(!t.moveable&&!t.resizeable)return;let s=t.moveable;i.item.hasOwnProperty("moveable")&&s&&(s=i.item.moveable),i.row.hasOwnProperty("moveable")&&s&&(s=i.row.moveable);let r=t.resizeable&&(!i.item.hasOwnProperty("resizeable")||!0===i.item.resizeable);i.row.hasOwnProperty("resizeable")&&r&&(r=i.row.resizeable);const a=i.api;let m=t.snapStart;void 0!==i.item.snapStart&&Array.isArray(i.item.snapStart)&&(m=item.snapStart);let d=t.snapEnd;if(void 0!==i.item.snapEnd&&Array.isArray(i.item.snapEnd)&&(d=i.item.snapEnd),r){const e=`<div class="${a.getClass("chart-gantt-items-row-item-content-resizer")}">${t.resizerContent}</div>`;o.insertAdjacentHTML("beforeend",e)}const l=o,c=l.querySelector(".gantt-schedule-timeline-calendar__chart-gantt-items-row-item-content-resizer"),g=i.state;void 0===e[i.item.id]&&(e[i.item.id]={moving:!1,resizing:!1});const f=e[i.item.id];function u(e){if(t.ghostNode){const t=e.x-f.ganttLeft-f.itemLeftCompensation;f.ghost.style.left=t+"px",f.ghost.style.top=e.y-f.ganttTop-f.itemTop+"px"}}function h(n){t.ghostNode&&(void 0!==e[n]&&void 0!==e[n].ghost&&(g.get("_internal.elements.gantt").removeChild(e[n].ghost),delete e[n].ghost),o.style.opacity="1")}function p(n){if(0!==n.button)return;f.moving=!0;const s=g.get(`config.chart.items.${i.item.id}`),r=g.get("_internal.chart.time.leftGlobal"),a=g.get("_internal.chart.time.timePerPixel"),m=g.get("_internal.elements.gantt").getBoundingClientRect();f.ganttTop=m.top,f.ganttLeft=m.left,f.itemX=Math.round((s.time.start-r)/a),f.itemLeftCompensation=n.x-f.ganttLeft-f.itemX,function(n,s,r,a){if(!t.ghostNode||void 0!==e[n].ghost)return;const m=o.cloneNode(!0),d=getComputedStyle(o);m.style.position="absolute",m.style.left=s.x-r-f.itemLeftCompensation+"px";const l=s.y-a-i.row.top-o.offsetTop;f.itemTop=l,m.style.top=s.y-a-l+"px",m.style.width=d.width,m.style["box-shadow"]="10px 10px 6px #00000020";const c=o.clientHeight+"px";m.style.height=c,m.style["line-height"]=c,m.style.opacity="0.75",g.get("_internal.elements.gantt").appendChild(m),e[n].ghost=m}(i.item.id,n,m.left,m.top)}function v(t){if(0!==t.button)return;t.stopPropagation(),f.resizing=!0;const e=g.get(`config.chart.items.${i.item.id}`),n=g.get("_internal.chart.time.leftGlobal"),o=g.get("_internal.chart.time.timePerPixel"),s=g.get("_internal.elements.gantt").getBoundingClientRect();f.ganttTop=s.top,f.ganttLeft=s.left,f.itemX=(e.time.end-n)/o,f.itemLeftCompensation=t.x-f.ganttLeft-f.itemX}function y(e,n,i,o){if(!t.collisionDetection)return!1;const s=g.get("_internal.chart.time");if(t.outOfBorders&&(i<s.from||o>s.to))return!0;let r=a.time.date(o).diff(i,"milliseconds");if(-1===Math.sign(r)&&(r=-r),r<=1)return!0;const m=g.get("config.list.rows."+e);for(const t of m._internal.items)if(t.id!==n){if(i>=t.time.start&&i<=t.time.end)return!0;if(o>=t.time.start&&o<=t.time.end)return!0;if(i<=t.time.start&&o>=t.time.end)return!0}return!1}function w(t,e,n=0,i=[]){let o=Number.MAX_SAFE_INTEGER,s=0;for(let n of i){let i=e.clone().add(t,"milliseconds").diff(n,"milliseconds");-1===Math.sign(i)&&(i=-i),i<o&&(o=i,s=n)}return s+=n,a.time.date(s)}function b(t){let e,n,o,r,a;if((f.moving||f.resizing)&&(e=g.get(`config.chart.items.${i.item.id}`),n=g.get(`config.chart.items.${i.item.id}.rowId`),o=g.get(`config.list.rows.${n}`),r=g.get("config.chart.time.zoom"),a=g.get("_internal.chart.time.timePerPixel")),f.moving){if((!0===s||"x"===s||Array.isArray(s)&&s.includes(n))&&function(t,e,n,o,s){const r=t.x-f.ganttLeft-f.itemLeftCompensation;u(t);const a=g.get("_internal.chart.time.leftGlobal")+r*s-n.time.start,d=n.time.start,l=w(a,i.api.time.date(n.time.start),0,m)-d,c=y(e.id,n.id,n.time.start+l,n.time.end+l);l&&!c&&g.update(`config.chart.items.${i.item.id}.time`,(function(t){return t.start+=l,t.end+=l,t}))}(t,o,e,0,a),!s||"x"===s)return;let r=function(t,e,n,i,o){u(t);const s=t.y-f.ganttTop,r=g.get("_internal.list.visibleRows");let a=0;for(const t of r){if(t.top>s)return a>0?a-1:0;a++}return a}(t);const d=g.get("_internal.list.visibleRows");void 0===d[r]&&(r>0?r=d.length-1:r<0&&(r=0));const l=d[r],c=l.id,h=y(c,e.id,e.time.start,e.time.end);c===e.rowId||h||Array.isArray(s)&&!s.includes(c)||l.hasOwnProperty("moveable")&&!l.moveable||g.update(`config.chart.items.${e.id}.rowId`,c)}else!f.resizing||void 0!==e.resizeable&&!0!==e.resizeable||function(t,e,n,o,s){const r=g.get("_internal.chart.time"),a=t.x-f.ganttLeft-f.itemLeftCompensation,m=r.leftGlobal+a*s-n.time.end;if(n.time.end+m<n.time.start)return;const l=n.time.end,c=w(m,i.api.time.date(n.time.end),-1,d)-l,u=y(e.id,n.id,n.time.start,n.time.end+c);c&&!u&&g.update(`config.chart.items.${i.item.id}.time.end`,(function(t){return t+c}))}(t,o,e,0,a)}function x(t){f.moving=!1,f.resizing=!1;for(const t in e)e[t].moving=!1,e[t].resizing=!1,h(t)}return s&&l.addEventListener("mousedown",p),r&&c.addEventListener("mousedown",v),document.addEventListener("mousemove",b),document.addEventListener("mouseup",x),{destroy(t,e){s&&l.removeEventListener("moudedown",p),r&&c.removeEventListener("mousedown",v),document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",x),r&&o.removeChild(c)}}}return function(t,e){t.update("config.actions.chart-gantt-items-row-item",t=>(t.push(n),t))}}
/**
 * Gantt-Schedule-Timeline-Calendar
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0
 */function n(t={}){function e(e){const n=e.target,i=n.clientWidth,o=n.clientHeight,s=unescape(encodeURIComponent(n.outerHTML));let r="";for(const t of document.styleSheets)if("gstc"===t.title)for(const e of t.rules)r+=e.cssText;const a=`<svg xmlns="http://www.w3.org/2000/svg" width="${i}" height="${o}" viewBox="0 0 ${i} ${o}">\n      <foreignObject x="0" y="0" width="${i}" height="${o}">\n        <div xmlns="http://www.w3.org/1999/xhtml">\n          ${r=`<style>* {${t.style}} ${r}</style>`}\n          ${s}\n        </div>\n      </foreignObject>\n    </svg>`,m=document.createElement("canvas");m.width=i,m.height=o;const d=m.getContext("2d");d.fillStyle="white",d.fillRect(0,0,i,o);const l="data:image/svg+xml;base64,"+btoa(a),c=new Image;c.onload=function(){d.drawImage(c,0,0),function(t,e){const n=document.createElement("a");n.href=t,n.download=e,document.body.appendChild(n),n.click()}(m.toDataURL("image/jpeg",1),t.filename)},c.src=l}return t={style:"font-family: sans-serif;",filename:"gantt-schedule-timeline-calendar.jpeg",options:t},function(t,n){t.subscribe("_internal.elements.main",t=>{t&&t.addEventListener("save-as-image",e)})}}export{t as ItemHold,e as ItemMovement,n as SaveAsImage};
//# sourceMappingURL=plugins.js.map
