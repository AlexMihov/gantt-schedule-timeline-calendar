/**
 * ItemHold plugin
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
 * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar
 */
function t(t={}){t={...{time:1e3,movementThreshold:2,action(t,e){}},...t};const e={},n={x:0,y:0};function i(t){void 0!==e[t]&&delete e[t]}function o(o,s){function r(i){!function(i,o,s){void 0===e[i.id]&&(e[i.id]={x:s.x,y:s.y},setTimeout(()=>{if(void 0!==e[i.id]){let s=!0,r=e[i.id].x-n.x;-1===Math.sign(r)&&(r=-r);let a=e[i.id].y-n.y;-1===Math.sign(a)&&(a=-a),r>t.movementThreshold&&(s=!1),a>t.movementThreshold&&(s=!1),delete e[i.id],s&&t.action(o,i)}},t.time))}(s.item,o,i)}function a(t){n.x=t.x,n.y=t.y}return o.addEventListener("mousedown",r),document.addEventListener("mouseup",(function(){i(s.item.id)})),document.addEventListener("mousemove",a),{update(t,e){s=e},destroy(t,e){document.removeEventListener("mouseup",i),document.removeEventListener("mousemove",a),t.removeEventListener("mousedown",r)}}}return function(t,e){t.update("config.actions.chart-timeline-items-row-item",t=>(t.push(o),t))}}
/**
 * ItemMovement plugin
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
 * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar
 */function e(t={}){t={moveable:!0,resizeable:!0,resizerContent:"",collisionDetection:!0,outOfBorders:!1,snapStart:(t,e)=>t+e,snapEnd:(t,e)=>t+e,ghostNode:!0,...t};const e={};function n(n,i){let o,s,r=n.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content");if(!t.moveable&&!t.resizeable)return;function a(e){let n=t.resizeable&&(!e.item.hasOwnProperty("resizeable")||!0===e.item.resizeable);return e.row.hasOwnProperty("resizeable")&&n&&(n=e.row.resizeable),n}function m(t){const n=t.item.id;return void 0===e[n]&&(e[n]={moving:!1,resizing:!1}),e[n]}function l(e,n){if(t.ghostNode){const t=m(e),i=n.x-t.ganttLeft-t.itemLeftCompensation,s=o.get("config.scroll.compensation");t.ghost.style.left=i+"px",t.ghost.style.top=n.y-t.ganttTop-t.itemTop+s+"px"}}function c(n){t.ghostNode&&(void 0!==e[n]&&void 0!==e[n].ghost&&(o.get("_internal.elements.chart-timeline").removeChild(e[n].ghost),delete e[n].ghost),r.style.opacity="1")}function d(e){let n=t.snapStart;return"function"==typeof e.item.snapStart&&(n=e.item.snapStart),n}function u(e){let n=t.snapEnd;return"function"==typeof e.item.snapEnd&&(n=e.item.snapEnd),n}o=i.state;const f=`<div class="${(s=i.api).getClass("chart-timeline-items-row-item-content-resizer")}">${t.resizerContent}</div>`;r.insertAdjacentHTML("beforeend",f);const g=r.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content-resizer");function p(e){if(e.stopPropagation(),0!==e.button)return;r=n.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content");const s=m(i);s.moving=!0;const a=o.get(`config.chart.items.${i.item.id}`),l=o.get("_internal.chart.time.leftGlobal"),c=o.get("_internal.chart.time.timePerPixel"),d=o.get("_internal.elements.chart-timeline").getBoundingClientRect();s.ganttTop=d.top,s.ganttLeft=d.left,s.itemX=Math.round((a.time.start-l)/c),s.itemLeftCompensation=e.x-s.ganttLeft-s.itemX,function(e,n,i,s){const a=m(e);if(!t.ghostNode||void 0!==a.ghost)return;const l=r.cloneNode(!0),c=getComputedStyle(r);l.style.position="absolute",l.style.left=n.x-i-a.itemLeftCompensation+"px";const d=n.y-s-e.row.top-r.offsetTop;a.itemTop=d,l.style.top=n.y-s-d+"px",l.style.width=c.width,l.style["box-shadow"]="10px 10px 6px #00000020";const u=r.clientHeight+"px";l.style.height=u,l.style["line-height"]=u,l.style.opacity="0.75",o.get("_internal.elements.chart-timeline").appendChild(l),a.ghost=l}(i,e,d.left,d.top)}function h(t){if(t.stopPropagation(),0!==t.button)return;const e=m(i);e.resizing=!0;const n=o.get(`config.chart.items.${i.item.id}`),s=o.get("_internal.chart.time.leftGlobal"),r=o.get("_internal.chart.time.timePerPixel"),a=o.get("_internal.elements.chart-timeline").getBoundingClientRect();e.ganttTop=a.top,e.ganttLeft=a.left,e.itemX=(n.time.end-s)/r,e.itemLeftCompensation=t.x-e.ganttLeft-e.itemX}function v(e,n,i,r){if(!t.collisionDetection)return!1;const a=o.get("_internal.chart.time");if(t.outOfBorders&&(i<a.from||r>a.to))return!0;let m=s.time.date(r).diff(i,"milliseconds");if(-1===Math.sign(m)&&(m=-m),m<=1)return!0;const l=o.get("config.list.rows."+e);for(const t of l._internal.items)if(t.id!==n){if(i>=t.time.start&&i<=t.time.end)return!0;if(r>=t.time.start&&r<=t.time.end)return!0;if(i<=t.time.start&&r>=t.time.end)return!0}return!1}function y(e){const n=m(i);let s,r,c,f,g;(n.moving||n.resizing)&&(e.stopPropagation(),s=o.get(`config.chart.items.${i.item.id}`),r=o.get(`config.chart.items.${i.item.id}.rowId`),c=o.get(`config.list.rows.${r}`),f=o.get("config.chart.time.zoom"),g=o.get("_internal.chart.time.timePerPixel"));const p=function(e){let n=t.moveable;return e.item.hasOwnProperty("moveable")&&n&&(n=e.item.moveable),e.row.hasOwnProperty("moveable")&&n&&(n=e.row.moveable),n}(i);if(n.moving){if((!0===p||"x"===p||Array.isArray(p)&&p.includes(r))&&function(t,e,n,s,r){t.stopPropagation();const a=m(i),c=t.x-a.ganttLeft-a.itemLeftCompensation;l(i,t);const f=o.get("_internal.chart.time.leftGlobal")+c*r-n.time.start,g=n.time.start,p=d(i)(n.time.start,f,n)-g,h=v(e.id,n.id,n.time.start+p,n.time.end+p);p&&!h&&o.update(`config.chart.items.${i.item.id}.time`,(function(t){return t.start+=p,t.end=u(i)(t.end,p,n)-1,t}))}(e,c,s,0,g),!p||"x"===p)return;let t=function(t,e,n,s,r){t.stopPropagation(),l(i,t);const a=m(i),c=t.y-a.ganttTop,d=o.get("_internal.list.visibleRows"),u=o.get("config.scroll.compensation");let f=0;for(const t of d){if(t.top+u>c)return f>0?f-1:0;f++}return f}(e);const n=o.get("_internal.list.visibleRows");void 0===n[t]&&(t>0?t=n.length-1:t<0&&(t=0));const a=n[t],f=a.id,h=v(f,s.id,s.time.start,s.time.end);f===s.rowId||h||Array.isArray(p)&&!p.includes(f)||a.hasOwnProperty("moveable")&&!a.moveable||o.update(`config.chart.items.${s.id}.rowId`,f)}else!n.resizing||void 0!==s.resizeable&&!0!==s.resizeable||function(t,e,n,s,r){if(t.stopPropagation(),!a(i))return;const l=o.get("_internal.chart.time"),c=m(i),f=t.x-c.ganttLeft-c.itemLeftCompensation,g=l.leftGlobal+f*r-n.time.end;if(n.time.end+g<n.time.start)return;const p=n.time.end,h=u(i)(n.time.end,g,n)-1-p,y=v(e.id,n.id,n.time.start,n.time.end+h);h&&!y&&o.update(`config.chart.items.${i.item.id}.time`,t=>(t.start=d(i)(t.start,0,n),t.end=u(i)(t.end,h,n)-1,t))}(e,c,s,0,g)}function b(t){const n=m(i);(n.moving||n.resizing)&&t.stopPropagation(),n.moving=!1,n.resizing=!1;for(const t in e)e[t].moving=!1,e[t].resizing=!1,c(t)}return a(i)?g.style.visibility="visible":g.style.visibility="hidden",r.addEventListener("mousedown",p),g.addEventListener("mousedown",h,{capture:!0}),document.addEventListener("mousemove",y,{capture:!0,passive:!0}),document.addEventListener("mouseup",b,{capture:!0,passive:!0}),{update(t,e){a(i=e)?g.style.visibility="visible":g.style.visibility="hidden"},destroy(t,e){r.removeEventListener("mousedown",p),g.removeEventListener("mousedown",h),document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",b),g.remove()}}}return function(t,e){t.update("config.actions.chart-timeline-items-row-item",t=>(t.push(n),t))}}
/**
 * SaveAsImage plugin
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
 * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar
 */function n(t={}){function e(e){const n=e.target,i=n.clientWidth,o=n.clientHeight,s=unescape(encodeURIComponent(n.outerHTML));let r="";for(const t of document.styleSheets)if("gstc"===t.title)for(const e of t.rules)r+=e.cssText;const a=`<svg xmlns="http://www.w3.org/2000/svg" width="${i}" height="${o}" viewBox="0 0 ${i} ${o}">\n      <foreignObject x="0" y="0" width="${i}" height="${o}">\n        <div xmlns="http://www.w3.org/1999/xhtml">\n          ${r=`<style>* {${t.style}} ${r}</style>`}\n          ${s}\n        </div>\n      </foreignObject>\n    </svg>`,m=document.createElement("canvas");m.width=i,m.height=o;const l=m.getContext("2d");l.fillStyle="white",l.fillRect(0,0,i,o);const c="data:image/svg+xml;base64,"+btoa(a),d=new Image;d.onload=function(){l.drawImage(d,0,0),function(t,e){const n=document.createElement("a");n.href=t,n.download=e,document.body.appendChild(n),n.click()}(m.toDataURL("image/jpeg",1),t.filename)},d.src=c}return t={style:"font-family: sans-serif;",filename:"gantt-schedule-timeline-calendar.jpeg",options:t},function(t,n){t.subscribe("_internal.elements.main",t=>{t&&t.addEventListener("save-as-image",e)})}}var i=function(t){var e=[],n=null,i=function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];e=o,n||(n=requestAnimationFrame((function(){n=null,t.apply(void 0,e)})))};return i.cancel=function(){n&&(cancelAnimationFrame(n),n=null)},i};
/**
 * Selection plugin
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
 * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar
 */function o(t={}){let e,n,o,s;t={...t,style:{},grid:!1,items:!0,rows:!1};let r={fromX:-1,fromY:-1,toX:-1,toY:-1,startX:-1,startY:-1,data:[],elements:[]};const a="config.plugins.selection",m="gantt-schedule-timeline-caledar__plugin-selection-rect",l=document.createElement("div");l.classList.add(m),l.style.visibility="hidden",l.style.left="0px",l.style.top="0px",l.style.width="0px",l.style.height="0px",l.style.background="rgba(0, 119, 192,0.2)",l.style.border="2px dashed rgba(0, 119, 192,1)",l.style.position="absolute",l.style["user-select"]="none",l.style["pointer-events"]="none";for(const e in t.style)l.style[e]=t.style[e];function c(t,c){if(!(n=e.get("_internal.elements.chart-timeline")).querySelector("."+m)){n.insertAdjacentElement("beforeend",l);const t=n.getBoundingClientRect();s=t.left,o=t.top}function d(t){0===t.button&&(r.fromX=t.x-s,r.fromY=t.y-o,r.startX=r.fromX,r.startY=r.fromY)}function u(t){-1===r.fromX&&-1===r.fromY||t.x-s!==r.fromX&&t.y-o!==r.fromY&&(t.stopPropagation(),function(t){const e=t.x-s,n=t.y-o;e<=r.startX?(r.fromX=e,r.toX=r.startX):(r.fromX=r.startX,r.toX=e),n<=r.startY?(r.fromY=n,r.toY=r.startY):(r.fromY=r.startY,r.toY=n)}(t),l.style.left=r.fromX+"px",l.style.top=r.fromY+"px",l.style.visibility="visible",l.style.width=r.toX-r.fromX+"px",l.style.height=r.toY-r.fromY+"px",e.get(`${a}.selecting`)||e.update(`${a}.selecting`,!0))}function f(t){-1!==r.fromX&&-1!==r.fromY&&t.stopPropagation(),r.fromX=-1,r.fromY=-1,r.startX=-1,r.startY=-1,r.data=[],r.elements=[],l.style.visibility="hidden",e.update(`${a}.selecting`,!1)}return t.addEventListener("mousedown",d),document.body.addEventListener("mousemove",i(u)),document.body.addEventListener("mouseup",f),{update(t,e){},destroy(){document.body.removeEventListener("mouseup",f),document.body.removeEventListener("mousemove",u),t.removeEventListener("mousedown",d)}}}return function(t,n){void 0===(e=t).get(a)&&e.update(a,{selecting:!1,selected:[]}),e.update("config.actions.chart-timeline",t=>(t.push(c),t))}}export{t as ItemHold,e as ItemMovement,n as SaveAsImage,o as Selection};
//# sourceMappingURL=plugins.js.map
