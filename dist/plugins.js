/**
 * Gantt-Schedule-Timeline-Calendar
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0
 */
function e(e={}){e={...{time:1e3,movementThreshold:2,action(e,t){}},...e};const t={},n={x:0,y:0};const i=[],o=[];function s(s,r){function a(){var e;e=r.item.id,void 0!==t[e]&&delete t[e]}function m(e){n.x=e.x,n.y=e.y}return s.addEventListener("mousedown",i=>{!function(i,o,s){void 0===t[i.id]&&(t[i.id]={x:s.x,y:s.y},setTimeout(()=>{if(void 0!==t[i.id]){let s=!0,r=t[i.id].x-n.x;-1===Math.sign(r)&&(r=-r);let a=t[i.id].y-n.y;-1===Math.sign(a)&&(a=-a),r>e.movementThreshold&&(s=!1),a>e.movementThreshold&&(s=!1),delete t[i.id],s&&e.action(o,i)}},e.time))}(r.item,s,i)}),i.push(a),document.addEventListener("mouseup",a),o.push(m),document.addEventListener("mousemove",m),{destroy(e,t){i.forEach(e=>document.removeEventListener("mouseup",e)),o.forEach(e=>document.removeEventListener("mousemove",e))}}}return function(e,t){e.update("config.actions.chart-timeline-items-row-item",e=>(e.push(s),e))}}
/**
 * Gantt-Schedule-Timeline-Calendar
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0
 */function t(e={}){(e={moveable:!0,resizeable:!0,resizerContent:"",collisionDetection:!0,outOfBorders:!1,snapStart:[],snapEnd:[],ghostNode:!0,...e}).snapStart=e.snapStart.slice(),e.snapEnd=e.snapEnd.slice();const t={};function n(n,i){const o=n.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content");if(!e.moveable&&!e.resizeable)return;let s=e.moveable;i.item.hasOwnProperty("moveable")&&s&&(s=i.item.moveable),i.row.hasOwnProperty("moveable")&&s&&(s=i.row.moveable);let r=e.resizeable&&(!i.item.hasOwnProperty("resizeable")||!0===i.item.resizeable);i.row.hasOwnProperty("resizeable")&&r&&(r=i.row.resizeable);const a=i.api;let m=e.snapStart;void 0!==i.item.snapStart&&Array.isArray(i.item.snapStart)&&(m=item.snapStart);let l=e.snapEnd;if(void 0!==i.item.snapEnd&&Array.isArray(i.item.snapEnd)&&(l=i.item.snapEnd),r){const t=`<div class="${a.getClass("chart-timeline-items-row-item-content-resizer")}">${e.resizerContent}</div>`;o.insertAdjacentHTML("beforeend",t)}const d=o,c=d.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content-resizer"),f=i.state;void 0===t[i.item.id]&&(t[i.item.id]={moving:!1,resizing:!1});const g=t[i.item.id];function u(t){if(e.ghostNode){const e=t.x-g.ganttLeft-g.itemLeftCompensation;g.ghost.style.left=e+"px",g.ghost.style.top=t.y-g.ganttTop-g.itemTop+"px"}}function h(n){e.ghostNode&&(void 0!==t[n]&&void 0!==t[n].ghost&&(f.get("_internal.elements.gantt").removeChild(t[n].ghost),delete t[n].ghost),o.style.opacity="1")}function p(n){if(0!==n.button)return;g.moving=!0;const s=f.get(`config.chart.items.${i.item.id}`),r=f.get("_internal.chart.time.leftGlobal"),a=f.get("_internal.chart.time.timePerPixel"),m=f.get("_internal.elements.gantt").getBoundingClientRect();g.ganttTop=m.top,g.ganttLeft=m.left,g.itemX=Math.round((s.time.start-r)/a),g.itemLeftCompensation=n.x-g.ganttLeft-g.itemX,function(n,s,r,a){if(!e.ghostNode||void 0!==t[n].ghost)return;const m=o.cloneNode(!0),l=getComputedStyle(o);m.style.position="absolute",m.style.left=s.x-r-g.itemLeftCompensation+"px";const d=s.y-a-i.row.top-o.offsetTop;g.itemTop=d,m.style.top=s.y-a-d+"px",m.style.width=l.width,m.style["box-shadow"]="10px 10px 6px #00000020";const c=o.clientHeight+"px";m.style.height=c,m.style["line-height"]=c,m.style.opacity="0.75",f.get("_internal.elements.gantt").appendChild(m),t[n].ghost=m}(i.item.id,n,m.left,m.top)}function v(e){if(0!==e.button)return;e.stopPropagation(),g.resizing=!0;const t=f.get(`config.chart.items.${i.item.id}`),n=f.get("_internal.chart.time.leftGlobal"),o=f.get("_internal.chart.time.timePerPixel"),s=f.get("_internal.elements.gantt").getBoundingClientRect();g.ganttTop=s.top,g.ganttLeft=s.left,g.itemX=(t.time.end-n)/o,g.itemLeftCompensation=e.x-g.ganttLeft-g.itemX}function y(t,n,i,o){if(!e.collisionDetection)return!1;const s=f.get("_internal.chart.time");if(e.outOfBorders&&(i<s.from||o>s.to))return!0;let r=a.time.date(o).diff(i,"milliseconds");if(-1===Math.sign(r)&&(r=-r),r<=1)return!0;const m=f.get("config.list.rows."+t);for(const e of m._internal.items)if(e.id!==n){if(i>=e.time.start&&i<=e.time.end)return!0;if(o>=e.time.start&&o<=e.time.end)return!0;if(i<=e.time.start&&o>=e.time.end)return!0}return!1}function w(e,t,n=0,i=[]){let o=Number.MAX_SAFE_INTEGER,s=0;for(let n of i){let i=t.clone().add(e,"milliseconds").diff(n,"milliseconds");-1===Math.sign(i)&&(i=-i),i<o&&(o=i,s=n)}return s+=n,a.time.date(s)}function b(e){let t,n,o,r,a;if((g.moving||g.resizing)&&(t=f.get(`config.chart.items.${i.item.id}`),n=f.get(`config.chart.items.${i.item.id}.rowId`),o=f.get(`config.list.rows.${n}`),r=f.get("config.chart.time.zoom"),a=f.get("_internal.chart.time.timePerPixel")),g.moving){if((!0===s||"x"===s||Array.isArray(s)&&s.includes(n))&&function(e,t,n,o,s){const r=e.x-g.ganttLeft-g.itemLeftCompensation;u(e);const a=f.get("_internal.chart.time.leftGlobal")+r*s-n.time.start,l=n.time.start,d=w(a,i.api.time.date(n.time.start),0,m)-l,c=y(t.id,n.id,n.time.start+d,n.time.end+d);d&&!c&&f.update(`config.chart.items.${i.item.id}.time`,(function(e){return e.start+=d,e.end+=d,e}))}(e,o,t,0,a),!s||"x"===s)return;let r=function(e,t,n,i,o){u(e);const s=e.y-g.ganttTop,r=f.get("_internal.list.visibleRows");let a=0;for(const e of r){if(e.top>s)return a>0?a-1:0;a++}return a}(e);const l=f.get("_internal.list.visibleRows");void 0===l[r]&&(r>0?r=l.length-1:r<0&&(r=0));const d=l[r],c=d.id,h=y(c,t.id,t.time.start,t.time.end);c===t.rowId||h||Array.isArray(s)&&!s.includes(c)||d.hasOwnProperty("moveable")&&!d.moveable||f.update(`config.chart.items.${t.id}.rowId`,c)}else!g.resizing||void 0!==t.resizeable&&!0!==t.resizeable||function(e,t,n,o,s){const r=f.get("_internal.chart.time"),a=e.x-g.ganttLeft-g.itemLeftCompensation,m=r.leftGlobal+a*s-n.time.end;if(n.time.end+m<n.time.start)return;const d=n.time.end,c=w(m,i.api.time.date(n.time.end),-1,l)-d,u=y(t.id,n.id,n.time.start,n.time.end+c);c&&!u&&f.update(`config.chart.items.${i.item.id}.time.end`,(function(e){return e+c}))}(e,o,t,0,a)}function x(e){g.moving=!1,g.resizing=!1;for(const e in t)t[e].moving=!1,t[e].resizing=!1,h(e)}return s&&d.addEventListener("mousedown",p),r&&c.addEventListener("mousedown",v),document.addEventListener("mousemove",b),document.addEventListener("mouseup",x),{destroy(e,t){s&&d.removeEventListener("moudedown",p),r&&c.removeEventListener("mousedown",v),document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",x),r&&o.removeChild(c)}}}return function(e,t){e.update("config.actions.chart-timeline-items-row-item",e=>(e.push(n),e))}}
/**
 * Gantt-Schedule-Timeline-Calendar
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0
 */function n(e={}){function t(t){const n=t.target,i=n.clientWidth,o=n.clientHeight,s=unescape(encodeURIComponent(n.outerHTML));let r="";for(const e of document.styleSheets)if("gstc"===e.title)for(const t of e.rules)r+=t.cssText;const a=`<svg xmlns="http://www.w3.org/2000/svg" width="${i}" height="${o}" viewBox="0 0 ${i} ${o}">\n      <foreignObject x="0" y="0" width="${i}" height="${o}">\n        <div xmlns="http://www.w3.org/1999/xhtml">\n          ${r=`<style>* {${e.style}} ${r}</style>`}\n          ${s}\n        </div>\n      </foreignObject>\n    </svg>`,m=document.createElement("canvas");m.width=i,m.height=o;const l=m.getContext("2d");l.fillStyle="white",l.fillRect(0,0,i,o);const d="data:image/svg+xml;base64,"+btoa(a),c=new Image;c.onload=function(){l.drawImage(c,0,0),function(e,t){const n=document.createElement("a");n.href=e,n.download=t,document.body.appendChild(n),n.click()}(m.toDataURL("image/jpeg",1),e.filename)},c.src=d}return e={style:"font-family: sans-serif;",filename:"gantt-schedule-timeline-calendar.jpeg",options:e},function(e,n){e.subscribe("_internal.elements.main",e=>{e&&e.addEventListener("save-as-image",t)})}}export{e as ItemHold,t as ItemMovement,n as SaveAsImage};
//# sourceMappingURL=plugins.js.map
