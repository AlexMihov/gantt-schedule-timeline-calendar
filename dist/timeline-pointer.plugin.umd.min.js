!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).TimelinePointer={})}(this,(function(t){"use strict";function e(t){return t&&"object"==typeof t&&t.constructor&&"Object"===t.constructor.name}function i(t,...s){const a=s.shift();if(e(t)&&e(a))for(const s in a)if(e(a[s]))"function"==typeof a[s].clone?t[s]=a[s].clone():(void 0===t[s]&&(t[s]={}),t[s]=i(t[s],a[s]));else if(Array.isArray(a[s])){t[s]=new Array(a[s].length);let n=0;for(let o of a[s])e(o)?"function"==typeof o.clone?t[s][n]=o.clone():t[s][n]=i({},o):t[s][n]=o,n++}else t[s]=a[s];return s.length?i(t,...s):t}const s="chart-timeline-grid-row-cell",a="chart-timeline-items-row-item";function n(t={}){const e={enabled:!0,isMoving:!1,pointerState:"up",currentTarget:null,realTarget:null,targetType:"",targetData:null,offset:{top:0,left:0},captureEvents:{down:!1,up:!1,move:!1},initialPosition:{x:0,y:0},currentPosition:{x:0,y:0},events:{down:null,move:null,up:null}};return t.captureEvents&&(e.captureEvents=Object.assign(Object.assign({},e.captureEvents),t.captureEvents)),e}const o="config.plugin.TimelinePointer";class r{constructor(t,e){this.unsub=[],this.classNames={cell:"",item:""},this.vido=e,this.api=e.api,this.state=e.state,this.element=this.state.get("$data.elements.chart-timeline"),this.pointerDown=this.pointerDown.bind(this),this.pointerMove=this.pointerMove.bind(this),this.pointerUp=this.pointerUp.bind(this),this.data=n(t),this.classNames.cell=this.api.getClass(s),this.classNames.item=this.api.getClass(a),this.destroy=this.destroy.bind(this),this.element.addEventListener("pointerdown",this.pointerDown),document.addEventListener("pointerup",this.pointerUp),document.addEventListener("pointermove",this.pointerMove),this.unsub.push(this.state.subscribe(o,t=>this.data=t)),this.unsub.push(this.state.subscribe("config.scroll.vertical.offset",t=>{this.data.offset.left=t,this.updateData()}))}destroy(){this.element.removeEventListener("pointerdown",this.pointerDown),document.removeEventListener("pointerup",this.pointerUp),document.removeEventListener("pointermove",this.pointerMove)}updateData(){this.state.update(o,()=>Object.assign({},this.data))}getRealTarget(t){let e=t.target.closest("."+this.classNames.item);return e||(e=t.target.closest("."+this.classNames.cell),e||null)}getRealPosition(t){const e={x:0,y:0};if(this.element){const i=this.element.getBoundingClientRect();e.x=t.x-i.x,e.y=t.y-i.y;const s=this.state.get("config.scroll.vertical.offset")||0;e.y+=s}return e}pointerDown(t){if(!this.data.enabled)return;this.data.pointerState="down",this.data.currentTarget=t.target,this.data.realTarget=this.getRealTarget(t),this.data.realTarget?this.data.realTarget.classList.contains(this.classNames.item)?(this.data.targetType=a,this.data.targetData=this.data.realTarget.vido.item):this.data.realTarget.classList.contains(this.classNames.cell)?(this.data.targetType=s,this.data.targetData=this.data.realTarget.vido):this.data.targetType="":(this.data.targetType="",this.data.targetData=null),this.data.isMoving=!!this.data.realTarget,this.data.events.down=t,this.data.events.move=t;const e=this.getRealPosition(t);this.data.initialPosition=e,this.data.currentPosition=e,this.updateData()}pointerUp(t){this.data.enabled&&(this.data.pointerState="up",this.data.isMoving=!1,this.data.events.up=t,this.data.currentPosition=this.getRealPosition(t),this.updateData())}pointerMove(t){this.data.enabled&&this.data.isMoving&&(this.data.pointerState="move",this.data.events.move=t,this.data.currentPosition=this.getRealPosition(t),this.updateData())}}t.CELL=s,t.ITEM=a,t.Plugin=function(t){return function(e){const s=e.state.get(o);console.log(s),s&&(t=i(i({},t),s));const a=[],l=n(t);let h;return e.state.update(o,l),a.push(e.state.subscribe("$data.elements.chart-timeline",i=>{if(i){h&&h();const i=new r(t,e);h=i.destroy}})),function(){a.forEach(t=>t()),h&&h()}}},Object.defineProperty(t,"__esModule",{value:!0})}));
