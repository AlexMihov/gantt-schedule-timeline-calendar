{"version":3,"file":"item-movement.plugin.esm.js","sources":["../node_modules/@neuronet.io/vido/src/helpers.ts","../src/plugins/timeline-pointer.plugin.ts","../src/plugins/item-movement.plugin.ts"],"sourcesContent":["/**\n * Schedule - a throttle function that uses requestAnimationFrame to limit the rate at which a function is called.\n *\n * @param {function} fn\n * @returns {function}\n */\nexport function schedule(fn: (argument) => void | any) {\n  let frameId = 0;\n  function wrapperFn(argument) {\n    if (frameId) {\n      return;\n    }\n    function executeFrame() {\n      frameId = 0;\n      fn.apply(undefined, [argument]);\n    }\n    frameId = requestAnimationFrame(executeFrame);\n  }\n  return wrapperFn;\n}\n\n/**\n * Is object - helper function to determine if specified variable is an object\n *\n * @param {any} item\n * @returns {boolean}\n */\nfunction isObject(item) {\n  return item && typeof item === 'object' && item.constructor && item.constructor.name === 'Object';\n}\n\n/**\n * Merge deep - helper function which will merge objects recursively - creating brand new one - like clone\n *\n * @param {object} target\n * @params {[object]} sources\n * @returns {object}\n */\nexport function mergeDeep(target, ...sources) {\n  const source = sources.shift();\n  if (isObject(target) && isObject(source)) {\n    for (const key in source) {\n      if (isObject(source[key])) {\n        if (typeof source[key].clone === 'function') {\n          target[key] = source[key].clone();\n        } else {\n          if (typeof target[key] === 'undefined') {\n            target[key] = {};\n          }\n          target[key] = mergeDeep(target[key], source[key]);\n        }\n      } else if (Array.isArray(source[key])) {\n        target[key] = new Array(source[key].length);\n        let index = 0;\n        for (let item of source[key]) {\n          if (isObject(item)) {\n            if (typeof item.clone === 'function') {\n              target[key][index] = item.clone();\n            } else {\n              target[key][index] = mergeDeep({}, item);\n            }\n          } else {\n            target[key][index] = item;\n          }\n          index++;\n        }\n      } else {\n        target[key] = source[key];\n      }\n    }\n  }\n  if (!sources.length) {\n    return target;\n  }\n  return mergeDeep(target, ...sources);\n}\n\n/**\n * Clone helper function\n *\n * @param source\n * @returns {object} cloned source\n */\nexport function clone(source) {\n  if (typeof source.actions !== 'undefined') {\n    const actns = source.actions.map((action) => {\n      const result = { ...action };\n      const props = { ...result.props };\n      delete props.state;\n      delete props.api;\n      delete result.element;\n      result.props = props;\n      return result;\n    });\n    source.actions = actns;\n  }\n  return mergeDeep({}, source);\n}\n\nexport default {\n  mergeDeep,\n  clone,\n  schedule,\n};\n","/**\n * TimelinePointer plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   AGPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nimport DeepState from 'deep-state-observer';\nimport { Api } from '../api/api';\nimport { Vido } from '../gstc';\nimport { mergeDeep } from '@neuronet.io/vido/src/helpers';\n\nexport const CELL = 'chart-timeline-grid-row-cell';\nexport type CELL_TYPE = 'chart-timeline-grid-row-cell';\nexport const ITEM = 'chart-timeline-items-row-item';\nexport type ITEM_TYPE = 'chart-timeline-items-row-item';\n\nexport interface PointerEvents {\n  down: PointerEvent | null;\n  move: PointerEvent | null;\n  up: PointerEvent | null;\n}\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type PointerState = 'up' | 'down' | 'move';\n\nexport interface CaptureEvents {\n  up?: boolean;\n  down?: boolean;\n  move?: boolean;\n}\n\nexport interface Options {\n  enabled?: boolean;\n  captureEvents?: CaptureEvents;\n}\n\nexport interface Offset {\n  top: number;\n  left: number;\n}\n\nexport interface PluginData extends Options {\n  isMoving: boolean;\n  pointerState: PointerState;\n  currentTarget: HTMLElement | null;\n  realTarget: HTMLElement | null;\n  targetType: ITEM_TYPE | CELL_TYPE | '';\n  targetData: any | null;\n  events: PointerEvents;\n  offset: Offset;\n  initialPosition: Point;\n  currentPosition: Point;\n}\n\nfunction generateEmptyData(options: Options = {}): PluginData {\n  const result: PluginData = {\n    enabled: true,\n    isMoving: false,\n    pointerState: 'up',\n    currentTarget: null,\n    realTarget: null,\n    targetType: '',\n    targetData: null,\n    offset: { top: 0, left: 0 },\n    captureEvents: {\n      down: false,\n      up: false,\n      move: false,\n    },\n    initialPosition: { x: 0, y: 0 },\n    currentPosition: { x: 0, y: 0 },\n    events: {\n      down: null,\n      move: null,\n      up: null,\n    },\n  };\n  if (options.captureEvents) {\n    result.captureEvents = {\n      ...result.captureEvents,\n      ...options.captureEvents,\n    };\n  }\n  return result;\n}\n\nconst pluginPath = 'config.plugin.TimelinePointer';\n\nclass TimelinePointer {\n  private element: HTMLElement;\n  private vido: Vido;\n  private api: Api;\n  private state: DeepState;\n  private data: PluginData;\n  private unsub = [];\n  private classNames = {\n    cell: '',\n    item: '',\n  };\n\n  constructor(options: Options, vido: Vido) {\n    this.vido = vido;\n    this.api = vido.api;\n    this.state = vido.state;\n    this.element = this.state.get(`$data.elements.chart-timeline`);\n    this.pointerDown = this.pointerDown.bind(this);\n    this.pointerMove = this.pointerMove.bind(this);\n    this.pointerUp = this.pointerUp.bind(this);\n    this.data = generateEmptyData(options);\n    this.classNames.cell = this.api.getClass(CELL);\n    this.classNames.item = this.api.getClass(ITEM);\n    this.destroy = this.destroy.bind(this);\n    this.element.addEventListener('pointerdown', this.pointerDown /*, this.data.captureEvents.down*/);\n    document.addEventListener('pointerup', this.pointerUp /*, this.data.captureEvents.up*/);\n    document.addEventListener('pointermove', this.pointerMove /*, this.data.captureEvents.move*/);\n    this.unsub.push(this.state.subscribe(pluginPath, (value) => (this.data = value)));\n    this.unsub.push(\n      this.state.subscribe('config.scroll.vertical.offset', (offset) => {\n        this.data.offset.left = offset;\n        this.updateData();\n      })\n    );\n  }\n\n  public destroy() {\n    this.element.removeEventListener('pointerdown', this.pointerDown);\n    document.removeEventListener('pointerup', this.pointerUp);\n    document.removeEventListener('pointermove', this.pointerMove);\n  }\n\n  private updateData() {\n    this.state.update(pluginPath, () => ({ ...this.data }));\n  }\n\n  private getRealTarget(ev: PointerEvent) {\n    let realTarget: HTMLElement = (ev.target as HTMLElement).closest('.' + this.classNames.item) as HTMLElement;\n    if (realTarget) {\n      return realTarget;\n    }\n    realTarget = (ev.target as HTMLElement).closest('.' + this.classNames.cell) as HTMLElement;\n    if (realTarget) {\n      return realTarget;\n    }\n    return null;\n  }\n\n  private getRealPosition(ev: PointerEvent): Point {\n    const pos = { x: 0, y: 0 };\n    if (this.element) {\n      const bounding = this.element.getBoundingClientRect();\n      pos.x = ev.x - bounding.x;\n      pos.y = ev.y - bounding.y;\n      const scrollOffsetTop = this.state.get('config.scroll.vertical.offset') || 0;\n      pos.y += scrollOffsetTop;\n    }\n    return pos;\n  }\n\n  private pointerDown(ev: PointerEvent) {\n    if (!this.data.enabled) return;\n    this.data.pointerState = 'down';\n    this.data.currentTarget = ev.target as HTMLElement;\n    this.data.realTarget = this.getRealTarget(ev);\n    if (this.data.realTarget) {\n      if (this.data.realTarget.classList.contains(this.classNames.item)) {\n        this.data.targetType = ITEM;\n        // @ts-ignore\n        this.data.targetData = this.data.realTarget.vido.item;\n      } else if (this.data.realTarget.classList.contains(this.classNames.cell)) {\n        this.data.targetType = CELL;\n        // @ts-ignore\n        this.data.targetData = this.data.realTarget.vido;\n      } else {\n        this.data.targetType = '';\n      }\n    } else {\n      this.data.targetType = '';\n      this.data.targetData = null;\n    }\n    this.data.isMoving = !!this.data.realTarget;\n    this.data.events.down = ev;\n    this.data.events.move = ev;\n    const realPosition = this.getRealPosition(ev);\n    this.data.initialPosition = realPosition;\n    this.data.currentPosition = realPosition;\n    this.updateData();\n  }\n\n  private pointerUp(ev: PointerEvent) {\n    if (!this.data.enabled) return;\n    this.data.pointerState = 'up';\n    this.data.isMoving = false;\n    this.data.events.up = ev;\n    this.data.currentPosition = this.getRealPosition(ev);\n    this.updateData();\n  }\n\n  private pointerMove(ev: PointerEvent) {\n    if (!this.data.enabled || !this.data.isMoving) return;\n    this.data.pointerState = 'move';\n    this.data.events.move = ev;\n    this.data.currentPosition = this.getRealPosition(ev);\n    this.updateData();\n  }\n}\n\nexport function Plugin(options: Options) {\n  return function initialize(vidoInstance: Vido) {\n    const currentOptions = vidoInstance.state.get(pluginPath);\n    if (currentOptions) {\n      options = mergeDeep(mergeDeep({}, options), currentOptions);\n    }\n    const subs = [];\n    const defaultData = generateEmptyData(options);\n    // for other plugins that are initialized before elements are saved\n    vidoInstance.state.update(pluginPath, defaultData);\n\n    // initialize only if chart element is mounted\n    let timelinePointerDestroy;\n    subs.push(\n      vidoInstance.state.subscribe('$data.elements.chart-timeline', (timelineElement: HTMLElement) => {\n        if (timelineElement) {\n          if (timelinePointerDestroy) timelinePointerDestroy();\n          const timelinePointer = new TimelinePointer(options, vidoInstance);\n          timelinePointerDestroy = timelinePointer.destroy;\n        }\n      })\n    );\n    return function destroy() {\n      subs.forEach((unsub) => unsub());\n      if (timelinePointerDestroy) timelinePointerDestroy();\n    };\n  };\n}\n","/**\n * ItemMovement plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   AGPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nimport { PluginData as SelectionPluginData } from './selection.plugin';\nimport { Item, DataChartTime, Vido, Row, Rows } from '../gstc';\nimport { ITEM, Point } from './timeline-pointer.plugin';\nimport { Dayjs } from 'dayjs';\nimport { Api } from '../api/api';\nimport DeepState from 'deep-state-observer';\nimport { mergeDeep } from '@neuronet.io/vido/src/helpers';\n\nexport interface SnapArg {\n  item: Item;\n  time: DataChartTime;\n  vido: Vido;\n  movement: Movement;\n}\n\nexport interface SnapStartArg extends SnapArg {\n  startTime: Dayjs;\n}\n\nexport interface SnapEndArg extends SnapArg {\n  endTime: Dayjs;\n}\n\nexport interface SnapToTime {\n  start?: (snapStartArgs: SnapStartArg) => Dayjs;\n  end?: (snapEndArgs: SnapEndArg) => Dayjs;\n}\n\nexport interface BeforeAfterInitialItems {\n  initial: Item[];\n  before: Item[];\n  after: Item[];\n  targetData: Item;\n}\n\nexport interface OnArg {\n  items: BeforeAfterInitialItems;\n  vido: Vido;\n  state: DeepState;\n  time: DataChartTime;\n}\n\nexport interface Events {\n  onStart?: (onArg: OnArg) => Item[];\n  onMove?: (onArg: OnArg) => Item[];\n  onEnd?: (onArg: OnArg) => Item[];\n}\n\nexport interface Options {\n  enabled?: boolean;\n  className?: string;\n  bodyClass?: string;\n  bodyClassMoving?: string;\n  events?: Events;\n  snapToTime?: SnapToTime;\n  debug?: boolean;\n}\n\nexport interface MovementResult {\n  horizontal: number;\n  vertical: number;\n}\n\nexport interface Movement {\n  px: MovementResult;\n  time: number;\n}\n\nexport interface LastMovement {\n  x: number;\n  y: number;\n  time: number;\n}\n\nexport interface PluginData extends Options {\n  moving: Item[];\n  targetData: Item | null;\n  initialItems: Item[];\n  movement: Movement;\n  lastMovement: LastMovement;\n  position: Point;\n  pointerState: 'up' | 'down' | 'move';\n  state: State;\n  pointerMoved: boolean;\n}\n\nexport interface MovingTimes {\n  startTime: Dayjs;\n  endTime: Dayjs;\n}\n\nexport type State = '' | 'start' | 'end' | 'move' | '';\n\nexport interface Cumulation {\n  start: number;\n  end: number;\n}\n\nexport interface Cumulations {\n  [key: string]: Cumulation;\n}\n\nexport interface RelativeVerticalPosition {\n  [key: string]: number;\n}\n\nfunction prepareOptions(options: Options): Options {\n  return {\n    enabled: true,\n    className: '',\n    bodyClass: 'gstc-item-movement',\n    bodyClassMoving: 'gstc-items-moving',\n    ...options\n  };\n}\n\nconst pluginPath = 'config.plugin.ItemMovement';\n\nfunction generateEmptyPluginData(options: Options): PluginData {\n  const events = {\n    onStart({ items }) {\n      return items.after;\n    },\n    onMove({ items }) {\n      return items.after;\n    },\n    onEnd({ items }) {\n      return items.after;\n    }\n  };\n  const snapToTime = {\n    start({ startTime, time }) {\n      return startTime.startOf(time.period);\n    },\n    end({ endTime, time }) {\n      return endTime.endOf(time.period);\n    }\n  };\n  const result: PluginData = {\n    debug: false,\n    moving: [],\n    targetData: null,\n    initialItems: [],\n    pointerState: 'up',\n    pointerMoved: false,\n    state: '',\n    position: { x: 0, y: 0 },\n    movement: {\n      px: { horizontal: 0, vertical: 0 },\n      time: 0\n    },\n    lastMovement: { x: 0, y: 0, time: 0 },\n    events: { ...events },\n    snapToTime: { ...snapToTime },\n    ...options\n  };\n  if (options.snapToTime) {\n    result.snapToTime = {\n      ...snapToTime,\n      ...options.snapToTime\n    };\n  }\n  if (options.events) {\n    result.events = {\n      ...events,\n      ...options.events\n    };\n  }\n  return result;\n}\n\nclass ItemMovement {\n  private vido: Vido;\n  private api: Api;\n  private state: DeepState;\n  private onDestroy = [];\n  private selection: SelectionPluginData;\n  private data: PluginData;\n  private cumulations: Cumulations = {};\n  private merge: (target: object, source: object) => object;\n  private relativeVerticalPosition: RelativeVerticalPosition = {};\n\n  constructor(vido: Vido) {\n    this.vido = vido;\n    this.api = vido.api;\n    this.state = vido.state;\n    this.merge = this.state.get('config.merge');\n    this.destroy = this.destroy.bind(this);\n    this.onDestroy.push(\n      this.state.subscribe(pluginPath, data => {\n        this.data = data;\n        if (!data.enabled) {\n          document.body.classList.remove(this.data.bodyClass);\n        } else {\n          document.body.classList.add(this.data.bodyClass);\n        }\n      })\n    );\n    if (!this.data.className) this.data.className = this.api.getClass('chart-timeline-items-row-item--moving');\n    this.onSelectionChange = this.onSelectionChange.bind(this);\n    this.onDestroy.push(this.state.subscribe('config.plugin.Selection', this.onSelectionChange));\n  }\n\n  public destroy() {\n    this.onDestroy.forEach(unsub => unsub());\n  }\n\n  private updateData() {\n    this.state.update(pluginPath, { ...this.data });\n  }\n\n  private clearCumulationsForItems() {\n    this.cumulations = {};\n  }\n\n  private setStartCumulationForItem(item: Item, cumulation: number) {\n    if (!this.cumulations[item.id]) {\n      this.cumulations[item.id] = { start: 0, end: 0 };\n    }\n    this.cumulations[item.id].start = cumulation;\n  }\n\n  private getStartCumulationForItem(item: Item): number {\n    return this.cumulations[item.id]?.start || 0;\n  }\n\n  private getItemMovingTimes(item: Item, time: DataChartTime): MovingTimes {\n    const horizontal = this.data.movement.px.horizontal;\n    const positionLeft = this.api.time.getViewOffsetPxFromDates(item.$data.time.startDate, false, time);\n    const x = positionLeft + horizontal + this.getStartCumulationForItem(item);\n    const leftGlobal = this.api.time.getTimeFromViewOffsetPx(x, time);\n    const startTime = this.data.snapToTime.start({\n      startTime: this.api.time.date(leftGlobal),\n      item,\n      time,\n      movement: this.data.movement,\n      vido: this.vido\n    });\n    const snapStartPxDiff = this.api.time.getDatesDiffPx(startTime, this.api.time.date(leftGlobal), time, true);\n    this.setStartCumulationForItem(item, snapStartPxDiff);\n    const startEndTimeDiff = item.$data.time.endDate.diff(item.$data.time.startDate, 'millisecond');\n    // diff could be too much if we are in the middle of european summer time (daylight-saving time)\n    const rightGlobal = startTime.add(startEndTimeDiff, 'millisecond').valueOf();\n    const rightGlobalDate = this.api.time.date(rightGlobal);\n    /* // summer time / daylight saving time bug\n    const leftFmt = rightGlobalDate.format('YYYY-MM-DD HH:mm:ss');\n    const rightFmt = rightGlobalDate.endOf(time.period).format('YYYY-MM-DD HH:mm:ss');\n    if (leftFmt !== rightFmt) {\n      console.log('no match', leftFmt, rightFmt);\n    }*/\n    const endTime = this.data.snapToTime.end({\n      endTime: rightGlobalDate,\n      item,\n      time,\n      movement: this.data.movement,\n      vido: this.vido\n    });\n    return { startTime, endTime };\n  }\n\n  private findRowAtViewPosition(y: number, currentRow: Row): Row {\n    const visibleRowsId: string[] = this.state.get('$data.list.visibleRows');\n    const visibleRows: Row[] = this.api.getRows(visibleRowsId);\n    for (const row of visibleRows) {\n      const rowBottom = row.$data.position.viewTop + row.$data.outerHeight;\n      if (row.$data.position.viewTop <= y && rowBottom >= y) return row;\n    }\n    return currentRow;\n  }\n\n  private getItemViewTop(item: Item): number {\n    const rows: Rows = this.api.getAllRows();\n    const row = rows[item.rowId];\n    return row.$data.position.viewTop + item.$data.position.actualTop;\n  }\n\n  private saveItemsRelativeVerticalPosition() {\n    for (const item of this.data.moving) {\n      const relativePosition = this.data.position.y - this.getItemViewTop(item);\n      this.setItemRelativeVerticalPosition(item, relativePosition);\n    }\n  }\n\n  private setItemRelativeVerticalPosition(item: Item, relativePosition: number) {\n    this.relativeVerticalPosition[item.id] = relativePosition;\n  }\n\n  private getItemRelativeVerticalPosition(item: Item): number {\n    return this.relativeVerticalPosition[item.id];\n  }\n\n  private moveItemVertically(item: Item): Row {\n    const rows: Rows = this.api.getAllRows();\n    const currentRow: Row = rows[item.rowId];\n    const relativePosition = this.getItemRelativeVerticalPosition(item);\n    const itemShouldBeAt = this.data.position.y + relativePosition;\n    return this.findRowAtViewPosition(itemShouldBeAt, currentRow);\n  }\n\n  private getEventArgument(afterItems: Item[]): OnArg {\n    const configItems = this.state.get('config.chart.items');\n    const before = [];\n    for (const item of afterItems) {\n      before.push(this.merge({}, configItems[item.id]) as Item);\n    }\n    return {\n      items: {\n        initial: this.data.initialItems,\n        before,\n        after: afterItems,\n        targetData: this.merge({}, this.data.targetData) as Item\n      },\n      vido: this.vido,\n      state: this.state,\n      time: this.state.get('$data.chart.time')\n    };\n  }\n\n  private moveItems() {\n    if (!this.data.enabled) return;\n    const time: DataChartTime = this.state.get('$data.chart.time');\n    const moving = this.data.moving.map(item => this.merge({}, item) as Item);\n    if (this.data.debug) console.log('moveItems', moving); // eslint-disable-line no-console\n    for (let item of moving) {\n      item.rowId = this.moveItemVertically(item).id;\n      const newItemTimes = this.getItemMovingTimes(item, time);\n      if (newItemTimes.startTime.valueOf() !== item.time.start || newItemTimes.endTime.valueOf() !== item.time.end) {\n        item.time.start = newItemTimes.startTime.valueOf();\n        item.time.end = newItemTimes.endTime.valueOf();\n        item.$data.time.startDate = newItemTimes.startTime;\n        item.$data.time.endDate = newItemTimes.endTime;\n      }\n    }\n    this.dispatchEvent('onMove', moving);\n  }\n\n  private clearSelection() {\n    this.data.moving = [];\n    this.data.initialItems = [];\n    this.data.movement.px.horizontal = 0;\n    this.data.movement.px.vertical = 0;\n    this.data.movement.time = 0;\n    this.data.pointerState = 'up';\n    this.data.pointerMoved = false;\n  }\n\n  private dispatchEvent(type: 'onStart' | 'onMove' | 'onEnd', items: Item[]) {\n    items = items.map(item => this.merge({}, item) as Item);\n    const modified = this.data.events[type](this.getEventArgument(items));\n    let multi = this.state.multi();\n    for (const item of modified) {\n      multi = multi.update(`config.chart.items.${item.id}`, currentItem => {\n        // items should be always references - we cannot make a copy of the object because it may lead us to troubles\n        mergeDeep(currentItem, item);\n        return currentItem;\n      });\n    }\n    multi.done();\n    this.data.moving = modified;\n  }\n\n  private onStart() {\n    this.data.initialItems = this.data.moving.map(item => this.merge({}, item) as Item);\n    this.clearCumulationsForItems();\n    document.body.classList.add(this.data.bodyClassMoving);\n    this.data.position = { ...this.selection.currentPosition };\n    this.data.lastMovement.time = this.data.moving[0].time.start;\n    this.saveItemsRelativeVerticalPosition();\n    const initial = this.data.initialItems.map(item => this.merge({}, item) as Item);\n    this.dispatchEvent('onStart', initial);\n  }\n\n  private onEnd() {\n    const moving = this.data.moving.map(item => this.merge({}, item) as Item);\n    this.dispatchEvent('onEnd', moving);\n    document.body.classList.remove(this.data.bodyClassMoving);\n    this.clearSelection();\n    this.clearCumulationsForItems();\n  }\n\n  private onSelectionChange(data: SelectionPluginData) {\n    if (!this.data.enabled) return;\n    this.selection = { ...data };\n    if (this.selection.targetType !== ITEM) {\n      return this.clearSelection();\n    }\n\n    if (this.data.pointerState === 'up' && this.selection.pointerState === 'down') {\n      this.data.state = 'start';\n    } else if (\n      (this.data.pointerState === 'down' || this.data.pointerState === 'move') &&\n      this.selection.pointerState === 'up'\n    ) {\n      this.data.state = 'end';\n    } else if (this.selection.pointerState === 'move') {\n      this.data.state = 'move';\n    } else {\n      this.data.state = '';\n      return this.updateData();\n    }\n\n    if (this.selection.events.move) {\n      this.selection.events.move.preventDefault();\n      this.selection.events.move.stopPropagation();\n    }\n    if (this.selection.events.down) {\n      this.selection.events.down.preventDefault();\n      this.selection.events.down.stopPropagation();\n    }\n\n    this.data.pointerState = this.selection.pointerState;\n    this.data.targetData = { ...this.selection.targetData };\n\n    if (this.data.state === 'end') this.onEnd(); // before this.selection.selected[ITEM] clear\n\n    this.data.moving = this.selection.selected[ITEM].map(itemId => this.merge({}, this.api.getItem(itemId)) as Item);\n    if (this.data.debug) console.log('state', this.data.pointerState); // eslint-disable-line no-console\n\n    if (this.data.state === 'start') this.onStart();\n\n    if (this.data.state === 'move' || this.data.state === 'start') {\n      this.data.lastMovement.x = this.data.movement.px.horizontal;\n      this.data.lastMovement.y = this.data.movement.px.vertical;\n      this.data.movement.px.horizontal = this.selection.currentPosition.x - this.data.position.x;\n      this.data.movement.px.vertical = this.selection.currentPosition.y - this.data.position.y;\n      this.data.movement.time = this.data.moving[0].time.start - this.data.lastMovement.time;\n      this.data.position.x = this.selection.currentPosition.x;\n      this.data.position.y = this.selection.currentPosition.y;\n      this.data.lastMovement.time = this.data.moving[0].time.start;\n    }\n\n    if (\n      this.data.state === 'move' &&\n      this.data.lastMovement.x === this.data.movement.px.horizontal &&\n      this.data.lastMovement.y === this.data.movement.px.vertical\n    ) {\n      // prevent movement if there is no movement... (performance optimization)\n      return this.updateData();\n    }\n\n    if (this.data.state === 'move') this.moveItems();\n    this.updateData();\n  }\n}\n\nexport function Plugin(options: Options = {}) {\n  return function initialize(vidoInstance: Vido) {\n    const currentOptions = vidoInstance.state.get(pluginPath);\n    if (currentOptions) {\n      options = mergeDeep({}, options, currentOptions);\n    }\n    vidoInstance.state.update(pluginPath, generateEmptyPluginData(prepareOptions(options)));\n    const itemMovement = new ItemMovement(vidoInstance);\n    return itemMovement.destroy;\n  };\n}\n"],"names":[],"mappings":"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"}