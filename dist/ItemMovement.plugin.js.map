{"version":3,"file":"ItemMovement.plugin.js","sources":["../src/plugins/ItemMovement.plugin.ts"],"sourcesContent":["/**\n * ItemMovement plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nexport interface Options {\n  moveable?: boolean | string;\n  resizeable?: boolean | string;\n  resizerContent?: string;\n  collisionDetection?: boolean;\n  outOfBorders?: boolean;\n  snapStart?: (timeStart: number, startDiff: number, item: object) => number;\n  snapEnd?: (timeEnd: number, endDiff: number, item: object) => number;\n  ghostNode?: boolean;\n}\n\nexport default function ItemMovement(options: Options = {}) {\n  const defaultOptions = {\n    moveable: true,\n    resizeable: true,\n    resizerContent: '',\n    collisionDetection: true,\n    outOfBorders: false,\n    snapStart(timeStart, startDiff) {\n      return timeStart + startDiff;\n    },\n    snapEnd(timeEnd, endDiff) {\n      return timeEnd + endDiff;\n    },\n    ghostNode: true\n  };\n  options = { ...defaultOptions, ...options };\n\n  const movementState = {};\n\n  /**\n   * Add moving functionality to items as action\n   *\n   * @param {HTMLElement} node DOM Node\n   * @param {Object} data\n   */\n  function action(element: HTMLElement, data) {\n    if (!options.moveable && !options.resizeable) {\n      return;\n    }\n    let state;\n    let api;\n\n    function isMoveable(data) {\n      let moveable = options.moveable;\n      if (data.item.hasOwnProperty('moveable') && moveable) {\n        moveable = data.item.moveable;\n      }\n      if (data.row.hasOwnProperty('moveable') && moveable) {\n        moveable = data.row.moveable;\n      }\n      return moveable;\n    }\n\n    function isResizeable(data) {\n      let resizeable = options.resizeable && (!data.item.hasOwnProperty('resizeable') || data.item.resizeable === true);\n      if (data.row.hasOwnProperty('resizeable') && resizeable) {\n        resizeable = data.row.resizeable;\n      }\n      return resizeable;\n    }\n\n    function getMovement(data) {\n      const itemId = data.item.id;\n      if (typeof movementState[itemId] === 'undefined') {\n        movementState[itemId] = { moving: false, resizing: false };\n      }\n      return movementState[itemId];\n    }\n\n    function createGhost(data, ev, ganttLeft, ganttTop) {\n      const movement = getMovement(data);\n      if (!options.ghostNode || typeof movement.ghost !== 'undefined') {\n        return;\n      }\n      const ghost = element.cloneNode(true) as HTMLElement;\n      const style = getComputedStyle(element);\n      const compensation = state.get('config.scroll.compensation');\n      ghost.style.position = 'absolute';\n      ghost.style.left = ev.x - ganttLeft - movement.itemLeftCompensation + 'px';\n      const itemTop = ev.y - ganttTop - element.offsetTop - compensation + parseInt(style['margin-top']);\n      movement.itemTop = itemTop;\n      ghost.style.top = ev.y - ganttTop - itemTop + 'px';\n      ghost.style.width = style.width;\n      ghost.style['box-shadow'] = '10px 10px 6px #00000020';\n      const height = element.clientHeight + 'px';\n      ghost.style.height = height;\n      ghost.style['line-height'] = element.clientHeight - 18 + 'px';\n      ghost.style.opacity = '0.6';\n      ghost.style.transform = 'scale(1.05, 1.05)';\n      state.get('_internal.elements.chart-timeline').appendChild(ghost);\n      movement.ghost = ghost;\n      return ghost;\n    }\n\n    function moveGhost(data, ev) {\n      if (options.ghostNode) {\n        const movement = getMovement(data);\n        const left = ev.x - movement.ganttLeft - movement.itemLeftCompensation;\n        movement.ghost.style.left = left + 'px';\n        movement.ghost.style.top =\n          ev.y - movement.ganttTop - movement.itemTop + parseInt(getComputedStyle(element)['margin-top']) + 'px';\n      }\n    }\n\n    function destroyGhost(itemId) {\n      if (!options.ghostNode) {\n        return;\n      }\n      if (typeof movementState[itemId] !== 'undefined' && typeof movementState[itemId].ghost !== 'undefined') {\n        state.get('_internal.elements.chart-timeline').removeChild(movementState[itemId].ghost);\n        delete movementState[itemId].ghost;\n      }\n    }\n\n    function getSnapStart(data) {\n      let snapStart = options.snapStart;\n      if (typeof data.item.snapStart === 'function') {\n        snapStart = data.item.snapStart;\n      }\n      return snapStart;\n    }\n\n    function getSnapEnd(data) {\n      let snapEnd = options.snapEnd;\n      if (typeof data.item.snapEnd === 'function') {\n        snapEnd = data.item.snapEnd;\n      }\n      return snapEnd;\n    }\n\n    state = data.state;\n    api = data.api;\n\n    const resizerHTML = `<div class=\"${api.getClass('chart-timeline-items-row-item-resizer')}\">${\n      options.resizerContent\n    }</div>`;\n    // @ts-ignore\n    element.insertAdjacentHTML('beforeend', resizerHTML);\n    const resizerEl = element.querySelector(\n      '.gantt-schedule-timeline-calendar__chart-timeline-items-row-item-resizer'\n    ) as HTMLElement;\n    if (!isResizeable(data)) {\n      resizerEl.style.visibility = 'hidden';\n    } else {\n      resizerEl.style.visibility = 'visible';\n    }\n\n    function labelMouseDown(ev) {\n      ev.stopPropagation();\n      if (ev.button !== 0) {\n        return;\n      }\n      const movement = getMovement(data);\n      movement.moving = true;\n      const item = state.get(`config.chart.items.${data.item.id}`);\n      const chartLeftTime = state.get('_internal.chart.time.leftGlobal');\n      const timePerPixel = state.get('_internal.chart.time.timePerPixel');\n      const ganttRect = state.get('_internal.elements.chart-timeline').getBoundingClientRect();\n      movement.ganttTop = ganttRect.top;\n      movement.ganttLeft = ganttRect.left;\n      movement.itemX = Math.round((item.time.start - chartLeftTime) / timePerPixel);\n      movement.itemLeftCompensation = ev.x - movement.ganttLeft - movement.itemX;\n      createGhost(data, ev, ganttRect.left, ganttRect.top);\n    }\n\n    function resizerMouseDown(ev) {\n      ev.stopPropagation();\n      if (ev.button !== 0) {\n        return;\n      }\n      const movement = getMovement(data);\n      movement.resizing = true;\n      const item = state.get(`config.chart.items.${data.item.id}`);\n      const chartLeftTime = state.get('_internal.chart.time.leftGlobal');\n      const timePerPixel = state.get('_internal.chart.time.timePerPixel');\n      const ganttRect = state.get('_internal.elements.chart-timeline').getBoundingClientRect();\n      movement.ganttTop = ganttRect.top;\n      movement.ganttLeft = ganttRect.left;\n      movement.itemX = (item.time.end - chartLeftTime) / timePerPixel;\n      movement.itemLeftCompensation = ev.x - movement.ganttLeft - movement.itemX;\n    }\n\n    function isCollision(rowId, itemId, start, end) {\n      if (!options.collisionDetection) {\n        return false;\n      }\n      const time = state.get('_internal.chart.time');\n      if (options.outOfBorders && (start < time.from || end > time.to)) {\n        return true;\n      }\n      let diff = api.time.date(end).diff(start, 'milliseconds');\n      if (Math.sign(diff) === -1) {\n        diff = -diff;\n      }\n      if (diff <= 1) {\n        return true;\n      }\n      const row = state.get('config.list.rows.' + rowId);\n      for (const rowItem of row._internal.items) {\n        if (rowItem.id !== itemId) {\n          if (start >= rowItem.time.start && start <= rowItem.time.end) {\n            return true;\n          }\n          if (end >= rowItem.time.start && end <= rowItem.time.end) {\n            return true;\n          }\n          if (start <= rowItem.time.start && end >= rowItem.time.end) {\n            return true;\n          }\n        }\n      }\n      return false;\n    }\n\n    function movementX(ev, row, item, zoom, timePerPixel) {\n      const movement = getMovement(data);\n      const left = ev.x - movement.ganttLeft - movement.itemLeftCompensation;\n      moveGhost(data, ev);\n      const leftMs = state.get('_internal.chart.time.leftGlobal') + left * timePerPixel;\n      const add = leftMs - item.time.start;\n      const originalStart = item.time.start;\n      const finalStartTime = getSnapStart(data)(item.time.start, add, item);\n      const finalAdd = finalStartTime - originalStart;\n      const collision = isCollision(row.id, item.id, item.time.start + finalAdd, item.time.end + finalAdd);\n      if (finalAdd && !collision) {\n        state.update(`config.chart.items.${data.item.id}.time`, function moveItem(time) {\n          time.start += finalAdd;\n          time.end = getSnapEnd(data)(time.end, finalAdd, item) - 1;\n          return time;\n        });\n      }\n    }\n\n    function resizeX(ev, row, item, zoom, timePerPixel) {\n      if (!isResizeable(data)) {\n        return;\n      }\n      const time = state.get('_internal.chart.time');\n      const movement = getMovement(data);\n      const left = ev.x - movement.ganttLeft - movement.itemLeftCompensation;\n      const leftMs = time.leftGlobal + left * timePerPixel;\n      const add = leftMs - item.time.end;\n      if (item.time.end + add < item.time.start) {\n        return;\n      }\n      const originalEnd = item.time.end;\n      const finalEndTime = getSnapEnd(data)(item.time.end, add, item) - 1;\n      const finalAdd = finalEndTime - originalEnd;\n      const collision = isCollision(row.id, item.id, item.time.start, item.time.end + finalAdd);\n      if (finalAdd && !collision) {\n        state.update(`config.chart.items.${data.item.id}.time`, time => {\n          time.start = getSnapStart(data)(time.start, 0, item);\n          time.end = getSnapEnd(data)(time.end, finalAdd, item) - 1;\n          return time;\n        });\n      }\n    }\n\n    function movementY(ev, row, item, zoom, timePerPixel) {\n      moveGhost(data, ev);\n      const movement = getMovement(data);\n      const top = ev.y - movement.ganttTop;\n      const visibleRows = state.get('_internal.list.visibleRows');\n      const compensation = state.get('config.scroll.compensation');\n      let index = 0;\n      for (const currentRow of visibleRows) {\n        if (currentRow.top + compensation > top) {\n          if (index > 0) {\n            return index - 1;\n          }\n          return 0;\n        }\n        index++;\n      }\n      return index;\n    }\n\n    function documentMouseMove(ev) {\n      const movement = getMovement(data);\n      let item, rowId, row, zoom, timePerPixel;\n      if (movement.moving || movement.resizing) {\n        item = state.get(`config.chart.items.${data.item.id}`);\n        rowId = state.get(`config.chart.items.${data.item.id}.rowId`);\n        row = state.get(`config.list.rows.${rowId}`);\n        zoom = state.get('config.chart.time.zoom');\n        timePerPixel = state.get('_internal.chart.time.timePerPixel');\n      }\n      const moveable = isMoveable(data);\n      if (movement.moving) {\n        if (moveable === true || moveable === 'x' || (Array.isArray(moveable) && moveable.includes(rowId))) {\n          movementX(ev, row, item, zoom, timePerPixel);\n        }\n        if (!moveable || moveable === 'x') {\n          return;\n        }\n        let visibleRowsIndex = movementY(ev, row, item, zoom, timePerPixel);\n        const visibleRows = state.get('_internal.list.visibleRows');\n        if (typeof visibleRows[visibleRowsIndex] === 'undefined') {\n          if (visibleRowsIndex > 0) {\n            visibleRowsIndex = visibleRows.length - 1;\n          } else if (visibleRowsIndex < 0) {\n            visibleRowsIndex = 0;\n          }\n        }\n        const newRow = visibleRows[visibleRowsIndex];\n        const newRowId = newRow.id;\n        const collision = isCollision(newRowId, item.id, item.time.start, item.time.end);\n        if (newRowId !== item.rowId && !collision) {\n          if (!Array.isArray(moveable) || moveable.includes(newRowId)) {\n            if (!newRow.hasOwnProperty('moveable') || newRow.moveable) {\n              state.update(`config.chart.items.${item.id}.rowId`, newRowId);\n            }\n          }\n        }\n      } else if (movement.resizing && (typeof item.resizeable === 'undefined' || item.resizeable === true)) {\n        resizeX(ev, row, item, zoom, timePerPixel);\n      }\n    }\n\n    function documentMouseUp(ev) {\n      const movement = getMovement(data);\n      if (movement.moving || movement.resizing) {\n        ev.stopPropagation();\n      }\n      movement.moving = false;\n      movement.resizing = false;\n      for (const itemId in movementState) {\n        movementState[itemId].moving = false;\n        movementState[itemId].resizing = false;\n        destroyGhost(itemId);\n      }\n    }\n    element.addEventListener('mousedown', labelMouseDown);\n    resizerEl.addEventListener('mousedown', resizerMouseDown, { capture: true });\n    document.addEventListener('mousemove', documentMouseMove, { capture: true, passive: true });\n    document.addEventListener('mouseup', documentMouseUp, { capture: true, passive: true });\n\n    return {\n      update(node, changedData) {\n        if (!isResizeable(data) && resizerEl.style.visibility === 'visible') {\n          resizerEl.style.visibility = 'hidden';\n        } else if (isResizeable(data) && resizerEl.style.visibility === 'hidden') {\n          resizerEl.style.visibility = 'visible';\n        }\n      },\n      destroy(node, data) {\n        element.removeEventListener('mousedown', labelMouseDown);\n        resizerEl.removeEventListener('mousedown', resizerMouseDown);\n        document.removeEventListener('mousemove', documentMouseMove);\n        document.removeEventListener('mouseup', documentMouseUp);\n        resizerEl.remove();\n      }\n    };\n  }\n\n  return function initialize(vido) {\n    vido.state.update('config.actions.chart-timeline-items-row-item', actions => {\n      actions.push(action);\n      return actions;\n    });\n  };\n}\n"],"names":[],"mappings":"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"}