{"version":3,"file":"Selection.plugin.js","sources":["../node_modules/raf-schd/dist/raf-schd.esm.js","../src/plugins/Selection.plugin.js"],"sourcesContent":["var rafSchd = function rafSchd(fn) {\n  var lastArgs = [];\n  var frameId = null;\n\n  var wrapperFn = function wrapperFn() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    lastArgs = args;\n\n    if (frameId) {\n      return;\n    }\n\n    frameId = requestAnimationFrame(function () {\n      frameId = null;\n      fn.apply(void 0, lastArgs);\n    });\n  };\n\n  wrapperFn.cancel = function () {\n    if (!frameId) {\n      return;\n    }\n\n    cancelAnimationFrame(frameId);\n    frameId = null;\n  };\n\n  return wrapperFn;\n};\n\nexport default rafSchd;\n","/**\n * Selection plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nimport schedule from 'raf-schd';\nexport default function Selection(options = {}) {\n  const defaultOptions = {\n    style: {},\n    grid: false,\n    items: true,\n    rows: false\n  };\n  options = { ...options, ...defaultOptions };\n  let state, api;\n  let chartTimeline, top, left;\n  let selecting = { fromX: -1, fromY: -1, toX: -1, toY: -1, startX: -1, startY: -1, data: [], elements: [] };\n  const path = 'config.plugins.selection';\n  const rectClassName = 'gantt-schedule-timeline-caledar__plugin-selection-rect';\n  const rect = document.createElement('div');\n  rect.classList.add(rectClassName);\n  rect.style.visibility = 'hidden';\n  rect.style.left = '0px';\n  rect.style.top = '0px';\n  rect.style.width = '0px';\n  rect.style.height = '0px';\n  rect.style.background = 'rgba(0, 119, 192,0.2)';\n  rect.style.border = '2px dashed rgba(0, 119, 192,1)';\n  rect.style.position = 'absolute';\n  rect.style['user-select'] = 'none';\n  rect.style['pointer-events'] = 'none';\n  for (const styleProp in options.style) {\n    rect.style[styleProp] = options.style[styleProp];\n  }\n\n  function rectSelectionAction(element, data) {\n    chartTimeline = state.get('_internal.elements.chart-timeline');\n    if (!chartTimeline.querySelector('.' + rectClassName)) {\n      chartTimeline.insertAdjacentElement('beforeend', rect);\n      const bounding = chartTimeline.getBoundingClientRect();\n      left = bounding.left;\n      top = bounding.top;\n    }\n\n    function mouseDown(ev) {\n      if (ev.button !== 0) {\n        return;\n      }\n      selecting.fromX = ev.x - left;\n      selecting.fromY = ev.y - top;\n      selecting.startX = selecting.fromX;\n      selecting.startY = selecting.fromY;\n    }\n\n    function saveAndSwapIfNeeded(ev) {\n      const currentX = ev.x - left;\n      const currentY = ev.y - top;\n      if (currentX <= selecting.startX) {\n        selecting.fromX = currentX;\n        selecting.toX = selecting.startX;\n      } else {\n        selecting.fromX = selecting.startX;\n        selecting.toX = currentX;\n      }\n      if (currentY <= selecting.startY) {\n        selecting.fromY = currentY;\n        selecting.toY = selecting.startY;\n      } else {\n        selecting.fromY = selecting.startY;\n        selecting.toY = currentY;\n      }\n    }\n\n    function mouseMove(ev) {\n      if (selecting.fromX === -1 && selecting.fromY === -1) {\n        return;\n      }\n      if (ev.x - left === selecting.fromX || ev.y - top === selecting.fromY) {\n        return;\n      }\n      ev.stopPropagation();\n      saveAndSwapIfNeeded(ev);\n      rect.style.left = selecting.fromX + 'px';\n      rect.style.top = selecting.fromY + 'px';\n      rect.style.visibility = 'visible';\n      rect.style.width = selecting.toX - selecting.fromX + 'px';\n      rect.style.height = selecting.toY - selecting.fromY + 'px';\n      if (!state.get(`${path}.selecting`)) state.update(`${path}.selecting`, true);\n    }\n\n    function mouseUp(ev) {\n      if (selecting.fromX !== -1 && selecting.fromY !== -1) {\n        ev.stopPropagation();\n      }\n      selecting.fromX = -1;\n      selecting.fromY = -1;\n      selecting.startX = -1;\n      selecting.startY = -1;\n      selecting.data = [];\n      selecting.elements = [];\n      rect.style.visibility = 'hidden';\n      state.update(`${path}.selecting`, false);\n    }\n\n    element.addEventListener('mousedown', mouseDown);\n    document.body.addEventListener('mousemove', schedule(mouseMove));\n    document.body.addEventListener('mouseup', mouseUp);\n    return {\n      update(element, changedData) {\n        data = changedData;\n      },\n      destroy() {\n        document.body.removeEventListener('mouseup', mouseUp);\n        document.body.removeEventListener('mousemove', mouseMove);\n        element.removeEventListener('mousedown', mouseDown);\n      }\n    };\n  }\n\n  return function initialize(State, Api) {\n    state = State;\n    api = Api;\n    if (typeof state.get(path) === 'undefined') {\n      state.update(path, { selecting: false, selected: [] });\n    }\n    state.update('config.actions.chart-timeline', actions => {\n      actions.push(rectSelectionAction);\n      return actions;\n    });\n  };\n}\n"],"names":["rafSchd","fn","lastArgs","frameId","wrapperFn","_len","arguments","length","args","Array","_key","requestAnimationFrame","apply","cancel","cancelAnimationFrame","options","state","chartTimeline","top","left","style","grid","items","rows","selecting","fromX","fromY","toX","toY","startX","startY","data","elements","path","rectClassName","rect","document","createElement","classList","add","visibility","width","height","background","border","position","styleProp","rectSelectionAction","element","get","querySelector","insertAdjacentElement","bounding","getBoundingClientRect","mouseDown","ev","button","x","y","mouseMove","stopPropagation","currentX","currentY","saveAndSwapIfNeeded","update","mouseUp","addEventListener","body","schedule","[object Object]","changedData","removeEventListener","State","Api","selected","actions","push"],"mappings":"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"}