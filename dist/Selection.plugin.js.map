{"version":3,"file":"Selection.plugin.js","sources":["../node_modules/raf-schd/dist/raf-schd.esm.js","../src/plugins/Selection.plugin.js"],"sourcesContent":["var rafSchd = function rafSchd(fn) {\n  var lastArgs = [];\n  var frameId = null;\n\n  var wrapperFn = function wrapperFn() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    lastArgs = args;\n\n    if (frameId) {\n      return;\n    }\n\n    frameId = requestAnimationFrame(function () {\n      frameId = null;\n      fn.apply(void 0, lastArgs);\n    });\n  };\n\n  wrapperFn.cancel = function () {\n    if (!frameId) {\n      return;\n    }\n\n    cancelAnimationFrame(frameId);\n    frameId = null;\n  };\n\n  return wrapperFn;\n};\n\nexport default rafSchd;\n","/**\n * Selection plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nimport schedule from 'raf-schd';\nexport default function Selection(options = {}) {\n  const defaultOptions = {\n    style: {},\n    grid: false,\n    items: true,\n    rows: false\n  };\n  options = { ...options, ...defaultOptions };\n  let state, api;\n  let chartTimeline, top, left;\n  let selecting = { fromX: -1, fromY: -1, toX: -1, toY: -1, startX: -1, startY: -1 };\n  const path = 'config.plugins.selection';\n  const rectClassName = 'gantt-schedule-timeline-caledar__plugin-selection-rect';\n  const rect = document.createElement('div');\n  rect.classList.add(rectClassName);\n  rect.style.visibility = 'hidden';\n  rect.style.left = '0px';\n  rect.style.top = '0px';\n  rect.style.width = '0px';\n  rect.style.height = '0px';\n  rect.style.background = 'rgba(0, 119, 192,0.2)';\n  rect.style.border = '2px dashed rgba(0, 119, 192,1)';\n  rect.style.position = 'absolute';\n  rect.style['user-select'] = 'none';\n  rect.style['pointer-events'] = 'none';\n  for (const styleProp in options.style) {\n    rect.style[styleProp] = options.style[styleProp];\n  }\n\n  function rectSelectionAction(element, data) {\n    chartTimeline = state.get('_internal.elements.chart-timeline');\n    if (!chartTimeline.querySelector('.' + rectClassName)) {\n      chartTimeline.insertAdjacentElement('beforeend', rect);\n      const bounding = chartTimeline.getBoundingClientRect();\n      left = bounding.left;\n      top = bounding.top;\n    }\n\n    function mouseDown(ev) {\n      if (ev.button !== 0) {\n        return;\n      }\n      selecting.fromX = ev.x - left;\n      selecting.fromY = ev.y - top;\n      selecting.startX = selecting.fromX;\n      selecting.startY = selecting.fromY;\n    }\n\n    function saveAndSwapIfNeeded(ev) {\n      const currentX = ev.x - left;\n      const currentY = ev.y - top;\n      if (currentX <= selecting.startX) {\n        selecting.fromX = currentX;\n        selecting.toX = selecting.startX;\n      } else {\n        selecting.fromX = selecting.startX;\n        selecting.toX = currentX;\n      }\n      if (currentY <= selecting.startY) {\n        selecting.fromY = currentY;\n        selecting.toY = selecting.startY;\n      } else {\n        selecting.fromY = selecting.startY;\n        selecting.toY = currentY;\n      }\n    }\n\n    function mouseMove(ev) {\n      if (selecting.fromX === -1 && selecting.fromY === -1) {\n        return;\n      }\n      if (ev.x - left === selecting.fromX || ev.y - top === selecting.fromY) {\n        return;\n      }\n      ev.stopPropagation();\n      saveAndSwapIfNeeded(ev);\n      rect.style.left = selecting.fromX + 'px';\n      rect.style.top = selecting.fromY + 'px';\n      rect.style.visibility = 'visible';\n      rect.style.width = selecting.toX - selecting.fromX + 'px';\n      rect.style.height = selecting.toY - selecting.fromY + 'px';\n      if (!state.get(`${path}.selecting`)) state.update(`${path}.selecting`, true);\n    }\n\n    function mouseUp(ev) {\n      if (selecting.fromX !== -1 && selecting.fromY !== -1) {\n        ev.stopPropagation();\n      }\n      selecting.fromX = -1;\n      selecting.fromY = -1;\n      selecting.startX = -1;\n      selecting.startY = -1;\n      rect.style.visibility = 'hidden';\n      if (state.get(`${path}.selecting`)) state.update(`${path}.selecting`, false);\n    }\n\n    element.addEventListener('mousedown', mouseDown);\n    document.body.addEventListener('mousemove', schedule(mouseMove));\n    document.body.addEventListener('mouseup', mouseUp);\n    return {\n      update(element, changedData) {\n        data = changedData;\n      },\n      destroy() {\n        document.body.removeEventListener('mouseup', mouseUp);\n        document.body.removeEventListener('mousemove', mouseMove);\n        element.removeEventListener('mousedown', mouseDown);\n      }\n    };\n  }\n\n  return function initialize(State, Api) {\n    state = State;\n    api = Api;\n    if (typeof state.get(path) === 'undefined') {\n      state.update(path, {\n        selecting: false,\n        selected: {\n          'chart-timeline-grid-rows': [],\n          'chart-timeline-grid-row-blocks': [],\n          'chart-timeline-items-rows': [],\n          'chart-timeline-items-row-items': []\n        }\n      });\n    }\n    state.update('config.actions.chart-timeline', actions => {\n      actions.push(rectSelectionAction);\n      return actions;\n    });\n  };\n}\n"],"names":["rafSchd","fn","lastArgs","frameId","wrapperFn","_len","arguments","length","args","Array","_key","requestAnimationFrame","apply","cancel","cancelAnimationFrame","options","state","chartTimeline","top","left","style","grid","items","rows","selecting","fromX","fromY","toX","toY","startX","startY","path","rectClassName","rect","document","createElement","classList","add","visibility","width","height","background","border","position","styleProp","rectSelectionAction","element","data","get","querySelector","insertAdjacentElement","bounding","getBoundingClientRect","mouseDown","ev","button","x","y","mouseMove","stopPropagation","currentX","currentY","saveAndSwapIfNeeded","update","mouseUp","addEventListener","body","schedule","[object Object]","changedData","removeEventListener","State","Api","selected","chart-timeline-grid-rows","chart-timeline-grid-row-blocks","chart-timeline-items-rows","chart-timeline-items-row-items","actions","push"],"mappings":"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"}