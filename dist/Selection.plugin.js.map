{"version":3,"file":"Selection.plugin.js","sources":["../src/plugins/Selection/helpers.ts","../src/plugins/Selection/SelectAction.ts","../src/plugins/Selection/Wrapper.ts","../src/plugins/Selection/Selection.plugin.ts"],"sourcesContent":["/**\n * Selection plugin helpers\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   AGPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nexport interface Options {\n  enabled?: boolean;\n  grid?: boolean;\n  items?: boolean;\n  rows?: boolean;\n  horizontal?: boolean;\n  vertical?: boolean;\n  selecting?: (data, type: string) => void;\n  deselecting?: (data, type: string) => void;\n  selected?: (data, type) => void;\n  deselected?: (data, type) => void;\n  canSelect?: (type, state, all) => any[];\n  canDeselect?: (type, state, all) => any[];\n}\n\nexport interface Items {\n  [key: string]: string[];\n}\n\nexport interface PointerEvents {\n  down: PointerEvent | null;\n  move: PointerEvent | null;\n  up: PointerEvent | null;\n}\n\nexport interface SelectionData {\n  enabled: boolean;\n  currentTarget: HTMLElement | null;\n  realTarget: HTMLElement | null;\n  targetType: 'item' | 'cell' | '';\n  isSelecting: boolean;\n  events: PointerEvents;\n}\n\nexport interface SelectState {\n  selecting?: Items;\n  selected?: Items;\n}\n\nexport function prepareOptions(options) {\n  const defaultOptions: Options = {\n    enabled: true,\n    grid: false,\n    items: true,\n    rows: false,\n    horizontal: true,\n    vertical: true,\n    selecting() {},\n    deselecting() {},\n    selected() {},\n    deselected() {},\n    canSelect(type, currently, all) {\n      return currently;\n    },\n    canDeselect(type, currently, all) {\n      return [];\n    }\n  };\n  options = { ...defaultOptions, ...options } as Options;\n  return options;\n}\n\nexport const selectionTypesIdGetters = {\n  'chart-timeline-grid-row': props => props.row.id,\n  'chart-timeline-grid-row-cell': props => props.id,\n  'chart-timeline-items-row': props => props.row.id,\n  'chart-timeline-items-row-item': props => props.item.id\n};\n","/**\n * Select Action\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   AGPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nimport { SelectionData } from './helpers';\n\nlet vido, api, state, options;\nconst pluginPath = 'config.plugin.Selection';\n\nconst classNames = {\n  cell: '',\n  item: ''\n};\n\nexport function generateEmptyData(): SelectionData {\n  return {\n    enabled: options.enabled,\n    currentTarget: null,\n    realTarget: null,\n    targetType: '',\n    isSelecting: false,\n    events: {\n      down: null,\n      move: null,\n      up: null\n    }\n  };\n}\n\nclass SelectAction {\n  private data: SelectionData;\n\n  constructor(element) {\n    this.pointerDown = this.pointerDown.bind(this);\n    this.pointerMove = this.pointerMove.bind(this);\n    this.pointerUp = this.pointerUp.bind(this);\n    this.data = generateEmptyData();\n    element.addEventListener('pointerdown', this.pointerDown);\n    document.addEventListener('pointerup', this.pointerUp);\n    document.addEventListener('pointermove', this.pointerMove);\n  }\n\n  destroy(element) {\n    element.removeEventListener('pointerdown', this.pointerDown);\n    document.removeEventListener('pointerup', this.pointerUp);\n    document.removeEventListener('pointermove', this.pointerMove);\n  }\n\n  private updateData() {\n    state.update(pluginPath, () => ({ ...this.data }));\n  }\n\n  private getRealTarget(ev: PointerEvent) {\n    let realTarget: HTMLElement = (ev.target as HTMLElement).closest('.' + classNames.item) as HTMLElement;\n    if (realTarget) {\n      return realTarget;\n    }\n    realTarget = (ev.target as HTMLElement).closest('.' + classNames.cell) as HTMLElement;\n    if (realTarget) {\n      return realTarget;\n    }\n    return null;\n  }\n\n  private pointerDown(ev: PointerEvent) {\n    this.data.currentTarget = ev.target as HTMLElement;\n    this.data.realTarget = this.getRealTarget(ev);\n    if (this.data.realTarget) {\n      if (this.data.realTarget.classList.contains(classNames.item)) {\n        this.data.targetType = 'item';\n      } else if (this.data.realTarget.classList.contains(classNames.cell)) {\n        this.data.targetType = 'cell';\n      } else {\n        this.data.targetType = '';\n      }\n    } else {\n      this.data.targetType = '';\n    }\n    this.data.isSelecting = !!this.data.realTarget;\n    this.data.events.down = ev;\n    this.updateData();\n  }\n\n  private pointerUp(ev: PointerEvent) {\n    this.data.isSelecting = false;\n    this.data.events.up = ev;\n    this.updateData();\n  }\n\n  private pointerMove(ev: PointerEvent) {\n    if (this.data.isSelecting) {\n      this.data.events.move = ev;\n      this.updateData();\n    }\n  }\n}\n\nexport function prepareSelectAction(vidoInstance, opts) {\n  options = opts;\n  vido = vidoInstance;\n  api = vido.api;\n  state = vido.state;\n  classNames.cell = api.getClass('chart-timeline-grid-row-cell');\n  classNames.item = api.getClass('chart-timeline-items-row-item');\n  return SelectAction;\n}\n","/**\n * Selection ChartTimeline Wrapper\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   AGPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nimport { SelectionData } from './helpers';\n\nlet wrapped, vido, api, state, html;\nlet data: SelectionData;\nlet className, styleMap;\n\n// this function will be called at each rerender\nfunction ChartTimelineWrapper(input, props) {\n  const oldContent = wrapped(input, props);\n  if (data.isSelecting) {\n    styleMap.style.display = 'block';\n  } else {\n    styleMap.style.display = 'none';\n  }\n  const SelectionRectangle = html`\n    <div class=${className} style=${styleMap}>${data.targetType}</div>\n  `;\n  return html`\n    ${oldContent}${SelectionRectangle}\n  `;\n}\n\nexport function Wrap(oldWrapper, vidoInstance) {\n  wrapped = oldWrapper;\n  vido = vidoInstance;\n  api = vido.api;\n  state = vido.state;\n  html = vido.html;\n  className = api.getClass('chart-selection');\n  styleMap = new vido.StyleMap({ display: 'none' });\n\n  state.subscribe('config.plugin.Selection', (Selection: SelectionData) => {\n    data = Selection;\n    vido.update(); // rerender to update rectangle\n  });\n\n  return ChartTimelineWrapper;\n}\n","/**\n * Selection plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   AGPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nimport { Options, prepareOptions, SelectionData } from './helpers';\nimport { prepareSelectAction, generateEmptyData } from './SelectAction';\nimport { Wrap } from './Wrapper';\n\nexport default function Selection(options: Options = {}) {\n  let vido, api, state;\n  options = prepareOptions(options);\n\n  return function initialize(vidoInstance) {\n    vido = vidoInstance;\n    api = vido.api;\n    state = vido.state;\n    state.update('config.actions.chart-timeline', timelineActions => {\n      timelineActions.push(prepareSelectAction(vido, options));\n      return timelineActions;\n    });\n    state.update('config.plugin.Selection', data => {\n      return generateEmptyData();\n    });\n    state.update('config.wrappers.ChartTimelineItems', oldWrapper => {\n      return Wrap(oldWrapper, vido);\n    });\n  };\n}\n"],"names":["vido","api","state"],"mappings":";;;;;;EAAA;;;;;;;;;WAiDgB,cAAc,CAAC,OAAO;MACpC,MAAM,cAAc,GAAY;UAC9B,OAAO,EAAE,IAAI;UACb,IAAI,EAAE,KAAK;UACX,KAAK,EAAE,IAAI;UACX,IAAI,EAAE,KAAK;UACX,UAAU,EAAE,IAAI;UAChB,QAAQ,EAAE,IAAI;UACd,SAAS,MAAK;UACd,WAAW,MAAK;UAChB,QAAQ,MAAK;UACb,UAAU,MAAK;UACf,SAAS,CAAC,IAAI,EAAE,SAAS,EAAE,GAAG;cAC5B,OAAO,SAAS,CAAC;WAClB;UACD,WAAW,CAAC,IAAI,EAAE,SAAS,EAAE,GAAG;cAC9B,OAAO,EAAE,CAAC;WACX;OACF,CAAC;MACF,OAAO,GAAG,gCAAK,cAAc,GAAK,OAAO,CAAa,CAAC;MACvD,OAAO,OAAO,CAAC;EACjB,CAAC;;;ECtED;;;;;;;;;EAYA,IAAI,IAAI,EAAE,GAAG,EAAE,KAAK,EAAE,OAAO,CAAC;EAC9B,MAAM,UAAU,GAAG,yBAAyB,CAAC;EAE7C,MAAM,UAAU,GAAG;MACjB,IAAI,EAAE,EAAE;MACR,IAAI,EAAE,EAAE;GACT,CAAC;WAEc,iBAAiB;MAC/B,OAAO;UACL,OAAO,EAAE,OAAO,CAAC,OAAO;UACxB,aAAa,EAAE,IAAI;UACnB,UAAU,EAAE,IAAI;UAChB,UAAU,EAAE,EAAE;UACd,WAAW,EAAE,KAAK;UAClB,MAAM,EAAE;cACN,IAAI,EAAE,IAAI;cACV,IAAI,EAAE,IAAI;cACV,EAAE,EAAE,IAAI;WACT;OACF,CAAC;EACJ,CAAC;EAED,MAAM,YAAY;MAGhB,YAAY,OAAO;UACjB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;UAC/C,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;UAC/C,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;UAC3C,IAAI,CAAC,IAAI,GAAG,iBAAiB,EAAE,CAAC;UAChC,OAAO,CAAC,gBAAgB,CAAC,aAAa,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;UAC1D,QAAQ,CAAC,gBAAgB,CAAC,WAAW,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;UACvD,QAAQ,CAAC,gBAAgB,CAAC,aAAa,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;OAC5D;MAED,OAAO,CAAC,OAAO;UACb,OAAO,CAAC,mBAAmB,CAAC,aAAa,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;UAC7D,QAAQ,CAAC,mBAAmB,CAAC,WAAW,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;UAC1D,QAAQ,CAAC,mBAAmB,CAAC,aAAa,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;OAC/D;MAEO,UAAU;UAChB,KAAK,CAAC,MAAM,CAAC,UAAU,EAAE,yBAAY,IAAI,CAAC,IAAI,EAAG,CAAC,CAAC;OACpD;MAEO,aAAa,CAAC,EAAgB;UACpC,IAAI,UAAU,GAAiB,EAAE,CAAC,MAAsB,CAAC,OAAO,CAAC,GAAG,GAAG,UAAU,CAAC,IAAI,CAAgB,CAAC;UACvG,IAAI,UAAU,EAAE;cACd,OAAO,UAAU,CAAC;WACnB;UACD,UAAU,GAAI,EAAE,CAAC,MAAsB,CAAC,OAAO,CAAC,GAAG,GAAG,UAAU,CAAC,IAAI,CAAgB,CAAC;UACtF,IAAI,UAAU,EAAE;cACd,OAAO,UAAU,CAAC;WACnB;UACD,OAAO,IAAI,CAAC;OACb;MAEO,WAAW,CAAC,EAAgB;UAClC,IAAI,CAAC,IAAI,CAAC,aAAa,GAAG,EAAE,CAAC,MAAqB,CAAC;UACnD,IAAI,CAAC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;UAC9C,IAAI,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;cACxB,IAAI,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE;kBAC5D,IAAI,CAAC,IAAI,CAAC,UAAU,GAAG,MAAM,CAAC;eAC/B;mBAAM,IAAI,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE;kBACnE,IAAI,CAAC,IAAI,CAAC,UAAU,GAAG,MAAM,CAAC;eAC/B;mBAAM;kBACL,IAAI,CAAC,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;eAC3B;WACF;eAAM;cACL,IAAI,CAAC,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;WAC3B;UACD,IAAI,CAAC,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC;UAC/C,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,GAAG,EAAE,CAAC;UAC3B,IAAI,CAAC,UAAU,EAAE,CAAC;OACnB;MAEO,SAAS,CAAC,EAAgB;UAChC,IAAI,CAAC,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;UAC9B,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,GAAG,EAAE,CAAC;UACzB,IAAI,CAAC,UAAU,EAAE,CAAC;OACnB;MAEO,WAAW,CAAC,EAAgB;UAClC,IAAI,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;cACzB,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,GAAG,EAAE,CAAC;cAC3B,IAAI,CAAC,UAAU,EAAE,CAAC;WACnB;OACF;GACF;WAEe,mBAAmB,CAAC,YAAY,EAAE,IAAI;MACpD,OAAO,GAAG,IAAI,CAAC;MACf,IAAI,GAAG,YAAY,CAAC;MACpB,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC;MACf,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;MACnB,UAAU,CAAC,IAAI,GAAG,GAAG,CAAC,QAAQ,CAAC,8BAA8B,CAAC,CAAC;MAC/D,UAAU,CAAC,IAAI,GAAG,GAAG,CAAC,QAAQ,CAAC,+BAA+B,CAAC,CAAC;MAChE,OAAO,YAAY,CAAC;EACtB,CAAC;;;EC/GD;;;;;;;;;EAYA,IAAI,OAAO,EAAEA,MAAI,EAAEC,KAAG,EAAEC,OAAK,EAAE,IAAI,CAAC;EACpC,IAAI,IAAmB,CAAC;EACxB,IAAI,SAAS,EAAE,QAAQ,CAAC;EAExB;EACA,SAAS,oBAAoB,CAAC,KAAK,EAAE,KAAK;MACxC,MAAM,UAAU,GAAG,OAAO,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;MACzC,IAAI,IAAI,CAAC,WAAW,EAAE;UACpB,QAAQ,CAAC,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;OAClC;WAAM;UACL,QAAQ,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;OACjC;MACD,MAAM,kBAAkB,GAAG,IAAI,CAAA;iBAChB,SAAS,UAAU,QAAQ,IAAI,IAAI,CAAC,UAAU;GAC5D,CAAC;MACF,OAAO,IAAI,CAAA;MACP,UAAU,GAAG,kBAAkB;GAClC,CAAC;EACJ,CAAC;WAEe,IAAI,CAAC,UAAU,EAAE,YAAY;MAC3C,OAAO,GAAG,UAAU,CAAC;MACrBF,MAAI,GAAG,YAAY,CAAC;MACpBC,KAAG,GAAGD,MAAI,CAAC,GAAG,CAAC;MACfE,OAAK,GAAGF,MAAI,CAAC,KAAK,CAAC;MACnB,IAAI,GAAGA,MAAI,CAAC,IAAI,CAAC;MACjB,SAAS,GAAGC,KAAG,CAAC,QAAQ,CAAC,iBAAiB,CAAC,CAAC;MAC5C,QAAQ,GAAG,IAAID,MAAI,CAAC,QAAQ,CAAC,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC,CAAC;MAElDE,OAAK,CAAC,SAAS,CAAC,yBAAyB,EAAE,CAAC,SAAwB;UAClE,IAAI,GAAG,SAAS,CAAC;UACjBF,MAAI,CAAC,MAAM,EAAE,CAAC;OACf,CAAC,CAAC;MAEH,OAAO,oBAAoB,CAAC;EAC9B;;EC/CA;;;;;;;;;WAcwB,SAAS,CAAC,UAAmB,EAAE;MACrD,IAAI,IAAI,EAAE,GAAG,EAAE,KAAK,CAAC;MACrB,OAAO,GAAG,cAAc,CAAC,OAAO,CAAC,CAAC;MAElC,OAAO,SAAS,UAAU,CAAC,YAAY;UACrC,IAAI,GAAG,YAAY,CAAC;UACpB,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC;UACf,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;UACnB,KAAK,CAAC,MAAM,CAAC,+BAA+B,EAAE,eAAe;cAC3D,eAAe,CAAC,IAAI,CAAC,mBAAmB,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC,CAAC;cACzD,OAAO,eAAe,CAAC;WACxB,CAAC,CAAC;UACH,KAAK,CAAC,MAAM,CAAC,yBAAyB,EAAE,IAAI;cAC1C,OAAO,iBAAiB,EAAE,CAAC;WAC5B,CAAC,CAAC;UACH,KAAK,CAAC,MAAM,CAAC,oCAAoC,EAAE,UAAU;cAC3D,OAAO,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;WAC/B,CAAC,CAAC;OACJ,CAAC;EACJ,CAAC;;;;;;;;;"}