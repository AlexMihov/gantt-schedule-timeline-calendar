{"version":3,"file":"item-resizing.plugin.js","sources":["../src/plugins/timeline-pointer.plugin.ts","../src/plugins/item-resizing.plugin.ts"],"sourcesContent":["/**\n * TimelinePointer plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   AGPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nimport DeepState from 'deep-state-observer';\nimport { Api } from '../api/api';\nimport { Vido } from '@src/gstc';\n\nexport const CELL = 'chart-timeline-grid-row-cell';\nexport type CELL_TYPE = 'chart-timeline-grid-row-cell';\nexport const ITEM = 'chart-timeline-items-row-item';\nexport type ITEM_TYPE = 'chart-timeline-items-row-item';\n\nexport interface PointerEvents {\n  down: PointerEvent | null;\n  move: PointerEvent | null;\n  up: PointerEvent | null;\n}\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type PointerState = 'up' | 'down' | 'move';\n\nexport interface PluginData {\n  enabled: boolean;\n  isMoving: boolean;\n  pointerState: PointerState;\n  currentTarget: HTMLElement | null;\n  realTarget: HTMLElement | null;\n  targetType: ITEM_TYPE | CELL_TYPE | '';\n  targetData: any | null;\n  events: PointerEvents;\n  initialPosition: Point;\n  currentPosition: Point;\n}\n\nexport function Plugin(options = { enabled: true }) {\n  let vido: Vido, api: Api, state: DeepState;\n  const pluginPath = 'config.plugin.TimelinePointer';\n\n  const classNames = {\n    cell: '',\n    item: '',\n  };\n\n  function generateEmptyData(): PluginData {\n    return {\n      enabled: options.enabled,\n      isMoving: false,\n      pointerState: 'up',\n      currentTarget: null,\n      realTarget: null,\n      targetType: '',\n      targetData: null,\n      initialPosition: { x: 0, y: 0 },\n      currentPosition: { x: 0, y: 0 },\n      events: {\n        down: null,\n        move: null,\n        up: null,\n      },\n    };\n  }\n\n  let chartTimelineElement: HTMLElement;\n\n  class TimelinePointerAction {\n    private data: PluginData;\n    private unsub = [];\n\n    constructor(element) {\n      this.pointerDown = this.pointerDown.bind(this);\n      this.pointerMove = this.pointerMove.bind(this);\n      this.pointerUp = this.pointerUp.bind(this);\n      this.data = generateEmptyData();\n      element.addEventListener('pointerdown', this.pointerDown);\n      document.addEventListener('pointerup', this.pointerUp);\n      document.addEventListener('pointermove', this.pointerMove);\n      this.unsub.push(state.subscribe(pluginPath, (value) => (this.data = value)));\n    }\n\n    public destroy(element) {\n      element.removeEventListener('pointerdown', this.pointerDown);\n      document.removeEventListener('pointerup', this.pointerUp);\n      document.removeEventListener('pointermove', this.pointerMove);\n    }\n\n    private updateData() {\n      state.update(pluginPath, () => ({ ...this.data }));\n    }\n\n    private getRealTarget(ev: PointerEvent) {\n      let realTarget: HTMLElement = (ev.target as HTMLElement).closest('.' + classNames.item) as HTMLElement;\n      if (realTarget) {\n        return realTarget;\n      }\n      realTarget = (ev.target as HTMLElement).closest('.' + classNames.cell) as HTMLElement;\n      if (realTarget) {\n        return realTarget;\n      }\n      return null;\n    }\n\n    getRealPosition(ev: PointerEvent): Point {\n      const pos = { x: 0, y: 0 };\n      if (chartTimelineElement) {\n        const bounding = chartTimelineElement.getBoundingClientRect();\n        pos.x = ev.x - bounding.x;\n        pos.y = ev.y - bounding.y;\n      }\n      return pos;\n    }\n\n    private pointerDown(ev: PointerEvent) {\n      if (!this.data.enabled) return;\n      this.data.pointerState = 'down';\n      this.data.currentTarget = ev.target as HTMLElement;\n      this.data.realTarget = this.getRealTarget(ev);\n      if (this.data.realTarget) {\n        if (this.data.realTarget.classList.contains(classNames.item)) {\n          this.data.targetType = ITEM;\n          // @ts-ignore\n          this.data.targetData = this.data.realTarget.vido.item;\n        } else if (this.data.realTarget.classList.contains(classNames.cell)) {\n          this.data.targetType = CELL;\n          // @ts-ignore\n          this.data.targetData = this.data.realTarget.vido;\n        } else {\n          this.data.targetType = '';\n        }\n      } else {\n        this.data.targetType = '';\n        this.data.targetData = null;\n      }\n      this.data.isMoving = !!this.data.realTarget;\n      this.data.events.down = ev;\n      this.data.events.move = ev;\n      const realPosition = this.getRealPosition(ev);\n      this.data.initialPosition = realPosition;\n      this.data.currentPosition = realPosition;\n      this.updateData();\n    }\n\n    private pointerUp(ev: PointerEvent) {\n      if (!this.data.enabled) return;\n      this.data.pointerState = 'up';\n      this.data.isMoving = false;\n      this.data.events.up = ev;\n      this.data.currentPosition = this.getRealPosition(ev);\n      this.updateData();\n    }\n\n    private pointerMove(ev: PointerEvent) {\n      if (!this.data.enabled || !this.data.isMoving) return;\n      this.data.pointerState = 'move';\n      this.data.events.move = ev;\n      this.data.currentPosition = this.getRealPosition(ev);\n      this.updateData();\n    }\n  }\n\n  return function initialize(vidoInstance: Vido) {\n    vido = vidoInstance;\n    api = vido.api;\n    state = vido.state;\n    classNames.cell = api.getClass(CELL);\n    classNames.item = api.getClass(ITEM);\n    const unsub = state.subscribe('$data.elements.chart-timeline', (el) => (chartTimelineElement = el));\n    state.update('config.actions.chart-timeline', (timelineActions) => {\n      timelineActions.push(TimelinePointerAction);\n      return timelineActions;\n    });\n    state.update(pluginPath, (data) => {\n      return generateEmptyData();\n    });\n\n    return function destroy() {\n      unsub();\n    };\n  };\n}\n","/**\n * ItemResizing plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   AGPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nimport { Vido, Wrapper, htmlResult, Item, DataChartTime } from '@src/gstc';\nimport DeepState from 'deep-state-observer';\nimport { Api } from '../api/api';\nimport { lithtml } from '@neuronet.io/vido/vido';\nimport { Point, ITEM } from './timeline-pointer.plugin';\n\nexport interface Handle {\n  width?: number;\n  horizontalMargin?: number;\n  verticalMargin?: number;\n  outside?: boolean;\n  onlyWhenSelected?: boolean;\n}\n\nexport interface ItemInitial {\n  id: string;\n  left: number;\n  width: number;\n}\n\nexport interface Options {\n  enabled?: boolean;\n  handle?: Handle;\n}\n\nexport interface PluginData extends Options {\n  leftIsMoving: boolean;\n  rightIsMoving: boolean;\n  itemsInitial: ItemInitial[];\n  initialPosition: Point;\n  currentPosition: Point;\n  movement: number;\n}\n\nfunction generateEmptyData(options: Options = {}): PluginData {\n  const result = {\n    enabled: true,\n    handle: {\n      width: 18,\n      horizontalMargin: 1,\n      verticalMargin: 1,\n      outside: false,\n      onlyWhenSelected: true,\n    },\n    initialPosition: { x: 0, y: 0 },\n    currentPosition: { x: 0, y: 0 },\n    movement: 0,\n    itemsInitial: [],\n    leftIsMoving: false,\n    rightIsMoving: false,\n    ...options,\n  };\n  if (options.handle) result.handle = { ...result.handle, ...options.handle };\n  return result;\n}\n\nclass ItemResizing {\n  private vido: Vido;\n  private state: DeepState;\n  private api: Api;\n  private data: PluginData;\n  private oldWrapper: Wrapper;\n  private html: typeof lithtml.html;\n  private leftClassName: string;\n  private rightClassName: string;\n  private spacing: number = 1;\n  private unsubs: (() => void)[] = [];\n\n  constructor(vido: Vido, options: Options) {\n    this.vido = vido;\n    this.state = vido.state;\n    this.api = vido.api;\n    this.data = generateEmptyData(options);\n    this.html = vido.html;\n    this.wrapper = this.wrapper.bind(this);\n    this.onRightPointerDown = this.onRightPointerDown.bind(this);\n    this.onRightPointerMove = this.onRightPointerMove.bind(this);\n    this.onRightPointerUp = this.onRightPointerUp.bind(this);\n    this.onLeftPointerDown = this.onLeftPointerDown.bind(this);\n    this.onLeftPointerMove = this.onLeftPointerMove.bind(this);\n    this.onLeftPointerUp = this.onLeftPointerUp.bind(this);\n    this.updateData();\n    this.unsubs.push(this.state.subscribe('config.plugin.ItemResizing', (data) => (this.data = data)));\n    document.addEventListener('pointermove', this.onLeftPointerMove);\n    document.addEventListener('pointerup', this.onLeftPointerUp);\n    document.addEventListener('pointermove', this.onRightPointerMove);\n    document.addEventListener('pointerup', this.onRightPointerUp);\n  }\n\n  public destroy() {\n    this.unsubs.forEach((unsub) => unsub());\n    document.removeEventListener('pointermove', this.onLeftPointerMove);\n    document.removeEventListener('pointerup', this.onLeftPointerUp);\n    document.removeEventListener('pointermove', this.onRightPointerMove);\n    document.removeEventListener('pointerup', this.onRightPointerUp);\n  }\n\n  private updateData() {\n    this.state.update('config.plugin.ItemResizing', this.data);\n  }\n\n  private initializeWrapper() {\n    this.leftClassName = this.api.getClass('chart-timeline-items-row-item-resizing-handle');\n    this.leftClassName += ' ' + this.leftClassName + '--left';\n    this.rightClassName = this.api.getClass('chart-timeline-items-row-item-resizing-handle');\n    this.rightClassName += ' ' + this.rightClassName + '--right';\n    this.spacing = this.state.get('config.chart.spacing');\n  }\n\n  private getSelectedItems(): Item[] {\n    return this.state.get(`config.plugin.Selection.selected.${ITEM}`);\n  }\n\n  private getRightStyleMap(item: Item, visible: boolean) {\n    const rightStyleMap = new this.vido.StyleMap({});\n    rightStyleMap.style.top = item.$data.position.actualTop + this.data.handle.verticalMargin + 'px';\n    if (this.data.handle.outside) {\n      rightStyleMap.style.left = item.$data.position.right + this.data.handle.horizontalMargin - this.spacing + 'px';\n    } else {\n      rightStyleMap.style.left =\n        item.$data.position.right - this.data.handle.width - this.data.handle.horizontalMargin - this.spacing + 'px';\n    }\n    rightStyleMap.style.width = this.data.handle.width + 'px';\n    rightStyleMap.style.height = item.$data.actualHeight - this.data.handle.verticalMargin * 2 + 'px';\n    return rightStyleMap;\n  }\n\n  private getLeftStyleMap(item: Item, visible: boolean) {\n    const leftStyleMap = new this.vido.StyleMap({});\n    leftStyleMap.style.top = item.$data.position.actualTop + this.data.handle.verticalMargin + 'px';\n    if (this.data.handle.outside) {\n      leftStyleMap.style.left =\n        item.$data.position.left - this.data.handle.width - this.data.handle.horizontalMargin + 'px';\n    } else {\n      leftStyleMap.style.left = item.$data.position.left + this.data.handle.horizontalMargin + 'px';\n    }\n    leftStyleMap.style.width = this.data.handle.width + 'px';\n    leftStyleMap.style.height = item.$data.actualHeight - this.data.handle.verticalMargin * 2 + 'px';\n    return leftStyleMap;\n  }\n\n  private onPointerDown(ev: PointerEvent) {\n    ev.preventDefault();\n    ev.stopPropagation();\n    this.data.itemsInitial = this.getSelectedItems().map((item: Item) => {\n      return {\n        id: item.id,\n        left: item.$data.position.left,\n        width: item.$data.width,\n      };\n    });\n    this.data.initialPosition = {\n      x: ev.screenX,\n      y: ev.screenY,\n    };\n    this.data.currentPosition = { ...this.data.initialPosition };\n  }\n\n  private onLeftPointerDown(ev: PointerEvent) {\n    /*if (!this.data.enabled) return;\n    this.data.leftIsMoving = true;\n    this.onPointerDown(ev);\n    this.updateData();*/\n  }\n  private onRightPointerDown(ev: PointerEvent) {\n    if (!this.data.enabled) return;\n    this.data.rightIsMoving = true;\n    this.onPointerDown(ev);\n    this.updateData();\n  }\n\n  private onPointerMove(ev: PointerEvent) {\n    ev.stopPropagation();\n    ev.preventDefault();\n    this.data.currentPosition.x = ev.screenX;\n    this.data.currentPosition.y = ev.screenY;\n    this.data.movement = this.data.currentPosition.x - this.data.initialPosition.x;\n  }\n  private onLeftPointerMove(ev: PointerEvent) {\n    if (!this.data.enabled || !this.data.leftIsMoving) return;\n    this.onPointerMove(ev);\n    const selected = this.getSelectedItems();\n    const movement = this.data.movement;\n    const time: DataChartTime = this.state.get('$data.chart.time');\n    let multi = this.state.multi();\n    for (let i = 0, len = selected.length; i < len; i++) {\n      const item = selected[i];\n      item.$data.position.left = this.data.itemsInitial[i].left + movement;\n      if (item.$data.position.left > item.$data.position.right) item.$data.position.left = item.$data.position.right;\n      item.$data.position.actualLeft = item.$data.position.left;\n      item.$data.width = item.$data.position.right - item.$data.position.left;\n      item.$data.actualWidth = item.$data.width;\n      const leftGlobal = this.api.time.getTimeFromViewOffsetPx(item.$data.position.left, time);\n      item.time.start = leftGlobal;\n      item.$data.time.startDate = this.api.time.date(leftGlobal);\n      multi = multi.update(`config.chart.items.${item.id}`, item);\n    }\n    multi.done();\n    this.updateData();\n  }\n\n  private onRightPointerMove(ev: PointerEvent) {\n    if (!this.data.enabled || !this.data.rightIsMoving) return;\n    this.onPointerMove(ev);\n    const selected = this.getSelectedItems();\n    const movement = this.data.movement;\n    const time: DataChartTime = this.state.get('$data.chart.time');\n    let multi = this.state.multi();\n    for (let i = 0, len = selected.length; i < len; i++) {\n      const item = selected[i];\n      item.$data.width = this.data.itemsInitial[i].width + movement;\n      if (item.$data.width < 0) item.$data.width = 0;\n      item.$data.actualWidth = item.$data.width;\n      const right = item.$data.position.left + item.$data.width;\n      item.$data.position.right = right;\n      item.$data.position.actualRight = right;\n      const rightGlobal = this.api.time.getTimeFromViewOffsetPx(right, time);\n      item.time.end = rightGlobal;\n      item.$data.time.endDate = this.api.time.date(rightGlobal);\n      multi = multi\n        .update(`config.chart.items.${item.id}.time`, item.time)\n        .update(`config.chart.items.${item.id}.$data`, item.$data);\n    }\n    multi.done();\n    this.updateData();\n  }\n\n  private onPointerUp(ev: PointerEvent) {\n    ev.preventDefault();\n    ev.stopPropagation();\n  }\n  private onLeftPointerUp(ev: PointerEvent) {\n    if (!this.data.enabled || !this.data.leftIsMoving) return;\n    this.onPointerUp(ev);\n    this.data.leftIsMoving = false;\n    this.updateData();\n  }\n  private onRightPointerUp(ev: PointerEvent) {\n    if (!this.data.enabled || !this.data.rightIsMoving) return;\n    this.onPointerUp(ev);\n    this.data.rightIsMoving = false;\n    this.updateData();\n  }\n\n  public wrapper(input: htmlResult, props?: any): htmlResult {\n    const oldContent = this.oldWrapper(input, props);\n    const item: Item = props.props.item;\n\n    let visible = !item.$data.detached;\n    if (this.data.handle.onlyWhenSelected) {\n      visible = visible && item.selected;\n    }\n    const detach = new this.vido.Detach(() => !visible);\n    const rightStyleMap = this.getRightStyleMap(item, visible);\n    const leftStyleMap = this.getLeftStyleMap(item, visible);\n    const onLeftPointerDown = {\n      handleEvent: this.onLeftPointerDown,\n      //capture: true,\n    };\n    const onRightPointerDown = {\n      handleEvent: this.onRightPointerDown,\n      //capture: true,\n    };\n    return this\n      .html`${oldContent}<div detach=${detach} class=${this.rightClassName} style=${rightStyleMap} @pointerdown=${onRightPointerDown}></div>`;\n  }\n\n  public getWrapper(oldWrapper: Wrapper): Wrapper {\n    if (!this.oldWrapper) {\n      this.oldWrapper = oldWrapper;\n    }\n    this.initializeWrapper();\n    return this.wrapper;\n  }\n}\n\nexport function Plugin(options: Options = {}) {\n  return function initialize(vidoInstance: Vido) {\n    const itemResizing = new ItemResizing(vidoInstance, options);\n    vidoInstance.state.update('config.wrappers.ChartTimelineItemsRowItem', (oldWrapper) => {\n      return itemResizing.getWrapper(oldWrapper);\n    });\n  };\n}\n"],"names":[],"mappings":"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"}