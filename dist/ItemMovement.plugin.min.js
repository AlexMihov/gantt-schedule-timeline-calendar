!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).ItemMovement=t()}(this,(function(){"use strict";
/**
   * ItemMovement plugin
   *
   * @copyright Rafal Pospiech <https://neuronet.io>
   * @author    Rafal Pospiech <neuronet.io@gmail.com>
   * @package   gantt-schedule-timeline-calendar
   * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
   * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar
   */return function ItemMovement(e={}){const t={moveable:!0,resizeable:!0,resizerContent:"",collisionDetection:!0,outOfBorders:!1,snapStart:(e,t)=>e+t,snapEnd:(e,t)=>e+t,ghostNode:!0};e=Object.assign(Object.assign({},t),e);const n={};function action(t,i){if(!e.moveable&&!e.resizeable)return;const o=i.state,r=i.api;function isResizeable(t){let n=e.resizeable&&(!t.item.hasOwnProperty("resizeable")||!0===t.item.resizeable);return t.row.hasOwnProperty("resizeable")&&n&&(n=t.row.resizeable),n}function getMovement(e){const t=e.item.id;return void 0===n[t]&&(n[t]={moving:!1,resizing:!1}),n[t]}function moveGhost(n,i){if(e.ghostNode){const e=getMovement(n),o=i.clientX-e.ganttLeft-e.itemLeftCompensation;e.ghost.style.left=o+"px",e.ghost.style.top=i.clientY-e.ganttTop-e.itemTop+parseInt(getComputedStyle(t)["margin-top"])+"px"}}function destroyGhost(t){e.ghostNode&&void 0!==n[t]&&void 0!==n[t].ghost&&(o.get("_internal.elements.chart-timeline").removeChild(n[t].ghost),delete n[t].ghost)}function getSnapStart(t){let n=e.snapStart;return"function"==typeof t.item.snapStart&&(n=t.item.snapStart),n}function getSnapEnd(t){let n=e.snapEnd;return"function"==typeof t.item.snapEnd&&(n=t.item.snapEnd),n}const s=`<div class="${r.getClass("chart-timeline-items-row-item-resizer")}">${e.resizerContent}</div>`;t.insertAdjacentHTML("beforeend",s);const a=t.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-resizer");function labelDown(n){n.stopPropagation(),n.preventDefault();const s=r.normalizePointerEvent(n);if("mouse"===n.ponterType&&0!==n.button)return;const a=getMovement(i);a.moving=!0;const l=o.get(`config.chart.items.${i.item.id}`),m=o.get("_internal.chart.time.leftGlobal"),c=o.get("_internal.chart.time.timePerPixel"),d=o.get("_internal.elements.chart-timeline").getBoundingClientRect();a.ganttTop=d.top,a.ganttLeft=d.left,a.itemX=Math.round((l.time.start-m)/c),a.itemLeftCompensation=s.clientX-a.ganttLeft-a.itemX,function createGhost(n,i,r,s){const a=getMovement(n);if(!e.ghostNode||void 0!==a.ghost)return;const l=t.cloneNode(!0),m=getComputedStyle(t),c=o.get("config.scroll.compensation");l.style.position="absolute",l.style.left=i.clientX-r-a.itemLeftCompensation+"px";const d=i.clientY-s-t.offsetTop-c+parseInt(m["margin-top"]);a.itemTop=d,l.style.top=i.clientY-s-d+"px",l.style.width=m.width,l.style["box-shadow"]="10px 10px 6px #00000020";const g=t.clientHeight+"px";return l.style.height=g,l.style["line-height"]=t.clientHeight-18+"px",l.style.opacity="0.6",l.style.transform="scale(1.05, 1.05)",o.get("_internal.elements.chart-timeline").appendChild(l),a.ghost=l,l}(i,s,d.left,d.top)}function resizerDown(e){if(e.stopPropagation(),e.preventDefault(),"mouse"===e.pointerType&&0!==e.button)return;const t=r.normalizePointerEvent(e),n=getMovement(i);n.resizing=!0;const s=o.get(`config.chart.items.${i.item.id}`),a=o.get("_internal.chart.time.leftGlobal"),l=o.get("_internal.chart.time.timePerPixel"),m=o.get("_internal.elements.chart-timeline").getBoundingClientRect();n.ganttTop=m.top,n.ganttLeft=m.left,n.itemX=(s.time.end-a)/l,n.itemLeftCompensation=t.clientX-n.ganttLeft-n.itemX}function isCollision(t,n,i,s){if(!e.collisionDetection)return!1;const a=o.get("_internal.chart.time");if(e.outOfBorders&&(i<a.from||s>a.to))return!0;let l=r.time.date(s).diff(i,"milliseconds");if(-1===Math.sign(l)&&(l=-l),l<=1)return!0;const m=o.get("config.list.rows."+t);for(const e of m._internal.items)if(e.id!==n){if(i>=e.time.start&&i<=e.time.end)return!0;if(s>=e.time.start&&s<=e.time.end)return!0;if(i<=e.time.start&&s>=e.time.end)return!0}return!1}function documentMove(t){const n=getMovement(i),s=r.normalizePointerEvent(t);let a,l,m,c,d;(n.moving||n.resizing)&&(t.stopPropagation(),t.preventDefault(),a=o.get(`config.chart.items.${i.item.id}`),l=o.get(`config.chart.items.${i.item.id}.rowId`),m=o.get(`config.list.rows.${l}`),c=o.get("config.chart.time.zoom"),d=o.get("_internal.chart.time.timePerPixel"));const g=function isMoveable(t){let n=e.moveable;return t.item.hasOwnProperty("moveable")&&n&&(n=t.item.moveable),t.row.hasOwnProperty("moveable")&&n&&(n=t.row.moveable),n}(i);if(n.moving){if((!0===g||"x"===g||Array.isArray(g)&&g.includes(l))&&function movementX(e,t,n,r,s){const a=getMovement(i),l=e.clientX-a.ganttLeft-a.itemLeftCompensation;moveGhost(i,e);const m=o.get("_internal.chart.time.leftGlobal")+l*s-n.time.start,c=n.time.start,d=getSnapStart(i)(n.time.start,m,n)-c,g=isCollision(t.id,n.id,n.time.start+d,n.time.end+d);d&&!g&&o.update(`config.chart.items.${i.item.id}.time`,(function moveItem(e){return e.start+=d,e.end=getSnapEnd(i)(e.end,d,n)-1,e}))}(s,m,a,0,d),!g||"x"===g)return;let e=function movementY(e,t,n,r,s){moveGhost(i,e);const a=getMovement(i),l=e.clientY-a.ganttTop,m=o.get("_internal.list.visibleRows"),c=o.get("config.scroll.compensation");let d=0;for(const e of m){if(e.top+c>l)return d>0?d-1:0;d++}return d}(s);const t=o.get("_internal.list.visibleRows");void 0===t[e]&&(e>0?e=t.length-1:e<0&&(e=0));const n=t[e],r=n.id,c=isCollision(r,a.id,a.time.start,a.time.end);r===a.rowId||c||Array.isArray(g)&&!g.includes(r)||n.hasOwnProperty("moveable")&&!n.moveable||o.update(`config.chart.items.${a.id}.rowId`,r)}else!n.resizing||void 0!==a.resizeable&&!0!==a.resizeable||function resizeX(e,t,n,r,s){if(!isResizeable(i))return;const a=o.get("_internal.chart.time"),l=getMovement(i),m=e.clientX-l.ganttLeft-l.itemLeftCompensation,c=a.leftGlobal+m*s-n.time.end;if(n.time.end+c<n.time.start)return;const d=n.time.end,g=getSnapEnd(i)(n.time.end,c,n)-1-d,f=isCollision(t.id,n.id,n.time.start,n.time.end+g);g&&!f&&o.update(`config.chart.items.${i.item.id}.time`,e=>(e.start=getSnapStart(i)(e.start,0,n),e.end=getSnapEnd(i)(e.end,g,n)-1,e))}(s,m,a,0,d)}function documentUp(e){const t=getMovement(i);(t.moving||t.resizing)&&(e.stopPropagation(),e.preventDefault()),t.moving=!1,t.resizing=!1;for(const e in n)n[e].moving=!1,n[e].resizing=!1,destroyGhost(e)}return isResizeable(i)?a.style.visibility="visible":a.style.visibility="hidden",t.addEventListener("pointerdown",labelDown),a.addEventListener("pointerdown",resizerDown),document.addEventListener("pointermove",documentMove),document.addEventListener("pointerup",documentUp),{update(e,t){isResizeable(t)||"visible"!==a.style.visibility?isResizeable(t)&&"hidden"===a.style.visibility&&(a.style.visibility="visible"):a.style.visibility="hidden",i=t},destroy(e,n){t.removeEventListener("pointerdown",labelDown),a.removeEventListener("pointerdown",resizerDown),document.removeEventListener("pointermove",documentMove),document.removeEventListener("pointerup",documentUp),a.remove()}}}return function initialize(e){e.state.update("config.actions.chart-timeline-items-row-item",e=>(e.push(action),e))}}}));
//# sourceMappingURL=ItemMovement.plugin.min.js.map
