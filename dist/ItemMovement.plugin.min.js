!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).ItemMovement=t()}(this,(function(){"use strict";const e="undefined"!=typeof PointerEvent;return function(t={}){const n={moveable:!0,resizable:!0,resizerContent:"",collisionDetection:!0,outOfBorders:!1,snapStart:(e,t)=>e+t,snapEnd:(e,t)=>e+t,ghostNode:!0,wait:0};t=Object.assign(Object.assign({},n),t);const i={};function o(n,o){if(!t.moveable&&!t.resizable)return;const r=o.state,s=o.api;function a(e){let n=t.resizable&&(!e.item.hasOwnProperty("resizable")||!0===e.item.resizable);return e.row.hasOwnProperty("resizable")&&n&&(n=e.row.resizable),n}function m(e){const t=e.item.id;return void 0===i[t]&&(i[t]={moving:!1,resizing:!1,waiting:!1}),i[t]}function d(e,t){r.update("config.plugin.ItemMovement.item",Object.assign({id:e},t)),r.update("config.plugin.ItemMovement.movement",e=>(e||(e={moving:!1,waiting:!1,resizing:!1}),e.moving=t.moving,e.waiting=t.waiting,e.resizing=t.resizing,e))}function l(e,i){if(t.ghostNode){const t=m(e),o=i.clientX-t.ganttLeft;t.ghost.style.left=o+"px",t.ghost.style.top=i.clientY-t.ganttTop-t.itemTop+parseInt(getComputedStyle(n)["margin-top"])+"px",d(e.item.id,t)}}function c(e){t.ghostNode&&void 0!==i[e]&&void 0!==i[e].ghost&&(r.get("_internal.elements.chart-timeline").removeChild(i[e].ghost),delete i[e].ghost,d(o.item.id,i[e]))}function u(e){let n=t.snapStart;return"function"==typeof e.item.snapStart&&(n=e.item.snapStart),n}function g(e){let n=t.snapEnd;return"function"==typeof e.item.snapEnd&&(n=e.item.snapEnd),n}const f=`<div class="${s.getClass("chart-timeline-items-row-item-resizer")}">${t.resizerContent}</div>`;n.insertAdjacentHTML("beforeend",f);const v=n.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-resizer");function p(e){const i=s.normalizePointerEvent(e);if(("pointerdown"===e.type||"mousedown"===e.type)&&0!==e.button)return;const a=m(o);a.waiting=!0,d(o.item.id,a),setTimeout(()=>{if(e.stopPropagation(),e.preventDefault(),!a.waiting)return;a.moving=!0;const s=r.get(`config.chart.items.${o.item.id}`),l=r.get("_internal.chart.time.leftGlobal"),c=r.get("_internal.chart.time.timePerPixel"),u=r.get("_internal.elements.chart-timeline").getBoundingClientRect();a.ganttTop=u.top,a.ganttLeft=u.left,a.itemX=Math.round((s.time.start-l)/c),d(o.item.id,a),function(e,i,o,s){const a=m(e);if(!t.ghostNode||void 0!==a.ghost)return;const l=n.cloneNode(!0),c=getComputedStyle(n);l.style.position="absolute",l.style.left=i.clientX-o+"px";const u=i.clientY-s-n.offsetTop+parseInt(c["margin-top"]);a.itemTop=u,l.style.top=i.clientY-s-u+"px",l.style.width=c.width,l.style["box-shadow"]="10px 10px 6px #00000020";const g=n.clientHeight+"px";l.style.height=g,l.style["line-height"]=n.clientHeight-18+"px",l.style.opacity="0.6",l.style.transform="scale(1.05, 1.05)",r.get("_internal.elements.chart-timeline").appendChild(l),a.ghost=l,d(e.item.id,a)}(o,i,u.left,u.top)},t.wait)}function h(e){if(e.stopPropagation(),e.preventDefault(),("pointerdown"===e.type||"mousedown"===e.type)&&0!==e.button)return;s.normalizePointerEvent(e);const t=m(o);t.resizing=!0;const n=r.get(`config.chart.items.${o.item.id}`),i=r.get("_internal.chart.time.leftGlobal"),a=r.get("_internal.chart.time.timePerPixel"),l=r.get("_internal.elements.chart-timeline").getBoundingClientRect();t.ganttTop=l.top,t.ganttLeft=l.left,t.itemX=(n.time.end-i)/a,d(o.item.id,t)}function y(e,n,i,o){if(!t.collisionDetection)return!1;const a=r.get("_internal.chart.time");if(t.outOfBorders&&(i<a.from||o>a.to))return!0;let m=s.time.date(o).diff(i,"milliseconds");if(-1===Math.sign(m)&&(m=-m),m<=1)return!0;const d=r.get("config.list.rows."+e);for(const e of d._internal.items)if(e.id!==n){if(i>=e.time.start&&i<=e.time.end)return!0;if(o>=e.time.start&&o<=e.time.end)return!0;if(i<=e.time.start&&o>=e.time.end)return!0}return!1}function w(e){const n=m(o),i=s.normalizePointerEvent(e);let d,c,f,v,p;(n.moving||n.resizing)&&(e.stopPropagation(),e.preventDefault(),d=r.get(`config.chart.items.${o.item.id}`),c=r.get(`config.chart.items.${o.item.id}.rowId`),f=r.get(`config.list.rows.${c}`),v=r.get("_internal.chart.time.zoom"),p=r.get("_internal.chart.time.timePerPixel"));const h=function(e){let n=t.moveable;return e.item.hasOwnProperty("moveable")&&n&&(n=e.item.moveable),e.row.hasOwnProperty("moveable")&&n&&(n=e.row.moveable),n}(o);if(n.moving){if((!0===h||"x"===h||Array.isArray(h)&&h.includes(c))&&function(e,t,n,i,s){const a=m(o),d=e.clientX-a.ganttLeft;l(o,e);const c=r.get("_internal.chart.time.leftGlobal")+d*s-n.time.start,f=n.time.start,v=u(o)(n.time.start,c,n)-f,p=y(t.id,n.id,n.time.start+v,n.time.end+v);v&&!p&&r.update(`config.chart.items.${o.item.id}.time`,(function(e){return e.start+=v,e.end=g(o)(e.end,v,n)-1,e}))}(i,f,d,0,p),!h||"x"===h)return;let e=function(e,t,n,i,s){l(o,e);const a=m(o),d=e.clientY-a.ganttTop,c=r.get("_internal.list.visibleRows");let u=0;for(const e of c){if(e.top>d)return u>0?u-1:0;u++}return u}(i);const t=r.get("_internal.list.visibleRows");void 0===t[e]&&(e>0?e=t.length-1:e<0&&(e=0));const n=t[e],s=n.id,a=y(s,d.id,d.time.start,d.time.end);s===d.rowId||a||Array.isArray(h)&&!h.includes(s)||n.hasOwnProperty("moveable")&&!n.moveable||r.update(`config.chart.items.${d.id}.rowId`,s)}else!n.resizing||void 0!==d.resizable&&!0!==d.resizable||function(e,t,n,i,s){if(!a(o))return;const d=r.get("_internal.chart.time"),l=m(o),c=e.clientX-l.ganttLeft,f=d.leftGlobal+c*s-n.time.end;if(n.time.end+f<n.time.start)return;const v=n.time.end,p=g(o)(n.time.end,f,n)-1-v,h=y(t.id,n.id,n.time.start,n.time.end+p);p&&!h&&r.update(`config.chart.items.${o.item.id}.time`,e=>(e.start=u(o)(e.start,0,n),e.end=g(o)(e.end,p,n)-1,e))}(i,f,d,0,p)}function b(e){const t=m(o);if(t.moving||t.resizing||t.waiting){e.stopPropagation(),e.preventDefault(),t.moving=!1,t.waiting=!1,t.resizing=!1,d(o.item.id,t);for(const e in i)i[e].moving=!1,i[e].resizing=!1,i[e].waiting=!1,c(e)}}return a(o)?v.style.visibility="visible":v.style.visibility="hidden",e?(n.addEventListener("pointerdown",p),v.addEventListener("pointerdown",h),document.addEventListener("pointermove",w),document.addEventListener("pointerup",b)):(n.addEventListener("touchstart",p),v.addEventListener("touchstart",h),document.addEventListener("touchmove",w),document.addEventListener("touchend",b),document.addEventListener("touchcancel",b),n.addEventListener("mousedown",p),v.addEventListener("mousedown",h),document.addEventListener("mousemove",w),document.addEventListener("mouseup",b)),{update(e,t){a(t)||"visible"!==v.style.visibility?a(t)&&"hidden"===v.style.visibility&&(v.style.visibility="visible"):v.style.visibility="hidden",o=t},destroy(t,i){e?(n.removeEventListener("pointerdown",p),v.removeEventListener("pointerdown",h),document.removeEventListener("pointermove",w),document.removeEventListener("pointerup",b)):(n.removeEventListener("mousedown",p),v.removeEventListener("mousedown",h),document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",b),n.removeEventListener("touchstart",p),v.removeEventListener("touchstart",h),document.removeEventListener("touchmove",w),document.removeEventListener("touchend",b),document.removeEventListener("touchcancel",b)),v.remove()}}}return function(e){e.state.update("config.actions.chart-timeline-items-row-item",e=>(e.push(o),e))}}}));
