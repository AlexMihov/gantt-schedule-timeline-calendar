!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).ItemMovement=t()}(this,(function(){"use strict";
/**
   * ItemMovement plugin
   *
   * @copyright Rafal Pospiech <https://neuronet.io>
   * @author    Rafal Pospiech <neuronet.io@gmail.com>
   * @package   gantt-schedule-timeline-calendar
   * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
   * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar
   */const e="undefined"!=typeof PointerEvent;return function ItemMovement(t={}){const n={moveable:!0,resizeable:!0,resizerContent:"",collisionDetection:!0,outOfBorders:!1,snapStart:(e,t)=>e+t,snapEnd:(e,t)=>e+t,ghostNode:!0};t=Object.assign(Object.assign({},n),t);const i={};function action(n,o){if(!t.moveable&&!t.resizeable)return;const r=o.state,s=o.api;function isResizeable(e){let n=t.resizeable&&(!e.item.hasOwnProperty("resizeable")||!0===e.item.resizeable);return e.row.hasOwnProperty("resizeable")&&n&&(n=e.row.resizeable),n}function getMovement(e){const t=e.item.id;return void 0===i[t]&&(i[t]={moving:!1,resizing:!1}),i[t]}function moveGhost(e,i){if(t.ghostNode){const t=getMovement(e),o=i.clientX-t.ganttLeft-t.itemLeftCompensation;t.ghost.style.left=o+"px",t.ghost.style.top=i.clientY-t.ganttTop-t.itemTop+parseInt(getComputedStyle(n)["margin-top"])+"px"}}function destroyGhost(e){t.ghostNode&&void 0!==i[e]&&void 0!==i[e].ghost&&(r.get("_internal.elements.chart-timeline").removeChild(i[e].ghost),delete i[e].ghost)}function getSnapStart(e){let n=t.snapStart;return"function"==typeof e.item.snapStart&&(n=e.item.snapStart),n}function getSnapEnd(e){let n=t.snapEnd;return"function"==typeof e.item.snapEnd&&(n=e.item.snapEnd),n}const m=`<div class="${s.getClass("chart-timeline-items-row-item-resizer")}">${t.resizerContent}</div>`;n.insertAdjacentHTML("beforeend",m);const a=n.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-resizer");function labelDown(e){e.stopPropagation(),e.preventDefault();const i=s.normalizePointerEvent(e);if(("pointerdown"===e.type||"mousedown"===e.type)&&0!==e.button)return;const m=getMovement(o);m.moving=!0;const a=r.get(`config.chart.items.${o.item.id}`),l=r.get("_internal.chart.time.leftGlobal"),c=r.get("_internal.chart.time.timePerPixel"),d=r.get("_internal.elements.chart-timeline").getBoundingClientRect();m.ganttTop=d.top,m.ganttLeft=d.left,m.itemX=Math.round((a.time.start-l)/c),m.itemLeftCompensation=i.clientX-m.ganttLeft-m.itemX,function createGhost(e,i,o,s){const m=getMovement(e);if(!t.ghostNode||void 0!==m.ghost)return;const a=n.cloneNode(!0),l=getComputedStyle(n),c=r.get("config.scroll.compensation");a.style.position="absolute",a.style.left=i.clientX-o-m.itemLeftCompensation+"px";const d=i.clientY-s-n.offsetTop-c+parseInt(l["margin-top"]);m.itemTop=d,a.style.top=i.clientY-s-d+"px",a.style.width=l.width,a.style["box-shadow"]="10px 10px 6px #00000020";const u=n.clientHeight+"px";return a.style.height=u,a.style["line-height"]=n.clientHeight-18+"px",a.style.opacity="0.6",a.style.transform="scale(1.05, 1.05)",r.get("_internal.elements.chart-timeline").appendChild(a),m.ghost=a,a}(o,i,d.left,d.top)}function resizerDown(e){if(e.stopPropagation(),e.preventDefault(),("pointerdown"===e.type||"mousedown"===e.type)&&0!==e.button)return;const t=s.normalizePointerEvent(e),n=getMovement(o);n.resizing=!0;const i=r.get(`config.chart.items.${o.item.id}`),m=r.get("_internal.chart.time.leftGlobal"),a=r.get("_internal.chart.time.timePerPixel"),l=r.get("_internal.elements.chart-timeline").getBoundingClientRect();n.ganttTop=l.top,n.ganttLeft=l.left,n.itemX=(i.time.end-m)/a,n.itemLeftCompensation=t.clientX-n.ganttLeft-n.itemX}function isCollision(e,n,i,o){if(!t.collisionDetection)return!1;const m=r.get("_internal.chart.time");if(t.outOfBorders&&(i<m.from||o>m.to))return!0;let a=s.time.date(o).diff(i,"milliseconds");if(-1===Math.sign(a)&&(a=-a),a<=1)return!0;const l=r.get("config.list.rows."+e);for(const e of l._internal.items)if(e.id!==n){if(i>=e.time.start&&i<=e.time.end)return!0;if(o>=e.time.start&&o<=e.time.end)return!0;if(i<=e.time.start&&o>=e.time.end)return!0}return!1}function documentMove(e){const n=getMovement(o),i=s.normalizePointerEvent(e);let m,a,l,c,d;(n.moving||n.resizing)&&(e.stopPropagation(),e.preventDefault(),m=r.get(`config.chart.items.${o.item.id}`),a=r.get(`config.chart.items.${o.item.id}.rowId`),l=r.get(`config.list.rows.${a}`),c=r.get("config.chart.time.zoom"),d=r.get("_internal.chart.time.timePerPixel"));const u=function isMoveable(e){let n=t.moveable;return e.item.hasOwnProperty("moveable")&&n&&(n=e.item.moveable),e.row.hasOwnProperty("moveable")&&n&&(n=e.row.moveable),n}(o);if(n.moving){if((!0===u||"x"===u||Array.isArray(u)&&u.includes(a))&&function movementX(e,t,n,i,s){const m=getMovement(o),a=e.clientX-m.ganttLeft-m.itemLeftCompensation;moveGhost(o,e);const l=r.get("_internal.chart.time.leftGlobal")+a*s-n.time.start,c=n.time.start,d=getSnapStart(o)(n.time.start,l,n)-c,u=isCollision(t.id,n.id,n.time.start+d,n.time.end+d);d&&!u&&r.update(`config.chart.items.${o.item.id}.time`,(function moveItem(e){return e.start+=d,e.end=getSnapEnd(o)(e.end,d,n)-1,e}))}(i,l,m,0,d),!u||"x"===u)return;let e=function movementY(e,t,n,i,s){moveGhost(o,e);const m=getMovement(o),a=e.clientY-m.ganttTop,l=r.get("_internal.list.visibleRows"),c=r.get("config.scroll.compensation");let d=0;for(const e of l){if(e.top+c>a)return d>0?d-1:0;d++}return d}(i);const t=r.get("_internal.list.visibleRows");void 0===t[e]&&(e>0?e=t.length-1:e<0&&(e=0));const n=t[e],s=n.id,c=isCollision(s,m.id,m.time.start,m.time.end);s===m.rowId||c||Array.isArray(u)&&!u.includes(s)||n.hasOwnProperty("moveable")&&!n.moveable||r.update(`config.chart.items.${m.id}.rowId`,s)}else!n.resizing||void 0!==m.resizeable&&!0!==m.resizeable||function resizeX(e,t,n,i,s){if(!isResizeable(o))return;const m=r.get("_internal.chart.time"),a=getMovement(o),l=e.clientX-a.ganttLeft-a.itemLeftCompensation,c=m.leftGlobal+l*s-n.time.end;if(n.time.end+c<n.time.start)return;const d=n.time.end,u=getSnapEnd(o)(n.time.end,c,n)-1-d,v=isCollision(t.id,n.id,n.time.start,n.time.end+u);u&&!v&&r.update(`config.chart.items.${o.item.id}.time`,e=>(e.start=getSnapStart(o)(e.start,0,n),e.end=getSnapEnd(o)(e.end,u,n)-1,e))}(i,l,m,0,d)}function documentUp(e){const t=getMovement(o);(t.moving||t.resizing)&&(e.stopPropagation(),e.preventDefault()),t.moving=!1,t.resizing=!1;for(const e in i)i[e].moving=!1,i[e].resizing=!1,destroyGhost(e)}return isResizeable(o)?a.style.visibility="visible":a.style.visibility="hidden",e?(n.addEventListener("pointerdown",labelDown),a.addEventListener("pointerdown",resizerDown),document.addEventListener("pointermove",documentMove),document.addEventListener("pointerup",documentUp)):(n.addEventListener("mousedown",labelDown),a.addEventListener("mousedown",resizerDown),document.addEventListener("mousemove",documentMove),document.addEventListener("mouseup",documentUp),n.addEventListener("touchstart",labelDown),a.addEventListener("touchstart",resizerDown),document.addEventListener("touchmove",documentMove),document.addEventListener("touchend",documentUp),document.addEventListener("touchcancel",documentUp)),{update(e,t){isResizeable(t)||"visible"!==a.style.visibility?isResizeable(t)&&"hidden"===a.style.visibility&&(a.style.visibility="visible"):a.style.visibility="hidden",o=t},destroy(t,i){e?(n.removeEventListener("pointerdown",labelDown),a.removeEventListener("pointerdown",resizerDown),document.removeEventListener("pointermove",documentMove),document.removeEventListener("pointerup",documentUp)):(n.removeEventListener("mousedown",labelDown),a.removeEventListener("mousedown",resizerDown),document.removeEventListener("mousemove",documentMove),document.removeEventListener("mouseup",documentUp),n.removeEventListener("touchstart",labelDown),a.removeEventListener("touchstart",resizerDown),document.removeEventListener("touchmove",documentMove),document.removeEventListener("touchend",documentUp),document.removeEventListener("touchcancel",documentUp)),a.remove()}}}return function initialize(e){e.state.update("config.actions.chart-timeline-items-row-item",e=>(e.push(action),e))}}}));
//# sourceMappingURL=ItemMovement.plugin.min.js.map
