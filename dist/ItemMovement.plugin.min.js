!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).ItemMovement=t()}(this,(function(){"use strict";
/**
   * ItemMovement plugin
   *
   * @copyright Rafal Pospiech <https://neuronet.io>
   * @author    Rafal Pospiech <neuronet.io@gmail.com>
   * @package   gantt-schedule-timeline-calendar
   * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
   * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar
   */return function ItemMovement(e={}){const t={moveable:!0,resizeable:!0,resizerContent:"",collisionDetection:!0,outOfBorders:!1,snapStart:(e,t)=>e+t,snapEnd:(e,t)=>e+t,ghostNode:!0};e=Object.assign(Object.assign({},t),e);const i={};function action(t,n){let o,s,r=t.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content");if(!e.moveable&&!e.resizeable)return;function isResizeable(t){let i=e.resizeable&&(!t.item.hasOwnProperty("resizeable")||!0===t.item.resizeable);return t.row.hasOwnProperty("resizeable")&&i&&(i=t.row.resizeable),i}function getMovement(e){const t=e.item.id;return void 0===i[t]&&(i[t]={moving:!1,resizing:!1}),i[t]}function moveGhost(t,i){if(e.ghostNode){const e=getMovement(t),n=i.x-e.ganttLeft-e.itemLeftCompensation,s=o.get("config.scroll.compensation");e.ghost.style.left=n+"px",e.ghost.style.top=i.y-e.ganttTop-e.itemTop+s+"px"}}function destroyGhost(t){e.ghostNode&&void 0!==i[t]&&void 0!==i[t].ghost&&(o.get("_internal.elements.chart-timeline").removeChild(i[t].ghost),delete i[t].ghost)}function getSnapStart(t){let i=e.snapStart;return"function"==typeof t.item.snapStart&&(i=t.item.snapStart),i}function getSnapEnd(t){let i=e.snapEnd;return"function"==typeof t.item.snapEnd&&(i=t.item.snapEnd),i}o=n.state;const a=`<div class="${(s=n.api).getClass("chart-timeline-items-row-item-content-resizer")}">${e.resizerContent}</div>`;r.insertAdjacentHTML("beforeend",a);const m=r.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content-resizer");function labelMouseDown(i){if(i.stopPropagation(),0!==i.button)return;r=t.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content");const s=getMovement(n);s.moving=!0;const a=o.get(`config.chart.items.${n.item.id}`),m=o.get("_internal.chart.time.leftGlobal"),l=o.get("_internal.chart.time.timePerPixel"),c=o.get("_internal.elements.chart-timeline").getBoundingClientRect();s.ganttTop=c.top,s.ganttLeft=c.left,s.itemX=Math.round((a.time.start-m)/l),s.itemLeftCompensation=i.x-s.ganttLeft-s.itemX,function createGhost(t,i,n,s){const a=getMovement(t);if(!e.ghostNode||void 0!==a.ghost)return;const m=r.cloneNode(!0),l=getComputedStyle(r);m.style.position="absolute",m.style.left=i.x-n-a.itemLeftCompensation+"px";const c=i.y-s-t.row.top-r.offsetTop;a.itemTop=c,m.style.top=i.y-s-c+"px",m.style.width=l.width,m.style["box-shadow"]="10px 10px 6px #00000020";const d=r.clientHeight+"px";return m.style.height=d,m.style["line-height"]=d,m.style.opacity="0.6",m.style.transform="scale(1.05, 1.05)",o.get("_internal.elements.chart-timeline").appendChild(m),a.ghost=m,m}(n,i,c.left,c.top)}function resizerMouseDown(e){if(e.stopPropagation(),0!==e.button)return;const t=getMovement(n);t.resizing=!0;const i=o.get(`config.chart.items.${n.item.id}`),s=o.get("_internal.chart.time.leftGlobal"),r=o.get("_internal.chart.time.timePerPixel"),a=o.get("_internal.elements.chart-timeline").getBoundingClientRect();t.ganttTop=a.top,t.ganttLeft=a.left,t.itemX=(i.time.end-s)/r,t.itemLeftCompensation=e.x-t.ganttLeft-t.itemX}function isCollision(t,i,n,r){if(!e.collisionDetection)return!1;const a=o.get("_internal.chart.time");if(e.outOfBorders&&(n<a.from||r>a.to))return!0;let m=s.time.date(r).diff(n,"milliseconds");if(-1===Math.sign(m)&&(m=-m),m<=1)return!0;const l=o.get("config.list.rows."+t);for(const e of l._internal.items)if(e.id!==i){if(n>=e.time.start&&n<=e.time.end)return!0;if(r>=e.time.start&&r<=e.time.end)return!0;if(n<=e.time.start&&r>=e.time.end)return!0}return!1}function documentMouseMove(t){const i=getMovement(n);let s,r,a,m,l;(i.moving||i.resizing)&&(t.stopPropagation(),s=o.get(`config.chart.items.${n.item.id}`),r=o.get(`config.chart.items.${n.item.id}.rowId`),a=o.get(`config.list.rows.${r}`),m=o.get("config.chart.time.zoom"),l=o.get("_internal.chart.time.timePerPixel"));const c=function isMoveable(t){let i=e.moveable;return t.item.hasOwnProperty("moveable")&&i&&(i=t.item.moveable),t.row.hasOwnProperty("moveable")&&i&&(i=t.row.moveable),i}(n);if(i.moving){if((!0===c||"x"===c||Array.isArray(c)&&c.includes(r))&&function movementX(e,t,i,s,r){e.stopPropagation();const a=getMovement(n),m=e.x-a.ganttLeft-a.itemLeftCompensation;moveGhost(n,e);const l=o.get("_internal.chart.time.leftGlobal")+m*r-i.time.start,c=i.time.start,d=getSnapStart(n)(i.time.start,l,i)-c,u=isCollision(t.id,i.id,i.time.start+d,i.time.end+d);d&&!u&&o.update(`config.chart.items.${n.item.id}.time`,(function moveItem(e){return e.start+=d,e.end=getSnapEnd(n)(e.end,d,i)-1,e}))}(t,a,s,0,l),!c||"x"===c)return;let e=function movementY(e,t,i,s,r){e.stopPropagation(),moveGhost(n,e);const a=getMovement(n),m=e.y-a.ganttTop,l=o.get("_internal.list.visibleRows"),c=o.get("config.scroll.compensation");let d=0;for(const e of l){if(e.top+c>m)return d>0?d-1:0;d++}return d}(t);const i=o.get("_internal.list.visibleRows");void 0===i[e]&&(e>0?e=i.length-1:e<0&&(e=0));const m=i[e],d=m.id,u=isCollision(d,s.id,s.time.start,s.time.end);d===s.rowId||u||Array.isArray(c)&&!c.includes(d)||m.hasOwnProperty("moveable")&&!m.moveable||o.update(`config.chart.items.${s.id}.rowId`,d)}else!i.resizing||void 0!==s.resizeable&&!0!==s.resizeable||function resizeX(e,t,i,s,r){if(e.stopPropagation(),!isResizeable(n))return;const a=o.get("_internal.chart.time"),m=getMovement(n),l=e.x-m.ganttLeft-m.itemLeftCompensation,c=a.leftGlobal+l*r-i.time.end;if(i.time.end+c<i.time.start)return;const d=i.time.end,u=getSnapEnd(n)(i.time.end,c,i)-1-d,g=isCollision(t.id,i.id,i.time.start,i.time.end+u);u&&!g&&o.update(`config.chart.items.${n.item.id}.time`,e=>(e.start=getSnapStart(n)(e.start,0,i),e.end=getSnapEnd(n)(e.end,u,i)-1,e))}(t,a,s,0,l)}function documentMouseUp(e){const t=getMovement(n);(t.moving||t.resizing)&&e.stopPropagation(),t.moving=!1,t.resizing=!1;for(const e in i)i[e].moving=!1,i[e].resizing=!1,destroyGhost(e)}return isResizeable(n)?m.style.visibility="visible":m.style.visibility="hidden",r.addEventListener("mousedown",labelMouseDown),m.addEventListener("mousedown",resizerMouseDown,{capture:!0}),document.addEventListener("mousemove",documentMouseMove,{capture:!0,passive:!0}),document.addEventListener("mouseup",documentMouseUp,{capture:!0,passive:!0}),{update(e,t){isResizeable(n)||"visible"!==m.style.visibility?isResizeable(n)&&"hidden"===m.style.visibility&&(m.style.visibility="visible"):m.style.visibility="hidden"},destroy(e,t){r.removeEventListener("mousedown",labelMouseDown),m.removeEventListener("mousedown",resizerMouseDown),document.removeEventListener("mousemove",documentMouseMove),document.removeEventListener("mouseup",documentMouseUp),m.remove()}}}return function initialize(e){e.state.update("config.actions.chart-timeline-items-row-item",e=>(e.push(action),e))}}}));
//# sourceMappingURL=ItemMovement.plugin.min.js.map
