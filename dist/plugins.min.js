const t="chart-timeline-grid-row-cell",e="chart-timeline-items-row-item";var i=Object.freeze({__proto__:null,CELL:t,ITEM:e,Plugin:function(i={enabled:!0}){let n,s,a;const o="config.plugin.TimelinePointer",r={cell:"",item:""};function l(){return{enabled:i.enabled,isMoving:!1,pointerState:"up",currentTarget:null,realTarget:null,targetType:"",targetData:null,initialPosition:{x:0,y:0},currentPosition:{x:0,y:0},events:{down:null,move:null,up:null}}}let c;class h{constructor(t){this.unsub=[],this.pointerDown=this.pointerDown.bind(this),this.pointerMove=this.pointerMove.bind(this),this.pointerUp=this.pointerUp.bind(this),this.data=l(),t.addEventListener("pointerdown",this.pointerDown),document.addEventListener("pointerup",this.pointerUp),document.addEventListener("pointermove",this.pointerMove),this.unsub.push(a.subscribe(o,t=>this.data=t))}destroy(t){t.removeEventListener("pointerdown",this.pointerDown),document.removeEventListener("pointerup",this.pointerUp),document.removeEventListener("pointermove",this.pointerMove)}updateData(){a.update(o,()=>Object.assign({},this.data))}getRealTarget(t){let e=t.target.closest("."+r.item);return e||(e=t.target.closest("."+r.cell),e||null)}getRealPosition(t){const e={x:0,y:0};if(c){const i=c.getBoundingClientRect();e.x=t.x-i.x,e.y=t.y-i.y}return e}pointerDown(i){if(!this.data.enabled)return;this.data.pointerState="down",this.data.currentTarget=i.target,this.data.realTarget=this.getRealTarget(i),this.data.realTarget?this.data.realTarget.classList.contains(r.item)?(this.data.targetType=e,this.data.targetData=this.data.realTarget.vido.item):this.data.realTarget.classList.contains(r.cell)?(this.data.targetType=t,this.data.targetData=this.data.realTarget.vido):this.data.targetType="":(this.data.targetType="",this.data.targetData=null),this.data.isMoving=!!this.data.realTarget,this.data.events.down=i,this.data.events.move=i;const n=this.getRealPosition(i);this.data.initialPosition=n,this.data.currentPosition=n,this.updateData()}pointerUp(t){this.data.enabled&&(this.data.pointerState="up",this.data.isMoving=!1,this.data.events.up=t,this.data.currentPosition=this.getRealPosition(t),this.updateData())}pointerMove(t){this.data.enabled&&this.data.isMoving&&(this.data.pointerState="move",this.data.events.move=t,this.data.currentPosition=this.getRealPosition(t),this.updateData())}}return function(i){n=i,s=n.api,a=n.state,r.cell=s.getClass(t),r.item=s.getClass(e);const d=a.subscribe("$data.elements.chart-timeline",t=>c=t);return a.update("config.actions.chart-timeline",t=>(t.push(h),t)),a.update(o,t=>l()),function(){d()}}}});var n=Object.freeze({__proto__:null,default:function(t={}){let e;const i={time:1e3,movementThreshold:2,action(t,e){}};t=Object.assign(Object.assign({},i),t);const n={},s={x:0,y:0};function a(t){void 0!==n[t]&&delete n[t]}function o(e,i){function o(a){!function(e,i,a){void 0===n[e.id]&&(n[e.id]={x:a.x,y:a.y},a.stopPropagation(),a.preventDefault(),setTimeout(()=>{if(void 0!==n[e.id]){let a=!0;const o=Math.abs(n[e.id].x-s.x),r=Math.abs(n[e.id].y-s.y);o>t.movementThreshold&&(a=!1),r>t.movementThreshold&&(a=!1),delete n[e.id],a&&t.action(i,e)}},t.time))}(i.item,e,a)}function r(t){s.x=t.x,s.y=t.y}return e.addEventListener("pointerdown",o),document.addEventListener("pointerup",(function(){a(i.item.id)})),document.addEventListener("pointermove",r),{update(t,e){i=e},destroy(t,e){document.removeEventListener("pointerup",a),document.removeEventListener("poitnermove",r),t.removeEventListener("pointerdown",o)}}}return function(t){e=t.api,t.state.update("config.actions.chart-timeline-items-row-item",t=>(t.push(o),t))}}});const s="config.plugin.ItemMovement";class a{constructor(t){this.onDestroy=[],this.lastPointerState="up",this.vido=t,this.api=t.api,this.state=t.state,this.onDestroy.push(this.state.subscribe(s,t=>this.data=t)),this.data.className||(this.data.className=this.api.getClass("chart-timeline-items-row-item--moving")),this.onSelectionChange=this.onSelectionChange.bind(this),this.onDestroy.push(this.state.subscribe("config.plugin.Selection",this.onSelectionChange))}destroy(){this.onDestroy.forEach(t=>t())}updateData(){this.state.update(s,this.data)}getItemTime(t){return t}moveItems(){for(const t of this.data.lastMoved){this.getItemTime(t.$data.time.startDate)}}updatePointerState(){"up"===this.lastPointerState&&"down"===this.selection.pointerState?this.data.onStart(this.data.moving):"down"!==this.lastPointerState&&"move"!==this.lastPointerState||"up"!==this.selection.pointerState?"move"===this.selection.pointerState&&this.data.onMove(this.data.moving):(this.data.moving=[],this.data.onEnd(this.data.lastMoved)),this.lastPointerState=this.selection.pointerState}onSelectionChange(t){this.data.enabled&&(this.selection=t,this.selection.events.move&&(this.selection.events.move.preventDefault(),this.selection.events.move.stopPropagation()),this.selection.events.down&&(this.selection.events.down.preventDefault(),this.selection.events.down.stopPropagation()),this.data.moving=[...this.selection.selected[e]],this.data.moving.length&&(this.data.lastMoved=[...this.data.moving]),this.updatePointerState(),this.data.movement.px.horizontal=this.selection.currentPosition.x-this.selection.initialPosition.x,this.data.movement.px.vertical=this.selection.currentPosition.y-this.selection.initialPosition.y,this.moveItems(),this.updateData())}}var o=Object.freeze({__proto__:null,Plugin:function(t={}){return function(e){e.state.update(s,function(t){return Object.assign({moving:[],lastMoved:[],movement:{px:{horizontal:0,vertical:0},time:0},onStart(t){console.log("start moving",t)},onMove(t){console.log("move",t)},onEnd(t){console.log("end move",t)},snapStart:({startTime:t,time:e})=>t.startOf(e.period),snapEnd:({endTime:t,time:e})=>t.endOf(e.period)},t)}(function(t){return Object.assign({enabled:!0,className:""},t)}(t))),new a(e)}}});let r,l,c,h,d,u,p,g;function m(t,e){const i=r(t,e);u.isSelecting?(g.style.display="block",g.style.left=u.selectionArea.x+"px",g.style.top=u.selectionArea.y+"px",g.style.width=u.selectionArea.width+"px",g.style.height=u.selectionArea.height+"px"):g.style.display="none";const n=d`
    <div class=${p} style=${g}></div>
  `;return d`
    ${i}${n}
  `}function v(){return{enabled:!0,isSelecting:!1,pointerState:"up",initialPosition:{x:0,y:0},currentPosition:{x:0,y:0},selectionArea:{x:0,y:0,width:0,height:0},selecting:{[e]:[],[t]:[]},selected:{[e]:[],[t]:[]},events:{down:null,move:null,up:null}}}class f{constructor(t,e){this.unsub=[],this.vido=t,this.state=t.state,this.api=t.api,this.options=e,this.data=v(),this.unsub.push(this.state.subscribe("config.plugin.TimelinePointer",t=>{this.poitnerData=t,this.onPointerData()})),this.updateData(),this.unsub.push(this.state.subscribe("config.plugin.Selection",t=>{this.data=t}))}destroy(){this.unsub.forEach(t=>t())}updateData(){this.state.update("config.plugin.Selection",Object.assign({},this.data))}getItemsUnderSelectionArea(){return[]}getSelectionArea(){const t={x:0,y:0,width:0,height:0},e=Object.assign({},this.poitnerData.initialPosition),i=Object.assign({},this.poitnerData.currentPosition),n=i.x-e.x,s=i.y-e.y;return n>=0?(t.x=e.x,t.width=n):(t.x=i.x,t.width=Math.abs(n)),s>=0?(t.y=e.y,t.height=s):(t.y=i.y,t.height=Math.abs(s)),t}collectLinkedItems(t,e=[]){if(t.linkedWith&&t.linkedWith.length){const i=this.state.get("config.chart.items");for(const n of t.linkedWith){const t=i[n];e.push(t),this.collectLinkedItems(t,e)}}return e}onPointerData(){if(this.poitnerData.isMoving&&"chart-timeline-grid-row-cell"===this.poitnerData.targetType){this.data.isSelecting=!0,this.data.selectionArea=this.getSelectionArea(),0===this.getItemsUnderSelectionArea().length&&(this.state.update("config.chart.items.*.selected",!1),this.data.selected[e].length=0)}else if(this.poitnerData.isMoving&&"chart-timeline-items-row-item"===this.poitnerData.targetType){this.data.isSelecting=!1,this.data.selectionArea=this.getSelectionArea(),this.data.currentPosition=this.poitnerData.currentPosition,this.data.initialPosition=this.poitnerData.initialPosition;const t=this.poitnerData.targetData,i=this.collectLinkedItems(t,[t]);this.data.selected[e]=i,this.state.update("config.chart.items.*.selected",!1);for(const t of i)this.state.update(`config.chart.items.${t.id}.selected`,!0)}else this.poitnerData.isMoving||(this.data.isSelecting=!1);this.data.events=this.poitnerData.events,this.data.pointerState=this.poitnerData.pointerState,this.updateData()}}var b=Object.freeze({__proto__:null,Plugin:function(t={}){return t=function(t){const e={enabled:!0,grid:!1,items:!0,rows:!1,horizontal:!0,vertical:!0,selecting(){},deselecting(){},selected(){},deselected(){},canSelect:(t,e,i)=>e,canDeselect:(t,e,i)=>[]};return t=Object.assign(Object.assign({},e),t)}(t),function(e){const i=new f(e,t);return e.state.update("config.plugin.Selection",v()),e.state.update("config.wrappers.ChartTimelineItems",t=>function(t,e){return r=t,l=e,c=l.api,h=l.state,d=l.html,p=c.getClass("chart-selection"),g=new l.StyleMap({display:"none"}),l.onDestroy(h.subscribe("config.plugin.Selection",t=>{u=t,l.update()})),m}(t,e)),function(){i.destroy()}}}});const y={enabled:!0};var w=Object.freeze({__proto__:null,Plugin:function(t=y){let e,i,n,s=t.enabled;class a{constructor(t){this.moving=!1,this.initialDataIndex={x:0,y:0},this.lastPos=0,this.pointerDown=this.pointerDown.bind(this),this.pointerUp=this.pointerUp.bind(this),this.pointerMove=e.schedule(this.pointerMove.bind(this)),t.addEventListener("pointerdown",this.pointerDown),document.addEventListener("pointermove",this.pointerMove,{passive:!0}),document.addEventListener("pointerup",this.pointerUp),t.style.cursor="grab"}destroy(t){t.removeEventListener("pointerdown",this.pointerDown),document.removeEventListener("pointermove",this.pointerMove),document.removeEventListener("pointerup",this.pointerUp)}resetInitialPoint(t){this.initialPoint={x:t.screenX,y:t.screenY}}pointerDown(t){if(!s)return;this.moving=!0,this.resetInitialPoint(t);const e=n.get("config.scroll");this.initialDataIndex={x:e.horizontal.dataIndex||0,y:e.vertical.dataIndex||0}}pointerUp(t){s&&this.moving&&(this.moving=!1)}handleHorizontalMovement(t,e){const s=n.get("$data.chart.time");if(t.x>0){if(0===this.initialDataIndex.x)return this.resetInitialPoint(e);const n=s.allDates[s.level];let a=this.initialDataIndex.x-1,o=0;for(;a>0;a--){if(o+=n[a].width,o>=t.x)break}i.scrollToTime(n[a].leftGlobal,!1)}else if(t.x<0){let a=this.initialDataIndex.x;const o=n.get("config.scroll.horizontal"),r=s.allDates[s.level];if(a-1>=r.length-o.lastPageCount)return this.resetInitialPoint(e);let l=0;for(let e=r.length;a<e;a++){if(l+=r[a].width,-l<=t.x)break}if(a-1>=r.length-o.lastPageCount)return;i.scrollToTime(r[a].leftGlobal,!1)}}pointerMove(t){if(!s||!this.moving)return;const e={x:t.screenX-this.initialPoint.x,y:t.screenY-this.initialPoint.y};this.handleHorizontalMovement(e,t)}}return function(o){e=o,i=e.api,n=e.state,n.update("config.plugin.CalendarScroll",t),n.subscribe("config.plugin.CalendarScroll.enabled",t=>s=t),n.update("config.actions.chart-calendar",t=>(t.push(a),t))}}});String(Math.random()).slice(2),document.createComment(""),document.createElement("template"),document.createTextNode("");let x=!1;(()=>{try{const t={get capture(){return x=!0,!1}};window.addEventListener("test",t,t),window.removeEventListener("test",t,t)}catch(t){}})(),"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.1.7");document.createElement("template");class D{constructor(){this.isAction=!0}}D.prototype.isAction=!0;document.createTextNode("");var P={TimelinePointer:i,ItemHold:n,ItemMovement:o,Selection:b,CalendarScroll:w,WeekendHighlight:Object.freeze({__proto__:null,Plugin:function(t={}){const e=t.weekdays||[6,0];let i,n,s=!0;class a extends D{constructor(t,e){super(),this.highlight(t,e.time.leftGlobal)}update(t,e){this.highlight(t,e.time.leftGlobal)}highlight(t,a){const o=t.classList.contains(i);if(!s)return void(o&&t.classList.remove(i));const r=e.includes(n.time.date(a).day());!o&&r?t.classList.add(i):o&&!r&&t.classList.remove(i)}}return function(e){n=e.api,i=t.className||n.getClass("chart-timeline-grid-row-cell")+"--weekend";const o=e.state.subscribe("$data.chart.time.format.period",t=>s="day"===t);return e.state.update("config.actions.chart-timeline-grid-row-cell",t=>(t.push(a),t)),function(){o()}}}})};export default P;
