!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Plugins=e()}(this,(function(){"use strict";const t="chart-timeline-grid-row-cell",e="chart-timeline-items-row-item";var i=Object.freeze({__proto__:null,CELL:t,ITEM:e,Plugin:function(i={enabled:!0}){let a,n,s;const o="config.plugin.TimelinePointer",r={cell:"",item:""};function h(){return{enabled:i.enabled,isMoving:!1,pointerState:"up",currentTarget:null,realTarget:null,targetType:"",targetData:null,initialPosition:{x:0,y:0},currentPosition:{x:0,y:0},events:{down:null,move:null,up:null}}}let d;class l{constructor(t){this.unsub=[],this.pointerDown=this.pointerDown.bind(this),this.pointerMove=this.pointerMove.bind(this),this.pointerUp=this.pointerUp.bind(this),this.data=h(),t.addEventListener("pointerdown",this.pointerDown),document.addEventListener("pointerup",this.pointerUp),document.addEventListener("pointermove",this.pointerMove),this.unsub.push(s.subscribe(o,t=>this.data=t))}destroy(t){t.removeEventListener("pointerdown",this.pointerDown),document.removeEventListener("pointerup",this.pointerUp),document.removeEventListener("pointermove",this.pointerMove)}updateData(){s.update(o,()=>Object.assign({},this.data))}getRealTarget(t){let e=t.target.closest("."+r.item);return e||(e=t.target.closest("."+r.cell),e||null)}getRealPosition(t){const e={x:0,y:0};if(d){const i=d.getBoundingClientRect();e.x=t.x-i.x,e.y=t.y-i.y}return e}pointerDown(i){if(!this.data.enabled)return;this.data.pointerState="down",this.data.currentTarget=i.target,this.data.realTarget=this.getRealTarget(i),this.data.realTarget?this.data.realTarget.classList.contains(r.item)?(this.data.targetType=e,this.data.targetData=this.data.realTarget.vido.item):this.data.realTarget.classList.contains(r.cell)?(this.data.targetType=t,this.data.targetData=this.data.realTarget.vido):this.data.targetType="":(this.data.targetType="",this.data.targetData=null),this.data.isMoving=!!this.data.realTarget,this.data.events.down=i,this.data.events.move=i;const a=this.getRealPosition(i);this.data.initialPosition=a,this.data.currentPosition=a,this.updateData()}pointerUp(t){this.data.enabled&&(this.data.pointerState="up",this.data.isMoving=!1,this.data.events.up=t,this.data.currentPosition=this.getRealPosition(t),this.updateData())}pointerMove(t){this.data.enabled&&this.data.isMoving&&(this.data.pointerState="move",this.data.events.move=t,this.data.currentPosition=this.getRealPosition(t),this.updateData())}}return function(i){a=i,n=a.api,s=a.state,r.cell=n.getClass(t),r.item=n.getClass(e);const c=s.subscribe("$data.elements.chart-timeline",t=>d=t);return s.update("config.actions.chart-timeline",t=>(t.push(l),t)),s.update(o,t=>h()),function(){c()}}}});var a=Object.freeze({__proto__:null,default:function(t={}){let e;const i={time:1e3,movementThreshold:2,action(t,e){}};t=Object.assign(Object.assign({},i),t);const a={},n={x:0,y:0};function s(t){void 0!==a[t]&&delete a[t]}function o(e,i){function o(s){!function(e,i,s){void 0===a[e.id]&&(a[e.id]={x:s.x,y:s.y},s.stopPropagation(),s.preventDefault(),setTimeout(()=>{if(void 0!==a[e.id]){let s=!0;const o=Math.abs(a[e.id].x-n.x),r=Math.abs(a[e.id].y-n.y);o>t.movementThreshold&&(s=!1),r>t.movementThreshold&&(s=!1),delete a[e.id],s&&t.action(i,e)}},t.time))}(i.item,e,s)}function r(t){n.x=t.x,n.y=t.y}return e.addEventListener("pointerdown",o),document.addEventListener("pointerup",(function(){s(i.item.id)})),document.addEventListener("pointermove",r),{update(t,e){i=e},destroy(t,e){document.removeEventListener("pointerup",s),document.removeEventListener("poitnermove",r),t.removeEventListener("pointerdown",o)}}}return function(t){e=t.api,t.state.update("config.actions.chart-timeline-items-row-item",t=>(t.push(o),t))}}});const n="config.plugin.ItemMovement";class s{constructor(t){this.onDestroy=[],this.vido=t,this.api=t.api,this.state=t.state,this.onDestroy.push(this.state.subscribe(n,t=>this.data=t)),this.data.className||(this.data.className=this.api.getClass("chart-timeline-items-row-item--moving")),this.onSelectionChange=this.onSelectionChange.bind(this),this.onDestroy.push(this.state.subscribe("config.plugin.Selection",this.onSelectionChange))}destroy(){this.onDestroy.forEach(t=>t())}updateData(){this.state.update(n,this.data)}getItemMovingTime(t,e){const i=this.data.movement.px.horizontal,a=t.$data.position.left+i,n=Math.round(this.api.time.getTimeFromViewOffsetPx(a,e));return{time:this.api.time.date(n),position:a}}moveItems(){const t=this.state.get("$data.chart.time");let e=this.state.multi();for(const i of this.data.lastMoved){const a=this.getItemMovingTime(i,t);let n;e=e.update(`config.chart.items.${i.id}.time`,t=>{const e=a.time.valueOf(),i=e-t.start;return t.start=e,t.end+=i,n=Object.assign({},t),t}).update(`config.chart.items.${i.id}.$data`,t=>(t.time.startDate=a.time,t.time.endDate=this.api.time.date(n.end),t.position.left=a.position,t.position.actualLeft=this.api.time.limitOffsetPxToView(a.position),t.position.right=t.position.left+t.width,t.position.actualRight=this.api.time.limitOffsetPxToView(t.position.right),t.actualWidth=t.position.actualRight-t.position.actualLeft,t))}e.done()}clearSelection(){this.data.moving=[],this.data.lastMoved=[],this.data.movement.px.horizontal=0,this.data.movement.px.vertical=0,this.data.movement.time=0,this.data.state="up",this.data.pointerMoved=!1}updatePointerState(){"up"===this.data.state&&"down"===this.selection.pointerState?this.data.onStart(this.data.moving):"down"!==this.data.state&&"move"!==this.data.state||"up"!==this.selection.pointerState?"move"===this.selection.pointerState&&((this.data.movement.px.horizontal||this.data.movement.px.vertical)&&(this.data.pointerMoved=!0),this.data.onMove(this.data.moving)):(this.data.moving=[],this.data.onEnd(this.data.lastMoved),this.clearSelection()),this.data.state=this.selection.pointerState}onStart(){this.data.lastPosition=Object.assign({},this.selection.currentPosition)}onSelectionChange(t){if(this.data.enabled){if(this.selection=t,this.selection.targetType!==e)return this.clearSelection();this.selection.events.move&&(this.selection.events.move.preventDefault(),this.selection.events.move.stopPropagation()),this.selection.events.down&&(this.selection.events.down.preventDefault(),this.selection.events.down.stopPropagation()),"up"===this.data.state&&"down"===this.selection.pointerState&&this.onStart(),this.data.moving=[...this.selection.selected[e]],this.data.moving.length&&(this.data.lastMoved=[...this.data.moving]),this.data.movement.px.horizontal=this.selection.currentPosition.x-this.data.lastPosition.x,this.data.movement.px.vertical=this.selection.currentPosition.y-this.data.lastPosition.y,this.data.lastPosition.x=this.selection.currentPosition.x,this.data.lastPosition.y=this.selection.currentPosition.y,this.updatePointerState(),this.moveItems(),this.updateData()}}}var o=Object.freeze({__proto__:null,Plugin:function(t={}){return function(e){e.state.update(n,function(t){return Object.assign({moving:[],lastMoved:[],state:"up",pointerMoved:!1,lastPosition:{x:0,y:0},movement:{px:{horizontal:0,vertical:0},time:0},onStart(){},onMove(){},onEnd(){},snapStart:({startTime:t,time:e})=>t.startOf(e.period),snapEnd:({endTime:t,time:e})=>t.endOf(e.period)},t)}(function(t){return Object.assign({enabled:!0,className:""},t)}(t))),new s(e)}}});class r{constructor(t,e){this.spacing=1,this.unsubs=[],this.vido=t,this.state=t.state,this.api=t.api,this.data=function(t={}){const e=Object.assign({enabled:!0,handle:{width:18,horizontalMargin:1,verticalMargin:1,outside:!1,onlyWhenSelected:!0},initialPosition:{x:0,y:0},currentPosition:{x:0,y:0},movement:0,itemsInitial:[],leftIsMoving:!1,rightIsMoving:!1},t);return t.handle&&(e.handle=Object.assign(Object.assign({},e.handle),t.handle)),e}(e),this.html=t.html,this.wrapper=this.wrapper.bind(this),this.onRightPointerDown=this.onRightPointerDown.bind(this),this.onRightPointerMove=this.onRightPointerMove.bind(this),this.onRightPointerUp=this.onRightPointerUp.bind(this),this.onLeftPointerDown=this.onLeftPointerDown.bind(this),this.onLeftPointerMove=this.onLeftPointerMove.bind(this),this.onLeftPointerUp=this.onLeftPointerUp.bind(this),this.updateData(),this.unsubs.push(this.state.subscribe("config.plugin.ItemResizing",t=>this.data=t)),document.addEventListener("pointermove",this.onLeftPointerMove),document.addEventListener("pointerup",this.onLeftPointerUp),document.addEventListener("pointermove",this.onRightPointerMove),document.addEventListener("pointerup",this.onRightPointerUp)}destroy(){this.unsubs.forEach(t=>t()),document.removeEventListener("pointermove",this.onLeftPointerMove),document.removeEventListener("pointerup",this.onLeftPointerUp),document.removeEventListener("pointermove",this.onRightPointerMove),document.removeEventListener("pointerup",this.onRightPointerUp)}updateData(){this.state.update("config.plugin.ItemResizing",this.data)}initializeWrapper(){this.leftClassName=this.api.getClass("chart-timeline-items-row-item-resizing-handle"),this.leftClassName+=" "+this.leftClassName+"--left",this.rightClassName=this.api.getClass("chart-timeline-items-row-item-resizing-handle"),this.rightClassName+=" "+this.rightClassName+"--right",this.spacing=this.state.get("config.chart.spacing")}getSelectedItems(){return this.state.get(`config.plugin.Selection.selected.${e}`)}getRightStyleMap(t,e){const i=new this.vido.StyleMap({});return i.style.display=e?"block":"none",i.style.top=t.$data.position.actualTop+this.data.handle.verticalMargin+"px",this.data.handle.outside?i.style.left=t.$data.position.right+this.data.handle.horizontalMargin-this.spacing+"px":i.style.left=t.$data.position.right-this.data.handle.width-this.data.handle.horizontalMargin-this.spacing+"px",i.style.width=this.data.handle.width+"px",i.style.height=t.$data.actualHeight-2*this.data.handle.verticalMargin+"px",i}getLeftStyleMap(t,e){const i=new this.vido.StyleMap({});return i.style.display=e?"block":"none",i.style.top=t.$data.position.actualTop+this.data.handle.verticalMargin+"px",this.data.handle.outside?i.style.left=t.$data.position.left-this.data.handle.width-this.data.handle.horizontalMargin+"px":i.style.left=t.$data.position.left+this.data.handle.horizontalMargin+"px",i.style.width=this.data.handle.width+"px",i.style.height=t.$data.actualHeight-2*this.data.handle.verticalMargin+"px",i}onPointerDown(t){t.preventDefault(),t.stopPropagation(),this.data.itemsInitial=this.getSelectedItems().map(t=>({id:t.id,left:t.$data.position.left,width:t.$data.width})),this.data.initialPosition={x:t.screenX,y:t.screenY},this.data.currentPosition=Object.assign({},this.data.initialPosition)}onLeftPointerDown(t){}onRightPointerDown(t){this.data.enabled&&(this.data.rightIsMoving=!0,this.onPointerDown(t),this.updateData())}onPointerMove(t){t.stopPropagation(),t.preventDefault(),this.data.currentPosition.x=t.screenX,this.data.currentPosition.y=t.screenY,this.data.movement=this.data.currentPosition.x-this.data.initialPosition.x}onLeftPointerMove(t){if(!this.data.enabled||!this.data.leftIsMoving)return;this.onPointerMove(t);const e=this.getSelectedItems(),i=this.data.movement,a=this.state.get("$data.chart.time");let n=this.state.multi();for(let t=0,s=e.length;t<s;t++){const s=e[t];s.$data.position.left=this.data.itemsInitial[t].left+i,s.$data.position.left>s.$data.position.right&&(s.$data.position.left=s.$data.position.right),s.$data.position.actualLeft=s.$data.position.left,s.$data.width=s.$data.position.right-s.$data.position.left,s.$data.actualWidth=s.$data.width;const o=this.api.time.getTimeFromViewOffsetPx(s.$data.position.left,a);s.time.start=o,s.$data.time.startDate=this.api.time.date(o),n=n.update(`config.chart.items.${s.id}`,s)}n.done(),this.updateData()}onRightPointerMove(t){if(!this.data.enabled||!this.data.rightIsMoving)return;this.onPointerMove(t);const e=this.getSelectedItems(),i=this.data.movement,a=this.state.get("$data.chart.time");let n=this.state.multi();for(let t=0,s=e.length;t<s;t++){const s=e[t];s.$data.width=this.data.itemsInitial[t].width+i,s.$data.width<0&&(s.$data.width=0),s.$data.actualWidth=s.$data.width;const o=s.$data.position.left+s.$data.width;s.$data.position.right=o,s.$data.position.actualRight=o;const r=this.api.time.getTimeFromViewOffsetPx(o,a);s.time.end=r,s.$data.time.endDate=this.api.time.date(r),n=n.update(`config.chart.items.${s.id}.time`,s.time).update(`config.chart.items.${s.id}.$data`,s.$data)}n.done(),this.updateData()}onPointerUp(t){t.preventDefault(),t.stopPropagation()}onLeftPointerUp(t){this.data.enabled&&this.data.leftIsMoving&&(this.onPointerUp(t),this.data.leftIsMoving=!1,this.updateData())}onRightPointerUp(t){this.data.enabled&&this.data.rightIsMoving&&(this.onPointerUp(t),this.data.rightIsMoving=!1,this.updateData())}wrapper(t,e){const i=this.oldWrapper(t,e),a=e.props.item;let n=!a.$data.detached;this.data.handle.onlyWhenSelected&&(n=n&&a.selected);const s=this.getRightStyleMap(a,n),o=this.getLeftStyleMap(a,n),r={handleEvent:this.onLeftPointerDown},h={handleEvent:this.onRightPointerDown},d=(this.html`<div class=${this.leftClassName} style=${o} @pointerdown=${r}></div>`,this.html`<div class=${this.rightClassName} style=${s} @pointerdown=${h}></div>`);return this.html`${i}${d}`}getWrapper(t){return this.oldWrapper||(this.oldWrapper=t),this.initializeWrapper(),this.wrapper}}var h=Object.freeze({__proto__:null,Plugin:function(t={}){return function(e){const i=new r(e,t);e.state.update("config.wrappers.ChartTimelineItemsRowItem",t=>i.getWrapper(t))}}});function d(i){return Object.assign({enabled:!0,showOverlay:!0,isSelecting:!1,pointerState:"up",targetType:"",initialPosition:{x:0,y:0},currentPosition:{x:0,y:0},selectionArea:{x:0,y:0,width:0,height:0},selecting:{[e]:[],[t]:[]},selected:{[e]:[],[t]:[]},events:{down:null,move:null,up:null}},i)}class l{constructor(t,e){this.unsub=[],this.vido=t,this.state=t.state,this.api=t.api,this.options=e,this.data=d(e),this.wrapperClassName=this.api.getClass("chart-selection"),this.wrapperStyleMap=new t.StyleMap({display:"none"}),this.html=t.html,this.wrapper=this.wrapper.bind(this),this.unsub.push(this.state.subscribe("config.plugin.TimelinePointer",t=>{this.poitnerData=t,this.onPointerData()})),this.updateData(),this.unsub.push(this.state.subscribe("config.plugin.Selection",t=>{this.data=t}))}destroy(){this.unsub.forEach(t=>t())}updateData(){this.state.update("config.plugin.Selection",Object.assign({},this.data)),this.vido.update()}getItemsUnderSelectionArea(){return[]}getSelectionArea(){const t={x:0,y:0,width:0,height:0},e=Object.assign({},this.poitnerData.initialPosition),i=Object.assign({},this.poitnerData.currentPosition),a=i.x-e.x,n=i.y-e.y;return a>=0?(t.x=e.x,t.width=a):(t.x=i.x,t.width=Math.abs(a)),n>=0?(t.y=e.y,t.height=n):(t.y=i.y,t.height=Math.abs(n)),t}collectLinkedItems(t,e=[]){if(t.linkedWith&&t.linkedWith.length){const i=this.state.get("config.chart.items");for(const a of t.linkedWith){const n=i[a];e.includes(n)||(e.push(n),this.collectLinkedItems(n,e)),n.linkedWith||(n.linkedWith=[]),n.linkedWith.includes(t.id)||n.linkedWith.push(t.id)}}return e}getSelected(t){let i;return i=this.data.selected[e].find(e=>e.id===t.id)?this.data.selected[e]:this.poitnerData.events.down.ctrlKey?[...new Set([...this.data.selected[e],...this.collectLinkedItems(t,[t])]).values()]:this.collectLinkedItems(t,[t]),i}selectCells(){this.data.isSelecting=!0,this.data.selectionArea=this.getSelectionArea(),0===this.getItemsUnderSelectionArea().length&&(this.state.update("config.chart.items.*.selected",!1),this.data.selected[e].length=0)}selectItems(){this.data.isSelecting=!1,this.data.selectionArea=this.getSelectionArea(),this.data.currentPosition=this.poitnerData.currentPosition,this.data.initialPosition=this.poitnerData.initialPosition;const t=this.poitnerData.targetData;this.data.selected[e]=this.getSelected(t);let i=this.state.multi();i=i.update("config.chart.items.*.selected",!1);for(const t of this.data.selected[e])i=i.update(`config.chart.items.${t.id}.selected`,!0);i.done()}onPointerData(){this.poitnerData.isMoving&&this.poitnerData.targetType===t?this.selectCells():this.poitnerData.isMoving&&this.poitnerData.targetType===e?this.selectItems():this.poitnerData.isMoving||(this.data.isSelecting=!1),this.data.events=this.poitnerData.events,this.data.pointerState=this.poitnerData.pointerState,this.data.targetType=this.poitnerData.targetType,this.updateData()}wrapper(t,e){const i=this.oldWrapper(t,e);this.data.isSelecting&&this.data.showOverlay?(this.wrapperStyleMap.style.display="block",this.wrapperStyleMap.style.left=this.data.selectionArea.x+"px",this.wrapperStyleMap.style.top=this.data.selectionArea.y+"px",this.wrapperStyleMap.style.width=this.data.selectionArea.width+"px",this.wrapperStyleMap.style.height=this.data.selectionArea.height+"px"):this.wrapperStyleMap.style.display="none";const a=this.html` <div class=${this.wrapperClassName} style=${this.wrapperStyleMap}></div> `;return this.html` ${i}${a} `}getWrapper(t){return this.oldWrapper||(this.oldWrapper=t),this.wrapper}}var c=Object.freeze({__proto__:null,Plugin:function(t={}){return t=function(t){const e={enabled:!0,cells:!0,items:!0,rows:!1,showOverlay:!0,canSelect:(t,e,i)=>e,canDeselect:(t,e,i)=>[]};return t=Object.assign(Object.assign({},e),t)}(t),function(e){const i=new l(e,t);return e.state.update("config.plugin.Selection",d(t)),e.state.update("config.wrappers.ChartTimelineItems",t=>i.getWrapper(t)),function(){i.destroy()}}}});const p={enabled:!0};var u=Object.freeze({__proto__:null,Plugin:function(t=p){let e,i,a,n=t.enabled;class s{constructor(t){this.moving=!1,this.initialDataIndex={x:0,y:0},this.lastPos=0,this.pointerDown=this.pointerDown.bind(this),this.pointerUp=this.pointerUp.bind(this),this.pointerMove=e.schedule(this.pointerMove.bind(this)),t.addEventListener("pointerdown",this.pointerDown),document.addEventListener("pointermove",this.pointerMove,{passive:!0}),document.addEventListener("pointerup",this.pointerUp),t.style.cursor="grab"}destroy(t){t.removeEventListener("pointerdown",this.pointerDown),document.removeEventListener("pointermove",this.pointerMove),document.removeEventListener("pointerup",this.pointerUp)}resetInitialPoint(t){this.initialPoint={x:t.screenX,y:t.screenY}}pointerDown(t){if(!n)return;this.moving=!0,this.resetInitialPoint(t);const e=a.get("config.scroll");this.initialDataIndex={x:e.horizontal.dataIndex||0,y:e.vertical.dataIndex||0}}pointerUp(t){n&&this.moving&&(this.moving=!1)}handleHorizontalMovement(t,e){const n=a.get("$data.chart.time");if(t.x>0){if(0===this.initialDataIndex.x)return this.resetInitialPoint(e);const a=n.allDates[n.level];let s=this.initialDataIndex.x-1,o=0;for(;s>0;s--){if(o+=a[s].width,o>=t.x)break}i.scrollToTime(a[s].leftGlobal,!1)}else if(t.x<0){let s=this.initialDataIndex.x;const o=a.get("config.scroll.horizontal"),r=n.allDates[n.level];if(s-1>=r.length-o.lastPageCount)return this.resetInitialPoint(e);let h=0;for(let e=r.length;s<e;s++){if(h+=r[s].width,-h<=t.x)break}if(s-1>=r.length-o.lastPageCount)return;i.scrollToTime(r[s].leftGlobal,!1)}}pointerMove(t){if(!n||!this.moving)return;const e={x:t.screenX-this.initialPoint.x,y:t.screenY-this.initialPoint.y};this.handleHorizontalMovement(e,t)}}return function(o){e=o,i=e.api,a=e.state,a.update("config.plugin.CalendarScroll",t),a.subscribe("config.plugin.CalendarScroll.enabled",t=>n=t),a.update("config.actions.chart-calendar",t=>(t.push(s),t))}}});String(Math.random()).slice(2),document.createComment(""),document.createElement("template"),document.createTextNode("");let g=!1;(()=>{try{const t={get capture(){return g=!0,!1}};window.addEventListener("test",t,t),window.removeEventListener("test",t,t)}catch(t){}})(),"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.1.7");document.createElement("template");class m{constructor(){this.isAction=!0}}m.prototype.isAction=!0;document.createTextNode("");return{TimelinePointer:i,ItemHold:a,ItemMovement:o,ItemResizing:h,Selection:c,CalendarScroll:u,HighlightWeekends:Object.freeze({__proto__:null,Plugin:function(t={}){const e=t.weekdays||[6,0];let i,a,n=!0;class s extends m{constructor(t,e){super(),this.highlight(t,e.time.leftGlobal)}update(t,e){this.highlight(t,e.time.leftGlobal)}highlight(t,s){const o=t.classList.contains(i);if(!n)return void(o&&t.classList.remove(i));const r=e.includes(a.time.date(s).day());!o&&r?t.classList.add(i):o&&!r&&t.classList.remove(i)}}return function(e){a=e.api,i=t.className||a.getClass("chart-timeline-grid-row-cell")+"--weekend";const o=e.state.subscribe("$data.chart.time.format.period",t=>n="day"===t);return e.state.update("config.actions.chart-timeline-grid-row-cell",t=>(t.push(s),t)),function(){o()}}}})}}));
