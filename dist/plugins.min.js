const t="chart-timeline-grid-row-cell",e="chart-timeline-items-row-item";var i=Object.freeze({__proto__:null,CELL:t,ITEM:e,Plugin:function(i={enabled:!0}){let n,a,s;const o="config.plugin.TimelinePointer",r={cell:"",item:""};function l(){return{enabled:i.enabled,isMoving:!1,pointerState:"up",currentTarget:null,realTarget:null,targetType:"",targetData:null,initialPosition:{x:0,y:0},currentPosition:{x:0,y:0},events:{down:null,move:null,up:null}}}let h;class d{constructor(t){this.unsub=[],this.pointerDown=this.pointerDown.bind(this),this.pointerMove=this.pointerMove.bind(this),this.pointerUp=this.pointerUp.bind(this),this.data=l(),t.addEventListener("pointerdown",this.pointerDown),document.addEventListener("pointerup",this.pointerUp),document.addEventListener("pointermove",this.pointerMove),this.unsub.push(s.subscribe(o,t=>this.data=t))}destroy(t){t.removeEventListener("pointerdown",this.pointerDown),document.removeEventListener("pointerup",this.pointerUp),document.removeEventListener("pointermove",this.pointerMove)}updateData(){s.update(o,()=>Object.assign({},this.data))}getRealTarget(t){let e=t.target.closest("."+r.item);return e||(e=t.target.closest("."+r.cell),e||null)}getRealPosition(t){const e={x:0,y:0};if(h){const i=h.getBoundingClientRect();e.x=t.x-i.x,e.y=t.y-i.y}return e}pointerDown(i){if(!this.data.enabled)return;this.data.pointerState="down",this.data.currentTarget=i.target,this.data.realTarget=this.getRealTarget(i),this.data.realTarget?this.data.realTarget.classList.contains(r.item)?(this.data.targetType=e,this.data.targetData=this.data.realTarget.vido.item):this.data.realTarget.classList.contains(r.cell)?(this.data.targetType=t,this.data.targetData=this.data.realTarget.vido):this.data.targetType="":(this.data.targetType="",this.data.targetData=null),this.data.isMoving=!!this.data.realTarget,this.data.events.down=i,this.data.events.move=i;const n=this.getRealPosition(i);this.data.initialPosition=n,this.data.currentPosition=n,this.updateData()}pointerUp(t){this.data.enabled&&(this.data.pointerState="up",this.data.isMoving=!1,this.data.events.up=t,this.data.currentPosition=this.getRealPosition(t),this.updateData())}pointerMove(t){this.data.enabled&&this.data.isMoving&&(this.data.pointerState="move",this.data.events.move=t,this.data.currentPosition=this.getRealPosition(t),this.updateData())}}return function(i){n=i,a=n.api,s=n.state,r.cell=a.getClass(t),r.item=a.getClass(e);const c=s.subscribe("$data.elements.chart-timeline",t=>h=t);return s.update("config.actions.chart-timeline",t=>(t.push(d),t)),s.update(o,t=>l()),function(){c()}}}});var n=Object.freeze({__proto__:null,default:function(t={}){let e;const i={time:1e3,movementThreshold:2,action(t,e){}};t=Object.assign(Object.assign({},i),t);const n={},a={x:0,y:0};function s(t){void 0!==n[t]&&delete n[t]}function o(e,i){function o(s){!function(e,i,s){void 0===n[e.id]&&(n[e.id]={x:s.x,y:s.y},s.stopPropagation(),s.preventDefault(),setTimeout(()=>{if(void 0!==n[e.id]){let s=!0;const o=Math.abs(n[e.id].x-a.x),r=Math.abs(n[e.id].y-a.y);o>t.movementThreshold&&(s=!1),r>t.movementThreshold&&(s=!1),delete n[e.id],s&&t.action(i,e)}},t.time))}(i.item,e,s)}function r(t){a.x=t.x,a.y=t.y}return e.addEventListener("pointerdown",o),document.addEventListener("pointerup",(function(){s(i.item.id)})),document.addEventListener("pointermove",r),{update(t,e){i=e},destroy(t,e){document.removeEventListener("pointerup",s),document.removeEventListener("poitnermove",r),t.removeEventListener("pointerdown",o)}}}return function(t){e=t.api,t.state.update("config.actions.chart-timeline-items-row-item",t=>(t.push(o),t))}}});const a="config.plugin.ItemMovement";class s{constructor(t){this.onDestroy=[],this.vido=t,this.api=t.api,this.state=t.state,this.onDestroy.push(this.state.subscribe(a,t=>this.data=t)),this.data.className||(this.data.className=this.api.getClass("chart-timeline-items-row-item--moving")),this.onSelectionChange=this.onSelectionChange.bind(this),this.onDestroy.push(this.state.subscribe("config.plugin.Selection",this.onSelectionChange))}destroy(){this.onDestroy.forEach(t=>t())}updateData(){this.state.update(a,this.data)}getItemMovingTime(t,e,i){const n=i.allDates[i.level],a="left"===e?t.$data.position.left+i.leftPx+this.data.movement.px.horizontal:t.$data.position.right+i.leftPx+this.data.movement.px.horizontal;return this.api.time.findDateAtOffsetPx(a,n).leftGlobalDate.clone()}moveItems(){const t=this.state.get("$data.chart.time");for(const e of this.data.lastMoved){const i=this.getItemMovingTime(e,"left",t),n=this.getItemMovingTime(e,"right",t);this.state.update(`config.chart.items.${e.id}.time`,t=>(t.start=i.valueOf(),t.end=n.valueOf(),t)),this.state.update(`config.chart.items.${e.id}.$data.time`,t=>(t.startDate=i,t.endDate=n,t))}}clearSelection(){this.data.moving=[],this.data.lastMoved=[],this.data.movement.px.horizontal=0,this.data.movement.px.vertical=0,this.data.movement.time=0,this.data.state="up",this.data.pointerMoved=!1}updatePointerState(){"up"===this.data.state&&"down"===this.selection.pointerState?this.data.onStart(this.data.moving):"down"!==this.data.state&&"move"!==this.data.state||"up"!==this.selection.pointerState?"move"===this.selection.pointerState&&((this.data.movement.px.horizontal||this.data.movement.px.vertical)&&(this.data.pointerMoved=!0),this.data.onMove(this.data.moving)):(this.data.moving=[],this.data.onEnd(this.data.lastMoved),this.clearSelection()),this.data.state=this.selection.pointerState}onSelectionChange(t){if(this.data.enabled){if(this.selection=t,this.selection.targetType!==e)return this.clearSelection();this.selection.events.move&&(this.selection.events.move.preventDefault(),this.selection.events.move.stopPropagation()),this.selection.events.down&&(this.selection.events.down.preventDefault(),this.selection.events.down.stopPropagation()),this.data.moving=[...this.selection.selected[e]],this.data.moving.length&&(this.data.lastMoved=[...this.data.moving]),this.data.movement.px.horizontal=this.selection.currentPosition.x-this.selection.initialPosition.x,this.data.movement.px.vertical=this.selection.currentPosition.y-this.selection.initialPosition.y,this.updatePointerState(),this.moveItems(),this.updateData()}}}var o=Object.freeze({__proto__:null,Plugin:function(t={}){return function(e){e.state.update(a,function(t){return Object.assign({moving:[],lastMoved:[],state:"up",pointerMoved:!1,movement:{px:{horizontal:0,vertical:0},time:0},onStart(t){console.log("start moving",t)},onMove(t){console.log("move",t)},onEnd(t){console.log("end move",t)},snapStart:({startTime:t,time:e})=>t.startOf(e.period),snapEnd:({endTime:t,time:e})=>t.endOf(e.period)},t)}(function(t){return Object.assign({enabled:!0,className:""},t)}(t))),new s(e)}}});let r,l,h,d,c,p,u,g;function m(t,e){const i=r(t,e);p.isSelecting?(g.style.display="block",g.style.left=p.selectionArea.x+"px",g.style.top=p.selectionArea.y+"px",g.style.width=p.selectionArea.width+"px",g.style.height=p.selectionArea.height+"px"):g.style.display="none";const n=c`
    <div class=${u} style=${g}></div>
  `;return c`
    ${i}${n}
  `}function v(){return{enabled:!0,isSelecting:!1,pointerState:"up",targetType:"",initialPosition:{x:0,y:0},currentPosition:{x:0,y:0},selectionArea:{x:0,y:0,width:0,height:0},selecting:{[e]:[],[t]:[]},selected:{[e]:[],[t]:[]},events:{down:null,move:null,up:null}}}class f{constructor(t,e){this.unsub=[],this.vido=t,this.state=t.state,this.api=t.api,this.options=e,this.data=v(),this.unsub.push(this.state.subscribe("config.plugin.TimelinePointer",t=>{this.poitnerData=t,this.onPointerData()})),this.updateData(),this.unsub.push(this.state.subscribe("config.plugin.Selection",t=>{this.data=t}))}destroy(){this.unsub.forEach(t=>t())}updateData(){this.state.update("config.plugin.Selection",Object.assign({},this.data))}getItemsUnderSelectionArea(){return[]}getSelectionArea(){const t={x:0,y:0,width:0,height:0},e=Object.assign({},this.poitnerData.initialPosition),i=Object.assign({},this.poitnerData.currentPosition),n=i.x-e.x,a=i.y-e.y;return n>=0?(t.x=e.x,t.width=n):(t.x=i.x,t.width=Math.abs(n)),a>=0?(t.y=e.y,t.height=a):(t.y=i.y,t.height=Math.abs(a)),t}collectLinkedItems(t,e=[]){if(t.linkedWith&&t.linkedWith.length){const i=this.state.get("config.chart.items");for(const n of t.linkedWith){const t=i[n];e.push(t),this.collectLinkedItems(t,e)}}return e}onPointerData(){if(this.poitnerData.isMoving&&this.poitnerData.targetType===t){this.data.isSelecting=!0,this.data.selectionArea=this.getSelectionArea(),0===this.getItemsUnderSelectionArea().length&&(this.state.update("config.chart.items.*.selected",!1),this.data.selected[e].length=0)}else if(this.poitnerData.isMoving&&this.poitnerData.targetType===e){this.data.isSelecting=!1,this.data.selectionArea=this.getSelectionArea(),this.data.currentPosition=this.poitnerData.currentPosition,this.data.initialPosition=this.poitnerData.initialPosition;const t=this.poitnerData.targetData,i=this.collectLinkedItems(t,[t]);this.data.selected[e]=i,this.state.update("config.chart.items.*.selected",!1);for(const t of i)this.state.update(`config.chart.items.${t.id}.selected`,!0)}else this.poitnerData.isMoving||(this.data.isSelecting=!1);this.data.events=this.poitnerData.events,this.data.pointerState=this.poitnerData.pointerState,this.data.targetType=this.poitnerData.targetType,this.updateData()}}var b=Object.freeze({__proto__:null,Plugin:function(t={}){return t=function(t){const e={enabled:!0,grid:!1,items:!0,rows:!1,horizontal:!0,vertical:!0,selecting(){},deselecting(){},selected(){},deselected(){},canSelect:(t,e,i)=>e,canDeselect:(t,e,i)=>[]};return t=Object.assign(Object.assign({},e),t)}(t),function(e){const i=new f(e,t);return e.state.update("config.plugin.Selection",v()),e.state.update("config.wrappers.ChartTimelineItems",t=>function(t,e){return r=t,l=e,h=l.api,d=l.state,c=l.html,u=h.getClass("chart-selection"),g=new l.StyleMap({display:"none"}),l.onDestroy(d.subscribe("config.plugin.Selection",t=>{p=t,l.update()})),m}(t,e)),function(){i.destroy()}}}});const y={enabled:!0};var x=Object.freeze({__proto__:null,Plugin:function(t=y){let e,i,n,a=t.enabled;class s{constructor(t){this.moving=!1,this.initialDataIndex={x:0,y:0},this.lastPos=0,this.pointerDown=this.pointerDown.bind(this),this.pointerUp=this.pointerUp.bind(this),this.pointerMove=e.schedule(this.pointerMove.bind(this)),t.addEventListener("pointerdown",this.pointerDown),document.addEventListener("pointermove",this.pointerMove,{passive:!0}),document.addEventListener("pointerup",this.pointerUp),t.style.cursor="grab"}destroy(t){t.removeEventListener("pointerdown",this.pointerDown),document.removeEventListener("pointermove",this.pointerMove),document.removeEventListener("pointerup",this.pointerUp)}resetInitialPoint(t){this.initialPoint={x:t.screenX,y:t.screenY}}pointerDown(t){if(!a)return;this.moving=!0,this.resetInitialPoint(t);const e=n.get("config.scroll");this.initialDataIndex={x:e.horizontal.dataIndex||0,y:e.vertical.dataIndex||0}}pointerUp(t){a&&this.moving&&(this.moving=!1)}handleHorizontalMovement(t,e){const a=n.get("$data.chart.time");if(t.x>0){if(0===this.initialDataIndex.x)return this.resetInitialPoint(e);const n=a.allDates[a.level];let s=this.initialDataIndex.x-1,o=0;for(;s>0;s--){if(o+=n[s].width,o>=t.x)break}i.scrollToTime(n[s].leftGlobal,!1)}else if(t.x<0){let s=this.initialDataIndex.x;const o=n.get("config.scroll.horizontal"),r=a.allDates[a.level];if(s-1>=r.length-o.lastPageCount)return this.resetInitialPoint(e);let l=0;for(let e=r.length;s<e;s++){if(l+=r[s].width,-l<=t.x)break}if(s-1>=r.length-o.lastPageCount)return;i.scrollToTime(r[s].leftGlobal,!1)}}pointerMove(t){if(!a||!this.moving)return;const e={x:t.screenX-this.initialPoint.x,y:t.screenY-this.initialPoint.y};this.handleHorizontalMovement(e,t)}}return function(o){e=o,i=e.api,n=e.state,n.update("config.plugin.CalendarScroll",t),n.subscribe("config.plugin.CalendarScroll.enabled",t=>a=t),n.update("config.actions.chart-calendar",t=>(t.push(s),t))}}});String(Math.random()).slice(2),document.createComment(""),document.createElement("template"),document.createTextNode("");let D=!1;(()=>{try{const t={get capture(){return D=!0,!1}};window.addEventListener("test",t,t),window.removeEventListener("test",t,t)}catch(t){}})(),"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.1.7");document.createElement("template");class w{constructor(){this.isAction=!0}}w.prototype.isAction=!0;document.createTextNode("");var P={TimelinePointer:i,ItemHold:n,ItemMovement:o,Selection:b,CalendarScroll:x,WeekendHighlight:Object.freeze({__proto__:null,Plugin:function(t={}){const e=t.weekdays||[6,0];let i,n,a=!0;class s extends w{constructor(t,e){super(),this.highlight(t,e.time.leftGlobal)}update(t,e){this.highlight(t,e.time.leftGlobal)}highlight(t,s){const o=t.classList.contains(i);if(!a)return void(o&&t.classList.remove(i));const r=e.includes(n.time.date(s).day());!o&&r?t.classList.add(i):o&&!r&&t.classList.remove(i)}}return function(e){n=e.api,i=t.className||n.getClass("chart-timeline-grid-row-cell")+"--weekend";const o=e.state.subscribe("$data.chart.time.format.period",t=>a="day"===t);return e.state.update("config.actions.chart-timeline-grid-row-cell",t=>(t.push(s),t)),function(){o()}}}})};export default P;
