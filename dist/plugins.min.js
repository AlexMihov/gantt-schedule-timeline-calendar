/**
 * ItemHold plugin
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
 * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar
 */
var e={ItemHold:function ItemHold(e={}){const t={time:1e3,movementThreshold:2,action(e,t){}};e=Object.assign(Object.assign({},t),e);const i={},n={x:0,y:0};function onMouseUp(e){void 0!==i[e]&&delete i[e]}function action(t,s){function elementMouseDown(o){!function onMouseDown(t,s,o){void 0===i[t.id]&&(i[t.id]={x:o.x,y:o.y},setTimeout(()=>{if(void 0!==i[t.id]){let o=!0,c=i[t.id].x-n.x;-1===Math.sign(c)&&(c=-c);let r=i[t.id].y-n.y;-1===Math.sign(r)&&(r=-r),c>e.movementThreshold&&(o=!1),r>e.movementThreshold&&(o=!1),delete i[t.id],o&&e.action(s,t)}},e.time))}(s.item,t,o)}function onMouseMove(e){n.x=e.x,n.y=e.y}return t.addEventListener("mousedown",elementMouseDown),document.addEventListener("mouseup",(function mouseUp(){onMouseUp(s.item.id)})),document.addEventListener("mousemove",onMouseMove),{update(e,t){s=t},destroy(e,t){document.removeEventListener("mouseup",onMouseUp),document.removeEventListener("mousemove",onMouseMove),e.removeEventListener("mousedown",elementMouseDown)}}}return function initialize(e){e.state.update("config.actions.chart-timeline-items-row-item",e=>(e.push(action),e))}}
/**
 * ItemMovement plugin
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
 * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar
 */,ItemMovement:function ItemMovement(e={}){const t={moveable:!0,resizeable:!0,resizerContent:"",collisionDetection:!0,outOfBorders:!1,snapStart:(e,t)=>e+t,snapEnd:(e,t)=>e+t,ghostNode:!0};e=Object.assign(Object.assign({},t),e);const i={};function action(t,n){let s,o,c=t.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content");if(!e.moveable&&!e.resizeable)return;function isResizeable(t){let i=e.resizeable&&(!t.item.hasOwnProperty("resizeable")||!0===t.item.resizeable);return t.row.hasOwnProperty("resizeable")&&i&&(i=t.row.resizeable),i}function getMovement(e){const t=e.item.id;return void 0===i[t]&&(i[t]={moving:!1,resizing:!1}),i[t]}function moveGhost(t,i){if(e.ghostNode){const e=getMovement(t),n=i.x-e.ganttLeft-e.itemLeftCompensation,o=s.get("config.scroll.compensation");e.ghost.style.left=n+"px",e.ghost.style.top=i.y-e.ganttTop-e.itemTop+o+"px"}}function destroyGhost(t){e.ghostNode&&void 0!==i[t]&&void 0!==i[t].ghost&&(s.get("_internal.elements.chart-timeline").removeChild(i[t].ghost),delete i[t].ghost)}function getSnapStart(t){let i=e.snapStart;return"function"==typeof t.item.snapStart&&(i=t.item.snapStart),i}function getSnapEnd(t){let i=e.snapEnd;return"function"==typeof t.item.snapEnd&&(i=t.item.snapEnd),i}s=n.state;const r=`<div class="${(o=n.api).getClass("chart-timeline-items-row-item-content-resizer")}">${e.resizerContent}</div>`;c.insertAdjacentHTML("beforeend",r);const l=c.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content-resizer");function labelMouseDown(i){if(i.stopPropagation(),0!==i.button)return;c=t.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content");const o=getMovement(n);o.moving=!0;const r=s.get(`config.chart.items.${n.item.id}`),l=s.get("_internal.chart.time.leftGlobal"),a=s.get("_internal.chart.time.timePerPixel"),m=s.get("_internal.elements.chart-timeline").getBoundingClientRect();o.ganttTop=m.top,o.ganttLeft=m.left,o.itemX=Math.round((r.time.start-l)/a),o.itemLeftCompensation=i.x-o.ganttLeft-o.itemX,function createGhost(t,i,n,o){const r=getMovement(t);if(!e.ghostNode||void 0!==r.ghost)return;const l=c.cloneNode(!0),a=getComputedStyle(c);l.style.position="absolute",l.style.left=i.x-n-r.itemLeftCompensation+"px";const m=i.y-o-t.row.top-c.offsetTop;r.itemTop=m,l.style.top=i.y-o-m+"px",l.style.width=a.width,l.style["box-shadow"]="10px 10px 6px #00000020";const d=c.clientHeight+"px";return l.style.height=d,l.style["line-height"]=d,l.style.opacity="0.6",l.style.transform="scale(1.05, 1.05)",s.get("_internal.elements.chart-timeline").appendChild(l),r.ghost=l,l}(n,i,m.left,m.top)}function resizerMouseDown(e){if(e.stopPropagation(),0!==e.button)return;const t=getMovement(n);t.resizing=!0;const i=s.get(`config.chart.items.${n.item.id}`),o=s.get("_internal.chart.time.leftGlobal"),c=s.get("_internal.chart.time.timePerPixel"),r=s.get("_internal.elements.chart-timeline").getBoundingClientRect();t.ganttTop=r.top,t.ganttLeft=r.left,t.itemX=(i.time.end-o)/c,t.itemLeftCompensation=e.x-t.ganttLeft-t.itemX}function isCollision(t,i,n,c){if(!e.collisionDetection)return!1;const r=s.get("_internal.chart.time");if(e.outOfBorders&&(n<r.from||c>r.to))return!0;let l=o.time.date(c).diff(n,"milliseconds");if(-1===Math.sign(l)&&(l=-l),l<=1)return!0;const a=s.get("config.list.rows."+t);for(const e of a._internal.items)if(e.id!==i){if(n>=e.time.start&&n<=e.time.end)return!0;if(c>=e.time.start&&c<=e.time.end)return!0;if(n<=e.time.start&&c>=e.time.end)return!0}return!1}function documentMouseMove(t){const i=getMovement(n);let o,c,r,l,a;(i.moving||i.resizing)&&(t.stopPropagation(),o=s.get(`config.chart.items.${n.item.id}`),c=s.get(`config.chart.items.${n.item.id}.rowId`),r=s.get(`config.list.rows.${c}`),l=s.get("config.chart.time.zoom"),a=s.get("_internal.chart.time.timePerPixel"));const m=function isMoveable(t){let i=e.moveable;return t.item.hasOwnProperty("moveable")&&i&&(i=t.item.moveable),t.row.hasOwnProperty("moveable")&&i&&(i=t.row.moveable),i}(n);if(i.moving){if((!0===m||"x"===m||Array.isArray(m)&&m.includes(c))&&function movementX(e,t,i,o,c){e.stopPropagation();const r=getMovement(n),l=e.x-r.ganttLeft-r.itemLeftCompensation;moveGhost(n,e);const a=s.get("_internal.chart.time.leftGlobal")+l*c-i.time.start,m=i.time.start,d=getSnapStart(n)(i.time.start,a,i)-m,g=isCollision(t.id,i.id,i.time.start+d,i.time.end+d);d&&!g&&s.update(`config.chart.items.${n.item.id}.time`,(function moveItem(e){return e.start+=d,e.end=getSnapEnd(n)(e.end,d,i)-1,e}))}(t,r,o,0,a),!m||"x"===m)return;let e=function movementY(e,t,i,o,c){e.stopPropagation(),moveGhost(n,e);const r=getMovement(n),l=e.y-r.ganttTop,a=s.get("_internal.list.visibleRows"),m=s.get("config.scroll.compensation");let d=0;for(const e of a){if(e.top+m>l)return d>0?d-1:0;d++}return d}(t);const i=s.get("_internal.list.visibleRows");void 0===i[e]&&(e>0?e=i.length-1:e<0&&(e=0));const l=i[e],d=l.id,g=isCollision(d,o.id,o.time.start,o.time.end);d===o.rowId||g||Array.isArray(m)&&!m.includes(d)||l.hasOwnProperty("moveable")&&!l.moveable||s.update(`config.chart.items.${o.id}.rowId`,d)}else!i.resizing||void 0!==o.resizeable&&!0!==o.resizeable||function resizeX(e,t,i,o,c){if(e.stopPropagation(),!isResizeable(n))return;const r=s.get("_internal.chart.time"),l=getMovement(n),a=e.x-l.ganttLeft-l.itemLeftCompensation,m=r.leftGlobal+a*c-i.time.end;if(i.time.end+m<i.time.start)return;const d=i.time.end,g=getSnapEnd(n)(i.time.end,m,i)-1-d,u=isCollision(t.id,i.id,i.time.start,i.time.end+g);g&&!u&&s.update(`config.chart.items.${n.item.id}.time`,e=>(e.start=getSnapStart(n)(e.start,0,i),e.end=getSnapEnd(n)(e.end,g,i)-1,e))}(t,r,o,0,a)}function documentMouseUp(e){const t=getMovement(n);(t.moving||t.resizing)&&e.stopPropagation(),t.moving=!1,t.resizing=!1;for(const e in i)i[e].moving=!1,i[e].resizing=!1,destroyGhost(e)}return isResizeable(n)?l.style.visibility="visible":l.style.visibility="hidden",c.addEventListener("mousedown",labelMouseDown),l.addEventListener("mousedown",resizerMouseDown,{capture:!0}),document.addEventListener("mousemove",documentMouseMove,{capture:!0,passive:!0}),document.addEventListener("mouseup",documentMouseUp,{capture:!0,passive:!0}),{update(e,t){isResizeable(n)||"visible"!==l.style.visibility?isResizeable(n)&&"hidden"===l.style.visibility&&(l.style.visibility="visible"):l.style.visibility="hidden"},destroy(e,t){c.removeEventListener("mousedown",labelMouseDown),l.removeEventListener("mousedown",resizerMouseDown),document.removeEventListener("mousemove",documentMouseMove),document.removeEventListener("mouseup",documentMouseUp),l.remove()}}}return function initialize(e){e.state.update("config.actions.chart-timeline-items-row-item",e=>(e.push(action),e))}}
/**
 * SaveAsImage plugin
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
 * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar
 */,SaveAsImage:function SaveAsImage(e={}){function saveAsImage(t){const i=t.target,n=i.clientWidth,s=i.clientHeight,o=unescape(encodeURIComponent(i.outerHTML));let c="";for(const e of document.styleSheets)if("gstc"===e.title)for(const t of e.rules)c+=t.cssText;const r=`<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${s}" viewBox="0 0 ${n} ${s}">\n      <foreignObject x="0" y="0" width="${n}" height="${s}">\n        <div xmlns="http://www.w3.org/1999/xhtml">\n          ${c=`<style>* {${e.style}} ${c}</style>`}\n          ${o}\n        </div>\n      </foreignObject>\n    </svg>`,l=document.createElement("canvas");l.width=n,l.height=s;const a=l.getContext("2d");a.fillStyle="white",a.fillRect(0,0,n,s);const m="data:image/svg+xml;base64,"+btoa(r),d=new Image;d.onload=function onLoad(){a.drawImage(d,0,0),function downloadImage(e,t){const i=document.createElement("a");i.href=e,i.download=t,document.body.appendChild(i),i.click()}(l.toDataURL("image/jpeg",1),e.filename)},d.src=m}return e=Object.assign(Object.assign({},{style:"font-family: sans-serif;",filename:"gantt-schedule-timeline-calendar.jpeg"}),{options:e}),function initialize(e){e.state.subscribe("_internal.elements.main",e=>{e&&e.addEventListener("save-as-image",saveAsImage)})}}
/**
 * Selection plugin
 *
 * @copyright Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
 * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar
 */,Selection:function Selection(e={}){let t,i,n,s;const o={grid:!1,items:!0,rows:!1,horizontal:!0,vertical:!0,rectStyle:{},selecting(){},deselecting(){},selected(){},deselected(){},canSelect:(e,t)=>t};let c,r,l;e=Object.assign(Object.assign({},o),e);let a={fromX:-1,fromY:-1,toX:-1,toY:-1,startX:-1,startY:-1,startCell:!1,selecting:!1};const m={"chart-timeline-grid-row":e=>e.row.id,"chart-timeline-grid-row-block":e=>e.id,"chart-timeline-items-row":e=>e.row.id,"chart-timeline-items-row-item":e=>e.item.id},d="config.plugin.selection",g="gantt-schedule-timeline-caledar__plugin-selection-rect",u=document.createElement("div");u.classList.add(g),u.style.visibility="hidden",u.style.left="0px",u.style.top="0px",u.style.width="0px",u.style.height="0px",u.style.background="rgba(0, 119, 192, 0.2)",u.style.border="2px dashed rgba(0, 119, 192, 0.75)",u.style.position="absolute",u.style["user-select"]="none",u.style["pointer-events"]="none";for(const t in e.rectStyle)u.style[t]=e.rectStyle[t];function selectionAction(t,n){let o;if(!(c=i.get("_internal.elements.chart-timeline")).querySelector("."+g)){c.insertAdjacentElement("beforeend",u);const e=c.getBoundingClientRect();l=e.left,r=e.top}function clearSelection(){i.update(d,{selecting:{"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]},selected:{"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]}}),i.update("_internal.chart.grid.rowsWithBlocks",(function clearRowsWithBlocks(e){for(const t of e)for(const e of t.blocks)e.selected=!1,e.selecting=!1;return e}))}function isInside(e,t){let i=!1,n=!1;return(e.left>t.left&&e.left<t.right||e.right>t.left&&e.right<t.right||e.left<=t.left&&e.right>=t.right)&&(i=!0),(e.top>t.top&&e.top<t.bottom||e.bottom>t.top&&e.bottom<t.bottom||e.top<=t.top&&e.bottom>=t.bottom)&&(n=!0),i&&n}function getSelecting(t,n,s,o){const c=[],r=[],l=n[s+"s"],a=i.get(`${d}.selecting.${s}s`);for(const i of l){if(isInside(i.getBoundingClientRect(),t)){r.push(i.vido),e.canSelect(s,r).includes(i.vido)?(a.includes(o(i.vido))||e.selecting(i.vido,s),c.push(o(i.vido))):r.unshift()}else a.includes(o(i.vido))&&e.deselecting(i.vido,s)}return c}function select(e){if(!a.selecting)return;!function saveAndSwapIfNeeded(e){const t=e.x-l,i=e.y-r;t<=a.startX?(a.fromX=t,a.toX=a.startX):(a.fromX=a.startX,a.toX=t),i<=a.startY?(a.fromY=i,a.toY=a.startY):(a.fromY=a.startY,a.toY=i)}(e),u.style.left=a.fromX+"px",u.style.top=a.fromY+"px",u.style.visibility="visible",u.style.width=a.toX-a.fromX+"px",u.style.height=a.toY-a.fromY+"px";const t=u.getBoundingClientRect(),n=i.get("_internal.elements"),s={};for(const e in m)s[e+"s"]=getSelecting(t,n,e,m[e]);i.update(`${d}.selecting`,s),i.update("config.chart.items",(function updateItems(e){const t=s["chart-timeline-items-row-items"];for(const i in e){const n=e[i];t.includes(n.id)?n.selecting=!0:n.selecting=!1}return e})),i.update("_internal.chart.grid.rowsWithBlocks",(function updateRowsWithBlocks(e){const t=s["chart-timeline-grid-row-blocks"],i=s["chart-timeline-grid-rows"];for(const n of e){i.includes(n.id)?n.selecting=!0:n.selecting=!1;for(const e of n.blocks)t.includes(e.id)?e.selecting=!0:e.selecting=!1}return e}))}function mouseDown(e){0===e.button&&(a.selecting=!0,a.fromX=e.x-l,a.fromY=e.y-r,a.startX=a.fromX,a.startY=a.fromY,o=function cloneSelection(e){const t={};return t.selecting=Object.assign({},e.selecting),t.selecting["chart-timeline-grid-rows"]=e.selecting["chart-timeline-grid-rows"].slice(),t.selecting["chart-timeline-grid-row-blocks"]=e.selecting["chart-timeline-grid-row-blocks"].slice(),t.selecting["chart-timeline-items-rows"]=e.selecting["chart-timeline-items-rows"].slice(),t.selecting["chart-timeline-items-row-items"]=e.selecting["chart-timeline-items-row-items"].slice(),t.selected=Object.assign({},e.selected),t.selected["chart-timeline-grid-rows"]=e.selected["chart-timeline-grid-rows"].slice(),t.selected["chart-timeline-grid-row-blocks"]=e.selected["chart-timeline-grid-row-blocks"].slice(),t.selected["chart-timeline-items-rows"]=e.selected["chart-timeline-items-rows"].slice(),t.selected["chart-timeline-items-row-items"]=e.selected["chart-timeline-items-row-items"].slice(),t}(i.get(d)),clearSelection())}function mouseMove(e){select(e)}function mouseUp(t){!function endSelect(t){if(!a.selecting)return void clearSelection();t.stopPropagation(),a.selecting=!1,u.style.visibility="hidden";const n=i.get(d),s={};i.update(d,e=>(s.selected=Object.assign({},e.selecting),s.selecting={"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]},s));const c=i.get("_internal.elements");for(const t in m)for(const i of c[t+"s"])n.selecting[t+"s"].includes(i.vido.id)&&e.deselecting(i.vido,t);i.update("config.chart.items",(function updateItems(e){const t=n.selecting["chart-timeline-items-row-items"];for(const i in e){const n=e[i];t.includes(n.id)?n.selecting=!0:n.selecting=!1}return e})),i.update("_internal.chart.grid.rowsWithBlocks",(function updateRowsWithBlocks(t){for(const i of t)for(const t of i.blocks)n.selecting["chart-timeline-grid-row-blocks"].includes(t.id)?(void 0!==t.selected&&t.selected||e.selected(t,"chart-timeline-grid-row-block"),t.selected=!0):(o.selected["chart-timeline-grid-row-blocks"].includes(t.id)&&e.deselected(t,"chart-timeline-grid-row-block"),t.selected=!1);return t}))}(t)}return t.addEventListener("mousedown",mouseDown),document.addEventListener("mousemove",s(mouseMove)),document.body.addEventListener("mouseup",mouseUp),{update(){},destroy(){document.body.removeEventListener("mouseup",mouseUp),document.removeEventListener("mousemove",mouseMove),t.removeEventListener("mousedown",mouseDown)}}}function updateSelection(e,t,i,n,s){t&&!e.classList.contains(n)?e.classList.add(n):!t&&e.classList.contains(n)&&e.classList.remove(n),i&&!e.classList.contains(s)?e.classList.add(s):!i&&e.classList.contains(s)&&e.classList.remove(s)}class GridBlockAction{constructor(e,t){this.classNameSelecting=n.getClass("chart-timeline-grid-row-block")+"--selecting",this.classNameSelected=n.getClass("chart-timeline-grid-row-block")+"--selected",updateSelection(e,t.selecting,t.selected,this.classNameSelecting,this.classNameSelected)}update(e,t){updateSelection(e,t.selecting,t.selected,this.classNameSelecting,this.classNameSelected)}destroy(e,t){e.classList.remove(this.classNameSelecting),e.classList.remove(this.classNameSelected)}}class ItemAction{constructor(e,t){this.classNameSelecting=n.getClass("chart-timeline-items-row-item")+"--selecting",this.classNameSelected=n.getClass("chart-timeline-items-row-item")+"--selected",updateSelection(e,t.item.selecting,t.item.selected,this.classNameSelecting,this.classNameSelected)}update(e,t){updateSelection(e,t.item.selecting,t.item.selected,this.classNameSelecting,this.classNameSelected)}destroy(e,t){e.classList.remove(this.classNameSelecting),e.classList.remove(this.classNameSelected)}}function onBlockCreate(e){const t=i.get("config.plugin.selection.selected.chart-timeline-grid-row-blocks");for(const i of t)if(i===e.id)return e.selected=!0,e;return e.selected=!1,e}return function initialize(e){i=(t=e).state,n=t.api,s=t.schedule,void 0===i.get(d)&&i.update(d,{selecting:{"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]},selected:{"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]}}),i.update("config.chart.items",e=>{for(const t in e){const i=e[t];void 0===i.selecting&&(i.selecting=!1),void 0===i.selected&&(i.selected=!1)}return e}),i.update("config.actions.chart-timeline",e=>(e.push(selectionAction),e)),i.update("config.actions.chart-timeline-grid-row-block",e=>(e.push(GridBlockAction),e)),i.update("config.actions.chart-timeline-items-row-item",e=>(e.push(ItemAction),e)),i.update("config.chart.grid.block.onCreate",e=>(e.push(onBlockCreate),e))}}};export default e;
//# sourceMappingURL=plugins.min.js.map
