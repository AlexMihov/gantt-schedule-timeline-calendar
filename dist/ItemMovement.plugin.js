!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).ItemMovement=t()}(this,(function(){"use strict";return function(e={}){(e={moveable:!0,resizeable:!0,resizerContent:"",collisionDetection:!0,snapTo:[],...e}).snapTo=e.snapTo.slice();const t={},i={create:function(i,n){const o=i.querySelector(".gantt-shedule-timeline-calendar__chart-gantt-items-row-item-content");if(!e.moveable&&!e.resizeable)return;let r=e.moveable;n.item.hasOwnProperty("moveable")&&r&&(r=n.item.moveable),n.row.hasOwnProperty("moveable")&&r&&(r=n.row.moveable);let a=e.resizeable&&(!n.item.hasOwnProperty("resizeable")||!0===n.item.resizeable);n.row.hasOwnProperty("resizeable")&&a&&(a=n.row.resizeable);const s=n.api;if(a){const t=`<div class="${s.getClass("chart-gantt-items-row-item-content-resizer")}">${e.resizerContent}</div>`;o.insertAdjacentHTML("beforeend",t)}const m=o,c=(m.querySelector(".gantt-shedule-timeline-calendar__chart-gantt-items-row-item-content-label"),m.querySelector(".gantt-shedule-timeline-calendar__chart-gantt-items-row-item-content-resizer")),l=n.state;void 0===t[n.item.id]&&(t[n.item.id]={moving:!1,resizing:!1});const d=t[n.item.id];function f(e){d.moving=!0;const t=l.get(`config.chart.items.${n.item.id}`),i=l.get("_internal.chart.time.leftGlobal"),o=l.get("_internal.chart.time.timePerPixel"),r=l.get("_internal.elements.gantt").getBoundingClientRect();d.ganttTop=r.top,d.ganttLeft=r.left,d.itemX=Math.round((t.time.start-i)/o),d.itemLeftCompensation=e.x-d.ganttLeft-d.itemX}function u(e){e.stopPropagation(),d.resizing=!0;const t=l.get(`config.chart.items.${n.item.id}`),i=l.get("_internal.chart.time.leftGlobal"),o=l.get("_internal.chart.time.timePerPixel"),r=l.get("_internal.elements.gantt").getBoundingClientRect();d.ganttTop=r.top,d.ganttLeft=r.left,d.itemX=(t.time.end-i)/o,d.itemLeftCompensation=e.x-d.ganttLeft-d.itemX}function g(t,i,n,o){if(!e.collisionDetection)return!1;const r=l.get("_internal.chart.time");if(n<r.from||o>r.to)return!0;if(s.time.date(o).diff(n,r.period)<=0)return!0;const a=l.get("config.list.rows."+t);for(const e of a._internal.items)if(e.id!==i){if(n>=e.time.start&&n<=e.time.end)return!0;if(o>=e.time.start&&o<=e.time.end)return!0;if(n<=e.time.start&&o>=e.time.end)return!0}return!1}function p(t,i,n=0){let o=Number.MAX_SAFE_INTEGER,r=0;for(let n of e.snapTo){let e=i.clone().add(t,"milliseconds").diff(n,"milliseconds");-1===Math.sign(e)&&(e=-e),e<o&&(o=e,r=n)}return r+=n,s.time.date(r)}function v(e){let t,i,o,a,s;if((d.moving||d.resizing)&&(t=l.get(`config.chart.items.${n.item.id}`),i=l.get(`config.chart.items.${n.item.id}.rowId`),o=l.get(`config.list.rows.${i}`),a=l.get("config.chart.time.zoom"),s=l.get("_internal.chart.time.timePerPixel")),d.moving){if((!0===r||"x"===r||Array.isArray(r)&&r.includes(i))&&function(e,t,i,o,r){const a=e.x-d.ganttLeft-d.itemLeftCompensation,s=l.get("_internal.chart.time.leftGlobal")+a*r-i.time.start,m=i.time.start,c=p(s,n.api.time.date(i.time.start))-m,f=g(t.id,i.id,i.time.start+c,i.time.end+c);c&&!f&&l.update(`config.chart.items.${n.item.id}.time`,(function(e){return e.start+=c,e.end+=c,e}))}(e,o,t,0,s),!r||"x"===r)return;let a=function(e,t,i,n,o){const r=e.y-d.ganttTop,a=l.get("_internal.list.visibleRows");let s=0;for(const e of a){if(e.top>r)return s>0?s-1:0;s++}return s}(e);const m=l.get("_internal.list.visibleRows");void 0===m[a]&&(a>0?a=m.length-1:a<0&&(a=0));const c=m[a],f=c.id,u=g(f,t.id,t.time.start,t.time.end);f===t.rowId||u||Array.isArray(r)&&!r.includes(f)||c.hasOwnProperty("moveable")&&!c.moveable||l.update(`config.chart.items.${t.id}.rowId`,f)}else!d.resizing||void 0!==t.resizeable&&!0!==t.resizeable||function(e,t,i,o,r){const a=l.get("_internal.chart.time"),s=e.x-d.ganttLeft-d.itemLeftCompensation,m=a.leftGlobal+s*r-i.time.end;if(i.time.end+m<i.time.start)return;const c=i.time.end,f=p(m,n.api.time.date(i.time.end),-1)-c,u=g(t.id,i.id,i.time.start,i.time.end+f);f&&!u&&l.update(`config.chart.items.${n.item.id}.time.end`,(function(e){return e+f}))}(e,o,t,0,s)}function h(e){d.moving=!1,d.resizing=!1}return r&&m.addEventListener("mousedown",f),a&&c.addEventListener("mousedown",u),document.addEventListener("mousemove",v),document.addEventListener("mouseup",h),{update(e){},destroy(){r&&m.removeEventListener("moudedown",f),a&&c.removeEventListener("mousedown",u),document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",h)}}}};return function(e,t){state.update("config.actions.chart-gantt-items-row-item",e=>(e.some(e=>e===i)||e.push(i),e))}}}));
//# sourceMappingURL=ItemMovement.plugin.js.map
