!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).ItemMovement=e()}(this,(function(){"use strict";
/**
   * Gantt-Schedule-Timeline-Calendar
   *
   * @copyright Rafal Pospiech <https://neuronet.io>
   * @author    Rafal Pospiech <neuronet.io@gmail.com>
   * @package   gantt-schedule-timeline-calendar
   * @license   GPL-3.0
   */return function(t={}){(t={moveable:!0,resizeable:!0,resizerContent:"",collisionDetection:!0,outOfBorders:!1,snapStart:[],snapEnd:[],ghostNode:!0,...t}).snapStart=t.snapStart.slice(),t.snapEnd=t.snapEnd.slice();const e={};function i(i,n){const o=i.querySelector(".gantt-schedule-timeline-calendar__chart-gantt-items-row-item-content");if(!t.moveable&&!t.resizeable)return;let r=t.moveable;n.item.hasOwnProperty("moveable")&&r&&(r=n.item.moveable),n.row.hasOwnProperty("moveable")&&r&&(r=n.row.moveable);let s=t.resizeable&&(!n.item.hasOwnProperty("resizeable")||!0===n.item.resizeable);n.row.hasOwnProperty("resizeable")&&s&&(s=n.row.resizeable);const a=n.api;let m=t.snapStart;void 0!==n.item.snapStart&&Array.isArray(n.item.snapStart)&&(m=item.snapStart);let l=t.snapEnd;if(void 0!==n.item.snapEnd&&Array.isArray(n.item.snapEnd)&&(l=n.item.snapEnd),s){const e=`<div class="${a.getClass("chart-gantt-items-row-item-content-resizer")}">${t.resizerContent}</div>`;o.insertAdjacentHTML("beforeend",e)}const d=o,c=d.querySelector(".gantt-schedule-timeline-calendar__chart-gantt-items-row-item-content-resizer"),f=n.state;void 0===e[n.item.id]&&(e[n.item.id]={moving:!1,resizing:!1});const g=e[n.item.id];function u(e){if(t.ghostNode){const t=e.x-g.ganttLeft-g.itemLeftCompensation;g.ghost.style.left=t+"px",g.ghost.style.top=e.y-g.ganttTop-g.itemTop+"px"}}function p(i){t.ghostNode&&(void 0!==e[i]&&void 0!==e[i].ghost&&(f.get("_internal.elements.gantt").removeChild(e[i].ghost),delete e[i].ghost),o.style.opacity="1")}function h(i){if(0!==i.button)return;g.moving=!0;const r=f.get(`config.chart.items.${n.item.id}`),s=f.get("_internal.chart.time.leftGlobal"),a=f.get("_internal.chart.time.timePerPixel"),m=f.get("_internal.elements.gantt").getBoundingClientRect();g.ganttTop=m.top,g.ganttLeft=m.left,g.itemX=Math.round((r.time.start-s)/a),g.itemLeftCompensation=i.x-g.ganttLeft-g.itemX,function(i,r,s,a){if(!t.ghostNode||void 0!==e[i].ghost)return;const m=o.cloneNode(!0),l=getComputedStyle(o);m.style.position="absolute",m.style.left=r.x-s-g.itemLeftCompensation+"px";const d=r.y-a-n.row.top-o.offsetTop;g.itemTop=d,m.style.top=r.y-a-d+"px",m.style.width=l.width,m.style["box-shadow"]="10px 10px 6px #00000020";const c=o.clientHeight+"px";m.style.height=c,m.style["line-height"]=c,m.style.opacity="0.75",f.get("_internal.elements.gantt").appendChild(m),e[i].ghost=m}(n.item.id,i,m.left,m.top)}function v(t){if(0!==t.button)return;t.stopPropagation(),g.resizing=!0;const e=f.get(`config.chart.items.${n.item.id}`),i=f.get("_internal.chart.time.leftGlobal"),o=f.get("_internal.chart.time.timePerPixel"),r=f.get("_internal.elements.gantt").getBoundingClientRect();g.ganttTop=r.top,g.ganttLeft=r.left,g.itemX=(e.time.end-i)/o,g.itemLeftCompensation=t.x-g.ganttLeft-g.itemX}function y(e,i,n,o){if(!t.collisionDetection)return!1;const r=f.get("_internal.chart.time");if(t.outOfBorders&&(n<r.from||o>r.to))return!0;let s=a.time.date(o).diff(n,"milliseconds");if(-1===Math.sign(s)&&(s=-s),s<=1)return!0;const m=f.get("config.list.rows."+e);for(const t of m._internal.items)if(t.id!==i){if(n>=t.time.start&&n<=t.time.end)return!0;if(o>=t.time.start&&o<=t.time.end)return!0;if(n<=t.time.start&&o>=t.time.end)return!0}return!1}function b(t,e,i=0,n=[]){let o=Number.MAX_SAFE_INTEGER,r=0;for(let i of n){let n=e.clone().add(t,"milliseconds").diff(i,"milliseconds");-1===Math.sign(n)&&(n=-n),n<o&&(o=n,r=i)}return r+=i,a.time.date(r)}function w(t){let e,i,o,s,a;if((g.moving||g.resizing)&&(e=f.get(`config.chart.items.${n.item.id}`),i=f.get(`config.chart.items.${n.item.id}.rowId`),o=f.get(`config.list.rows.${i}`),s=f.get("config.chart.time.zoom"),a=f.get("_internal.chart.time.timePerPixel")),g.moving){if((!0===r||"x"===r||Array.isArray(r)&&r.includes(i))&&function(t,e,i,o,r){const s=t.x-g.ganttLeft-g.itemLeftCompensation;u(t);const a=f.get("_internal.chart.time.leftGlobal")+s*r-i.time.start,l=i.time.start,d=b(a,n.api.time.date(i.time.start),0,m)-l,c=y(e.id,i.id,i.time.start+d,i.time.end+d);d&&!c&&f.update(`config.chart.items.${n.item.id}.time`,(function(t){return t.start+=d,t.end+=d,t}))}(t,o,e,0,a),!r||"x"===r)return;let s=function(t,e,i,n,o){u(t);const r=t.y-g.ganttTop,s=f.get("_internal.list.visibleRows");let a=0;for(const t of s){if(t.top>r)return a>0?a-1:0;a++}return a}(t);const l=f.get("_internal.list.visibleRows");void 0===l[s]&&(s>0?s=l.length-1:s<0&&(s=0));const d=l[s],c=d.id,p=y(c,e.id,e.time.start,e.time.end);c===e.rowId||p||Array.isArray(r)&&!r.includes(c)||d.hasOwnProperty("moveable")&&!d.moveable||f.update(`config.chart.items.${e.id}.rowId`,c)}else!g.resizing||void 0!==e.resizeable&&!0!==e.resizeable||function(t,e,i,o,r){const s=f.get("_internal.chart.time"),a=t.x-g.ganttLeft-g.itemLeftCompensation,m=s.leftGlobal+a*r-i.time.end;if(i.time.end+m<i.time.start)return;const d=i.time.end,c=b(m,n.api.time.date(i.time.end),-1,l)-d,u=y(e.id,i.id,i.time.start,i.time.end+c);c&&!u&&f.update(`config.chart.items.${n.item.id}.time.end`,(function(t){return t+c}))}(t,o,e,0,a)}function x(t){g.moving=!1,g.resizing=!1;for(const t in e)e[t].moving=!1,e[t].resizing=!1,p(t)}return r&&d.addEventListener("mousedown",h),s&&c.addEventListener("mousedown",v),document.addEventListener("mousemove",w),document.addEventListener("mouseup",x),{destroy(t,e){r&&d.removeEventListener("moudedown",h),s&&c.removeEventListener("mousedown",v),document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",x),s&&o.removeChild(c)}}}return function(t,e){t.update("config.actions.chart-gantt-items-row-item",t=>(t.push(i),t))}}}));
//# sourceMappingURL=ItemMovement.plugin.js.map
