!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).ItemMovement=e()}(this,(function(){"use strict";
/**
   * ItemMovement plugin
   *
   * @copyright Rafal Pospiech <https://neuronet.io>
   * @author    Rafal Pospiech <neuronet.io@gmail.com>
   * @package   gantt-schedule-timeline-calendar
   * @license   GPL-3.0
   */return function(t={}){t={moveable:!0,resizeable:!0,resizerContent:"",collisionDetection:!0,outOfBorders:!1,snapStart:(t,e)=>t+e,snapEnd:(t,e)=>t+e,ghostNode:!0,...t};const e={};function n(n,i){let o,r,s=n.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content");if(!t.moveable&&!t.resizeable)return;function a(e){let n=t.resizeable&&(!e.item.hasOwnProperty("resizeable")||!0===e.item.resizeable);return e.row.hasOwnProperty("resizeable")&&n&&(n=e.row.resizeable),n}function m(t){const n=t.item.id;return void 0===e[n]&&(e[n]={moving:!1,resizing:!1}),e[n]}function l(e,n){if(t.ghostNode){const t=m(e),i=n.x-t.ganttLeft-t.itemLeftCompensation;t.ghost.style.left=i+"px",t.ghost.style.top=n.y-t.ganttTop-t.itemTop+"px"}}function c(n){t.ghostNode&&(void 0!==e[n]&&void 0!==e[n].ghost&&(o.get("_internal.elements.gantt").removeChild(e[n].ghost),delete e[n].ghost),s.style.opacity="1")}function d(e){let n=t.snapStart;return"function"==typeof e.item.snapStart&&(n=e.item.snapStart),n}function f(e){let n=t.snapEnd;return"function"==typeof e.item.snapEnd&&(n=e.item.snapEnd),n}o=i.state;const u=`<div class="${(r=i.api).getClass("chart-timeline-items-row-item-content-resizer")}">${t.resizerContent}</div>`;s.insertAdjacentHTML("beforeend",u);const g=s.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content-resizer");function p(e){if(0!==e.button)return;s=n.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content");const r=m(i);r.moving=!0;const a=o.get(`config.chart.items.${i.item.id}`),l=o.get("_internal.chart.time.leftGlobal"),c=o.get("_internal.chart.time.timePerPixel"),d=o.get("_internal.elements.gantt").getBoundingClientRect();r.ganttTop=d.top,r.ganttLeft=d.left,r.itemX=Math.round((a.time.start-l)/c),r.itemLeftCompensation=e.x-r.ganttLeft-r.itemX,function(e,n,i,r){const a=m(e);if(!t.ghostNode||void 0!==a.ghost)return;const l=s.cloneNode(!0),c=getComputedStyle(s);l.style.position="absolute",l.style.left=n.x-i-a.itemLeftCompensation+"px";const d=n.y-r-e.row.top-s.offsetTop;a.itemTop=d,l.style.top=n.y-r-d+"px",l.style.width=c.width,l.style["box-shadow"]="10px 10px 6px #00000020";const f=s.clientHeight+"px";l.style.height=f,l.style["line-height"]=f,l.style.opacity="0.75",o.get("_internal.elements.gantt").appendChild(l),a.ghost=l}(i,e,d.left,d.top)}function h(t){if(0!==t.button)return;t.stopPropagation();const e=m(i);e.resizing=!0;const n=o.get(`config.chart.items.${i.item.id}`),r=o.get("_internal.chart.time.leftGlobal"),s=o.get("_internal.chart.time.timePerPixel"),a=o.get("_internal.elements.gantt").getBoundingClientRect();e.ganttTop=a.top,e.ganttLeft=a.left,e.itemX=(n.time.end-r)/s,e.itemLeftCompensation=t.x-e.ganttLeft-e.itemX}function v(e,n,i,s){if(!t.collisionDetection)return!1;const a=o.get("_internal.chart.time");if(t.outOfBorders&&(i<a.from||s>a.to))return!0;let m=r.time.date(s).diff(i,"milliseconds");if(-1===Math.sign(m)&&(m=-m),m<=1)return!0;const l=o.get("config.list.rows."+e);for(const t of l._internal.items)if(t.id!==n){if(i>=t.time.start&&i<=t.time.end)return!0;if(s>=t.time.start&&s<=t.time.end)return!0;if(i<=t.time.start&&s>=t.time.end)return!0}return!1}function y(e){const n=m(i);let r,s,c,u,g;(n.moving||n.resizing)&&(r=o.get(`config.chart.items.${i.item.id}`),s=o.get(`config.chart.items.${i.item.id}.rowId`),c=o.get(`config.list.rows.${s}`),u=o.get("config.chart.time.zoom"),g=o.get("_internal.chart.time.timePerPixel"));const p=function(e){let n=t.moveable;return e.item.hasOwnProperty("moveable")&&n&&(n=e.item.moveable),e.row.hasOwnProperty("moveable")&&n&&(n=e.row.moveable),n}(i);if(n.moving){if((!0===p||"x"===p||Array.isArray(p)&&p.includes(s))&&function(t,e,n,r,s){const a=m(i),c=t.x-a.ganttLeft-a.itemLeftCompensation;l(i,t);const u=o.get("_internal.chart.time.leftGlobal")+c*s-n.time.start,g=n.time.start,p=d(i)(n.time.start,u,n)-g,h=v(e.id,n.id,n.time.start+p,n.time.end+p);p&&!h&&o.update(`config.chart.items.${i.item.id}.time`,(function(t){return t.start+=p,t.end=f(i)(t.end,p,n)-1,t}))}(e,c,r,0,g),!p||"x"===p)return;let t=function(t,e,n,r,s){l(i,t);const a=m(i),c=t.y-a.ganttTop,d=o.get("_internal.list.visibleRows");let f=0;for(const t of d){if(t.top>c)return f>0?f-1:0;f++}return f}(e);const n=o.get("_internal.list.visibleRows");void 0===n[t]&&(t>0?t=n.length-1:t<0&&(t=0));const a=n[t],u=a.id,h=v(u,r.id,r.time.start,r.time.end);u===r.rowId||h||Array.isArray(p)&&!p.includes(u)||a.hasOwnProperty("moveable")&&!a.moveable||o.update(`config.chart.items.${r.id}.rowId`,u)}else!n.resizing||void 0!==r.resizeable&&!0!==r.resizeable||function(t,e,n,r,s){if(!a(i))return;const l=o.get("_internal.chart.time"),c=m(i),u=t.x-c.ganttLeft-c.itemLeftCompensation,g=l.leftGlobal+u*s-n.time.end;if(n.time.end+g<n.time.start)return;const p=n.time.end,h=f(i)(n.time.end,g,n)-1-p,y=v(e.id,n.id,n.time.start,n.time.end+h);h&&!y&&o.update(`config.chart.items.${i.item.id}.time`,t=>(t.start=d(i)(t.start,0,n),t.end=f(i)(t.end,h,n)-1,t))}(e,c,r,0,g)}function b(t){const n=m(i);n.moving=!1,n.resizing=!1;for(const t in e)e[t].moving=!1,e[t].resizing=!1,c(t)}return a(i)||(g.style.display="none"),s.addEventListener("mousedown",p),g.addEventListener("mousedown",h),document.addEventListener("mousemove",y),document.addEventListener("mouseup",b),{update(t,e){i=e},destroy(t,e){s.removeEventListener("mousedown",p),g.removeEventListener("mousedown",h),document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",b),g.remove()}}}return function(t,e){t.update("config.actions.chart-timeline-items-row-item",t=>(t.push(n),t))}}}));
//# sourceMappingURL=ItemMovement.plugin.js.map
