{"version":3,"file":"CalendarScroll.plugin.js","sources":["../src/plugins/CalendarScroll.plugin.ts"],"sourcesContent":["/**\n * CalendarScroll plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   AGPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport interface Options {\n  enabled: boolean;\n}\n\nconst defaultOptions = {\n  enabled: true\n};\n\nexport default function CalendarScroll(options = defaultOptions) {\n  let vido, api, state;\n  let enabled = options.enabled;\n\n  class ChartAction {\n    private moving = false;\n    private initialPoint: Point;\n    private initialDataIndex: Point = { x: 0, y: 0 };\n\n    constructor(element: HTMLElement) {\n      this.pointerDown = this.pointerDown.bind(this);\n      this.pointerUp = this.pointerUp.bind(this);\n      this.pointerMove = vido.schedule(this.pointerMove.bind(this));\n      element.addEventListener('pointerdown', this.pointerDown);\n      document.addEventListener('pointermove', this.pointerMove, { passive: true });\n      document.addEventListener('pointerup', this.pointerUp);\n      element.style.cursor = 'grab';\n    }\n\n    public destroy(element: HTMLElement) {\n      element.removeEventListener('pointerdown', this.pointerDown);\n      document.removeEventListener('pointermove', this.pointerMove);\n      document.removeEventListener('pointerup', this.pointerUp);\n    }\n\n    private pointerDown(ev: PointerEvent) {\n      if (!enabled) return;\n      this.moving = true;\n      this.initialPoint = { x: ev.screenX, y: ev.screenY };\n      const scroll = state.get('config.scroll');\n      this.initialDataIndex = { x: scroll.horizontal.dataIndex || 0, y: scroll.vertical.dataIndex || 0 };\n    }\n\n    private pointerUp(ev: PointerEvent) {\n      if (!enabled) return;\n      if (this.moving) {\n        this.moving = false;\n      }\n    }\n\n    private handleHorizontalMovement(diff: Point, ev: PointerEvent) {\n      const time = state.get('_internal.chart.time');\n      if (diff.x > 0) {\n        // go backward - move dates forward\n        if (this.initialDataIndex.x === 0) return;\n        const allDates = time.allDates[time.level];\n        let i = this.initialDataIndex.x - 1;\n        let width = 0;\n        for (; i > 0; i--) {\n          const date = allDates[i];\n          width += date.width;\n          if (width >= diff.x) break;\n        }\n        api.scrollToTime(allDates[i].leftGlobal, false);\n      } else if (diff.x < 0) {\n        // go forward - move dates backward\n        const allDates = time.allDates[time.level];\n        let i = this.initialDataIndex.x;\n        let width = 0;\n        for (let len = allDates.length; i < len; i++) {\n          const date = allDates[i];\n          width += date.width;\n          if (-width <= diff.x) break;\n        }\n        api.scrollToTime(allDates[i].leftGlobal, false);\n      }\n    }\n\n    private pointerMove(ev: PointerEvent) {\n      if (!enabled || !this.moving) return;\n      const diffX = ev.screenX - this.initialPoint.x;\n      const diffY = ev.screenY - this.initialPoint.y;\n      const diff: Point = { x: diffX, y: diffY };\n      this.handleHorizontalMovement(diff, ev);\n    }\n  }\n\n  return function initialize(vidoInstance) {\n    vido = vidoInstance;\n    api = vido.api;\n    state = vido.state;\n    state.update('config.plugin.CalendarScroll', options);\n    state.subscribe('config.plugin.CalendarScroll.enabled', value => (enabled = value));\n    state.update('config.actions.chart-calendar', chartActions => {\n      chartActions.push(ChartAction);\n      return chartActions;\n    });\n  };\n}\n"],"names":[],"mappings":"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"}