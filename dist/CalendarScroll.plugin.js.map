{"version":3,"file":"CalendarScroll.plugin.js","sources":["../src/plugins/CalendarScroll.plugin.ts"],"sourcesContent":["/**\n * CalendarScroll plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nexport default function CalendarScroll(options = {}) {\n  let state, api, schedule;\n  const defaultOptions = {\n    speed: 1,\n    hideScroll: false,\n    onChange(time) {}\n  };\n  options = { ...defaultOptions, ...options };\n\n  class CalendarScrollAction {\n    isMoving: boolean = false;\n    lastX: number = 0;\n    mc: any;\n\n    constructor(element: HTMLElement) {\n      this.onPointerStart = this.onPointerStart.bind(this);\n      this.onPointerMove = this.onPointerMove.bind(this);\n      this.onPointerEnd = this.onPointerEnd.bind(this);\n      element.addEventListener('touchstart', this.onPointerStart);\n      document.addEventListener('touchmove', this.onPointerMove);\n      document.addEventListener('touchend', this.onPointerEnd);\n      element.addEventListener('mousedown', this.onPointerStart);\n      document.addEventListener('mousemove', this.onPointerMove);\n      document.addEventListener('mouseup', this.onPointerEnd);\n      element.style.cursor = 'move';\n      const horizontalScroll = state.get('_internal.elements.horizontal-scroll');\n      // @ts-ignore\n      if (options.hideScroll && horizontalScroll) {\n        horizontalScroll.style.visibility = 'hidden';\n      }\n    }\n\n    onPointerStart(ev) {\n      if (ev.type === 'mousedown' && ev.button !== 0) return;\n      ev.stopPropagation();\n      this.isMoving = true;\n      const normalized = api.normalizePointerEvent(ev);\n      this.lastX = normalized.x;\n    }\n\n    onPointerMove(ev) {\n      schedule(() => {\n        if (!this.isMoving) return;\n        const normalized = api.normalizePointerEvent(ev);\n        const movedX = normalized.x - this.lastX;\n        const time = state.get('_internal.chart.time');\n        // @ts-ignore\n        const movedTime = -Math.round(movedX * time.timePerPixel * options.speed);\n        state.update('config.chart.time', configTime => {\n          if (configTime.from === 0) configTime.from = time.from;\n          if (configTime.to === 0) configTime.to = time.to;\n          configTime.from += movedTime;\n          configTime.to += movedTime;\n          // @ts-ignore\n          options.onChange(configTime);\n          return configTime;\n        });\n        this.lastX = normalized.x;\n      })();\n    }\n\n    onPointerEnd(ev) {\n      this.isMoving = false;\n      this.lastX = 0;\n    }\n\n    destroy(element: HTMLElement, data: any) {\n      element.removeEventListener('touchstart', this.onPointerStart);\n      document.removeEventListener('touchmove', this.onPointerMove);\n      document.removeEventListener('touchend', this.onPointerEnd);\n      element.removeEventListener('mousedown', this.onPointerStart);\n      document.removeEventListener('mousemove', this.onPointerMove);\n      document.removeEventListener('mouseup', this.onPointerEnd);\n    }\n  }\n\n  return function initialize(vido) {\n    api = vido.api;\n    state = vido.state;\n    schedule = vido.schedule;\n    state.update('config.actions.chart-calendar', actions => {\n      actions.push(CalendarScrollAction);\n      return actions;\n    });\n  };\n}\n"],"names":[],"mappings":"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"}