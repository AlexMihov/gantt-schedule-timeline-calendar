{"version":3,"file":"plugins.js","sources":["../src/plugins/ItemHold.plugin.js","../src/plugins/ItemMovement.plugin.js","../src/plugins/SaveAsImage.plugin.js","../node_modules/raf-schd/dist/raf-schd.esm.js","../src/plugins/Selection.plugin.js"],"sourcesContent":["/**\n * ItemHold plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nexport default function ItemHold(options = {}) {\n  const defaultOptions = {\n    time: 1000,\n    movementThreshold: 2,\n    action(element, data) {}\n  };\n  options = { ...defaultOptions, ...options };\n\n  const holding = {};\n  const mouse = { x: 0, y: 0 };\n\n  function onMouseDown(item, element, event) {\n    if (typeof holding[item.id] === 'undefined') {\n      holding[item.id] = { x: event.x, y: event.y };\n      setTimeout(() => {\n        if (typeof holding[item.id] !== 'undefined') {\n          let exec = true;\n          let xMovement = holding[item.id].x - mouse.x;\n          if (Math.sign(xMovement) === -1) {\n            xMovement = -xMovement;\n          }\n          let yMovement = holding[item.id].y - mouse.y;\n          if (Math.sign(yMovement) === -1) {\n            yMovement = -yMovement;\n          }\n          if (xMovement > options.movementThreshold) {\n            exec = false;\n          }\n          if (yMovement > options.movementThreshold) {\n            exec = false;\n          }\n          delete holding[item.id];\n          if (exec) {\n            options.action(element, item);\n          }\n        }\n      }, options.time);\n    }\n  }\n\n  function onMouseUp(itemId) {\n    if (typeof holding[itemId] !== 'undefined') {\n      delete holding[itemId];\n    }\n  }\n\n  function action(element, data) {\n    function elementMouseDown(event) {\n      onMouseDown(data.item, element, event);\n    }\n    element.addEventListener('mousedown', elementMouseDown);\n    function mouseUp() {\n      onMouseUp(data.item.id);\n    }\n\n    document.addEventListener('mouseup', mouseUp);\n    function onMouseMove(event) {\n      mouse.x = event.x;\n      mouse.y = event.y;\n    }\n\n    document.addEventListener('mousemove', onMouseMove);\n    return {\n      update(element, changedData) {\n        data = changedData;\n      },\n      destroy(element, data) {\n        document.removeEventListener('mouseup', onMouseUp);\n        document.removeEventListener('mousemove', onMouseMove);\n        element.removeEventListener('mousedown', elementMouseDown);\n      }\n    };\n  }\n\n  return function initialize(vido) {\n    vido.state.update('config.actions.chart-timeline-items-row-item', actions => {\n      actions.push(action);\n      return actions;\n    });\n  };\n}\n","/**\n * ItemMovement plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nexport default function ItemMovement(options = {}) {\n  const defaultOptions = {\n    moveable: true,\n    resizeable: true,\n    resizerContent: '',\n    collisionDetection: true,\n    outOfBorders: false,\n    snapStart: (timeStart, startDiff) => timeStart + startDiff,\n    snapEnd: (timeEnd, endDiff) => timeEnd + endDiff,\n    ghostNode: true\n  };\n  options = { ...defaultOptions, ...options };\n\n  const movementState = {};\n\n  /**\n   * Add moving functionality to items as action\n   *\n   * @param {Node} node DOM Node\n   * @param {Object} data\n   */\n  function action(node, data) {\n    // @ts-ignore\n    let element = node.querySelector('.gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content');\n    if (!options.moveable && !options.resizeable) {\n      return;\n    }\n    let state;\n    let api;\n\n    function isMoveable(data) {\n      let moveable = options.moveable;\n      if (data.item.hasOwnProperty('moveable') && moveable) {\n        moveable = data.item.moveable;\n      }\n      if (data.row.hasOwnProperty('moveable') && moveable) {\n        moveable = data.row.moveable;\n      }\n      return moveable;\n    }\n\n    function isResizeable(data) {\n      let resizeable = options.resizeable && (!data.item.hasOwnProperty('resizeable') || data.item.resizeable === true);\n      if (data.row.hasOwnProperty('resizeable') && resizeable) {\n        resizeable = data.row.resizeable;\n      }\n      return resizeable;\n    }\n\n    function getMovement(data) {\n      const itemId = data.item.id;\n      if (typeof movementState[itemId] === 'undefined') {\n        movementState[itemId] = { moving: false, resizing: false };\n      }\n      return movementState[itemId];\n    }\n\n    function createGhost(data, ev, ganttLeft, ganttTop) {\n      const movement = getMovement(data);\n      if (!options.ghostNode || typeof movement.ghost !== 'undefined') {\n        return;\n      }\n      const ghost = element.cloneNode(true);\n      const style = getComputedStyle(element);\n      ghost.style.position = 'absolute';\n      ghost.style.left = ev.x - ganttLeft - movement.itemLeftCompensation + 'px';\n      const itemTop = ev.y - ganttTop - data.row.top - element.offsetTop;\n      movement.itemTop = itemTop;\n      ghost.style.top = ev.y - ganttTop - itemTop + 'px';\n      ghost.style.width = style.width;\n      ghost.style['box-shadow'] = '10px 10px 6px #00000020';\n      const height = element.clientHeight + 'px';\n      ghost.style.height = height;\n      ghost.style['line-height'] = height;\n      ghost.style.opacity = '0.75';\n      state.get('_internal.elements.chart-timeline').appendChild(ghost);\n      movement.ghost = ghost;\n      return ghost;\n    }\n\n    function moveGhost(data, ev) {\n      if (options.ghostNode) {\n        const movement = getMovement(data);\n        const left = ev.x - movement.ganttLeft - movement.itemLeftCompensation;\n        const compensation = state.get('config.scroll.compensation');\n        movement.ghost.style.left = left + 'px';\n        movement.ghost.style.top = ev.y - movement.ganttTop - movement.itemTop + compensation + 'px';\n      }\n    }\n\n    function destroyGhost(itemId) {\n      if (!options.ghostNode) {\n        return;\n      }\n      if (typeof movementState[itemId] !== 'undefined' && typeof movementState[itemId].ghost !== 'undefined') {\n        state.get('_internal.elements.chart-timeline').removeChild(movementState[itemId].ghost);\n        delete movementState[itemId].ghost;\n      }\n      element.style.opacity = '1';\n    }\n\n    function getSnapStart(data) {\n      let snapStart = options.snapStart;\n      if (typeof data.item.snapStart === 'function') {\n        snapStart = data.item.snapStart;\n      }\n      return snapStart;\n    }\n\n    function getSnapEnd(data) {\n      let snapEnd = options.snapEnd;\n      if (typeof data.item.snapEnd === 'function') {\n        snapEnd = data.item.snapEnd;\n      }\n      return snapEnd;\n    }\n\n    state = data.state;\n    api = data.api;\n\n    const resizerHTML = `<div class=\"${api.getClass('chart-timeline-items-row-item-content-resizer')}\">${\n      options.resizerContent\n    }</div>`;\n    // @ts-ignore\n    element.insertAdjacentHTML('beforeend', resizerHTML);\n    const resizerEl = element.querySelector(\n      '.gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content-resizer'\n    );\n    if (!isResizeable(data)) {\n      resizerEl.style.visibility = 'hidden';\n    } else {\n      resizerEl.style.visibility = 'visible';\n    }\n\n    function labelMouseDown(ev) {\n      ev.stopPropagation();\n      if (ev.button !== 0) {\n        return;\n      }\n      // @ts-ignore\n      element = node.querySelector('.gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content');\n      const movement = getMovement(data);\n      movement.moving = true;\n      const item = state.get(`config.chart.items.${data.item.id}`);\n      const chartLeftTime = state.get('_internal.chart.time.leftGlobal');\n      const timePerPixel = state.get('_internal.chart.time.timePerPixel');\n      const ganttRect = state.get('_internal.elements.chart-timeline').getBoundingClientRect();\n      movement.ganttTop = ganttRect.top;\n      movement.ganttLeft = ganttRect.left;\n      movement.itemX = Math.round((item.time.start - chartLeftTime) / timePerPixel);\n      movement.itemLeftCompensation = ev.x - movement.ganttLeft - movement.itemX;\n      createGhost(data, ev, ganttRect.left, ganttRect.top);\n    }\n\n    function resizerMouseDown(ev) {\n      ev.stopPropagation();\n      if (ev.button !== 0) {\n        return;\n      }\n      const movement = getMovement(data);\n      movement.resizing = true;\n      const item = state.get(`config.chart.items.${data.item.id}`);\n      const chartLeftTime = state.get('_internal.chart.time.leftGlobal');\n      const timePerPixel = state.get('_internal.chart.time.timePerPixel');\n      const ganttRect = state.get('_internal.elements.chart-timeline').getBoundingClientRect();\n      movement.ganttTop = ganttRect.top;\n      movement.ganttLeft = ganttRect.left;\n      movement.itemX = (item.time.end - chartLeftTime) / timePerPixel;\n      movement.itemLeftCompensation = ev.x - movement.ganttLeft - movement.itemX;\n    }\n\n    function isCollision(rowId, itemId, start, end) {\n      if (!options.collisionDetection) {\n        return false;\n      }\n      const time = state.get('_internal.chart.time');\n      if (options.outOfBorders && (start < time.from || end > time.to)) {\n        return true;\n      }\n      let diff = api.time.date(end).diff(start, 'milliseconds');\n      if (Math.sign(diff) === -1) {\n        diff = -diff;\n      }\n      if (diff <= 1) {\n        return true;\n      }\n      const row = state.get('config.list.rows.' + rowId);\n      for (const rowItem of row._internal.items) {\n        if (rowItem.id !== itemId) {\n          if (start >= rowItem.time.start && start <= rowItem.time.end) {\n            return true;\n          }\n          if (end >= rowItem.time.start && end <= rowItem.time.end) {\n            return true;\n          }\n          if (start <= rowItem.time.start && end >= rowItem.time.end) {\n            return true;\n          }\n        }\n      }\n      return false;\n    }\n\n    function movementX(ev, row, item, zoom, timePerPixel) {\n      ev.stopPropagation();\n      const movement = getMovement(data);\n      const left = ev.x - movement.ganttLeft - movement.itemLeftCompensation;\n      moveGhost(data, ev);\n      const leftMs = state.get('_internal.chart.time.leftGlobal') + left * timePerPixel;\n      const add = leftMs - item.time.start;\n      const originalStart = item.time.start;\n      const finalStartTime = getSnapStart(data)(item.time.start, add, item);\n      const finalAdd = finalStartTime - originalStart;\n      const collision = isCollision(row.id, item.id, item.time.start + finalAdd, item.time.end + finalAdd);\n      if (finalAdd && !collision) {\n        state.update(`config.chart.items.${data.item.id}.time`, function moveItem(time) {\n          time.start += finalAdd;\n          time.end = getSnapEnd(data)(time.end, finalAdd, item) - 1;\n          return time;\n        });\n      }\n    }\n\n    function resizeX(ev, row, item, zoom, timePerPixel) {\n      ev.stopPropagation();\n      if (!isResizeable(data)) {\n        return;\n      }\n      const time = state.get('_internal.chart.time');\n      const movement = getMovement(data);\n      const left = ev.x - movement.ganttLeft - movement.itemLeftCompensation;\n      const leftMs = time.leftGlobal + left * timePerPixel;\n      const add = leftMs - item.time.end;\n      if (item.time.end + add < item.time.start) {\n        return;\n      }\n      const originalEnd = item.time.end;\n      const finalEndTime = getSnapEnd(data)(item.time.end, add, item) - 1;\n      const finalAdd = finalEndTime - originalEnd;\n      const collision = isCollision(row.id, item.id, item.time.start, item.time.end + finalAdd);\n      if (finalAdd && !collision) {\n        state.update(`config.chart.items.${data.item.id}.time`, time => {\n          time.start = getSnapStart(data)(time.start, 0, item);\n          time.end = getSnapEnd(data)(time.end, finalAdd, item) - 1;\n          return time;\n        });\n      }\n    }\n\n    function movementY(ev, row, item, zoom, timePerPixel) {\n      ev.stopPropagation();\n      moveGhost(data, ev);\n      const movement = getMovement(data);\n      const top = ev.y - movement.ganttTop;\n      const visibleRows = state.get('_internal.list.visibleRows');\n      const compensation = state.get('config.scroll.compensation');\n      let index = 0;\n      for (const currentRow of visibleRows) {\n        if (currentRow.top + compensation > top) {\n          if (index > 0) {\n            return index - 1;\n          }\n          return 0;\n        }\n        index++;\n      }\n      return index;\n    }\n\n    function documentMouseMove(ev) {\n      const movement = getMovement(data);\n      let item, rowId, row, zoom, timePerPixel;\n      if (movement.moving || movement.resizing) {\n        ev.stopPropagation();\n        item = state.get(`config.chart.items.${data.item.id}`);\n        rowId = state.get(`config.chart.items.${data.item.id}.rowId`);\n        row = state.get(`config.list.rows.${rowId}`);\n        zoom = state.get('config.chart.time.zoom');\n        timePerPixel = state.get('_internal.chart.time.timePerPixel');\n      }\n      const moveable = isMoveable(data);\n      if (movement.moving) {\n        if (moveable === true || moveable === 'x' || (Array.isArray(moveable) && moveable.includes(rowId))) {\n          movementX(ev, row, item, zoom, timePerPixel);\n        }\n        if (!moveable || moveable === 'x') {\n          return;\n        }\n        let visibleRowsIndex = movementY(ev, row, item, zoom, timePerPixel);\n        const visibleRows = state.get('_internal.list.visibleRows');\n        if (typeof visibleRows[visibleRowsIndex] === 'undefined') {\n          if (visibleRowsIndex > 0) {\n            visibleRowsIndex = visibleRows.length - 1;\n          } else if (visibleRowsIndex < 0) {\n            visibleRowsIndex = 0;\n          }\n        }\n        const newRow = visibleRows[visibleRowsIndex];\n        const newRowId = newRow.id;\n        const collision = isCollision(newRowId, item.id, item.time.start, item.time.end);\n        if (newRowId !== item.rowId && !collision) {\n          if (!Array.isArray(moveable) || moveable.includes(newRowId)) {\n            if (!newRow.hasOwnProperty('moveable') || newRow.moveable) {\n              state.update(`config.chart.items.${item.id}.rowId`, newRowId);\n            }\n          }\n        }\n      } else if (movement.resizing && (typeof item.resizeable === 'undefined' || item.resizeable === true)) {\n        resizeX(ev, row, item, zoom, timePerPixel);\n      }\n    }\n\n    function documentMouseUp(ev) {\n      const movement = getMovement(data);\n      if (movement.moving || movement.resizing) {\n        ev.stopPropagation();\n      }\n      movement.moving = false;\n      movement.resizing = false;\n      for (const itemId in movementState) {\n        movementState[itemId].moving = false;\n        movementState[itemId].resizing = false;\n        destroyGhost(itemId);\n      }\n    }\n    element.addEventListener('mousedown', labelMouseDown);\n    resizerEl.addEventListener('mousedown', resizerMouseDown, { capture: true });\n    document.addEventListener('mousemove', documentMouseMove, { capture: true, passive: true });\n    document.addEventListener('mouseup', documentMouseUp, { capture: true, passive: true });\n    return {\n      update(node, changedData) {\n        data = changedData;\n        if (!isResizeable(data)) {\n          resizerEl.style.visibility = 'hidden';\n        } else {\n          resizerEl.style.visibility = 'visible';\n        }\n      },\n      destroy(node, data) {\n        element.removeEventListener('mousedown', labelMouseDown);\n        resizerEl.removeEventListener('mousedown', resizerMouseDown);\n        document.removeEventListener('mousemove', documentMouseMove);\n        document.removeEventListener('mouseup', documentMouseUp);\n        resizerEl.remove();\n      }\n    };\n  }\n\n  return function initialize(vido) {\n    vido.state.update('config.actions.chart-timeline-items-row-item', actions => {\n      actions.push(action);\n      return actions;\n    });\n  };\n}\n","/**\n * SaveAsImage plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\n// @ts-nocheck\nexport default function SaveAsImage(options = {}) {\n  const defaultOptions = {\n    style: 'font-family: sans-serif;',\n    filename: 'gantt-schedule-timeline-calendar.jpeg'\n  };\n  options = { ...defaultOptions, options };\n  function downloadImage(data, filename) {\n    const a = document.createElement('a');\n    a.href = data;\n    a.download = filename;\n    document.body.appendChild(a);\n    a.click();\n  }\n\n  function saveAsImage(ev) {\n    const element = ev.target;\n    const width = element.clientWidth;\n    const height = element.clientHeight;\n    const html = unescape(encodeURIComponent(element.outerHTML));\n    let style = '';\n    for (const styleSheet of document.styleSheets) {\n      if (styleSheet.title === 'gstc') {\n        for (const rule of styleSheet.rules) {\n          style += rule.cssText;\n        }\n      }\n    }\n    style = `<style>* {${options.style}} ${style}</style>`;\n    const svg = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${width}\" height=\"${height}\" viewBox=\"0 0 ${width} ${height}\">\n      <foreignObject x=\"0\" y=\"0\" width=\"${width}\" height=\"${height}\">\n        <div xmlns=\"http://www.w3.org/1999/xhtml\">\n          ${style}\n          ${html}\n        </div>\n      </foreignObject>\n    </svg>`;\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = 'white';\n    ctx.fillRect(0, 0, width, height);\n    const svg64 = 'data:image/svg+xml;base64,' + btoa(svg);\n    const img = new Image();\n    img.onload = function onLoad() {\n      ctx.drawImage(img, 0, 0);\n      const jpeg = canvas.toDataURL('image/jpeg', 1.0);\n      downloadImage(jpeg, options.filename);\n    };\n    img.src = svg64;\n  }\n\n  return function initialize(vido) {\n    vido.state.subscribe('_internal.elements.main', main => {\n      if (main) {\n        main.addEventListener('save-as-image', saveAsImage);\n      }\n    });\n  };\n}\n","var rafSchd = function rafSchd(fn) {\n  var lastArgs = [];\n  var frameId = null;\n\n  var wrapperFn = function wrapperFn() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    lastArgs = args;\n\n    if (frameId) {\n      return;\n    }\n\n    frameId = requestAnimationFrame(function () {\n      frameId = null;\n      fn.apply(void 0, lastArgs);\n    });\n  };\n\n  wrapperFn.cancel = function () {\n    if (!frameId) {\n      return;\n    }\n\n    cancelAnimationFrame(frameId);\n    frameId = null;\n  };\n\n  return wrapperFn;\n};\n\nexport default rafSchd;\n","/**\n * Selection plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nimport schedule from 'raf-schd';\nexport default function Selection(options = {}) {\n  let vido, state, api;\n  const defaultOptions = {\n    style: {},\n    grid: false,\n    items: true,\n    rows: false,\n    horizontal: true,\n    vertical: true,\n    selected() {},\n    deselected() {}\n  };\n  options = { ...options, ...defaultOptions };\n  let chartTimeline, top, left;\n  let selecting = { fromX: -1, fromY: -1, toX: -1, toY: -1, startX: -1, startY: -1, selecting: false };\n  const path = 'config.plugin.selection';\n  const rectClassName = 'gantt-schedule-timeline-caledar__plugin-selection-rect';\n  const rect = document.createElement('div');\n  rect.classList.add(rectClassName);\n  rect.style.visibility = 'hidden';\n  rect.style.left = '0px';\n  rect.style.top = '0px';\n  rect.style.width = '0px';\n  rect.style.height = '0px';\n  rect.style.background = 'rgba(0, 119, 192, 0.2)';\n  rect.style.border = '2px dashed rgba(0, 119, 192, 0.75)';\n  rect.style.position = 'absolute';\n  rect.style['user-select'] = 'none';\n  rect.style['pointer-events'] = 'none';\n  for (const styleProp in options.style) {\n    rect.style[styleProp] = options.style[styleProp];\n  }\n\n  function rectSelectionAction(element, data) {\n    chartTimeline = state.get('_internal.elements.chart-timeline');\n    if (!chartTimeline.querySelector('.' + rectClassName)) {\n      chartTimeline.insertAdjacentElement('beforeend', rect);\n      const bounding = chartTimeline.getBoundingClientRect();\n      left = bounding.left;\n      top = bounding.top;\n    }\n\n    /**\n     * Clear selection\n     */\n    function clearSelection() {\n      state.update(path, {\n        selecting: {\n          'chart-timeline-grid-rows': [],\n          'chart-timeline-grid-row-blocks': [],\n          'chart-timeline-items-rows': [],\n          'chart-timeline-items-row-items': []\n        },\n        selcted: {\n          'chart-timeline-grid-rows': [],\n          'chart-timeline-grid-row-blocks': [],\n          'chart-timeline-items-rows': [],\n          'chart-timeline-items-row-items': []\n        }\n      });\n      state.update('_internal.chart.grid.rowsWithBlocks', rowsWithBlocks => {\n        for (const row of rowsWithBlocks) {\n          for (const block of row.blocks) {\n            block.selected = false;\n            block.selecting = false;\n          }\n        }\n        return rowsWithBlocks;\n      });\n    }\n\n    /**\n     * Mouse down event handler\n     * @param {MouseEvent} ev\n     */\n    function mouseDown(ev) {\n      if (ev.button !== 0) {\n        return;\n      }\n      selecting.selecting = true;\n      selecting.fromX = ev.x - left;\n      selecting.fromY = ev.y - top;\n      selecting.startX = selecting.fromX;\n      selecting.startY = selecting.fromY;\n      clearSelection();\n      vido.update();\n    }\n\n    /**\n     * Save and swap coordinates if needed\n     * @param {MouseEvent} ev\n     */\n    function saveAndSwapIfNeeded(ev) {\n      const currentX = ev.x - left;\n      const currentY = ev.y - top;\n      if (currentX <= selecting.startX) {\n        selecting.fromX = currentX;\n        selecting.toX = selecting.startX;\n      } else {\n        selecting.fromX = selecting.startX;\n        selecting.toX = currentX;\n      }\n      if (currentY <= selecting.startY) {\n        selecting.fromY = currentY;\n        selecting.toY = selecting.startY;\n      } else {\n        selecting.fromY = selecting.startY;\n        selecting.toY = currentY;\n      }\n    }\n\n    /**\n     * Is rectangle inside other rectangle ?\n     * @param {DOMRect} boundingRect\n     * @param {DOMRect} rectBoundingRect\n     * @returns {boolean}\n     */\n    function isInside(boundingRect, rectBoundingRect) {\n      let horizontal = false;\n      let vertical = false;\n      if (\n        (boundingRect.left >= rectBoundingRect.left && boundingRect.left <= rectBoundingRect.right) ||\n        (boundingRect.right >= rectBoundingRect.left && boundingRect.right <= rectBoundingRect.right) ||\n        (boundingRect.left <= rectBoundingRect.left && boundingRect.right >= rectBoundingRect.right)\n      ) {\n        horizontal = true;\n      }\n      if (\n        (boundingRect.top >= rectBoundingRect.top && boundingRect.top <= rectBoundingRect.bottom) ||\n        (boundingRect.bottom >= rectBoundingRect.top && boundingRect.bottom <= rectBoundingRect.bottom) ||\n        (boundingRect.top <= rectBoundingRect.top && boundingRect.bottom >= rectBoundingRect.bottom)\n      ) {\n        vertical = true;\n      }\n      return horizontal && vertical;\n    }\n\n    /**\n     * Get selecting elements\n     * @param {DOMRect} rectBoundingRect\n     * @param {Element[]} elements\n     * @param {string} type\n     * @returns {Element[]}\n     */\n    function getSelecting(rectBoundingRect, elements, type) {\n      const selectingResult = [];\n      const all = elements[type + 's'];\n      for (const element of all) {\n        const boundingRect = element.getBoundingClientRect();\n        if (isInside(boundingRect, rectBoundingRect)) {\n          selectingResult.push(element.vido.id);\n        }\n      }\n      const currentSelecting = state.get(`${path}.selecting.${type}s`);\n      for (const id of currentSelecting) {\n        if (!selectingResult.includes(id)) {\n        }\n      }\n      return selectingResult;\n    }\n\n    /**\n     * Mouse move event handler\n     * @param {MouseEvent} ev\n     */\n    function mouseMove(ev) {\n      if (!selecting.selecting) {\n        return;\n      }\n      if (ev.x - left === selecting.fromX || ev.y - top === selecting.fromY) {\n        return;\n      }\n      ev.stopPropagation();\n      saveAndSwapIfNeeded(ev);\n      rect.style.left = selecting.fromX + 'px';\n      rect.style.top = selecting.fromY + 'px';\n      rect.style.visibility = 'visible';\n      rect.style.width = selecting.toX - selecting.fromX + 'px';\n      rect.style.height = selecting.toY - selecting.fromY + 'px';\n      const rectBoundingRect = rect.getBoundingClientRect();\n      const elements = state.get('_internal.elements');\n      const selectingGridRowBlocks = getSelecting(rectBoundingRect, elements, 'chart-timeline-grid-row-block');\n      state.update(`${path}.selecting`, {\n        'chart-timeline-grid-rows': [],\n        'chart-timeline-grid-row-blocks': selectingGridRowBlocks,\n        'chart-timeline-items-rows': [],\n        'chart-timeline-items-row-items': []\n      });\n      state.update('_internal.chart.grid.rowsWithBlocks', rowsWithBlocks => {\n        for (const row of rowsWithBlocks) {\n          for (const block of row.blocks) {\n            // @ts-ignore\n            if (selectingGridRowBlocks.includes(block.id)) {\n              block.selecting = true;\n            } else {\n              block.selecting = false;\n            }\n          }\n        }\n        return rowsWithBlocks;\n      });\n    }\n\n    /**\n     * Mouse up event handler\n     * @param {MouseEvent} ev\n     */\n    function mouseUp(ev) {\n      if (selecting.selecting) {\n        ev.stopPropagation();\n      } else {\n        return;\n      }\n      selecting.selecting = false;\n      rect.style.visibility = 'hidden';\n      const select = {};\n      state.update(path, value => {\n        select.selected = { ...value.selecting };\n        select.selecting = {\n          'chart-timeline-grid-rows': [],\n          'chart-timeline-grid-row-blocks': [],\n          'chart-timeline-items-rows': [],\n          'chart-timeline-items-row-items': []\n        };\n        return select;\n      });\n      const currentSelected = select.selected;\n      state.update('_internal.chart.grid.rowsWithBlocks', rowsWithBlocks => {\n        for (const row of rowsWithBlocks) {\n          for (const block of row.blocks) {\n            if (currentSelected['chart-timeline-grid-row-blocks'].includes(block.id)) {\n              block.selected = true;\n            } else {\n              block.selected = false;\n            }\n          }\n        }\n        return rowsWithBlocks;\n      });\n    }\n\n    element.addEventListener('mousedown', mouseDown);\n    element.addEventListener('mousemove', schedule(mouseMove));\n    document.body.addEventListener('mouseup', mouseUp);\n    return {\n      destroy() {\n        document.body.removeEventListener('mouseup', mouseUp);\n        element.removeEventListener('mousemove', mouseMove);\n        element.removeEventListener('mousedown', mouseDown);\n      }\n    };\n  }\n\n  /**\n   * Grid row block action\n   * @param {Element} element\n   * @param {object} data\n   * @returns {object} with update and destroy functions\n   */\n  function gridBlockAction(element, data) {\n    const classNameSelecting = api.getClass('chart-timeline-grid-row-block') + '--selecting';\n    const classNameSelected = api.getClass('chart-timeline-grid-row-block') + '--selected';\n    if (data.selecting) {\n      element.classList.add(classNameSelecting);\n    } else {\n      element.classList.remove(classNameSelecting);\n    }\n    if (data.selected) {\n      element.classList.add(classNameSelected);\n    } else {\n      element.classList.remove(classNameSelected);\n    }\n    return {\n      update(element, data) {\n        if (data.selecting) {\n          element.classList.add(classNameSelecting);\n        } else {\n          element.classList.remove(classNameSelecting);\n        }\n        if (data.selected) {\n          element.classList.add(classNameSelected);\n        } else {\n          element.classList.remove(classNameSelected);\n        }\n      },\n      destroy(element, changedData) {\n        element.classList.remove(classNameSelecting);\n        element.classList.remove(classNameSelected);\n      }\n    };\n  }\n\n  /**\n   * On block create handler\n   * @param {object} block\n   * @returns {object} block\n   */\n  function onBlockCreate(block) {\n    const select = state.get('config.plugin.selection');\n    if (select.selected['chart-timeline-grid-row-blocks'].find(id => id === block.id)) {\n      block.selected = true;\n    } else {\n      block.selected = false;\n    }\n    return block;\n  }\n\n  return function initialize(mainVido) {\n    vido = mainVido;\n    state = vido.state;\n    api = vido.api;\n    if (typeof state.get(path) === 'undefined') {\n      state.update(path, {\n        selecting: {\n          'chart-timeline-grid-rows': [],\n          'chart-timeline-grid-row-blocks': [],\n          'chart-timeline-items-rows': [],\n          'chart-timeline-items-row-items': []\n        },\n        selected: {\n          'chart-timeline-grid-rows': [],\n          'chart-timeline-grid-row-blocks': [],\n          'chart-timeline-items-rows': [],\n          'chart-timeline-items-row-items': []\n        }\n      });\n    }\n    state.update('config.actions.chart-timeline', actions => {\n      actions.push(rectSelectionAction);\n      return actions;\n    });\n    state.update('config.actions.chart-timeline-grid-row-block', actions => {\n      actions.push(gridBlockAction);\n      return actions;\n    });\n    state.update('config.chart.grid.block.onCreate', onCreate => {\n      onCreate.push(onBlockCreate);\n      return onCreate;\n    });\n  };\n}\n"],"names":["ItemHold","options","time","movementThreshold","[object Object]","element","data","holding","mouse","x","y","onMouseUp","itemId","action","elementMouseDown","event","item","id","setTimeout","exec","xMovement","Math","sign","yMovement","onMouseDown","onMouseMove","addEventListener","document","changedData","removeEventListener","vido","state","update","actions","push","ItemMovement","moveable","resizeable","resizerContent","collisionDetection","outOfBorders","snapStart","timeStart","startDiff","snapEnd","timeEnd","endDiff","ghostNode","movementState","node","api","querySelector","isResizeable","hasOwnProperty","row","getMovement","moving","resizing","moveGhost","ev","movement","left","ganttLeft","itemLeftCompensation","compensation","get","ghost","style","top","ganttTop","itemTop","destroyGhost","removeChild","opacity","getSnapStart","getSnapEnd","resizerHTML","getClass","insertAdjacentHTML","resizerEl","labelMouseDown","stopPropagation","button","chartLeftTime","timePerPixel","ganttRect","getBoundingClientRect","itemX","round","start","cloneNode","getComputedStyle","position","offsetTop","width","height","clientHeight","appendChild","createGhost","resizerMouseDown","end","isCollision","rowId","from","to","diff","date","rowItem","_internal","items","documentMouseMove","zoom","isMoveable","Array","isArray","includes","add","originalStart","finalAdd","collision","movementX","visibleRowsIndex","visibleRows","index","currentRow","movementY","length","newRow","newRowId","leftGlobal","originalEnd","resizeX","documentMouseUp","visibility","capture","passive","remove","SaveAsImage","saveAsImage","target","clientWidth","html","unescape","encodeURIComponent","outerHTML","styleSheet","styleSheets","title","rule","rules","cssText","svg","canvas","createElement","ctx","getContext","fillStyle","fillRect","svg64","btoa","img","Image","onload","drawImage","filename","a","href","download","body","click","downloadImage","toDataURL","src","subscribe","main","rafSchd","fn","lastArgs","frameId","wrapperFn","_len","arguments","args","_key","requestAnimationFrame","apply","cancel","cancelAnimationFrame","Selection","defaultOptions","grid","rows","horizontal","vertical","chartTimeline","selecting","fromX","fromY","toX","toY","startX","startY","path","rectClassName","rect","classList","background","border","styleProp","rectSelectionAction","insertAdjacentElement","bounding","mouseDown","chart-timeline-grid-rows","chart-timeline-grid-row-blocks","chart-timeline-items-rows","chart-timeline-items-row-items","selcted","rowsWithBlocks","block","blocks","selected","isInside","boundingRect","rectBoundingRect","right","bottom","mouseMove","currentX","currentY","saveAndSwapIfNeeded","selectingGridRowBlocks","elements","type","selectingResult","all","currentSelecting","getSelecting","mouseUp","select","value","currentSelected","schedule","gridBlockAction","classNameSelecting","classNameSelected","onBlockCreate","find","mainVido","onCreate"],"mappings":"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"}