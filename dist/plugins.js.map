{"version":3,"file":"plugins.js","sources":["../src/plugins/ItemHold.plugin.js","../src/plugins/ItemMovement.plugin.js","../src/plugins/SaveAsImage.plugin.js"],"sourcesContent":["/**\n * Gantt-Schedule-Timeline-Calendar\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0\n */\n\nexport default function ItemHoldPlugin(options = {}) {\n  const defaultOptions = {\n    time: 1000,\n    movementThreshold: 2,\n    action(element, data) {}\n  };\n  options = { ...defaultOptions, ...options };\n\n  const holding = {};\n  const mouse = { x: 0, y: 0 };\n\n  function onMouseDown(item, element, event) {\n    if (typeof holding[item.id] === 'undefined') {\n      holding[item.id] = { x: event.x, y: event.y };\n      setTimeout(() => {\n        if (typeof holding[item.id] !== 'undefined') {\n          let exec = true;\n          let xMovement = holding[item.id].x - mouse.x;\n          if (Math.sign(xMovement) === -1) {\n            xMovement = -xMovement;\n          }\n          let yMovement = holding[item.id].y - mouse.y;\n          if (Math.sign(yMovement) === -1) {\n            yMovement = -yMovement;\n          }\n          if (xMovement > options.movementThreshold) {\n            exec = false;\n          }\n          if (yMovement > options.movementThreshold) {\n            exec = false;\n          }\n          delete holding[item.id];\n          if (exec) {\n            options.action(element, item);\n          }\n        }\n      }, options.time);\n    }\n  }\n\n  function onMouseUp(itemId) {\n    if (typeof holding[itemId] !== 'undefined') {\n      delete holding[itemId];\n    }\n  }\n\n  const mouseUps = [];\n  const mouseMoves = [];\n\n  function action(element, data) {\n    element.addEventListener('mousedown', event => {\n      onMouseDown(data.item, element, event);\n    });\n    function mouseUp() {\n      onMouseUp(data.item.id);\n    }\n    mouseUps.push(mouseUp);\n    document.addEventListener('mouseup', mouseUp);\n    function mouseMove(event) {\n      mouse.x = event.x;\n      mouse.y = event.y;\n    }\n    mouseMoves.push(mouseMove);\n    document.addEventListener('mousemove', mouseMove);\n    return {\n      destroy(element, data) {\n        mouseUps.forEach(mouseUp => document.removeEventListener('mouseup', mouseUp));\n        mouseMoves.forEach(mouseMove => document.removeEventListener('mousemove', mouseMove));\n      }\n    };\n  }\n\n  return function initializePlugin(state, api) {\n    state.update('config.actions.chart-timeline-items-row-item', actions => {\n      actions.push(action);\n      return actions;\n    });\n  };\n}\n","/**\n * Gantt-Schedule-Timeline-Calendar\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0\n */\n\n// @ts-nocheck\nexport default function ItemMovementPlugin(options = {}) {\n  const defaultOptions = {\n    moveable: true,\n    resizeable: true,\n    resizerContent: '',\n    collisionDetection: true,\n    outOfBorders: false,\n    snapStart: [],\n    snapEnd: [],\n    ghostNode: true\n  };\n  options = { ...defaultOptions, ...options };\n  options.snapStart = options.snapStart.slice();\n  options.snapEnd = options.snapEnd.slice();\n  const movementState = {};\n\n  /**\n   * Add moving functionality to items as action\n   *\n   * @param {Node} node DOM Node\n   * @param {Object} data\n   */\n  function action(node, data) {\n    const element = node.querySelector('.gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content');\n    if (!options.moveable && !options.resizeable) {\n      return;\n    }\n    let moveable = options.moveable;\n    if (data.item.hasOwnProperty('moveable') && moveable) {\n      moveable = data.item.moveable;\n    }\n    if (data.row.hasOwnProperty('moveable') && moveable) {\n      moveable = data.row.moveable;\n    }\n    let resizeable = options.resizeable && (!data.item.hasOwnProperty('resizeable') || data.item.resizeable === true);\n    if (data.row.hasOwnProperty('resizeable') && resizeable) {\n      resizeable = data.row.resizeable;\n    }\n    const api = data.api;\n    let snapStart = options.snapStart;\n    if (typeof data.item.snapStart !== 'undefined' && Array.isArray(data.item.snapStart)) {\n      snapStart = item.snapStart;\n    }\n    let snapEnd = options.snapEnd;\n    if (typeof data.item.snapEnd !== 'undefined' && Array.isArray(data.item.snapEnd)) {\n      snapEnd = data.item.snapEnd;\n    }\n\n    if (resizeable) {\n      const resizerHTML = `<div class=\"${api.getClass('chart-timeline-items-row-item-content-resizer')}\">${\n        options.resizerContent\n      }</div>`;\n      // @ts-ignore\n      element.insertAdjacentHTML('beforeend', resizerHTML);\n    }\n\n    const el = element;\n    const resizerEl = el.querySelector(\n      '.gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content-resizer'\n    );\n    const state = data.state;\n\n    if (typeof movementState[data.item.id] === 'undefined') {\n      movementState[data.item.id] = { moving: false, resizing: false };\n    }\n    const movement = movementState[data.item.id];\n\n    function createGhost(itemId, ev, ganttLeft, ganttTop) {\n      if (!options.ghostNode || typeof movementState[itemId].ghost !== 'undefined') {\n        return;\n      }\n      const ghost = element.cloneNode(true);\n      const style = getComputedStyle(element);\n      ghost.style.position = 'absolute';\n      ghost.style.left = ev.x - ganttLeft - movement.itemLeftCompensation + 'px';\n      const itemTop = ev.y - ganttTop - data.row.top - element.offsetTop;\n      movement.itemTop = itemTop;\n      ghost.style.top = ev.y - ganttTop - itemTop + 'px';\n      ghost.style.width = style.width;\n      ghost.style['box-shadow'] = '10px 10px 6px #00000020';\n      const height = element.clientHeight + 'px';\n      ghost.style.height = height;\n      ghost.style['line-height'] = height;\n      ghost.style.opacity = '0.75';\n      state.get('_internal.elements.gantt').appendChild(ghost);\n      movementState[itemId].ghost = ghost;\n      return ghost;\n    }\n\n    function moveGhost(ev) {\n      if (options.ghostNode) {\n        const left = ev.x - movement.ganttLeft - movement.itemLeftCompensation;\n        movement.ghost.style.left = left + 'px';\n        movement.ghost.style.top = ev.y - movement.ganttTop - movement.itemTop + 'px';\n      }\n    }\n\n    function destroyGhost(itemId) {\n      if (!options.ghostNode) {\n        return;\n      }\n      if (typeof movementState[itemId] !== 'undefined' && typeof movementState[itemId].ghost !== 'undefined') {\n        state.get('_internal.elements.gantt').removeChild(movementState[itemId].ghost);\n        delete movementState[itemId].ghost;\n      }\n      element.style.opacity = '1';\n    }\n\n    function labelMouseDown(ev) {\n      if (ev.button !== 0) {\n        return;\n      }\n      movement.moving = true;\n      const item = state.get(`config.chart.items.${data.item.id}`);\n      const chartLeftTime = state.get('_internal.chart.time.leftGlobal');\n      const timePerPixel = state.get('_internal.chart.time.timePerPixel');\n      const ganttRect = state.get('_internal.elements.gantt').getBoundingClientRect();\n      movement.ganttTop = ganttRect.top;\n      movement.ganttLeft = ganttRect.left;\n      movement.itemX = Math.round((item.time.start - chartLeftTime) / timePerPixel);\n      movement.itemLeftCompensation = ev.x - movement.ganttLeft - movement.itemX;\n      createGhost(data.item.id, ev, ganttRect.left, ganttRect.top);\n    }\n\n    function resizerMouseDown(ev) {\n      if (ev.button !== 0) {\n        return;\n      }\n      ev.stopPropagation();\n      movement.resizing = true;\n      const item = state.get(`config.chart.items.${data.item.id}`);\n      const chartLeftTime = state.get('_internal.chart.time.leftGlobal');\n      const timePerPixel = state.get('_internal.chart.time.timePerPixel');\n      const ganttRect = state.get('_internal.elements.gantt').getBoundingClientRect();\n      movement.ganttTop = ganttRect.top;\n      movement.ganttLeft = ganttRect.left;\n      movement.itemX = (item.time.end - chartLeftTime) / timePerPixel;\n      movement.itemLeftCompensation = ev.x - movement.ganttLeft - movement.itemX;\n    }\n\n    function isCollision(rowId, itemId, start, end) {\n      if (!options.collisionDetection) {\n        return false;\n      }\n      const time = state.get('_internal.chart.time');\n      if (options.outOfBorders && (start < time.from || end > time.to)) {\n        return true;\n      }\n      let diff = api.time.date(end).diff(start, 'milliseconds');\n      if (Math.sign(diff) === -1) {\n        diff = -diff;\n      }\n      if (diff <= 1) {\n        return true;\n      }\n      const row = state.get('config.list.rows.' + rowId);\n      for (const rowItem of row._internal.items) {\n        if (rowItem.id !== itemId) {\n          if (start >= rowItem.time.start && start <= rowItem.time.end) {\n            return true;\n          }\n          if (end >= rowItem.time.start && end <= rowItem.time.end) {\n            return true;\n          }\n          if (start <= rowItem.time.start && end >= rowItem.time.end) {\n            return true;\n          }\n        }\n      }\n      return false;\n    }\n\n    function snap(addMilliseconds, currentDate, addToEnd = 0, snapValues = []) {\n      let smallestDiff = Number.MAX_SAFE_INTEGER;\n      let smallestTime = 0;\n      for (let snapTime of snapValues) {\n        let diff = currentDate\n          .clone()\n          .add(addMilliseconds, 'milliseconds')\n          .diff(snapTime, 'milliseconds');\n        if (Math.sign(diff) === -1) {\n          diff = -diff;\n        }\n        if (diff < smallestDiff) {\n          smallestDiff = diff;\n          smallestTime = snapTime;\n        }\n      }\n      smallestTime += addToEnd;\n      return api.time.date(smallestTime);\n    }\n\n    function movementX(ev, row, item, zoom, timePerPixel) {\n      const left = ev.x - movement.ganttLeft - movement.itemLeftCompensation;\n      moveGhost(ev);\n      const leftMs = state.get('_internal.chart.time.leftGlobal') + left * timePerPixel;\n      const add = leftMs - item.time.start;\n      const originalStart = item.time.start;\n      const finalStartTime = snap(add, data.api.time.date(item.time.start), 0, snapStart);\n      const finalAdd = finalStartTime - originalStart;\n      const collision = isCollision(row.id, item.id, item.time.start + finalAdd, item.time.end + finalAdd);\n      if (finalAdd && !collision) {\n        state.update(`config.chart.items.${data.item.id}.time`, function moveItem(time) {\n          time.start += finalAdd;\n          time.end += finalAdd;\n          return time;\n        });\n      }\n    }\n\n    function resizeX(ev, row, item, zoom, timePerPixel) {\n      const time = state.get('_internal.chart.time');\n      const left = ev.x - movement.ganttLeft - movement.itemLeftCompensation;\n      const leftMs = time.leftGlobal + left * timePerPixel;\n      const add = leftMs - item.time.end;\n      if (item.time.end + add < item.time.start) {\n        return;\n      }\n      const originalEnd = item.time.end;\n      const finalEndTime = snap(add, data.api.time.date(item.time.end), -1, snapEnd);\n      const finalAdd = finalEndTime - originalEnd;\n      const collision = isCollision(row.id, item.id, item.time.start, item.time.end + finalAdd);\n      if (finalAdd && !collision) {\n        state.update(`config.chart.items.${data.item.id}.time.end`, function resizeItem(end) {\n          return (end += finalAdd);\n        });\n      }\n    }\n\n    function movementY(ev, row, item, zoom, timePerPixel) {\n      moveGhost(ev);\n      const top = ev.y - movement.ganttTop;\n      const visibleRows = state.get('_internal.list.visibleRows');\n      let index = 0;\n      for (const currentRow of visibleRows) {\n        if (currentRow.top > top) {\n          if (index > 0) {\n            return index - 1;\n          }\n          return 0;\n        }\n        index++;\n      }\n      return index;\n    }\n\n    function documentMouseMove(ev) {\n      let item, rowId, row, zoom, timePerPixel;\n      if (movement.moving || movement.resizing) {\n        item = state.get(`config.chart.items.${data.item.id}`);\n        rowId = state.get(`config.chart.items.${data.item.id}.rowId`);\n        row = state.get(`config.list.rows.${rowId}`);\n        zoom = state.get('config.chart.time.zoom');\n        timePerPixel = state.get('_internal.chart.time.timePerPixel');\n      }\n      if (movement.moving) {\n        if (moveable === true || moveable === 'x' || (Array.isArray(moveable) && moveable.includes(rowId))) {\n          movementX(ev, row, item, zoom, timePerPixel);\n        }\n        if (!moveable || moveable === 'x') {\n          return;\n        }\n        let visibleRowsIndex = movementY(ev, row, item, zoom, timePerPixel);\n        const visibleRows = state.get('_internal.list.visibleRows');\n        if (typeof visibleRows[visibleRowsIndex] === 'undefined') {\n          if (visibleRowsIndex > 0) {\n            visibleRowsIndex = visibleRows.length - 1;\n          } else if (visibleRowsIndex < 0) {\n            visibleRowsIndex = 0;\n          }\n        }\n        const newRow = visibleRows[visibleRowsIndex];\n        const newRowId = newRow.id;\n        const collision = isCollision(newRowId, item.id, item.time.start, item.time.end);\n        if (newRowId !== item.rowId && !collision) {\n          if (!Array.isArray(moveable) || moveable.includes(newRowId)) {\n            if (!newRow.hasOwnProperty('moveable') || newRow.moveable) {\n              state.update(`config.chart.items.${item.id}.rowId`, newRowId);\n            }\n          }\n        }\n      } else if (movement.resizing && (typeof item.resizeable === 'undefined' || item.resizeable === true)) {\n        resizeX(ev, row, item, zoom, timePerPixel);\n      }\n    }\n\n    function documentMouseUp(ev) {\n      movement.moving = false;\n      movement.resizing = false;\n      for (const itemId in movementState) {\n        movementState[itemId].moving = false;\n        movementState[itemId].resizing = false;\n        destroyGhost(itemId);\n      }\n    }\n    if (moveable) el.addEventListener('mousedown', labelMouseDown);\n    if (resizeable) resizerEl.addEventListener('mousedown', resizerMouseDown);\n    document.addEventListener('mousemove', documentMouseMove);\n    document.addEventListener('mouseup', documentMouseUp);\n\n    return {\n      destroy(node, data) {\n        if (moveable) el.removeEventListener('moudedown', labelMouseDown);\n        if (resizeable) resizerEl.removeEventListener('mousedown', resizerMouseDown);\n        document.removeEventListener('mousemove', documentMouseMove);\n        document.removeEventListener('mouseup', documentMouseUp);\n        if (resizeable) element.removeChild(resizerEl);\n      }\n    };\n  }\n\n  return function initializePlugin(state, api) {\n    state.update('config.actions.chart-timeline-items-row-item', actions => {\n      actions.push(action);\n      return actions;\n    });\n  };\n}\n","/**\n * Gantt-Schedule-Timeline-Calendar\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0\n */\n\n// @ts-nocheck\nexport default function SaveAsImage(options = {}) {\n  const defaultOptions = {\n    style: 'font-family: sans-serif;',\n    filename: 'gantt-schedule-timeline-calendar.jpeg'\n  };\n  options = { ...defaultOptions, options };\n  function downloadImage(data, filename) {\n    const a = document.createElement('a');\n    a.href = data;\n    a.download = filename;\n    document.body.appendChild(a);\n    a.click();\n  }\n\n  function saveAsImage(ev) {\n    const element = ev.target;\n    const width = element.clientWidth;\n    const height = element.clientHeight;\n    const html = unescape(encodeURIComponent(element.outerHTML));\n    let style = '';\n    for (const styleSheet of document.styleSheets) {\n      if (styleSheet.title === 'gstc') {\n        for (const rule of styleSheet.rules) {\n          style += rule.cssText;\n        }\n      }\n    }\n    style = `<style>* {${options.style}} ${style}</style>`;\n    const svg = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${width}\" height=\"${height}\" viewBox=\"0 0 ${width} ${height}\">\n      <foreignObject x=\"0\" y=\"0\" width=\"${width}\" height=\"${height}\">\n        <div xmlns=\"http://www.w3.org/1999/xhtml\">\n          ${style}\n          ${html}\n        </div>\n      </foreignObject>\n    </svg>`;\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = 'white';\n    ctx.fillRect(0, 0, width, height);\n    const svg64 = 'data:image/svg+xml;base64,' + btoa(svg);\n    const img = new Image();\n    img.onload = function onLoad() {\n      ctx.drawImage(img, 0, 0);\n      const jpeg = canvas.toDataURL('image/jpeg', 1.0);\n      downloadImage(jpeg, options.filename);\n    };\n    img.src = svg64;\n  }\n\n  return function initializePlugin(state, api) {\n    state.subscribe('_internal.elements.main', main => {\n      if (main) {\n        main.addEventListener('save-as-image', saveAsImage);\n      }\n    });\n  };\n}\n"],"names":["ItemHoldPlugin","options","time","movementThreshold","[object Object]","element","data","holding","mouse","x","y","mouseUps","mouseMoves","action","mouseUp","itemId","item","id","mouseMove","event","addEventListener","setTimeout","exec","xMovement","Math","sign","yMovement","onMouseDown","push","document","forEach","removeEventListener","state","api","update","actions","ItemMovementPlugin","moveable","resizeable","resizerContent","collisionDetection","outOfBorders","snapStart","snapEnd","ghostNode","slice","movementState","node","querySelector","hasOwnProperty","row","Array","isArray","resizerHTML","getClass","insertAdjacentHTML","el","resizerEl","moving","resizing","movement","moveGhost","ev","left","ganttLeft","itemLeftCompensation","ghost","style","top","ganttTop","itemTop","destroyGhost","get","removeChild","opacity","labelMouseDown","button","chartLeftTime","timePerPixel","ganttRect","getBoundingClientRect","itemX","round","start","cloneNode","getComputedStyle","position","offsetTop","width","height","clientHeight","appendChild","createGhost","resizerMouseDown","stopPropagation","end","isCollision","rowId","from","to","diff","date","rowItem","_internal","items","snap","addMilliseconds","currentDate","addToEnd","snapValues","smallestDiff","Number","MAX_SAFE_INTEGER","smallestTime","snapTime","clone","add","documentMouseMove","zoom","includes","originalStart","finalAdd","collision","movementX","visibleRowsIndex","visibleRows","index","currentRow","movementY","length","newRow","newRowId","leftGlobal","originalEnd","resizeX","documentMouseUp","SaveAsImage","saveAsImage","target","clientWidth","html","unescape","encodeURIComponent","outerHTML","styleSheet","styleSheets","title","rule","rules","cssText","svg","canvas","createElement","ctx","getContext","fillStyle","fillRect","svg64","btoa","img","Image","onload","drawImage","filename","a","href","download","body","click","downloadImage","toDataURL","src","subscribe","main"],"mappings":"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"}