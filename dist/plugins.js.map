{"version":3,"file":"plugins.js","sources":["../src/plugins/ItemHold.plugin.js","../src/plugins/ItemMovement.plugin.js","../src/plugins/SaveAsImage.plugin.js"],"sourcesContent":["/**\n * ItemsHold plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0\n */\n\nexport default function ItemHold(options = {}) {\n  const defaultOptions = {\n    time: 1000,\n    movementThreshold: 2,\n    action(element, data) {}\n  };\n  options = { ...defaultOptions, ...options };\n\n  const holding = {};\n  const mouse = { x: 0, y: 0 };\n\n  function onMouseDown(item, element, event) {\n    if (typeof holding[item.id] === 'undefined') {\n      holding[item.id] = { x: event.x, y: event.y };\n      setTimeout(() => {\n        if (typeof holding[item.id] !== 'undefined') {\n          let exec = true;\n          let xMovement = holding[item.id].x - mouse.x;\n          if (Math.sign(xMovement) === -1) {\n            xMovement = -xMovement;\n          }\n          let yMovement = holding[item.id].y - mouse.y;\n          if (Math.sign(yMovement) === -1) {\n            yMovement = -yMovement;\n          }\n          if (xMovement > options.movementThreshold) {\n            exec = false;\n          }\n          if (yMovement > options.movementThreshold) {\n            exec = false;\n          }\n          delete holding[item.id];\n          if (exec) {\n            options.action(element, item);\n          }\n        }\n      }, options.time);\n    }\n  }\n\n  function onMouseUp(itemId) {\n    if (typeof holding[itemId] !== 'undefined') {\n      delete holding[itemId];\n    }\n  }\n\n  function action(element, data) {\n    function elementMouseDown(event) {\n      onMouseDown(data.item, element, event);\n    }\n    element.addEventListener('mousedown', elementMouseDown);\n    function mouseUp() {\n      onMouseUp(data.item.id);\n    }\n\n    document.addEventListener('mouseup', mouseUp);\n    function onMouseMove(event) {\n      mouse.x = event.x;\n      mouse.y = event.y;\n    }\n\n    document.addEventListener('mousemove', onMouseMove);\n    return {\n      update(element, changedData) {\n        data = changedData;\n      },\n      destroy(element, data) {\n        document.removeEventListener('mouseup', onMouseUp);\n        document.removeEventListener('mousemove', onMouseMove);\n        element.removeEventListener('mousedown', elementMouseDown);\n      }\n    };\n  }\n\n  return function initializePlugin(state, api) {\n    state.update('config.actions.chart-timeline-items-row-item', actions => {\n      actions.push(action);\n      return actions;\n    });\n  };\n}\n","/**\n * ItemMovement plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0\n */\n\nexport default function ItemMovement(options = {}) {\n  const defaultOptions = {\n    moveable: true,\n    resizeable: true,\n    resizerContent: '',\n    collisionDetection: true,\n    outOfBorders: false,\n    snapStart: (timeStart, startDiff) => timeStart + startDiff,\n    snapEnd: (timeEnd, endDiff) => timeEnd + endDiff,\n    ghostNode: true\n  };\n  options = { ...defaultOptions, ...options };\n\n  const movementState = {};\n\n  /**\n   * Add moving functionality to items as action\n   *\n   * @param {Node} node DOM Node\n   * @param {Object} data\n   */\n  function action(node, data) {\n    // @ts-ignore\n    let element = node.querySelector('.gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content');\n    if (!options.moveable && !options.resizeable) {\n      return;\n    }\n    let state;\n    let api;\n\n    function isMoveable(data) {\n      let moveable = options.moveable;\n      if (data.item.hasOwnProperty('moveable') && moveable) {\n        moveable = data.item.moveable;\n      }\n      if (data.row.hasOwnProperty('moveable') && moveable) {\n        moveable = data.row.moveable;\n      }\n      return moveable;\n    }\n\n    function isResizeable(data) {\n      let resizeable = options.resizeable && (!data.item.hasOwnProperty('resizeable') || data.item.resizeable === true);\n      if (data.row.hasOwnProperty('resizeable') && resizeable) {\n        resizeable = data.row.resizeable;\n      }\n      return resizeable;\n    }\n\n    function getMovement(data) {\n      const itemId = data.item.id;\n      if (typeof movementState[itemId] === 'undefined') {\n        movementState[itemId] = { moving: false, resizing: false };\n      }\n      return movementState[itemId];\n    }\n\n    function createGhost(data, ev, ganttLeft, ganttTop) {\n      const movement = getMovement(data);\n      if (!options.ghostNode || typeof movement.ghost !== 'undefined') {\n        return;\n      }\n      const ghost = element.cloneNode(true);\n      const style = getComputedStyle(element);\n      ghost.style.position = 'absolute';\n      ghost.style.left = ev.x - ganttLeft - movement.itemLeftCompensation + 'px';\n      const itemTop = ev.y - ganttTop - data.row.top - element.offsetTop;\n      movement.itemTop = itemTop;\n      ghost.style.top = ev.y - ganttTop - itemTop + 'px';\n      ghost.style.width = style.width;\n      ghost.style['box-shadow'] = '10px 10px 6px #00000020';\n      const height = element.clientHeight + 'px';\n      ghost.style.height = height;\n      ghost.style['line-height'] = height;\n      ghost.style.opacity = '0.75';\n      state.get('_internal.elements.gantt').appendChild(ghost);\n      movement.ghost = ghost;\n      return ghost;\n    }\n\n    function moveGhost(data, ev) {\n      if (options.ghostNode) {\n        const movement = getMovement(data);\n        const left = ev.x - movement.ganttLeft - movement.itemLeftCompensation;\n        movement.ghost.style.left = left + 'px';\n        movement.ghost.style.top = ev.y - movement.ganttTop - movement.itemTop + 'px';\n      }\n    }\n\n    function destroyGhost(itemId) {\n      if (!options.ghostNode) {\n        return;\n      }\n      if (typeof movementState[itemId] !== 'undefined' && typeof movementState[itemId].ghost !== 'undefined') {\n        state.get('_internal.elements.gantt').removeChild(movementState[itemId].ghost);\n        delete movementState[itemId].ghost;\n      }\n      element.style.opacity = '1';\n    }\n\n    function getSnapStart(data) {\n      let snapStart = options.snapStart;\n      if (typeof data.item.snapStart === 'function') {\n        snapStart = data.item.snapStart;\n      }\n      return snapStart;\n    }\n\n    function getSnapEnd(data) {\n      let snapEnd = options.snapEnd;\n      if (typeof data.item.snapEnd === 'function') {\n        snapEnd = data.item.snapEnd;\n      }\n      return snapEnd;\n    }\n\n    state = data.state;\n    api = data.api;\n\n    const resizerHTML = `<div class=\"${api.getClass('chart-timeline-items-row-item-content-resizer')}\">${\n      options.resizerContent\n    }</div>`;\n    // @ts-ignore\n    element.insertAdjacentHTML('beforeend', resizerHTML);\n    const resizerEl = element.querySelector(\n      '.gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content-resizer'\n    );\n    if (!isResizeable(data)) {\n      resizerEl.style.visibility = 'hidden';\n    } else {\n      resizerEl.style.visibility = 'visible';\n    }\n\n    function labelMouseDown(ev) {\n      if (ev.button !== 0) {\n        return;\n      }\n      // @ts-ignore\n      element = node.querySelector('.gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content');\n      const movement = getMovement(data);\n      movement.moving = true;\n      const item = state.get(`config.chart.items.${data.item.id}`);\n      const chartLeftTime = state.get('_internal.chart.time.leftGlobal');\n      const timePerPixel = state.get('_internal.chart.time.timePerPixel');\n      const ganttRect = state.get('_internal.elements.gantt').getBoundingClientRect();\n      movement.ganttTop = ganttRect.top;\n      movement.ganttLeft = ganttRect.left;\n      movement.itemX = Math.round((item.time.start - chartLeftTime) / timePerPixel);\n      movement.itemLeftCompensation = ev.x - movement.ganttLeft - movement.itemX;\n      createGhost(data, ev, ganttRect.left, ganttRect.top);\n    }\n\n    function resizerMouseDown(ev) {\n      if (ev.button !== 0) {\n        return;\n      }\n      ev.stopPropagation();\n      const movement = getMovement(data);\n      movement.resizing = true;\n      const item = state.get(`config.chart.items.${data.item.id}`);\n      const chartLeftTime = state.get('_internal.chart.time.leftGlobal');\n      const timePerPixel = state.get('_internal.chart.time.timePerPixel');\n      const ganttRect = state.get('_internal.elements.gantt').getBoundingClientRect();\n      movement.ganttTop = ganttRect.top;\n      movement.ganttLeft = ganttRect.left;\n      movement.itemX = (item.time.end - chartLeftTime) / timePerPixel;\n      movement.itemLeftCompensation = ev.x - movement.ganttLeft - movement.itemX;\n    }\n\n    function isCollision(rowId, itemId, start, end) {\n      if (!options.collisionDetection) {\n        return false;\n      }\n      const time = state.get('_internal.chart.time');\n      if (options.outOfBorders && (start < time.from || end > time.to)) {\n        return true;\n      }\n      let diff = api.time.date(end).diff(start, 'milliseconds');\n      if (Math.sign(diff) === -1) {\n        diff = -diff;\n      }\n      if (diff <= 1) {\n        return true;\n      }\n      const row = state.get('config.list.rows.' + rowId);\n      for (const rowItem of row._internal.items) {\n        if (rowItem.id !== itemId) {\n          if (start >= rowItem.time.start && start <= rowItem.time.end) {\n            return true;\n          }\n          if (end >= rowItem.time.start && end <= rowItem.time.end) {\n            return true;\n          }\n          if (start <= rowItem.time.start && end >= rowItem.time.end) {\n            return true;\n          }\n        }\n      }\n      return false;\n    }\n\n    function movementX(ev, row, item, zoom, timePerPixel) {\n      const movement = getMovement(data);\n      const left = ev.x - movement.ganttLeft - movement.itemLeftCompensation;\n      moveGhost(data, ev);\n      const leftMs = state.get('_internal.chart.time.leftGlobal') + left * timePerPixel;\n      const add = leftMs - item.time.start;\n      const originalStart = item.time.start;\n      const finalStartTime = getSnapStart(data)(item.time.start, add, item);\n      const finalAdd = finalStartTime - originalStart;\n      const collision = isCollision(row.id, item.id, item.time.start + finalAdd, item.time.end + finalAdd);\n      if (finalAdd && !collision) {\n        state.update(`config.chart.items.${data.item.id}.time`, function moveItem(time) {\n          time.start += finalAdd;\n          time.end = getSnapEnd(data)(time.end, finalAdd, item) - 1;\n          return time;\n        });\n      }\n    }\n\n    function resizeX(ev, row, item, zoom, timePerPixel) {\n      if (!isResizeable(data)) {\n        return;\n      }\n      const time = state.get('_internal.chart.time');\n      const movement = getMovement(data);\n      const left = ev.x - movement.ganttLeft - movement.itemLeftCompensation;\n      const leftMs = time.leftGlobal + left * timePerPixel;\n      const add = leftMs - item.time.end;\n      if (item.time.end + add < item.time.start) {\n        return;\n      }\n      const originalEnd = item.time.end;\n      const finalEndTime = getSnapEnd(data)(item.time.end, add, item) - 1;\n      const finalAdd = finalEndTime - originalEnd;\n      const collision = isCollision(row.id, item.id, item.time.start, item.time.end + finalAdd);\n      if (finalAdd && !collision) {\n        state.update(`config.chart.items.${data.item.id}.time`, time => {\n          time.start = getSnapStart(data)(time.start, 0, item);\n          time.end = getSnapEnd(data)(time.end, finalAdd, item) - 1;\n          return time;\n        });\n      }\n    }\n\n    function movementY(ev, row, item, zoom, timePerPixel) {\n      moveGhost(data, ev);\n      const movement = getMovement(data);\n      const top = ev.y - movement.ganttTop;\n      const visibleRows = state.get('_internal.list.visibleRows');\n      let index = 0;\n      for (const currentRow of visibleRows) {\n        if (currentRow.top > top) {\n          if (index > 0) {\n            return index - 1;\n          }\n          return 0;\n        }\n        index++;\n      }\n      return index;\n    }\n\n    function documentMouseMove(ev) {\n      const movement = getMovement(data);\n      let item, rowId, row, zoom, timePerPixel;\n      if (movement.moving || movement.resizing) {\n        item = state.get(`config.chart.items.${data.item.id}`);\n        rowId = state.get(`config.chart.items.${data.item.id}.rowId`);\n        row = state.get(`config.list.rows.${rowId}`);\n        zoom = state.get('config.chart.time.zoom');\n        timePerPixel = state.get('_internal.chart.time.timePerPixel');\n      }\n      const moveable = isMoveable(data);\n      if (movement.moving) {\n        if (moveable === true || moveable === 'x' || (Array.isArray(moveable) && moveable.includes(rowId))) {\n          movementX(ev, row, item, zoom, timePerPixel);\n        }\n        if (!moveable || moveable === 'x') {\n          return;\n        }\n        let visibleRowsIndex = movementY(ev, row, item, zoom, timePerPixel);\n        const visibleRows = state.get('_internal.list.visibleRows');\n        if (typeof visibleRows[visibleRowsIndex] === 'undefined') {\n          if (visibleRowsIndex > 0) {\n            visibleRowsIndex = visibleRows.length - 1;\n          } else if (visibleRowsIndex < 0) {\n            visibleRowsIndex = 0;\n          }\n        }\n        const newRow = visibleRows[visibleRowsIndex];\n        const newRowId = newRow.id;\n        const collision = isCollision(newRowId, item.id, item.time.start, item.time.end);\n        if (newRowId !== item.rowId && !collision) {\n          if (!Array.isArray(moveable) || moveable.includes(newRowId)) {\n            if (!newRow.hasOwnProperty('moveable') || newRow.moveable) {\n              state.update(`config.chart.items.${item.id}.rowId`, newRowId);\n            }\n          }\n        }\n      } else if (movement.resizing && (typeof item.resizeable === 'undefined' || item.resizeable === true)) {\n        resizeX(ev, row, item, zoom, timePerPixel);\n      }\n    }\n\n    function documentMouseUp(ev) {\n      const movement = getMovement(data);\n      movement.moving = false;\n      movement.resizing = false;\n      for (const itemId in movementState) {\n        movementState[itemId].moving = false;\n        movementState[itemId].resizing = false;\n        destroyGhost(itemId);\n      }\n    }\n    element.addEventListener('mousedown', labelMouseDown);\n    resizerEl.addEventListener('mousedown', resizerMouseDown);\n    document.addEventListener('mousemove', documentMouseMove);\n    document.addEventListener('mouseup', documentMouseUp);\n    return {\n      update(node, changedData) {\n        data = changedData;\n        if (!isResizeable(data)) {\n          resizerEl.style.visibility = 'hidden';\n        } else {\n          resizerEl.style.visibility = 'visible';\n        }\n      },\n      destroy(node, data) {\n        element.removeEventListener('mousedown', labelMouseDown);\n        resizerEl.removeEventListener('mousedown', resizerMouseDown);\n        document.removeEventListener('mousemove', documentMouseMove);\n        document.removeEventListener('mouseup', documentMouseUp);\n        resizerEl.remove();\n      }\n    };\n  }\n\n  return function initializePlugin(state, api) {\n    state.update('config.actions.chart-timeline-items-row-item', actions => {\n      actions.push(action);\n      return actions;\n    });\n  };\n}\n","/**\n * SaveAsImage plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0\n */\n\n// @ts-nocheck\nexport default function SaveAsImage(options = {}) {\n  const defaultOptions = {\n    style: 'font-family: sans-serif;',\n    filename: 'gantt-schedule-timeline-calendar.jpeg'\n  };\n  options = { ...defaultOptions, options };\n  function downloadImage(data, filename) {\n    const a = document.createElement('a');\n    a.href = data;\n    a.download = filename;\n    document.body.appendChild(a);\n    a.click();\n  }\n\n  function saveAsImage(ev) {\n    const element = ev.target;\n    const width = element.clientWidth;\n    const height = element.clientHeight;\n    const html = unescape(encodeURIComponent(element.outerHTML));\n    let style = '';\n    for (const styleSheet of document.styleSheets) {\n      if (styleSheet.title === 'gstc') {\n        for (const rule of styleSheet.rules) {\n          style += rule.cssText;\n        }\n      }\n    }\n    style = `<style>* {${options.style}} ${style}</style>`;\n    const svg = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${width}\" height=\"${height}\" viewBox=\"0 0 ${width} ${height}\">\n      <foreignObject x=\"0\" y=\"0\" width=\"${width}\" height=\"${height}\">\n        <div xmlns=\"http://www.w3.org/1999/xhtml\">\n          ${style}\n          ${html}\n        </div>\n      </foreignObject>\n    </svg>`;\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = 'white';\n    ctx.fillRect(0, 0, width, height);\n    const svg64 = 'data:image/svg+xml;base64,' + btoa(svg);\n    const img = new Image();\n    img.onload = function onLoad() {\n      ctx.drawImage(img, 0, 0);\n      const jpeg = canvas.toDataURL('image/jpeg', 1.0);\n      downloadImage(jpeg, options.filename);\n    };\n    img.src = svg64;\n  }\n\n  return function initializePlugin(state, api) {\n    state.subscribe('_internal.elements.main', main => {\n      if (main) {\n        main.addEventListener('save-as-image', saveAsImage);\n      }\n    });\n  };\n}\n"],"names":["ItemHold","options","time","movementThreshold","[object Object]","element","data","holding","mouse","x","y","onMouseUp","itemId","action","elementMouseDown","event","item","id","setTimeout","exec","xMovement","Math","sign","yMovement","onMouseDown","onMouseMove","addEventListener","document","changedData","removeEventListener","state","api","update","actions","push","ItemMovement","moveable","resizeable","resizerContent","collisionDetection","outOfBorders","snapStart","timeStart","startDiff","snapEnd","timeEnd","endDiff","ghostNode","movementState","node","querySelector","isResizeable","hasOwnProperty","row","getMovement","moving","resizing","moveGhost","ev","movement","left","ganttLeft","itemLeftCompensation","ghost","style","top","ganttTop","itemTop","destroyGhost","get","removeChild","opacity","getSnapStart","getSnapEnd","resizerHTML","getClass","insertAdjacentHTML","resizerEl","labelMouseDown","button","chartLeftTime","timePerPixel","ganttRect","getBoundingClientRect","itemX","round","start","cloneNode","getComputedStyle","position","offsetTop","width","height","clientHeight","appendChild","createGhost","resizerMouseDown","stopPropagation","end","isCollision","rowId","from","to","diff","date","rowItem","_internal","items","documentMouseMove","zoom","isMoveable","Array","isArray","includes","add","originalStart","finalAdd","collision","movementX","visibleRowsIndex","visibleRows","index","currentRow","movementY","length","newRow","newRowId","leftGlobal","originalEnd","resizeX","documentMouseUp","visibility","remove","SaveAsImage","saveAsImage","target","clientWidth","html","unescape","encodeURIComponent","outerHTML","styleSheet","styleSheets","title","rule","rules","cssText","svg","canvas","createElement","ctx","getContext","fillStyle","fillRect","svg64","btoa","img","Image","onload","drawImage","filename","a","href","download","body","click","downloadImage","toDataURL","src","subscribe","main"],"mappings":"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"}