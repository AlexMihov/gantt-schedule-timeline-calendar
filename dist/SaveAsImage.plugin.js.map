{"version":3,"file":"SaveAsImage.plugin.js","sources":["../src/plugins/SaveAsImage.plugin.js"],"sourcesContent":["/**\n * SaveAsImage plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0\n */\n\n// @ts-nocheck\nexport default function SaveAsImage(options = {}) {\n  const defaultOptions = {\n    style: 'font-family: sans-serif;',\n    filename: 'gantt-schedule-timeline-calendar.jpeg'\n  };\n  options = { ...defaultOptions, options };\n  function downloadImage(data, filename) {\n    const a = document.createElement('a');\n    a.href = data;\n    a.download = filename;\n    document.body.appendChild(a);\n    a.click();\n  }\n\n  function saveAsImage(ev) {\n    const element = ev.target;\n    const width = element.clientWidth;\n    const height = element.clientHeight;\n    const html = unescape(encodeURIComponent(element.outerHTML));\n    let style = '';\n    for (const styleSheet of document.styleSheets) {\n      if (styleSheet.title === 'gstc') {\n        for (const rule of styleSheet.rules) {\n          style += rule.cssText;\n        }\n      }\n    }\n    style = `<style>* {${options.style}} ${style}</style>`;\n    const svg = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${width}\" height=\"${height}\" viewBox=\"0 0 ${width} ${height}\">\n      <foreignObject x=\"0\" y=\"0\" width=\"${width}\" height=\"${height}\">\n        <div xmlns=\"http://www.w3.org/1999/xhtml\">\n          ${style}\n          ${html}\n        </div>\n      </foreignObject>\n    </svg>`;\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = 'white';\n    ctx.fillRect(0, 0, width, height);\n    const svg64 = 'data:image/svg+xml;base64,' + btoa(svg);\n    const img = new Image();\n    img.onload = function onLoad() {\n      ctx.drawImage(img, 0, 0);\n      const jpeg = canvas.toDataURL('image/jpeg', 1.0);\n      downloadImage(jpeg, options.filename);\n    };\n    img.src = svg64;\n  }\n\n  return function initializePlugin(state, api) {\n    state.subscribe('_internal.elements.main', main => {\n      if (main) {\n        main.addEventListener('save-as-image', saveAsImage);\n      }\n    });\n  };\n}\n"],"names":[],"mappings":"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"}