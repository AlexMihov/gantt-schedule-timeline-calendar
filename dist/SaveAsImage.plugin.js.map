{"version":3,"file":"SaveAsImage.plugin.js","sources":["../src/plugins/SaveAsImage.plugin.ts"],"sourcesContent":["/**\n * SaveAsImage plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\n// @ts-nocheck\nexport default function SaveAsImage(options = {}) {\n  const defaultOptions = {\n    style: 'font-family: sans-serif;',\n    filename: 'gantt-schedule-timeline-calendar.jpeg'\n  };\n  options = { ...defaultOptions, options };\n  function downloadImage(data, filename) {\n    const a = document.createElement('a');\n    a.href = data;\n    a.download = filename;\n    document.body.appendChild(a);\n    a.click();\n  }\n\n  function saveAsImage(ev) {\n    const element = ev.target;\n    const width = element.clientWidth;\n    const height = element.clientHeight;\n    const html = unescape(encodeURIComponent(element.outerHTML));\n    let style = '';\n    for (const styleSheet of document.styleSheets) {\n      if (styleSheet.title === 'gstc') {\n        for (const rule of styleSheet.rules) {\n          style += rule.cssText;\n        }\n      }\n    }\n    style = `<style>* {${options.style}} ${style}</style>`;\n    const svg = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${width}\" height=\"${height}\" viewBox=\"0 0 ${width} ${height}\">\n      <foreignObject x=\"0\" y=\"0\" width=\"${width}\" height=\"${height}\">\n        <div xmlns=\"http://www.w3.org/1999/xhtml\">\n          ${style}\n          ${html}\n        </div>\n      </foreignObject>\n    </svg>`;\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = 'white';\n    ctx.fillRect(0, 0, width, height);\n    const svg64 = 'data:image/svg+xml;base64,' + btoa(svg);\n    const img = new Image();\n    img.onload = function onLoad() {\n      ctx.drawImage(img, 0, 0);\n      const jpeg = canvas.toDataURL('image/jpeg', 1.0);\n      downloadImage(jpeg, options.filename);\n    };\n    img.src = svg64;\n  }\n\n  return function initialize(vido) {\n    vido.state.subscribe('_internal.elements.main', main => {\n      if (main) {\n        main.addEventListener('save-as-image', saveAsImage);\n      }\n    });\n  };\n}\n"],"names":[],"mappings":";;;;;;EAAA;;;;;;;;;EAUA;AACA,WAAwB,WAAW,CAAC,OAAO,GAAG,EAAE;MAC9C,MAAM,cAAc,GAAG;UACrB,KAAK,EAAE,0BAA0B;UACjC,QAAQ,EAAE,uCAAuC;OAClD,CAAC;MACF,OAAO,mCAAQ,cAAc,KAAE,OAAO,GAAE,CAAC;MACzC,SAAS,aAAa,CAAC,IAAI,EAAE,QAAQ;UACnC,MAAM,CAAC,GAAG,QAAQ,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;UACtC,CAAC,CAAC,IAAI,GAAG,IAAI,CAAC;UACd,CAAC,CAAC,QAAQ,GAAG,QAAQ,CAAC;UACtB,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;UAC7B,CAAC,CAAC,KAAK,EAAE,CAAC;OACX;MAED,SAAS,WAAW,CAAC,EAAE;UACrB,MAAM,OAAO,GAAG,EAAE,CAAC,MAAM,CAAC;UAC1B,MAAM,KAAK,GAAG,OAAO,CAAC,WAAW,CAAC;UAClC,MAAM,MAAM,GAAG,OAAO,CAAC,YAAY,CAAC;UACpC,MAAM,IAAI,GAAG,QAAQ,CAAC,kBAAkB,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC;UAC7D,IAAI,KAAK,GAAG,EAAE,CAAC;UACf,KAAK,MAAM,UAAU,IAAI,QAAQ,CAAC,WAAW,EAAE;cAC7C,IAAI,UAAU,CAAC,KAAK,KAAK,MAAM,EAAE;kBAC/B,KAAK,MAAM,IAAI,IAAI,UAAU,CAAC,KAAK,EAAE;sBACnC,KAAK,IAAI,IAAI,CAAC,OAAO,CAAC;mBACvB;eACF;WACF;UACD,KAAK,GAAG,aAAa,OAAO,CAAC,KAAK,KAAK,KAAK,UAAU,CAAC;UACvD,MAAM,GAAG,GAAG,kDAAkD,KAAK,aAAa,MAAM,kBAAkB,KAAK,IAAI,MAAM;0CACjF,KAAK,aAAa,MAAM;;YAEtD,KAAK;YACL,IAAI;;;WAGL,CAAC;UACR,MAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;UAChD,MAAM,CAAC,KAAK,GAAG,KAAK,CAAC;UACrB,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC;UACvB,MAAM,GAAG,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;UACpC,GAAG,CAAC,SAAS,GAAG,OAAO,CAAC;UACxB,GAAG,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;UAClC,MAAM,KAAK,GAAG,4BAA4B,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC;UACvD,MAAM,GAAG,GAAG,IAAI,KAAK,EAAE,CAAC;UACxB,GAAG,CAAC,MAAM,GAAG,SAAS,MAAM;cAC1B,GAAG,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;cACzB,MAAM,IAAI,GAAG,MAAM,CAAC,SAAS,CAAC,YAAY,EAAE,GAAG,CAAC,CAAC;cACjD,aAAa,CAAC,IAAI,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAC;WACvC,CAAC;UACF,GAAG,CAAC,GAAG,GAAG,KAAK,CAAC;OACjB;MAED,OAAO,SAAS,UAAU,CAAC,IAAI;UAC7B,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,yBAAyB,EAAE,IAAI;cAClD,IAAI,IAAI,EAAE;kBACR,IAAI,CAAC,gBAAgB,CAAC,eAAe,EAAE,WAAW,CAAC,CAAC;eACrD;WACF,CAAC,CAAC;OACJ,CAAC;EACJ,CAAC;;;;;;;;"}