const t="chart-timeline-grid-row-cell",e="chart-timeline-items-row-item";function i(t={}){const e={enabled:!0,isMoving:!1,pointerState:"up",currentTarget:null,realTarget:null,targetType:"",targetData:null,offset:{top:0,left:0},captureEvents:{down:!1,up:!1,move:!1},initialPosition:{x:0,y:0},currentPosition:{x:0,y:0},events:{down:null,move:null,up:null}};return t.captureEvents&&(e.captureEvents=Object.assign(Object.assign({},e.captureEvents),t.captureEvents)),e}const s="config.plugin.TimelinePointer";class n{constructor(n,a){this.unsub=[],this.classNames={cell:"",item:""},this.vido=a,this.api=a.api,this.state=a.state,this.element=this.state.get("$data.elements.chart-timeline"),this.pointerDown=this.pointerDown.bind(this),this.pointerMove=this.pointerMove.bind(this),this.pointerUp=this.pointerUp.bind(this),this.data=i(n),this.classNames.cell=this.api.getClass(t),this.classNames.item=this.api.getClass(e),this.destroy=this.destroy.bind(this),this.element.addEventListener("pointerdown",this.pointerDown),document.addEventListener("pointerup",this.pointerUp),document.addEventListener("pointermove",this.pointerMove),this.unsub.push(this.state.subscribe(s,t=>this.data=t)),this.unsub.push(this.state.subscribe("config.scroll.vertical.offset",t=>{this.data.offset.left=t,this.updateData()}))}destroy(){this.element.removeEventListener("pointerdown",this.pointerDown),document.removeEventListener("pointerup",this.pointerUp),document.removeEventListener("pointermove",this.pointerMove)}updateData(){this.state.update(s,()=>Object.assign({},this.data))}getRealTarget(t){let e=t.target.closest("."+this.classNames.item);return e||(e=t.target.closest("."+this.classNames.cell),e||null)}getRealPosition(t){const e={x:0,y:0};if(this.element){const i=this.element.getBoundingClientRect();e.x=t.x-i.x,e.y=t.y-i.y;const s=this.state.get("config.scroll.vertical.offset")||0;e.y+=s}return e}pointerDown(i){if(!this.data.enabled)return;this.data.pointerState="down",this.data.currentTarget=i.target,this.data.realTarget=this.getRealTarget(i),this.data.realTarget?this.data.realTarget.classList.contains(this.classNames.item)?(this.data.targetType=e,this.data.targetData=this.data.realTarget.vido.item):this.data.realTarget.classList.contains(this.classNames.cell)?(this.data.targetType=t,this.data.targetData=this.data.realTarget.vido):this.data.targetType="":(this.data.targetType="",this.data.targetData=null),this.data.isMoving=!!this.data.realTarget,this.data.events.down=i,this.data.events.move=i;const s=this.getRealPosition(i);this.data.initialPosition=s,this.data.currentPosition=s,this.updateData()}pointerUp(t){this.data.enabled&&(this.data.pointerState="up",this.data.isMoving=!1,this.data.events.up=t,this.data.currentPosition=this.getRealPosition(t),this.updateData())}pointerMove(t){this.data.enabled&&this.data.isMoving&&(this.data.pointerState="move",this.data.events.move=t,this.data.currentPosition=this.getRealPosition(t),this.updateData())}}var a=Object.freeze({__proto__:null,CELL:t,ITEM:e,Plugin:function(t){return function(e){const a=i(t);let o;e.state.update(s,a);const r=e.state.subscribe("$data.elements.chart-timeline",i=>{if(i){o&&o();const i=new n(t,e);o=i.destroy}});return function(){r(),o&&o()}}}});var o=Object.freeze({__proto__:null,default:function(t={}){let e;const i={time:1e3,movementThreshold:2,action(t,e){}};t=Object.assign(Object.assign({},i),t);const s={},n={x:0,y:0};function a(t){void 0!==s[t]&&delete s[t]}function o(e,i){function o(a){!function(e,i,a){void 0===s[e.id]&&(s[e.id]={x:a.x,y:a.y},a.stopPropagation(),a.preventDefault(),setTimeout(()=>{if(void 0!==s[e.id]){let a=!0;const o=Math.abs(s[e.id].x-n.x),r=Math.abs(s[e.id].y-n.y);o>t.movementThreshold&&(a=!1),r>t.movementThreshold&&(a=!1),delete s[e.id],a&&t.action(i,e)}},t.time))}(i.item,e,a)}function r(t){n.x=t.x,n.y=t.y}return e.addEventListener("pointerdown",o),document.addEventListener("pointerup",(function(){a(i.item.id)})),document.addEventListener("pointermove",r),{update(t,e){i=e},destroy(t,e){document.removeEventListener("pointerup",a),document.removeEventListener("poitnermove",r),t.removeEventListener("pointerdown",o)}}}return function(t){e=t.api,t.state.update("config.actions.chart-timeline-items-row-item",t=>(t.push(o),t))}}});function r(t){return t&&"object"==typeof t&&!Array.isArray(t)}function h(t,...e){const i=e.shift();if(r(t)&&r(i))for(const e in i)if(r(i[e]))"function"==typeof i[e].clone?t[e]=i[e].clone():(void 0===t[e]&&(t[e]={}),t[e]=h(t[e],i[e]));else if(Array.isArray(i[e])){t[e]=new Array(i[e].length);let s=0;for(let n of i[e])r(n)?"function"==typeof n.clone?t[e][s]=n.clone():t[e][s]=h({},n):t[e][s]=n,s++}else t[e]=i[e];return e.length?h(t,...e):t}const d="config.plugin.ItemMovement";class l{constructor(t){this.onDestroy=[],this.cumulations={},this.relativeVerticalPosition={},this.vido=t,this.api=t.api,this.state=t.state,this.merge=this.state.get("config.merge"),this.destroy=this.destroy.bind(this),this.onDestroy.push(this.state.subscribe(d,t=>{this.data=t,t.enabled?document.body.classList.add(this.data.bodyClass):document.body.classList.remove(this.data.bodyClass)})),this.data.className||(this.data.className=this.api.getClass("chart-timeline-items-row-item--moving")),this.onSelectionChange=this.onSelectionChange.bind(this),this.onDestroy.push(this.state.subscribe("config.plugin.Selection",this.onSelectionChange))}destroy(){this.onDestroy.forEach(t=>t())}updateData(){this.state.update(d,Object.assign({},this.data))}clearCumulationsForItems(){this.cumulations={}}setStartCumulationForItem(t,e){this.cumulations[t.id]||(this.cumulations[t.id]={start:0,end:0}),this.cumulations[t.id].start=e}getStartCumulationForItem(t){var e;return(null===(e=this.cumulations[t.id])||void 0===e?void 0:e.start)||0}getItemMovingTimes(t,e){const i=this.data.movement.px.horizontal,s=this.api.time.getViewOffsetPxFromDates(t.$data.time.startDate,!1,e)+i+this.getStartCumulationForItem(t),n=this.api.time.getTimeFromViewOffsetPx(s,e),a=this.data.snapToTime.start({startTime:this.api.time.date(n),item:t,time:e,movement:this.data.movement,vido:this.vido}),o=this.api.time.getDatesDiffPx(a,this.api.time.date(n),e,!0);this.setStartCumulationForItem(t,o);const r=t.$data.time.endDate.diff(t.$data.time.startDate,"millisecond"),h=a.add(r,"millisecond").valueOf(),d=this.api.time.date(h);return{startTime:a,endTime:this.data.snapToTime.end({endTime:d,item:t,time:e,movement:this.data.movement,vido:this.vido})}}findRowAtViewPosition(t,e){const i=this.state.get("$data.list.visibleRows");for(const e of i){const i=e.$data.position.viewTop+e.$data.outerHeight;if(e.$data.position.viewTop<=t&&i>=t)return e}return e}getItemViewTop(t){return this.state.get("config.list.rows")[t.rowId].$data.position.viewTop+t.$data.position.actualTop}saveItemsRelativeVerticalPosition(){for(const t of this.data.moving){const e=this.data.position.y-this.getItemViewTop(t);this.setItemRelativeVerticalPosition(t,e)}}setItemRelativeVerticalPosition(t,e){this.relativeVerticalPosition[t.id]=e}getItemRelativeVerticalPosition(t){return this.relativeVerticalPosition[t.id]}moveItemVertically(t){const e=this.state.get("config.list.rows")[t.rowId],i=this.getItemRelativeVerticalPosition(t),s=this.data.position.y+i;return this.findRowAtViewPosition(s,e)}getEventArgument(t){const e=this.state.get("config.chart.items"),i=[];for(const s of t)i.push(this.merge({},e[s.id]));return{items:{initial:this.data.initialItems,before:i,after:t,targetData:this.merge({},this.data.targetData)},vido:this.vido,state:this.state,time:this.state.get("$data.chart.time")}}moveItems(){if(!this.data.enabled)return;const t=this.state.get("$data.chart.time"),e=this.data.moving.map(t=>this.merge({},t));this.data.debug&&console.log("moveItems",e);for(let i of e){i.rowId=this.moveItemVertically(i).id;const e=this.getItemMovingTimes(i,t);e.startTime.valueOf()===i.time.start&&e.endTime.valueOf()===i.time.end||(i.time.start=e.startTime.valueOf(),i.time.end=e.endTime.valueOf(),i.$data.time.startDate=e.startTime,i.$data.time.endDate=e.endTime)}this.dispatchEvent("onMove",e)}clearSelection(){this.data.moving=[],this.data.initialItems=[],this.data.movement.px.horizontal=0,this.data.movement.px.vertical=0,this.data.movement.time=0,this.data.pointerState="up",this.data.pointerMoved=!1}dispatchEvent(t,e){e=e.map(t=>this.merge({},t));const i=this.data.events[t](this.getEventArgument(e));let s=this.state.multi();for(const t of i)s=s.update(`config.chart.items.${t.id}`,e=>(h(e,t),e));s.done(),this.data.moving=i}onStart(){this.data.initialItems=this.data.moving.map(t=>this.merge({},t)),this.clearCumulationsForItems(),document.body.classList.add(this.data.bodyClassMoving),this.data.position=Object.assign({},this.selection.currentPosition),this.data.lastMovement.time=this.data.moving[0].time.start,this.saveItemsRelativeVerticalPosition();const t=this.data.initialItems.map(t=>this.merge({},t));this.dispatchEvent("onStart",t)}onEnd(){const t=this.data.moving.map(t=>this.merge({},t));this.dispatchEvent("onEnd",t),document.body.classList.remove(this.data.bodyClassMoving),this.clearSelection(),this.clearCumulationsForItems()}onSelectionChange(t){if(this.data.enabled){if(this.selection=Object.assign({},t),this.selection.targetType!==e)return this.clearSelection();if("up"===this.data.pointerState&&"down"===this.selection.pointerState)this.data.state="start";else if("down"!==this.data.pointerState&&"move"!==this.data.pointerState||"up"!==this.selection.pointerState){if("move"!==this.selection.pointerState)return this.data.state="",this.updateData();this.data.state="move"}else this.data.state="end";if(this.selection.events.move&&(this.selection.events.move.preventDefault(),this.selection.events.move.stopPropagation()),this.selection.events.down&&(this.selection.events.down.preventDefault(),this.selection.events.down.stopPropagation()),this.data.pointerState=this.selection.pointerState,this.data.targetData=Object.assign({},this.selection.targetData),"end"===this.data.state&&this.onEnd(),this.data.moving=this.selection.selected[e].map(t=>this.merge({},t)),this.data.debug&&console.log("state",this.data.pointerState),"start"===this.data.state&&this.onStart(),"move"!==this.data.state&&"start"!==this.data.state||(this.data.lastMovement.x=this.data.movement.px.horizontal,this.data.lastMovement.y=this.data.movement.px.vertical,this.data.movement.px.horizontal=this.selection.currentPosition.x-this.data.position.x,this.data.movement.px.vertical=this.selection.currentPosition.y-this.data.position.y,this.data.movement.time=this.data.moving[0].time.start-this.data.lastMovement.time,this.data.position.x=this.selection.currentPosition.x,this.data.position.y=this.selection.currentPosition.y,this.data.lastMovement.time=this.data.moving[0].time.start),"move"===this.data.state&&this.data.lastMovement.x===this.data.movement.px.horizontal&&this.data.lastMovement.y===this.data.movement.px.vertical)return this.updateData();"move"===this.data.state&&this.moveItems(),this.updateData()}}}var c=Object.freeze({__proto__:null,Plugin:function(t={}){return function(e){return e.state.update(d,function(t){const e={onStart:({items:t})=>t.after,onMove:({items:t})=>t.after,onEnd:({items:t})=>t.after},i={start:({startTime:t,time:e})=>t.startOf(e.period),end:({endTime:t,time:e})=>t.endOf(e.period)},s=Object.assign({debug:!1,moving:[],targetData:null,initialItems:[],pointerState:"up",pointerMoved:!1,state:"",position:{x:0,y:0},movement:{px:{horizontal:0,vertical:0},time:0},lastMovement:{x:0,y:0,time:0},events:Object.assign({},e),snapToTime:Object.assign({},i)},t);return t.snapToTime&&(s.snapToTime=Object.assign(Object.assign({},i),t.snapToTime)),t.events&&(s.events=Object.assign(Object.assign({},e),t.events)),s}(function(t){return Object.assign({enabled:!0,className:"",bodyClass:"gstc-item-movement",bodyClassMoving:"gstc-items-moving"},t)}(t))),new l(e).destroy}}}),u=function(){if("undefined"!=typeof Map)return Map;function t(t,e){var i=-1;return t.some((function(t,s){return t[0]===e&&(i=s,!0)})),i}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(e){var i=t(this.__entries__,e),s=this.__entries__[i];return s&&s[1]},e.prototype.set=function(e,i){var s=t(this.__entries__,e);~s?this.__entries__[s][1]=i:this.__entries__.push([e,i])},e.prototype.delete=function(e){var i=this.__entries__,s=t(i,e);~s&&i.splice(s,1)},e.prototype.has=function(e){return!!~t(this.__entries__,e)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,e){void 0===e&&(e=null);for(var i=0,s=this.__entries__;i<s.length;i++){var n=s[i];t.call(e,n[1],n[0])}},e}()}(),m="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,p="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),f="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(p):function(t){return setTimeout((function(){return t(Date.now())}),1e3/60)};var g=["top","right","bottom","left","width","height","size","weight"],v="undefined"!=typeof MutationObserver,y=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(t,e){var i=!1,s=!1,n=0;function a(){i&&(i=!1,t()),s&&r()}function o(){f(a)}function r(){var t=Date.now();if(i){if(t-n<2)return;s=!0}else i=!0,s=!1,setTimeout(o,e);n=t}return r}(this.refresh.bind(this),20)}return t.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},t.prototype.removeObserver=function(t){var e=this.observers_,i=e.indexOf(t);~i&&e.splice(i,1),!e.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},t.prototype.updateObservers_=function(){var t=this.observers_.filter((function(t){return t.gatherActive(),t.hasActive()}));return t.forEach((function(t){return t.broadcastActive()})),t.length>0},t.prototype.connect_=function(){m&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),v?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){m&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(t){var e=t.propertyName,i=void 0===e?"":e;g.some((function(t){return!!~i.indexOf(t)}))&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),b=function(t,e){for(var i=0,s=Object.keys(e);i<s.length;i++){var n=s[i];Object.defineProperty(t,n,{value:e[n],enumerable:!1,writable:!1,configurable:!0})}return t},w=function(t){return t&&t.ownerDocument&&t.ownerDocument.defaultView||p},$=O(0,0,0,0);function D(t){return parseFloat(t)||0}function M(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return e.reduce((function(e,i){return e+D(t["border-"+i+"-width"])}),0)}function S(t){var e=t.clientWidth,i=t.clientHeight;if(!e&&!i)return $;var s=w(t).getComputedStyle(t),n=function(t){for(var e={},i=0,s=["top","right","bottom","left"];i<s.length;i++){var n=s[i],a=t["padding-"+n];e[n]=D(a)}return e}(s),a=n.left+n.right,o=n.top+n.bottom,r=D(s.width),h=D(s.height);if("border-box"===s.boxSizing&&(Math.round(r+a)!==e&&(r-=M(s,"left","right")+a),Math.round(h+o)!==i&&(h-=M(s,"top","bottom")+o)),!function(t){return t===w(t).document.documentElement}(t)){var d=Math.round(r+a)-e,l=Math.round(h+o)-i;1!==Math.abs(d)&&(r-=d),1!==Math.abs(l)&&(h-=l)}return O(n.left,n.top,r,h)}var _="undefined"!=typeof SVGGraphicsElement?function(t){return t instanceof w(t).SVGGraphicsElement}:function(t){return t instanceof w(t).SVGElement&&"function"==typeof t.getBBox};function T(t){return m?_(t)?function(t){var e=t.getBBox();return O(0,0,e.width,e.height)}(t):S(t):$}function O(t,e,i,s){return{x:t,y:e,width:i,height:s}}var x=function(){function t(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=O(0,0,0,0),this.target=t}return t.prototype.isActive=function(){var t=T(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},t}(),P=function(t,e){var i,s,n,a,o,r,h,d=(s=(i=e).x,n=i.y,a=i.width,o=i.height,r="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,h=Object.create(r.prototype),b(h,{x:s,y:n,width:a,height:o,top:n,right:s+a,bottom:o+n,left:s}),h);b(this,{target:t,contentRect:d})},I=function(){function t(t,e,i){if(this.activeObservations_=[],this.observations_=new u,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=e,this.callbackCtx_=i}return t.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof w(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new x(t)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof w(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach((function(e){e.isActive()&&t.activeObservations_.push(e)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map((function(t){return new P(t.target,t.broadcastRect())}));this.callback_.call(t,e,t),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),L="undefined"!=typeof WeakMap?new WeakMap:new u,E=function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=y.getInstance(),s=new I(e,i,this);L.set(this,s)};["observe","unobserve","disconnect"].forEach((function(t){E.prototype[t]=function(){var e;return(e=L.get(this))[t].apply(e,arguments)}}));void 0!==p.ResizeObserver&&p.ResizeObserver;class C{constructor(){this.isAction=!0}}C.prototype.isAction=!0;String(Math.random()).slice(2),document.createComment(""),document.createElement("template"),document.createTextNode("");let A=!1;(()=>{try{const t={get capture(){return A=!0,!1}};window.addEventListener("test",t,t),window.removeEventListener("test",t,t)}catch(t){}})(),"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.1.7");document.createElement("template"),document.createTextNode("");"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function R(t,e){return t(e={exports:{}},e.exports),e.exports}R((function(t,e){t.exports=function(){var t="millisecond",e="second",i="minute",s="hour",n="day",a="week",o="month",r="quarter",h="year",d=/^(\d{4})-?(\d{1,2})-?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d{1,3})?$/,l=/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,c=function(t,e,i){var s=String(t);return!s||s.length>=e?t:""+Array(e+1-s.length).join(i)+t},u={s:c,z:function(t){var e=-t.utcOffset(),i=Math.abs(e),s=Math.floor(i/60),n=i%60;return(e<=0?"+":"-")+c(s,2,"0")+":"+c(n,2,"0")},m:function(t,e){var i=12*(e.year()-t.year())+(e.month()-t.month()),s=t.clone().add(i,o),n=e-s<0,a=t.clone().add(i+(n?-1:1),o);return Number(-(i+(e-s)/(n?s-a:a-s))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(d){return{M:o,y:h,w:a,d:n,D:"date",h:s,m:i,s:e,ms:t,Q:r}[d]||String(d||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},m={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},p="en",f={};f[p]=m;var g=function(t){return t instanceof w},v=function(t,e,i){var s;if(!t)return p;if("string"==typeof t)f[t]&&(s=t),e&&(f[t]=e,s=t);else{var n=t.name;f[n]=t,s=n}return!i&&s&&(p=s),s||!i&&p},y=function(t,e,i){if(g(t))return t.clone();var s=e?"string"==typeof e?{format:e,pl:i}:e:{};return s.date=t,new w(s)},b=u;b.l=v,b.i=g,b.w=function(t,e){return y(t,{locale:e.$L,utc:e.$u,$offset:e.$offset})};var w=function(){function c(t){this.$L=this.$L||v(t.locale,null,!0),this.parse(t)}var u=c.prototype;return u.parse=function(t){this.$d=function(t){var e=t.date,i=t.utc;if(null===e)return new Date(NaN);if(b.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var s=e.match(d);if(s)return i?new Date(Date.UTC(s[1],s[2]-1,s[3]||1,s[4]||0,s[5]||0,s[6]||0,s[7]||0)):new Date(s[1],s[2]-1,s[3]||1,s[4]||0,s[5]||0,s[6]||0,s[7]||0)}return new Date(e)}(t),this.init()},u.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},u.$utils=function(){return b},u.isValid=function(){return!("Invalid Date"===this.$d.toString())},u.isSame=function(t,e){var i=y(t);return this.startOf(e)<=i&&i<=this.endOf(e)},u.isAfter=function(t,e){return y(t)<this.startOf(e)},u.isBefore=function(t,e){return this.endOf(e)<y(t)},u.$g=function(t,e,i){return b.u(t)?this[e]:this.set(i,t)},u.year=function(t){return this.$g(t,"$y",h)},u.month=function(t){return this.$g(t,"$M",o)},u.day=function(t){return this.$g(t,"$W",n)},u.date=function(t){return this.$g(t,"$D","date")},u.hour=function(t){return this.$g(t,"$H",s)},u.minute=function(t){return this.$g(t,"$m",i)},u.second=function(t){return this.$g(t,"$s",e)},u.millisecond=function(e){return this.$g(e,"$ms",t)},u.unix=function(){return Math.floor(this.valueOf()/1e3)},u.valueOf=function(){return this.$d.getTime()},u.startOf=function(t,r){var d=this,l=!!b.u(r)||r,c=b.p(t),u=function(t,e){var i=b.w(d.$u?Date.UTC(d.$y,e,t):new Date(d.$y,e,t),d);return l?i:i.endOf(n)},m=function(t,e){return b.w(d.toDate()[t].apply(d.toDate(),(l?[0,0,0,0]:[23,59,59,999]).slice(e)),d)},p=this.$W,f=this.$M,g=this.$D,v="set"+(this.$u?"UTC":"");switch(c){case h:return l?u(1,0):u(31,11);case o:return l?u(1,f):u(0,f+1);case a:var y=this.$locale().weekStart||0,w=(p<y?p+7:p)-y;return u(l?g-w:g+(6-w),f);case n:case"date":return m(v+"Hours",0);case s:return m(v+"Minutes",1);case i:return m(v+"Seconds",2);case e:return m(v+"Milliseconds",3);default:return this.clone()}},u.endOf=function(t){return this.startOf(t,!1)},u.$set=function(a,r){var d,l=b.p(a),c="set"+(this.$u?"UTC":""),u=(d={},d.day=c+"Date",d.date=c+"Date",d[o]=c+"Month",d[h]=c+"FullYear",d[s]=c+"Hours",d[i]=c+"Minutes",d[e]=c+"Seconds",d[t]=c+"Milliseconds",d)[l],m=l===n?this.$D+(r-this.$W):r;if(l===o||l===h){var p=this.clone().set("date",1);p.$d[u](m),p.init(),this.$d=p.set("date",Math.min(this.$D,p.daysInMonth())).toDate()}else u&&this.$d[u](m);return this.init(),this},u.set=function(t,e){return this.clone().$set(t,e)},u.get=function(t){return this[b.p(t)]()},u.add=function(t,r){var d,l=this;t=Number(t);var c=b.p(r),u=function(e){var i=y(l);return b.w(i.date(i.date()+Math.round(e*t)),l)};if(c===o)return this.set(o,this.$M+t);if(c===h)return this.set(h,this.$y+t);if(c===n)return u(1);if(c===a)return u(7);var m=(d={},d[i]=6e4,d[s]=36e5,d[e]=1e3,d)[c]||1,p=this.$d.getTime()+t*m;return b.w(p,this)},u.subtract=function(t,e){return this.add(-1*t,e)},u.format=function(t){var e=this;if(!this.isValid())return"Invalid Date";var i=t||"YYYY-MM-DDTHH:mm:ssZ",s=b.z(this),n=this.$locale(),a=this.$H,o=this.$m,r=this.$M,h=n.weekdays,d=n.months,c=function(t,s,n,a){return t&&(t[s]||t(e,i))||n[s].substr(0,a)},u=function(t){return b.s(a%12||12,t,"0")},m=n.meridiem||function(t,e,i){var s=t<12?"AM":"PM";return i?s.toLowerCase():s},p={YY:String(this.$y).slice(-2),YYYY:this.$y,M:r+1,MM:b.s(r+1,2,"0"),MMM:c(n.monthsShort,r,d,3),MMMM:d[r]||d(this,i),D:this.$D,DD:b.s(this.$D,2,"0"),d:String(this.$W),dd:c(n.weekdaysMin,this.$W,h,2),ddd:c(n.weekdaysShort,this.$W,h,3),dddd:h[this.$W],H:String(a),HH:b.s(a,2,"0"),h:u(1),hh:u(2),a:m(a,o,!0),A:m(a,o,!1),m:String(o),mm:b.s(o,2,"0"),s:String(this.$s),ss:b.s(this.$s,2,"0"),SSS:b.s(this.$ms,3,"0"),Z:s};return i.replace(l,(function(t,e){return e||p[t]||s.replace(":","")}))},u.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},u.diff=function(t,n,d){var l,c=b.p(n),u=y(t),m=6e4*(u.utcOffset()-this.utcOffset()),p=this-u,f=b.m(this,u);return f=(l={},l[h]=f/12,l[o]=f,l[r]=f/3,l[a]=(p-m)/6048e5,l.day=(p-m)/864e5,l[s]=p/36e5,l[i]=p/6e4,l[e]=p/1e3,l)[c]||p,d?f:b.a(f)},u.daysInMonth=function(){return this.endOf(o).$D},u.$locale=function(){return f[this.$L]},u.locale=function(t,e){if(!t)return this.$L;var i=this.clone(),s=v(t,e,!0);return s&&(i.$L=s),i},u.clone=function(){return b.w(this.$d,this)},u.toDate=function(){return new Date(this.valueOf())},u.toJSON=function(){return this.isValid()?this.toISOString():null},u.toISOString=function(){return this.$d.toISOString()},u.toString=function(){return this.$d.toUTCString()},c}();return y.prototype=w.prototype,y.extend=function(t,e){return t(e,w,y),y},y.locale=v,y.isDayjs=g,y.unix=function(t){return y(1e3*t)},y.en=f[p],y.Ls=f,y}()})),R((function(t,e){t.exports=function(t,e,i){var s=(new Date).getTimezoneOffset(),n=e.prototype;i.utc=function(t,i){return new e({date:t,utc:!0,format:i})},n.utc=function(){return i(this.toDate(),{locale:this.$L,utc:!0})},n.local=function(){return i(this.toDate(),{locale:this.$L,utc:!1})};var a=n.parse;n.parse=function(t){t.utc&&(this.$u=!0),this.$utils().u(t.$offset)||(this.$offset=t.$offset),a.call(this,t)};var o=n.init;n.init=function(){if(this.$u){var t=this.$d;this.$y=t.getUTCFullYear(),this.$M=t.getUTCMonth(),this.$D=t.getUTCDate(),this.$W=t.getUTCDay(),this.$H=t.getUTCHours(),this.$m=t.getUTCMinutes(),this.$s=t.getUTCSeconds(),this.$ms=t.getUTCMilliseconds()}else o.call(this)};var r=n.utcOffset;n.utcOffset=function(t){var e=this.$utils().u;if(e(t))return this.$u?0:e(this.$offset)?r.call(this):this.$offset;var i,n=Math.abs(t)<=16?60*t:t;return 0!==t?(i=this.local().add(n+s,"minute")).$offset=n:i=this.utc(),i};var h=n.format;n.format=function(t){var e=t||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return h.call(this,e)},n.valueOf=function(){var t=this.$utils().u(this.$offset)?0:this.$offset+s;return this.$d.valueOf()-6e4*t},n.isUTC=function(){return!!this.$u},n.toISOString=function(){return this.toDate().toISOString()},n.toString=function(){return this.toDate().toUTCString()}}}));new TextEncoder("utf-8");const z="gantt-schedule-timeline-calendar";const j=function(t){let e=`${z}__${t}`;return t===z&&(e=z),e}("chart-timeline-items-row-item-resizing-handle-content-line");class W{constructor(t,e){this.spacing=1,this.unsubs=[],this.vido=t,this.state=t.state,this.api=t.api,this.data=function(t={}){const e={onStart:({items:t})=>t.after,onResize:({items:t})=>t.after,onEnd:({items:t})=>t.after},i={start:({startTime:t,time:e})=>t.startOf(e.period),end:({endTime:t,time:e})=>t.endOf(e.period)},s={width:18,horizontalMargin:0,verticalMargin:0,outside:!1,onlyWhenSelected:!0},n=Object.assign({enabled:!0,debug:!1,state:"",content:null,bodyClass:"gstc-item-resizing",bodyClassLeft:"gstc-items-resizing-left",bodyClassRight:"gstc-items-resizing-right",initialPosition:{x:0,y:0},currentPosition:{x:0,y:0},movement:{px:0,time:0},initialItems:[],targetData:null,leftIsMoving:!1,rightIsMoving:!1,handle:Object.assign({},s),events:Object.assign({},e),snapToTime:Object.assign({},i)},t);return t.snapToTime&&(n.snapToTime=Object.assign(Object.assign({},i),t.snapToTime)),t.events&&(n.events=Object.assign(Object.assign({},e),t.events)),t.handle&&(n.handle=Object.assign(Object.assign({},s),t.handle)),n}(e),this.merge=this.state.get("config.merge"),this.minWidth=2*this.data.handle.width,this.state.update("config.chart.item.minWidth",this.minWidth),this.state.update("config.chart.items.*.minWidth",this.minWidth),this.html=t.html,this.data.content||(this.data.content=this.html`<div class=${j}></div><div class=${j}></div>`),this.wrapper=this.wrapper.bind(this),this.onRightPointerDown=this.onRightPointerDown.bind(this),this.onRightPointerMove=this.onRightPointerMove.bind(this),this.onRightPointerUp=this.onRightPointerUp.bind(this),this.onLeftPointerDown=this.onLeftPointerDown.bind(this),this.onLeftPointerMove=this.onLeftPointerMove.bind(this),this.onLeftPointerUp=this.onLeftPointerUp.bind(this),this.destroy=this.destroy.bind(this),this.updateData(),document.body.classList.add(this.data.bodyClass),this.unsubs.push(this.state.subscribe("config.plugin.ItemResizing",t=>{t.enabled?t.enabled&&document.body.classList.add(this.data.bodyClass):document.body.classList.remove(this.data.bodyClass),this.data=t})),document.addEventListener("pointermove",this.onLeftPointerMove),document.addEventListener("pointerup",this.onLeftPointerUp),document.addEventListener("pointermove",this.onRightPointerMove),document.addEventListener("pointerup",this.onRightPointerUp),this.state.update("config.wrappers.ChartTimelineItemsRowItem",t=>(this.oldWrapper||(this.oldWrapper=t),this.initializeWrapper(),this.wrapper))}destroy(){this.unsubs.forEach(t=>t()),document.removeEventListener("pointermove",this.onLeftPointerMove),document.removeEventListener("pointerup",this.onLeftPointerUp),document.removeEventListener("pointermove",this.onRightPointerMove),document.removeEventListener("pointerup",this.onRightPointerUp),this.oldWrapper&&this.state.update("config.wrappers.ChartTimelineItemsRowItem",()=>this.oldWrapper)}updateData(){this.state.update("config.plugin.ItemResizing",this.data)}initializeWrapper(){this.leftClassName=this.api.getClass("chart-timeline-items-row-item-resizing-handle"),this.leftClassName+=" "+this.leftClassName+"--left",this.rightClassName=this.api.getClass("chart-timeline-items-row-item-resizing-handle"),this.rightClassName+=" "+this.rightClassName+"--right",this.spacing=this.state.get("config.chart.spacing")}getSelectedItems(){return this.state.get(`config.plugin.Selection.selected.${e}`).map(t=>this.merge({},t))}getRightStyleMap(t,e){const i=new this.vido.StyleMap({});return i.style.top=t.$data.position.actualTop+this.data.handle.verticalMargin+"px",this.data.handle.outside?i.style.left=t.$data.position.right+this.data.handle.horizontalMargin-this.spacing+"px":i.style.left=t.$data.position.right-this.data.handle.width-this.data.handle.horizontalMargin-this.spacing+"px",i.style.width=this.data.handle.width+"px",i.style.height=t.$data.actualHeight-2*this.data.handle.verticalMargin+"px",i}getLeftStyleMap(t,e){const i=new this.vido.StyleMap({});return i.style.top=t.$data.position.actualTop+this.data.handle.verticalMargin+"px",this.data.handle.outside?i.style.left=t.$data.position.left-this.data.handle.width-this.data.handle.horizontalMargin+"px":i.style.left=t.$data.position.left+this.data.handle.horizontalMargin+"px",i.style.width=this.data.handle.width+"px",i.style.height=t.$data.actualHeight-2*this.data.handle.verticalMargin+"px",i}getEventArgument(t){const e=this.state.get("config.chart.items"),i=[];for(const s of t)i.push(this.merge({},e[s.id]));return{items:{initial:this.data.initialItems,before:i,after:t,targetData:this.data.targetData},vido:this.vido,state:this.state,time:this.state.get("$data.chart.time")}}dispatchEvent(t,e){e=e.map(t=>this.merge({},t));const i=this.data.events[t](this.getEventArgument(e));let s=this.state.multi();for(const t of i)s=s.update(`config.chart.items.${t.id}.time`,t.time).update(`config.chart.items.${t.id}.$data`,t.$data);s.done()}getItemsForDiff(){const t=this.getSelectedItems()[0],e=this.data.initialItems.find(e=>e.id===t.id);return{modified:t,original:e}}onPointerDown(t){t.preventDefault(),t.stopPropagation(),this.data.initialItems=this.getSelectedItems(),this.data.targetData=this.merge({},t.target.vido),this.data.initialPosition={x:t.screenX,y:t.screenY},this.data.currentPosition=Object.assign({},this.data.initialPosition),""!==this.data.state&&"end"!==this.data.state||(this.data.state="resize"),this.dispatchEvent("onStart",this.data.initialItems)}onLeftPointerDown(t){this.data.enabled&&(document.body.classList.add(this.data.bodyClassLeft),this.onPointerDown(t),this.data.leftIsMoving=!0,this.updateData())}onRightPointerDown(t){this.data.enabled&&(document.body.classList.add(this.data.bodyClassRight),this.onPointerDown(t),this.data.rightIsMoving=!0,this.updateData())}onPointerMove(t){t.stopPropagation(),t.preventDefault(),this.data.currentPosition.x=t.screenX,this.data.currentPosition.y=t.screenY,this.data.movement.px=this.data.currentPosition.x-this.data.initialPosition.x;const{original:e,modified:i}=this.getItemsForDiff();this.data.movement.time=i.time.start-e.time.start,"resize"!==this.data.state&&"start"!==this.data.state||(this.data.state="resize")}onLeftPointerMove(t){if(!this.data.enabled||!this.data.leftIsMoving)return;this.onPointerMove(t);const e=this.getSelectedItems(),i=this.merge({},this.data.movement),s=this.state.get("$data.chart.time");for(let t=0,n=e.length;t<n;t++){const n=e[t];n.$data.position.left=this.data.initialItems[t].$data.position.left+i.px,n.$data.position.left>n.$data.position.right&&(n.$data.position.left=n.$data.position.right),n.$data.position.actualLeft=n.$data.position.left,n.$data.width=n.$data.position.right-n.$data.position.left,n.$data.width<n.minWidth&&(n.$data.width=n.minWidth),n.$data.actualWidth=n.$data.width;const a=this.api.time.getTimeFromViewOffsetPx(n.$data.position.left,s,!0),o=this.data.snapToTime.start({startTime:this.api.time.date(a),item:n,time:s,movement:i,vido:this.vido});n.time.start=o.valueOf(),n.$data.time.startDate=o}this.dispatchEvent("onResize",e),this.updateData()}onRightPointerMove(t){if(!this.data.enabled||!this.data.rightIsMoving)return;this.onPointerMove(t);const e=this.getSelectedItems(),i=this.data.movement,s=this.state.get("$data.chart.time");for(let t=0,n=e.length;t<n;t++){const n=e[t];n.$data.width=this.data.initialItems[t].$data.width+i.px,n.$data.width<n.minWidth&&(n.$data.width=n.minWidth);const a=n.$data.position.actualLeft===n.$data.position.left?0:n.$data.position.left;n.$data.actualWidth=n.$data.width+a;let o=n.$data.position.left+n.$data.width;n.$data.position.right=o,n.$data.position.actualRight=o;const r=this.api.time.getTimeFromViewOffsetPx(o,s,!1),h=this.data.snapToTime.end({endTime:this.api.time.date(r),item:n,time:s,movement:i,vido:this.vido});n.time.end=h.valueOf(),n.$data.time.endDate=h}this.dispatchEvent("onResize",e),this.updateData()}onEnd(t){const e=this.getSelectedItems();this.dispatchEvent("onEnd",e)}onPointerUp(t){t.preventDefault(),t.stopPropagation(),"resize"===this.data.state&&(this.data.state="end")}onLeftPointerUp(t){this.data.enabled&&this.data.leftIsMoving&&(document.body.classList.remove(this.data.bodyClassLeft),this.data.leftIsMoving=!1,this.onPointerUp(t),this.onEnd("left"),this.updateData())}onRightPointerUp(t){this.data.enabled&&this.data.rightIsMoving&&(document.body.classList.remove(this.data.bodyClassRight),this.data.rightIsMoving=!1,this.onPointerUp(t),this.onEnd("right"),this.updateData())}wrapper(t,e){const i=this.oldWrapper(t,e),s=e.props.item;let n=!s.$data.detached;this.data.handle.onlyWhenSelected&&(n=n&&s.selected);const a=this.getRightStyleMap(s,n),o=(this.getLeftStyleMap(s,n),{handleEvent:t=>this.onRightPointerDown(t)}),r=this.html`<div class=${this.rightClassName} style=${a} @pointerdown=${o}>${this.data.content}</div>`;return this.html`${i}${n?r:null}`}}function U(i){return Object.assign({enabled:!0,showOverlay:!0,isSelecting:!1,pointerState:"up",selectKey:"",multiKey:"shift",multipleSelection:!0,targetType:"",targetData:null,initialPosition:{x:0,y:0},currentPosition:{x:0,y:0},selectionAreaLocal:{x:0,y:0,width:0,height:0},selectionAreaGlobal:{x:0,y:0,width:0,height:0},selecting:{[e]:[],[t]:[]},selected:{[e]:[],[t]:[]},automaticallySelected:{[e]:[],[t]:[]},events:{down:null,move:null,up:null}},i)}class k{constructor(t,i){this.onDestroy=[],this.vido=t,this.state=t.state,this.api=t.api,this.merge=this.state.get("config.merge"),this.state.update("config.plugin.Selection",U(i)),this.data=U(i),this.wrapperClassName=this.api.getClass("chart-selection"),this.wrapperStyleMap=new t.StyleMap({display:"none"}),this.html=t.html,this.wrapper=this.wrapper.bind(this),this.destroy=this.destroy.bind(this),this.setWrapper(),this.onDestroy.push(this.state.subscribe("config.plugin.TimelinePointer",t=>{this.poitnerData=t,this.onPointerData()})),this.updateData(),this.onDestroy.push(this.state.subscribe("config.plugin.Selection",t=>{this.data=t})),this.onDestroy.push(this.state.subscribe("config.chart.items",t=>{this.data.selected[e]=this.data.selected[e].filter(e=>!!t[e.id]).map(e=>this.merge({},t[e.id]))},{ignore:["config.chart.items.*.$data.detached","config.chart.items.*.selected"]}))}setWrapper(){this.state.update("config.wrappers.ChartTimelineItems",t=>(this.oldWrapper||(this.oldWrapper=t),this.wrapper))}destroy(){this.state.update("config.wrappers.ChartTimelineItems",this.oldWrapper),this.oldWrapper=null,this.onDestroy.forEach(t=>t())}updateData(){this.state.update("config.plugin.Selection",Object.assign({},this.data)),this.vido.update()}modKeyPressed(t,e){switch(t){case"shift":return e.shiftKey;case"alt":return e.altKey;case"ctrl":return e.ctrlKey}}canSelect(){let t=this.data.enabled;const e=this.poitnerData.events.down;return e&&this.data.selectKey&&(t=t&&this.modKeyPressed(this.data.selectKey,e)),t}getSelectionAreaLocal(){const t={x:0,y:0,width:0,height:0},e=Object.assign({},this.poitnerData.initialPosition),i=Object.assign({},this.poitnerData.currentPosition),s=i.x-e.x,n=i.y-e.y;return s>=0?(t.x=e.x,t.width=s):(t.x=i.x,t.width=Math.abs(s)),n>=0?(t.y=e.y,t.height=n):(t.y=i.y,t.height=Math.abs(n)),t}translateAreaLocalToGlobal(t){const e=this.state.get("$data.chart.time.leftPx"),i=this.state.get("config.scroll.vertical.posPx");return Object.assign(Object.assign({},t),{x:t.x+e,y:t.y+i})}collectLinkedItems(t,e=[]){if(t.linkedWith&&t.linkedWith.length){const i=this.state.get("config.chart.items");for(const s of t.linkedWith){const t=i[s];e.includes(t)||e.push(t)}}return e}getSelected(t){let i,s=this.data.automaticallySelected[e].slice();const n=this.poitnerData.events.move,a=this.data.multiKey&&this.modKeyPressed(this.data.multiKey,n),o=this.collectLinkedItems(t,[t]);if(this.data.selected[e].find(e=>e.id===t.id))if(i=this.data.selected[e],s.find(e=>e.id===t.id)){const e=s.map(t=>t.id),n=i.find(i=>t.linkedWith.includes(i.id)&&!e.includes(i.id));s=s.filter(e=>e.id!==t.id),s.push(n)}else s=this.data.automaticallySelected[e];else i=a?[...new Set([...this.data.selected[e],...o]).values()]:o,s=o.filter(e=>e.id!==t.id);return i=i.map(t=>(t.selected=!0,t)),{selected:i,automaticallySelected:s}}isItemVerticallyInsideArea(t,e){if(!e.width||!e.height)return!1;const i=e.y+e.height,s=t.position.viewTop,n=s+t.actualHeight;return s>=e.y&&s<=i||n>=e.y&&n<=i||s>=e.y&&n<=i||s<=e.y&&n>=i}isItemHorizontallyInsideArea(t,e){if(!e.width||!e.height)return!1;const i=e.x+e.width;return t.position.actualLeft>=e.x&&t.position.actualLeft<=i||t.position.actualRight>=e.x&&t.position.actualRight<=i||t.position.actualLeft<=e.x&&t.position.actualRight>=i||t.position.actualLeft>=e.x&&t.position.actualRight<=i}getItemsUnderSelectionArea(t){const i=this.state.get("$data.chart.visibleItems"),s=this.poitnerData.events.move,n=s&&this.data.multiKey&&this.modKeyPressed(this.data.multiKey,s);let a=n?[...this.data.selected[e]]:[];const o=n?[...this.data.automaticallySelected[e]]:[];for(let e of i){e=this.merge({},e);const i=e.$data;if(this.isItemVerticallyInsideArea(i,t)&&this.isItemHorizontallyInsideArea(i,t)){a.find(t=>t.id===e.id)||a.push(e);const t=this.collectLinkedItems(e,[e]);for(let e of t)e=this.merge({},e),a.find(t=>t.id===e.id)||(a.push(e),o.push(e))}}return a=a.map(t=>(t.selected=!0,t)),{selected:a,automaticallySelected:o}}unmarkSelected(){const t=this.state.get("config.chart.items");let e=this.state.multi();for(const i in t){t[i].selected&&(e=e.update(`config.chart.items.${i}.selected`,!1))}e.done()}deselectItems(){this.unmarkSelected(),this.data.selected[e]=[],this.updateData()}selectMultipleCellsAndItems(){if(!this.canSelect())return;if(!this.data.multipleSelection)return void this.deselectItems();this.data.isSelecting=!0,this.data.selectionAreaLocal=this.getSelectionAreaLocal(),this.data.selectionAreaGlobal=this.translateAreaLocalToGlobal(this.data.selectionAreaLocal);const{selected:t,automaticallySelected:i}=this.getItemsUnderSelectionArea(this.data.selectionAreaLocal);if(this.data.automaticallySelected[e]=i,0===t.length)return this.unmarkSelected(),void(this.data.selected[e].length=0);this.data.selected[e]=t,this.unmarkSelected();let s=this.state.multi();for(const e of t)s=s.update(`config.chart.items.${e.id}.selected`,!0);s.done()}selectItemsIndividually(){if(this.data.isSelecting=!1,this.data.selectionAreaLocal=this.getSelectionAreaLocal(),this.data.currentPosition=this.poitnerData.currentPosition,this.data.initialPosition=this.poitnerData.initialPosition,!this.canSelect())return;const t=this.merge({},this.poitnerData.targetData);let{selected:i,automaticallySelected:s}=this.getSelected(t);i.length>1&&!this.data.multipleSelection&&(i=[t],s=[]),this.data.selected[e]=i,this.data.automaticallySelected[e]=s,this.unmarkSelected();let n=this.state.multi();for(const t of this.data.selected[e])n=n.update(`config.chart.items.${t.id}.selected`,!0);n.done()}onPointerData(){this.poitnerData.isMoving&&this.poitnerData.targetType===t&&this.data.rectangularSelection?this.selectMultipleCellsAndItems():this.poitnerData.isMoving&&this.poitnerData.targetType===t&&!this.data.rectangularSelection?this.deselectItems():this.poitnerData.isMoving&&this.poitnerData.targetType===e?this.selectItemsIndividually():this.poitnerData.isMoving||(this.data.isSelecting=!1),this.poitnerData.isMoving&&this.poitnerData.targetType!==t&&this.poitnerData.targetType!==e&&this.deselectItems(),this.data.events=this.poitnerData.events,this.data.pointerState=this.poitnerData.pointerState,this.data.targetType=this.poitnerData.targetType,this.data.targetData=this.poitnerData.targetData,this.updateData()}wrapper(t,e){if(!this.oldWrapper)return t;const i=this.oldWrapper(t,e);let s=!0;this.canSelect()&&this.data.isSelecting&&this.data.showOverlay&&this.data.multipleSelection&&this.data.rectangularSelection&&(this.wrapperStyleMap.style.display="block",this.wrapperStyleMap.style.left=this.data.selectionAreaLocal.x+"px",this.wrapperStyleMap.style.top=this.data.selectionAreaLocal.y+"px",this.wrapperStyleMap.style.width=this.data.selectionAreaLocal.width+"px",this.wrapperStyleMap.style.height=this.data.selectionAreaLocal.height+"px",s=!1);const n=this.html`<div class=${this.wrapperClassName} style=${this.wrapperStyleMap}></div>`;return this.html`${i}${s?null:n}`}}const H={enabled:!0,bodyClassName:"gstc-scrolling"};var N={TimelinePointer:a,ItemHold:o,ItemMovement:c,ItemResizing:Object.freeze({__proto__:null,Plugin:function(t={}){return function(e){return new W(e,t).destroy}}}),Selection:Object.freeze({__proto__:null,Plugin:function(t={}){return t=function(t){const e={enabled:!0,cells:!0,items:!0,rows:!1,showOverlay:!0,rectangularSelection:!0,multipleSelection:!0,canSelect:(t,e,i)=>e,canDeselect:(t,e,i)=>[]};return t=Object.assign(Object.assign({},e),t)}(t),function(e){return new k(e,t).destroy}}}),CalendarScroll:Object.freeze({__proto__:null,Plugin:function(t=H){let e,i,s,n=t.enabled;class a{constructor(t){this.moving=!1,this.initialDataIndex={x:0,y:0},this.pointerDown=this.pointerDown.bind(this),this.pointerUp=this.pointerUp.bind(this),this.pointerMove=e.schedule(this.pointerMove.bind(this)),t.addEventListener("pointerdown",this.pointerDown),document.addEventListener("pointermove",this.pointerMove,{passive:!0}),document.addEventListener("pointerup",this.pointerUp),t.style.cursor="grab"}destroy(t){t.removeEventListener("pointerdown",this.pointerDown),document.removeEventListener("pointermove",this.pointerMove),document.removeEventListener("pointerup",this.pointerUp)}resetInitialPoint(t){this.initialPoint={x:t.screenX,y:t.screenY}}pointerDown(e){if(!n)return;document.body.classList.add(t.bodyClassName),this.moving=!0,this.resetInitialPoint(e);const i=s.get("config.scroll");this.initialDataIndex={x:i.horizontal.dataIndex||0,y:i.vertical.dataIndex||0}}pointerUp(e){n&&(document.body.classList.remove(t.bodyClassName),this.moving&&(this.moving=!1))}handleHorizontalMovement(t,e){const n=s.get("$data.chart.time");if(t.x>0){if(0===this.initialDataIndex.x)return this.resetInitialPoint(e);const s=n.allDates[n.level];let a=this.initialDataIndex.x-1,o=0;for(;a>0;a--){if(o+=s[a].width,o>=t.x)break}i.setScrollLeft(a,n)}else if(t.x<0){let a=this.initialDataIndex.x;const o=s.get("config.scroll.horizontal"),r=n.allDates[n.level];if(a-1>=r.length-o.lastPageCount)return this.resetInitialPoint(e);let h=0;for(let e=r.length;a<e;a++){if(h+=r[a].width,-h<=t.x)break}if(a-1>=r.length-o.lastPageCount)return;i.setScrollLeft(a,n)}}pointerMove(t){if(!n||!this.moving)return;const e={x:t.screenX-this.initialPoint.x,y:t.screenY-this.initialPoint.y};this.handleHorizontalMovement(e,t)}}return function(o){e=o,i=e.api,s=e.state,s.update("config.plugin.CalendarScroll",t),s.subscribe("config.plugin.CalendarScroll.enabled",t=>n=t),s.update("config.actions.chart-calendar",t=>(t.push(a),t))}}}),HighlightWeekends:Object.freeze({__proto__:null,Plugin:function(t={}){const e=t.weekdays||[6,0];let i,s,n=!0;class a extends C{constructor(t,e){super(),this.highlight(t,e.time.leftGlobal)}update(t,e){this.highlight(t,e.time.leftGlobal)}highlight(t,a){const o=t.classList.contains(i);if(!n)return void(o&&t.classList.remove(i));const r=e.includes(s.time.date(a).day());!o&&r?t.classList.add(i):o&&!r&&t.classList.remove(i)}}return function(e){s=e.api,i=t.className||s.getClass("chart-timeline-grid-row-cell")+"--weekend";const o=e.state.subscribe("$data.chart.time.format.period",t=>n="day"===t);return e.state.update("config.actions.chart-timeline-grid-row-cell",t=>(t.push(a),t)),function(){o()}}}})};export default N;
