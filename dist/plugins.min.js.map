{"version":3,"file":"plugins.min.js","sources":["../src/plugins/plugins.ts","../src/plugins/ItemHold.plugin.ts","../src/plugins/ItemMovement.plugin.ts","../src/plugins/SaveAsImage.plugin.ts","../src/plugins/Selection.plugin.ts"],"sourcesContent":["import ItemHold from './ItemHold.plugin';\nimport ItemMovement from './ItemMovement.plugin';\nimport SaveAsImage from './SaveAsImage.plugin';\nimport Selection from './Selection.plugin';\n\nexport default { ItemHold, ItemMovement, SaveAsImage, Selection };\n","/**\n * ItemHold plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nexport default function ItemHold(options = {}) {\n  const defaultOptions = {\n    time: 1000,\n    movementThreshold: 2,\n    action(element, data) {}\n  };\n  options = { ...defaultOptions, ...options };\n\n  const holding = {};\n  const mouse = { x: 0, y: 0 };\n\n  function onMouseDown(item, element, event) {\n    if (typeof holding[item.id] === 'undefined') {\n      holding[item.id] = { x: event.x, y: event.y };\n      setTimeout(() => {\n        if (typeof holding[item.id] !== 'undefined') {\n          let exec = true;\n          let xMovement = holding[item.id].x - mouse.x;\n          if (Math.sign(xMovement) === -1) {\n            xMovement = -xMovement;\n          }\n          let yMovement = holding[item.id].y - mouse.y;\n          if (Math.sign(yMovement) === -1) {\n            yMovement = -yMovement;\n          }\n          if (xMovement > options.movementThreshold) {\n            exec = false;\n          }\n          if (yMovement > options.movementThreshold) {\n            exec = false;\n          }\n          delete holding[item.id];\n          if (exec) {\n            options.action(element, item);\n          }\n        }\n      }, options.time);\n    }\n  }\n\n  function onMouseUp(itemId) {\n    if (typeof holding[itemId] !== 'undefined') {\n      delete holding[itemId];\n    }\n  }\n\n  function action(element, data) {\n    function elementMouseDown(event) {\n      onMouseDown(data.item, element, event);\n    }\n    element.addEventListener('mousedown', elementMouseDown);\n    function mouseUp() {\n      onMouseUp(data.item.id);\n    }\n\n    document.addEventListener('mouseup', mouseUp);\n    function onMouseMove(event) {\n      mouse.x = event.x;\n      mouse.y = event.y;\n    }\n\n    document.addEventListener('mousemove', onMouseMove);\n    return {\n      update(element, changedData) {\n        data = changedData;\n      },\n      destroy(element, data) {\n        document.removeEventListener('mouseup', onMouseUp);\n        document.removeEventListener('mousemove', onMouseMove);\n        element.removeEventListener('mousedown', elementMouseDown);\n      }\n    };\n  }\n\n  return function initialize(vido) {\n    vido.state.update('config.actions.chart-timeline-items-row-item', actions => {\n      actions.push(action);\n      return actions;\n    });\n  };\n}\n","/**\n * ItemMovement plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nexport default function ItemMovement(options = {}) {\n  const defaultOptions = {\n    moveable: true,\n    resizeable: true,\n    resizerContent: '',\n    collisionDetection: true,\n    outOfBorders: false,\n    snapStart(timeStart, startDiff) {\n      return timeStart + startDiff;\n    },\n    snapEnd(timeEnd, endDiff) {\n      return timeEnd + endDiff;\n    },\n    ghostNode: true\n  };\n  options = { ...defaultOptions, ...options };\n\n  const movementState = {};\n\n  /**\n   * Add moving functionality to items as action\n   *\n   * @param {Element} node DOM Node\n   * @param {Object} data\n   */\n  function action(node, data) {\n    let element = node.querySelector('.gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content');\n    if (!options.moveable && !options.resizeable) {\n      return;\n    }\n    let state;\n    let api;\n\n    function isMoveable(data) {\n      let moveable = options.moveable;\n      if (data.item.hasOwnProperty('moveable') && moveable) {\n        moveable = data.item.moveable;\n      }\n      if (data.row.hasOwnProperty('moveable') && moveable) {\n        moveable = data.row.moveable;\n      }\n      return moveable;\n    }\n\n    function isResizeable(data) {\n      let resizeable = options.resizeable && (!data.item.hasOwnProperty('resizeable') || data.item.resizeable === true);\n      if (data.row.hasOwnProperty('resizeable') && resizeable) {\n        resizeable = data.row.resizeable;\n      }\n      return resizeable;\n    }\n\n    function getMovement(data) {\n      const itemId = data.item.id;\n      if (typeof movementState[itemId] === 'undefined') {\n        movementState[itemId] = { moving: false, resizing: false };\n      }\n      return movementState[itemId];\n    }\n\n    function createGhost(data, ev, ganttLeft, ganttTop) {\n      const movement = getMovement(data);\n      if (!options.ghostNode || typeof movement.ghost !== 'undefined') {\n        return;\n      }\n      const ghost = element.cloneNode(true);\n      const style = getComputedStyle(element);\n      ghost.style.position = 'absolute';\n      ghost.style.left = ev.x - ganttLeft - movement.itemLeftCompensation + 'px';\n      const itemTop = ev.y - ganttTop - data.row.top - element.offsetTop;\n      movement.itemTop = itemTop;\n      ghost.style.top = ev.y - ganttTop - itemTop + 'px';\n      ghost.style.width = style.width;\n      ghost.style['box-shadow'] = '10px 10px 6px #00000020';\n      const height = element.clientHeight + 'px';\n      ghost.style.height = height;\n      ghost.style['line-height'] = height;\n      ghost.style.opacity = '0.6';\n      ghost.style.transform = 'scale(1.05, 1.05)';\n      state.get('_internal.elements.chart-timeline').appendChild(ghost);\n      movement.ghost = ghost;\n      return ghost;\n    }\n\n    function moveGhost(data, ev) {\n      if (options.ghostNode) {\n        const movement = getMovement(data);\n        const left = ev.x - movement.ganttLeft - movement.itemLeftCompensation;\n        const compensation = state.get('config.scroll.compensation');\n        movement.ghost.style.left = left + 'px';\n        movement.ghost.style.top = ev.y - movement.ganttTop - movement.itemTop + compensation + 'px';\n      }\n    }\n\n    function destroyGhost(itemId) {\n      if (!options.ghostNode) {\n        return;\n      }\n      if (typeof movementState[itemId] !== 'undefined' && typeof movementState[itemId].ghost !== 'undefined') {\n        state.get('_internal.elements.chart-timeline').removeChild(movementState[itemId].ghost);\n        delete movementState[itemId].ghost;\n      }\n    }\n\n    function getSnapStart(data) {\n      let snapStart = options.snapStart;\n      if (typeof data.item.snapStart === 'function') {\n        snapStart = data.item.snapStart;\n      }\n      return snapStart;\n    }\n\n    function getSnapEnd(data) {\n      let snapEnd = options.snapEnd;\n      if (typeof data.item.snapEnd === 'function') {\n        snapEnd = data.item.snapEnd;\n      }\n      return snapEnd;\n    }\n\n    state = data.state;\n    api = data.api;\n\n    const resizerHTML = `<div class=\"${api.getClass('chart-timeline-items-row-item-content-resizer')}\">${\n      options.resizerContent\n    }</div>`;\n    // @ts-ignore\n    element.insertAdjacentHTML('beforeend', resizerHTML);\n    const resizerEl = element.querySelector(\n      '.gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content-resizer'\n    );\n    if (!isResizeable(data)) {\n      resizerEl.style.visibility = 'hidden';\n    } else {\n      resizerEl.style.visibility = 'visible';\n    }\n\n    function labelMouseDown(ev) {\n      ev.stopPropagation();\n      if (ev.button !== 0) {\n        return;\n      }\n      // @ts-ignore\n      element = node.querySelector('.gantt-schedule-timeline-calendar__chart-timeline-items-row-item-content');\n      const movement = getMovement(data);\n      movement.moving = true;\n      const item = state.get(`config.chart.items.${data.item.id}`);\n      const chartLeftTime = state.get('_internal.chart.time.leftGlobal');\n      const timePerPixel = state.get('_internal.chart.time.timePerPixel');\n      const ganttRect = state.get('_internal.elements.chart-timeline').getBoundingClientRect();\n      movement.ganttTop = ganttRect.top;\n      movement.ganttLeft = ganttRect.left;\n      movement.itemX = Math.round((item.time.start - chartLeftTime) / timePerPixel);\n      movement.itemLeftCompensation = ev.x - movement.ganttLeft - movement.itemX;\n      createGhost(data, ev, ganttRect.left, ganttRect.top);\n    }\n\n    function resizerMouseDown(ev) {\n      ev.stopPropagation();\n      if (ev.button !== 0) {\n        return;\n      }\n      const movement = getMovement(data);\n      movement.resizing = true;\n      const item = state.get(`config.chart.items.${data.item.id}`);\n      const chartLeftTime = state.get('_internal.chart.time.leftGlobal');\n      const timePerPixel = state.get('_internal.chart.time.timePerPixel');\n      const ganttRect = state.get('_internal.elements.chart-timeline').getBoundingClientRect();\n      movement.ganttTop = ganttRect.top;\n      movement.ganttLeft = ganttRect.left;\n      movement.itemX = (item.time.end - chartLeftTime) / timePerPixel;\n      movement.itemLeftCompensation = ev.x - movement.ganttLeft - movement.itemX;\n    }\n\n    function isCollision(rowId, itemId, start, end) {\n      if (!options.collisionDetection) {\n        return false;\n      }\n      const time = state.get('_internal.chart.time');\n      if (options.outOfBorders && (start < time.from || end > time.to)) {\n        return true;\n      }\n      let diff = api.time.date(end).diff(start, 'milliseconds');\n      if (Math.sign(diff) === -1) {\n        diff = -diff;\n      }\n      if (diff <= 1) {\n        return true;\n      }\n      const row = state.get('config.list.rows.' + rowId);\n      for (const rowItem of row._internal.items) {\n        if (rowItem.id !== itemId) {\n          if (start >= rowItem.time.start && start <= rowItem.time.end) {\n            return true;\n          }\n          if (end >= rowItem.time.start && end <= rowItem.time.end) {\n            return true;\n          }\n          if (start <= rowItem.time.start && end >= rowItem.time.end) {\n            return true;\n          }\n        }\n      }\n      return false;\n    }\n\n    function movementX(ev, row, item, zoom, timePerPixel) {\n      ev.stopPropagation();\n      const movement = getMovement(data);\n      const left = ev.x - movement.ganttLeft - movement.itemLeftCompensation;\n      moveGhost(data, ev);\n      const leftMs = state.get('_internal.chart.time.leftGlobal') + left * timePerPixel;\n      const add = leftMs - item.time.start;\n      const originalStart = item.time.start;\n      const finalStartTime = getSnapStart(data)(item.time.start, add, item);\n      const finalAdd = finalStartTime - originalStart;\n      const collision = isCollision(row.id, item.id, item.time.start + finalAdd, item.time.end + finalAdd);\n      if (finalAdd && !collision) {\n        state.update(`config.chart.items.${data.item.id}.time`, function moveItem(time) {\n          time.start += finalAdd;\n          time.end = getSnapEnd(data)(time.end, finalAdd, item) - 1;\n          return time;\n        });\n      }\n    }\n\n    function resizeX(ev, row, item, zoom, timePerPixel) {\n      ev.stopPropagation();\n      if (!isResizeable(data)) {\n        return;\n      }\n      const time = state.get('_internal.chart.time');\n      const movement = getMovement(data);\n      const left = ev.x - movement.ganttLeft - movement.itemLeftCompensation;\n      const leftMs = time.leftGlobal + left * timePerPixel;\n      const add = leftMs - item.time.end;\n      if (item.time.end + add < item.time.start) {\n        return;\n      }\n      const originalEnd = item.time.end;\n      const finalEndTime = getSnapEnd(data)(item.time.end, add, item) - 1;\n      const finalAdd = finalEndTime - originalEnd;\n      const collision = isCollision(row.id, item.id, item.time.start, item.time.end + finalAdd);\n      if (finalAdd && !collision) {\n        state.update(`config.chart.items.${data.item.id}.time`, time => {\n          time.start = getSnapStart(data)(time.start, 0, item);\n          time.end = getSnapEnd(data)(time.end, finalAdd, item) - 1;\n          return time;\n        });\n      }\n    }\n\n    function movementY(ev, row, item, zoom, timePerPixel) {\n      ev.stopPropagation();\n      moveGhost(data, ev);\n      const movement = getMovement(data);\n      const top = ev.y - movement.ganttTop;\n      const visibleRows = state.get('_internal.list.visibleRows');\n      const compensation = state.get('config.scroll.compensation');\n      let index = 0;\n      for (const currentRow of visibleRows) {\n        if (currentRow.top + compensation > top) {\n          if (index > 0) {\n            return index - 1;\n          }\n          return 0;\n        }\n        index++;\n      }\n      return index;\n    }\n\n    function documentMouseMove(ev) {\n      const movement = getMovement(data);\n      let item, rowId, row, zoom, timePerPixel;\n      if (movement.moving || movement.resizing) {\n        ev.stopPropagation();\n        item = state.get(`config.chart.items.${data.item.id}`);\n        rowId = state.get(`config.chart.items.${data.item.id}.rowId`);\n        row = state.get(`config.list.rows.${rowId}`);\n        zoom = state.get('config.chart.time.zoom');\n        timePerPixel = state.get('_internal.chart.time.timePerPixel');\n      }\n      const moveable = isMoveable(data);\n      if (movement.moving) {\n        if (moveable === true || moveable === 'x' || (Array.isArray(moveable) && moveable.includes(rowId))) {\n          movementX(ev, row, item, zoom, timePerPixel);\n        }\n        if (!moveable || moveable === 'x') {\n          return;\n        }\n        let visibleRowsIndex = movementY(ev, row, item, zoom, timePerPixel);\n        const visibleRows = state.get('_internal.list.visibleRows');\n        if (typeof visibleRows[visibleRowsIndex] === 'undefined') {\n          if (visibleRowsIndex > 0) {\n            visibleRowsIndex = visibleRows.length - 1;\n          } else if (visibleRowsIndex < 0) {\n            visibleRowsIndex = 0;\n          }\n        }\n        const newRow = visibleRows[visibleRowsIndex];\n        const newRowId = newRow.id;\n        const collision = isCollision(newRowId, item.id, item.time.start, item.time.end);\n        if (newRowId !== item.rowId && !collision) {\n          if (!Array.isArray(moveable) || moveable.includes(newRowId)) {\n            if (!newRow.hasOwnProperty('moveable') || newRow.moveable) {\n              state.update(`config.chart.items.${item.id}.rowId`, newRowId);\n            }\n          }\n        }\n      } else if (movement.resizing && (typeof item.resizeable === 'undefined' || item.resizeable === true)) {\n        resizeX(ev, row, item, zoom, timePerPixel);\n      }\n    }\n\n    function documentMouseUp(ev) {\n      const movement = getMovement(data);\n      if (movement.moving || movement.resizing) {\n        ev.stopPropagation();\n      }\n      movement.moving = false;\n      movement.resizing = false;\n      for (const itemId in movementState) {\n        movementState[itemId].moving = false;\n        movementState[itemId].resizing = false;\n        destroyGhost(itemId);\n      }\n    }\n    element.addEventListener('mousedown', labelMouseDown);\n    resizerEl.addEventListener('mousedown', resizerMouseDown, { capture: true });\n    document.addEventListener('mousemove', documentMouseMove, { capture: true, passive: true });\n    document.addEventListener('mouseup', documentMouseUp, { capture: true, passive: true });\n\n    return {\n      update(node, changedData) {\n        if (!isResizeable(data) && resizerEl.style.visibility === 'visible') {\n          resizerEl.style.visibility = 'hidden';\n        } else if (isResizeable(data) && resizerEl.style.visibility === 'hidden') {\n          resizerEl.style.visibility = 'visible';\n        }\n      },\n      destroy(node, data) {\n        element.removeEventListener('mousedown', labelMouseDown);\n        resizerEl.removeEventListener('mousedown', resizerMouseDown);\n        document.removeEventListener('mousemove', documentMouseMove);\n        document.removeEventListener('mouseup', documentMouseUp);\n        resizerEl.remove();\n      }\n    };\n  }\n\n  return function initialize(vido) {\n    vido.state.update('config.actions.chart-timeline-items-row-item', actions => {\n      actions.push(action);\n      return actions;\n    });\n  };\n}\n","/**\n * SaveAsImage plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\n// @ts-nocheck\nexport default function SaveAsImage(options = {}) {\n  const defaultOptions = {\n    style: 'font-family: sans-serif;',\n    filename: 'gantt-schedule-timeline-calendar.jpeg'\n  };\n  options = { ...defaultOptions, options };\n  function downloadImage(data, filename) {\n    const a = document.createElement('a');\n    a.href = data;\n    a.download = filename;\n    document.body.appendChild(a);\n    a.click();\n  }\n\n  function saveAsImage(ev) {\n    const element = ev.target;\n    const width = element.clientWidth;\n    const height = element.clientHeight;\n    const html = unescape(encodeURIComponent(element.outerHTML));\n    let style = '';\n    for (const styleSheet of document.styleSheets) {\n      if (styleSheet.title === 'gstc') {\n        for (const rule of styleSheet.rules) {\n          style += rule.cssText;\n        }\n      }\n    }\n    style = `<style>* {${options.style}} ${style}</style>`;\n    const svg = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${width}\" height=\"${height}\" viewBox=\"0 0 ${width} ${height}\">\n      <foreignObject x=\"0\" y=\"0\" width=\"${width}\" height=\"${height}\">\n        <div xmlns=\"http://www.w3.org/1999/xhtml\">\n          ${style}\n          ${html}\n        </div>\n      </foreignObject>\n    </svg>`;\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = 'white';\n    ctx.fillRect(0, 0, width, height);\n    const svg64 = 'data:image/svg+xml;base64,' + btoa(svg);\n    const img = new Image();\n    img.onload = function onLoad() {\n      ctx.drawImage(img, 0, 0);\n      const jpeg = canvas.toDataURL('image/jpeg', 1.0);\n      downloadImage(jpeg, options.filename);\n    };\n    img.src = svg64;\n  }\n\n  return function initialize(vido) {\n    vido.state.subscribe('_internal.elements.main', main => {\n      if (main) {\n        main.addEventListener('save-as-image', saveAsImage);\n      }\n    });\n  };\n}\n","/**\n * Selection plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nexport interface RectStyle {\n  [key: string]: any;\n}\n\nexport interface Options {\n  grid?: boolean;\n  items?: boolean;\n  rows?: boolean;\n  horizontal?: boolean;\n  vertical?: boolean;\n  rectStyle?: RectStyle;\n  selecting?: (data, type: string) => void;\n  deselecting?: (data, type: string) => void;\n  selected?: (data, type) => void;\n  deselected?: (data, type) => void;\n  canSelect?: (type, state) => any[];\n}\n\nexport interface Items {\n  [key: string]: string[];\n}\n\ninterface SelectingData {\n  fromX?: number;\n  fromY?: number;\n  toX?: number;\n  toY?: number;\n  startX?: number;\n  startY?: number;\n  startCell?: any;\n  selecting?: boolean;\n  selected?: Items;\n}\n\nexport interface SelectState {\n  selecting?: Items;\n  selected?: Items;\n}\n\nexport default function Selection(options: Options = {}) {\n  let vido, state, api, schedule;\n  const defaultOptions: Options = {\n    grid: false,\n    items: true,\n    rows: false,\n    horizontal: true,\n    vertical: true,\n    rectStyle: {},\n    selecting() {},\n    deselecting() {},\n    selected() {},\n    deselected() {},\n    canSelect(type, currently) {\n      return currently;\n    }\n  };\n  options = { ...defaultOptions, ...options } as Options;\n  let chartTimeline, top, left;\n  let selecting: SelectingData = {\n    fromX: -1,\n    fromY: -1,\n    toX: -1,\n    toY: -1,\n    startX: -1,\n    startY: -1,\n    startCell: false,\n    selecting: false\n  };\n  const selectionTypesIdGetters = {\n    'chart-timeline-grid-row': props => props.row.id,\n    'chart-timeline-grid-row-block': props => props.id,\n    'chart-timeline-items-row': props => props.row.id,\n    'chart-timeline-items-row-item': props => props.item.id\n  };\n  const path = 'config.plugin.selection';\n  const rectClassName = 'gantt-schedule-timeline-caledar__plugin-selection-rect';\n  const rect = document.createElement('div');\n  rect.classList.add(rectClassName);\n  rect.style.visibility = 'hidden';\n  rect.style.left = '0px';\n  rect.style.top = '0px';\n  rect.style.width = '0px';\n  rect.style.height = '0px';\n  rect.style.background = 'rgba(0, 119, 192, 0.2)';\n  rect.style.border = '2px dashed rgba(0, 119, 192, 0.75)';\n  rect.style.position = 'absolute';\n  rect.style['user-select'] = 'none';\n  rect.style['pointer-events'] = 'none';\n  for (const styleProp in options.rectStyle) {\n    rect.style[styleProp] = options.rectStyle[styleProp];\n  }\n\n  /**\n   * Selection action\n   * @param {Element} element\n   * @param {object|any} data\n   * @returns {object} with update and destroy\n   */\n  function selectionAction(element, data) {\n    let previousSelect;\n    chartTimeline = state.get('_internal.elements.chart-timeline');\n    if (!chartTimeline.querySelector('.' + rectClassName)) {\n      chartTimeline.insertAdjacentElement('beforeend', rect);\n      const bounding = chartTimeline.getBoundingClientRect();\n      left = bounding.left;\n      top = bounding.top;\n    }\n\n    /**\n     * Clear selection\n     */\n    function clearSelection() {\n      state.update(path, {\n        selecting: {\n          'chart-timeline-grid-rows': [],\n          'chart-timeline-grid-row-blocks': [],\n          'chart-timeline-items-rows': [],\n          'chart-timeline-items-row-items': []\n        },\n        selected: {\n          'chart-timeline-grid-rows': [],\n          'chart-timeline-grid-row-blocks': [],\n          'chart-timeline-items-rows': [],\n          'chart-timeline-items-row-items': []\n        }\n      });\n      state.update('_internal.chart.grid.rowsWithBlocks', function clearRowsWithBlocks(rowsWithBlocks) {\n        for (const row of rowsWithBlocks) {\n          for (const block of row.blocks) {\n            block.selected = false;\n            block.selecting = false;\n          }\n        }\n        return rowsWithBlocks;\n      });\n    }\n\n    /**\n     * Clone current selection state\n     * @param {object} currentSelect\n     * @returns {object} currentSelect cloned\n     */\n    function cloneSelection(currentSelect) {\n      const result: SelectingData = {};\n      result.selecting = { ...currentSelect.selecting };\n      result.selecting['chart-timeline-grid-rows'] = currentSelect.selecting['chart-timeline-grid-rows'].slice();\n      result.selecting['chart-timeline-grid-row-blocks'] = currentSelect.selecting[\n        'chart-timeline-grid-row-blocks'\n      ].slice();\n      result.selecting['chart-timeline-items-rows'] = currentSelect.selecting['chart-timeline-items-rows'].slice();\n      result.selecting['chart-timeline-items-row-items'] = currentSelect.selecting[\n        'chart-timeline-items-row-items'\n      ].slice();\n      result.selected = { ...currentSelect.selected };\n      result.selected['chart-timeline-grid-rows'] = currentSelect.selected['chart-timeline-grid-rows'].slice();\n      result.selected['chart-timeline-grid-row-blocks'] = currentSelect.selected[\n        'chart-timeline-grid-row-blocks'\n      ].slice();\n      result.selected['chart-timeline-items-rows'] = currentSelect.selected['chart-timeline-items-rows'].slice();\n      result.selected['chart-timeline-items-row-items'] = currentSelect.selected[\n        'chart-timeline-items-row-items'\n      ].slice();\n      return result;\n    }\n\n    /**\n     * Save and swap coordinates if needed\n     * @param {Event} ev\n     */\n    function saveAndSwapIfNeeded(ev) {\n      // @ts-ignore\n      const currentX = ev.x - left;\n      // @ts-ignore\n      const currentY = ev.y - top;\n      if (currentX <= selecting.startX) {\n        selecting.fromX = currentX;\n        selecting.toX = selecting.startX;\n      } else {\n        selecting.fromX = selecting.startX;\n        selecting.toX = currentX;\n      }\n      if (currentY <= selecting.startY) {\n        selecting.fromY = currentY;\n        selecting.toY = selecting.startY;\n      } else {\n        selecting.fromY = selecting.startY;\n        selecting.toY = currentY;\n      }\n    }\n\n    /**\n     * Is rectangle inside other rectangle ?\n     * @param {DOMRect} boundingRect\n     * @param {DOMRect} rectBoundingRect\n     * @returns {boolean}\n     */\n    function isInside(boundingRect, rectBoundingRect) {\n      let horizontal = false;\n      let vertical = false;\n      if (\n        (boundingRect.left > rectBoundingRect.left && boundingRect.left < rectBoundingRect.right) ||\n        (boundingRect.right > rectBoundingRect.left && boundingRect.right < rectBoundingRect.right) ||\n        (boundingRect.left <= rectBoundingRect.left && boundingRect.right >= rectBoundingRect.right)\n      ) {\n        horizontal = true;\n      }\n      if (\n        (boundingRect.top > rectBoundingRect.top && boundingRect.top < rectBoundingRect.bottom) ||\n        (boundingRect.bottom > rectBoundingRect.top && boundingRect.bottom < rectBoundingRect.bottom) ||\n        (boundingRect.top <= rectBoundingRect.top && boundingRect.bottom >= rectBoundingRect.bottom)\n      ) {\n        vertical = true;\n      }\n      return horizontal && vertical;\n    }\n\n    /**\n     * Get selecting elements\n     * @param {DOMRect} rectBoundingRect\n     * @param {Element[]} elements\n     * @param {string} type\n     * @returns {string[]}\n     */\n    function getSelecting(rectBoundingRect, elements, type, getId) {\n      const selectingResult = [];\n      const currentlySelectingData = [];\n      const all = elements[type + 's'];\n      const currentSelecting = state.get(`${path}.selecting.${type}s`);\n      for (const element of all) {\n        const boundingRect = element.getBoundingClientRect();\n        if (isInside(boundingRect, rectBoundingRect)) {\n          currentlySelectingData.push(element.vido);\n          const canSelect = options.canSelect(type, currentlySelectingData);\n          if (canSelect.includes(element.vido)) {\n            if (!currentSelecting.includes(getId(element.vido))) {\n              options.selecting(element.vido, type);\n            }\n            selectingResult.push(getId(element.vido));\n          } else {\n            currentlySelectingData.unshift();\n          }\n        } else {\n          if (currentSelecting.includes(getId(element.vido))) {\n            options.deselecting(element.vido, type);\n          }\n        }\n      }\n      return selectingResult;\n    }\n\n    /**\n     * Select\n     * @param {Event} ev\n     */\n    function select(ev) {\n      if (!selecting.selecting) {\n        return;\n      }\n      saveAndSwapIfNeeded(ev);\n      rect.style.left = selecting.fromX + 'px';\n      rect.style.top = selecting.fromY + 'px';\n      rect.style.visibility = 'visible';\n      rect.style.width = selecting.toX - selecting.fromX + 'px';\n      rect.style.height = selecting.toY - selecting.fromY + 'px';\n      const rectBoundingRect = rect.getBoundingClientRect();\n      const elements = state.get('_internal.elements');\n      const nowSelecting = {};\n      for (const type in selectionTypesIdGetters) {\n        nowSelecting[type + 's'] = getSelecting(rectBoundingRect, elements, type, selectionTypesIdGetters[type]);\n      }\n      state.update(`${path}.selecting`, nowSelecting);\n      state.update('config.chart.items', function updateItems(items) {\n        const now = nowSelecting['chart-timeline-items-row-items'];\n        for (const itemId in items) {\n          const item = items[itemId];\n          if (now.includes(item.id)) {\n            item.selecting = true;\n          } else {\n            item.selecting = false;\n          }\n        }\n        return items;\n      });\n      state.update('_internal.chart.grid.rowsWithBlocks', function updateRowsWithBlocks(rowsWithBlocks) {\n        const nowBlocks = nowSelecting['chart-timeline-grid-row-blocks'];\n        const nowRows = nowSelecting['chart-timeline-grid-rows'];\n        for (const row of rowsWithBlocks) {\n          if (nowRows.includes(row.id)) {\n            row.selecting = true;\n          } else {\n            row.selecting = false;\n          }\n          for (const block of row.blocks) {\n            if (nowBlocks.includes(block.id)) {\n              block.selecting = true;\n            } else {\n              block.selecting = false;\n            }\n          }\n        }\n        return rowsWithBlocks;\n      });\n    }\n\n    /**\n     * End select\n     * @param {Event} ev\n     */\n    function endSelect(ev) {\n      if (selecting.selecting) {\n        ev.stopPropagation();\n      } else {\n        clearSelection();\n        return;\n      }\n      selecting.selecting = false;\n      rect.style.visibility = 'hidden';\n      const currentSelect = state.get(path);\n      const select: SelectState = {};\n      state.update(path, value => {\n        select.selected = { ...value.selecting };\n        select.selecting = {\n          'chart-timeline-grid-rows': [],\n          'chart-timeline-grid-row-blocks': [],\n          'chart-timeline-items-rows': [],\n          'chart-timeline-items-row-items': []\n        } as Items;\n        return select;\n      });\n      const elements = state.get('_internal.elements');\n      for (const type in selectionTypesIdGetters) {\n        for (const element of elements[type + 's']) {\n          if (currentSelect.selecting[type + 's'].includes(element.vido.id)) {\n            options.deselecting(element.vido, type);\n          }\n        }\n      }\n      state.update('config.chart.items', function updateItems(items) {\n        const now = currentSelect.selecting['chart-timeline-items-row-items'];\n        for (const itemId in items) {\n          const item = items[itemId];\n          if (now.includes(item.id)) {\n            item.selecting = true;\n          } else {\n            item.selecting = false;\n          }\n        }\n        return items;\n      });\n      state.update('_internal.chart.grid.rowsWithBlocks', function updateRowsWithBlocks(rowsWithBlocks) {\n        for (const row of rowsWithBlocks) {\n          for (const block of row.blocks) {\n            if (currentSelect.selecting['chart-timeline-grid-row-blocks'].includes(block.id)) {\n              if (typeof block.selected === 'undefined' || !block.selected) {\n                options.selected(block, 'chart-timeline-grid-row-block');\n              }\n              block.selected = true;\n            } else {\n              if (previousSelect.selected['chart-timeline-grid-row-blocks'].includes(block.id)) {\n                options.deselected(block, 'chart-timeline-grid-row-block');\n              }\n              block.selected = false;\n            }\n          }\n        }\n        return rowsWithBlocks;\n      });\n    }\n\n    /**\n     * Mouse down event handler\n     * @param {MouseEvent} ev\n     */\n    function mouseDown(ev) {\n      if (ev.button !== 0) {\n        return;\n      }\n      selecting.selecting = true;\n      selecting.fromX = ev.x - left;\n      selecting.fromY = ev.y - top;\n      selecting.startX = selecting.fromX;\n      selecting.startY = selecting.fromY;\n      previousSelect = cloneSelection(state.get(path));\n      clearSelection();\n    }\n\n    /**\n     * Mouse move event handler\n     * @param {MouseEvent} ev\n     */\n    function mouseMove(ev) {\n      select(ev);\n    }\n\n    /**\n     * Mouse up event handler\n     * @param {MouseEvent} ev\n     */\n    function mouseUp(ev) {\n      endSelect(ev);\n    }\n\n    element.addEventListener('mousedown', mouseDown);\n    document.addEventListener('mousemove', schedule(mouseMove));\n    document.body.addEventListener('mouseup', mouseUp);\n    return {\n      update() {},\n      destroy() {\n        document.body.removeEventListener('mouseup', mouseUp);\n        document.removeEventListener('mousemove', mouseMove);\n        element.removeEventListener('mousedown', mouseDown);\n      }\n    };\n  }\n\n  /**\n   * Update selection\n   * @param {any} data\n   * @param {Element} element\n   * @param {string} classNameSelecting\n   * @param {string} classNameSelected\n   */\n  function updateSelection(element, selecting, selected, classNameSelecting, classNameSelected) {\n    if (selecting && !element.classList.contains(classNameSelecting)) {\n      element.classList.add(classNameSelecting);\n    } else if (!selecting && element.classList.contains(classNameSelecting)) {\n      element.classList.remove(classNameSelecting);\n    }\n    if (selected && !element.classList.contains(classNameSelected)) {\n      element.classList.add(classNameSelected);\n    } else if (!selected && element.classList.contains(classNameSelected)) {\n      element.classList.remove(classNameSelected);\n    }\n  }\n\n  /**\n   * Grid row block action\n   * @param {Element} element\n   * @param {object} data\n   * @returns {object} with update and destroy functions\n   */\n  class GridBlockAction {\n    classNameSelecting: string;\n    classNameSelected: string;\n\n    constructor(element, data) {\n      this.classNameSelecting = api.getClass('chart-timeline-grid-row-block') + '--selecting';\n      this.classNameSelected = api.getClass('chart-timeline-grid-row-block') + '--selected';\n      updateSelection(element, data.selecting, data.selected, this.classNameSelecting, this.classNameSelected);\n    }\n\n    update(element, data) {\n      updateSelection(element, data.selecting, data.selected, this.classNameSelecting, this.classNameSelected);\n    }\n\n    destroy(element, changedData) {\n      element.classList.remove(this.classNameSelecting);\n      element.classList.remove(this.classNameSelected);\n    }\n  }\n\n  /**\n   * Item action\n   * @param {Element} element\n   * @param {object} data\n   * @returns {object} with update and destroy functions\n   */\n  class ItemAction {\n    classNameSelecting: string;\n    classNameSelected: string;\n\n    constructor(element, data) {\n      this.classNameSelecting = api.getClass('chart-timeline-items-row-item') + '--selecting';\n      this.classNameSelected = api.getClass('chart-timeline-items-row-item') + '--selected';\n      updateSelection(\n        element,\n        data.item.selecting,\n        data.item.selected,\n        this.classNameSelecting,\n        this.classNameSelected\n      );\n    }\n\n    update(element, data) {\n      updateSelection(\n        element,\n        data.item.selecting,\n        data.item.selected,\n        this.classNameSelecting,\n        this.classNameSelected\n      );\n    }\n\n    destroy(element, data) {\n      element.classList.remove(this.classNameSelecting);\n      element.classList.remove(this.classNameSelected);\n    }\n  }\n\n  /**\n   * On block create handler\n   * @param {object} block\n   * @returns {object} block\n   */\n  function onBlockCreate(block) {\n    const selectedBlocks = state.get('config.plugin.selection.selected.chart-timeline-grid-row-blocks');\n    for (const selectedBlock of selectedBlocks) {\n      if (selectedBlock === block.id) {\n        block.selected = true;\n        return block;\n      }\n    }\n    block.selected = false;\n    return block;\n  }\n\n  return function initialize(mainVido) {\n    vido = mainVido;\n    state = vido.state;\n    api = vido.api;\n    schedule = vido.schedule;\n    if (typeof state.get(path) === 'undefined') {\n      state.update(path, {\n        selecting: {\n          'chart-timeline-grid-rows': [],\n          'chart-timeline-grid-row-blocks': [],\n          'chart-timeline-items-rows': [],\n          'chart-timeline-items-row-items': []\n        },\n        selected: {\n          'chart-timeline-grid-rows': [],\n          'chart-timeline-grid-row-blocks': [],\n          'chart-timeline-items-rows': [],\n          'chart-timeline-items-row-items': []\n        }\n      });\n    }\n    state.update('config.chart.items', items => {\n      for (const itemId in items) {\n        const item = items[itemId];\n        if (typeof item.selecting === 'undefined') {\n          item.selecting = false;\n        }\n        if (typeof item.selected === 'undefined') {\n          item.selected = false;\n        }\n      }\n      return items;\n    });\n    state.update('config.actions.chart-timeline', actions => {\n      actions.push(selectionAction);\n      return actions;\n    });\n    state.update('config.actions.chart-timeline-grid-row-block', actions => {\n      actions.push(GridBlockAction);\n      return actions;\n    });\n    state.update('config.actions.chart-timeline-items-row-item', actions => {\n      actions.push(ItemAction);\n      return actions;\n    });\n    state.update('config.chart.grid.block.onCreate', onCreate => {\n      onCreate.push(onBlockCreate);\n      return onCreate;\n    });\n  };\n}\n"],"names":["ItemHold","options","defaultOptions","time","movementThreshold","[object Object]","element","data","holding","mouse","x","y","onMouseUp","itemId","action","elementMouseDown","event","onMouseDown","item","id","setTimeout","exec","xMovement","Math","sign","yMovement","onMouseMove","addEventListener","document","mouseUp","changedData","removeEventListener","initialize","vido","state","update","actions","push","ItemMovement","moveable","resizeable","resizerContent","collisionDetection","outOfBorders","snapStart","timeStart","startDiff","snapEnd","timeEnd","endDiff","ghostNode","movementState","node","api","querySelector","isResizeable","hasOwnProperty","row","getMovement","moving","resizing","moveGhost","ev","movement","left","ganttLeft","itemLeftCompensation","compensation","get","ghost","style","top","ganttTop","itemTop","destroyGhost","removeChild","getSnapStart","getSnapEnd","resizerHTML","getClass","insertAdjacentHTML","resizerEl","labelMouseDown","stopPropagation","button","chartLeftTime","timePerPixel","ganttRect","getBoundingClientRect","itemX","round","start","createGhost","cloneNode","getComputedStyle","position","offsetTop","width","height","clientHeight","opacity","transform","appendChild","resizerMouseDown","end","isCollision","rowId","from","to","diff","date","rowItem","_internal","items","documentMouseMove","zoom","isMoveable","Array","isArray","includes","movementX","add","originalStart","finalAdd","collision","moveItem","visibleRowsIndex","movementY","visibleRows","index","currentRow","length","newRow","newRowId","resizeX","leftGlobal","originalEnd","documentMouseUp","visibility","capture","passive","remove","SaveAsImage","saveAsImage","target","clientWidth","html","unescape","encodeURIComponent","outerHTML","styleSheet","styleSheets","title","rule","rules","cssText","svg","canvas","createElement","ctx","getContext","fillStyle","fillRect","svg64","btoa","img","Image","onload","onLoad","drawImage","downloadImage","filename","a","href","download","body","click","toDataURL","src","subscribe","main","Selection","schedule","grid","rows","horizontal","vertical","rectStyle","canSelect","type","currently","chartTimeline","Object","selecting","fromX","fromY","toX","toY","startX","startY","startCell","selectionTypesIdGetters","chart-timeline-grid-row","props","chart-timeline-grid-row-block","chart-timeline-items-row","chart-timeline-items-row-item","path","rectClassName","rect","classList","background","border","styleProp","selectionAction","previousSelect","insertAdjacentElement","bounding","clearSelection","chart-timeline-grid-rows","chart-timeline-grid-row-blocks","chart-timeline-items-rows","chart-timeline-items-row-items","selected","clearRowsWithBlocks","rowsWithBlocks","block","blocks","isInside","boundingRect","rectBoundingRect","right","bottom","getSelecting","elements","getId","selectingResult","currentlySelectingData","all","currentSelecting","unshift","deselecting","select","saveAndSwapIfNeeded","currentX","currentY","nowSelecting","updateItems","now","updateRowsWithBlocks","nowBlocks","nowRows","mouseDown","cloneSelection","currentSelect","result","slice","mouseMove","endSelect","value","deselected","updateSelection","classNameSelecting","classNameSelected","contains","GridBlockAction","this","ItemAction","onBlockCreate","selectedBlocks","selectedBlock","mainVido","onCreate"],"mappings":"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"}