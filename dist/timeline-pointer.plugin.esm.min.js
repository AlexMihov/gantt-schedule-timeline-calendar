const t="chart-timeline-grid-row-cell",e="chart-timeline-items-row-item";function a(t){const e={enabled:!0,isMoving:!1,pointerState:"up",currentTarget:null,realTarget:null,targetType:"",targetData:null,captureEvents:{down:!1,up:!1,move:!1},initialPosition:{x:0,y:0},currentPosition:{x:0,y:0},events:{down:null,move:null,up:null}};return t.captureEvents&&(e.captureEvents=Object.assign(Object.assign({},e.captureEvents),t.captureEvents)),e}const i="config.plugin.TimelinePointer";class s{constructor(s,n){this.unsub=[],this.classNames={cell:"",item:""},this.vido=n,this.api=n.api,this.state=n.state,this.element=this.state.get("$data.elements.chart-timeline"),this.pointerDown=this.pointerDown.bind(this),this.pointerMove=this.pointerMove.bind(this),this.pointerUp=this.pointerUp.bind(this),this.data=a(s),this.classNames.cell=this.api.getClass(t),this.classNames.item=this.api.getClass(e),this.element.addEventListener("pointerdown",this.pointerDown,this.data.captureEvents.down),document.addEventListener("pointerup",this.pointerUp,this.data.captureEvents.up),document.addEventListener("pointermove",this.pointerMove,this.data.captureEvents.move),this.unsub.push(this.state.subscribe(i,t=>this.data=t))}destroy(){this&&this.element&&(this.element.removeEventListener("pointerdown",this.pointerDown),document.removeEventListener("pointerup",this.pointerUp),document.removeEventListener("pointermove",this.pointerMove))}updateData(){this.state.update(i,()=>Object.assign({},this.data))}getRealTarget(t){let e=t.target.closest("."+this.classNames.item);return e||(e=t.target.closest("."+this.classNames.cell),e||null)}getRealPosition(t){const e={x:0,y:0};if(this.element){const a=this.element.getBoundingClientRect();e.x=t.x-a.x,e.y=t.y-a.y}return e}pointerDown(a){if(!this.data.enabled)return;this.data.pointerState="down",this.data.currentTarget=a.target,this.data.realTarget=this.getRealTarget(a),this.data.realTarget?this.data.realTarget.classList.contains(this.classNames.item)?(this.data.targetType=e,this.data.targetData=this.data.realTarget.vido.item):this.data.realTarget.classList.contains(this.classNames.cell)?(this.data.targetType=t,this.data.targetData=this.data.realTarget.vido):this.data.targetType="":(this.data.targetType="",this.data.targetData=null),this.data.isMoving=!!this.data.realTarget,this.data.events.down=a,this.data.events.move=a;const i=this.getRealPosition(a);this.data.initialPosition=i,this.data.currentPosition=i,this.updateData()}pointerUp(t){this.data.enabled&&(this.data.pointerState="up",this.data.isMoving=!1,this.data.events.up=t,this.data.currentPosition=this.getRealPosition(t),this.updateData())}pointerMove(t){this.data.enabled&&this.data.isMoving&&(this.data.pointerState="move",this.data.events.move=t,this.data.currentPosition=this.getRealPosition(t),this.updateData())}}function n(t){return function(e){const n=a(t);let r;e.state.update(i,n);const o=e.state.subscribe("$data.elements.chart-timeline",a=>{if(a){const a=new s(t,e);r=a.destroy}});return function(){o(),r&&r()}}}export{t as CELL,e as ITEM,n as Plugin};
