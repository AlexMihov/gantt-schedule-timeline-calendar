{"version":3,"file":"Selection.plugin.min.js","sources":["../src/plugins/Selection.plugin.ts"],"sourcesContent":["/**\n * Selection plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nexport interface RectStyle {\n  [key: string]: any;\n}\n\nexport interface Options {\n  grid?: boolean;\n  items?: boolean;\n  rows?: boolean;\n  horizontal?: boolean;\n  vertical?: boolean;\n  rectStyle?: RectStyle;\n  selecting?: (data, type: string) => void;\n  deselecting?: (data, type: string) => void;\n  selected?: (data, type) => void;\n  deselected?: (data, type) => void;\n  canSelect?: (type, state) => any[];\n}\n\nexport interface Items {\n  [key: string]: string[];\n}\n\ninterface SelectingData {\n  fromX?: number;\n  fromY?: number;\n  toX?: number;\n  toY?: number;\n  startX?: number;\n  startY?: number;\n  startCell?: any;\n  selecting?: boolean;\n  selected?: Items;\n}\n\nexport interface SelectState {\n  selecting?: Items;\n  selected?: Items;\n}\n\nexport default function Selection(options: Options = {}) {\n  let vido, state, api, schedule;\n  const defaultOptions: Options = {\n    grid: false,\n    items: true,\n    rows: false,\n    horizontal: true,\n    vertical: true,\n    rectStyle: {},\n    selecting() {},\n    deselecting() {},\n    selected() {},\n    deselected() {},\n    canSelect(type, currently) {\n      return currently;\n    }\n  };\n  options = { ...defaultOptions, ...options } as Options;\n  let chartTimeline, top, left;\n  let selecting: SelectingData = {\n    fromX: -1,\n    fromY: -1,\n    toX: -1,\n    toY: -1,\n    startX: -1,\n    startY: -1,\n    startCell: false,\n    selecting: false\n  };\n  const selectionTypesIdGetters = {\n    'chart-timeline-grid-row': props => props.row.id,\n    'chart-timeline-grid-row-block': props => props.id,\n    'chart-timeline-items-row': props => props.row.id,\n    'chart-timeline-items-row-item': props => props.item.id\n  };\n  const path = 'config.plugin.selection';\n  const rectClassName = 'gantt-schedule-timeline-caledar__plugin-selection-rect';\n  const rect = document.createElement('div');\n  rect.classList.add(rectClassName);\n  rect.style.visibility = 'hidden';\n  rect.style.left = '0px';\n  rect.style.top = '0px';\n  rect.style.width = '0px';\n  rect.style.height = '0px';\n  rect.style.background = 'rgba(0, 119, 192, 0.2)';\n  rect.style.border = '2px dashed rgba(0, 119, 192, 0.75)';\n  rect.style.position = 'absolute';\n  rect.style['user-select'] = 'none';\n  rect.style['pointer-events'] = 'none';\n  for (const styleProp in options.rectStyle) {\n    rect.style[styleProp] = options.rectStyle[styleProp];\n  }\n\n  /**\n   * Selection action\n   * @param {Element} element\n   * @param {object|any} data\n   * @returns {object} with update and destroy\n   */\n  function selectionAction(element, data) {\n    let previousSelect;\n    chartTimeline = state.get('_internal.elements.chart-timeline');\n    if (!chartTimeline.querySelector('.' + rectClassName)) {\n      chartTimeline.insertAdjacentElement('beforeend', rect);\n      const bounding = chartTimeline.getBoundingClientRect();\n      left = bounding.left;\n      top = bounding.top;\n    }\n\n    /**\n     * Clear selection\n     */\n    function clearSelection() {\n      state.update(path, {\n        selecting: {\n          'chart-timeline-grid-rows': [],\n          'chart-timeline-grid-row-blocks': [],\n          'chart-timeline-items-rows': [],\n          'chart-timeline-items-row-items': []\n        },\n        selected: {\n          'chart-timeline-grid-rows': [],\n          'chart-timeline-grid-row-blocks': [],\n          'chart-timeline-items-rows': [],\n          'chart-timeline-items-row-items': []\n        }\n      });\n      state.update('_internal.chart.grid.rowsWithBlocks', function clearRowsWithBlocks(rowsWithBlocks) {\n        for (const row of rowsWithBlocks) {\n          for (const block of row.blocks) {\n            block.selected = false;\n            block.selecting = false;\n          }\n        }\n        return rowsWithBlocks;\n      });\n    }\n\n    /**\n     * Clone current selection state\n     * @param {object} currentSelect\n     * @returns {object} currentSelect cloned\n     */\n    function cloneSelection(currentSelect) {\n      const result: SelectingData = {};\n      result.selecting = { ...currentSelect.selecting };\n      result.selecting['chart-timeline-grid-rows'] = currentSelect.selecting['chart-timeline-grid-rows'].slice();\n      result.selecting['chart-timeline-grid-row-blocks'] = currentSelect.selecting[\n        'chart-timeline-grid-row-blocks'\n      ].slice();\n      result.selecting['chart-timeline-items-rows'] = currentSelect.selecting['chart-timeline-items-rows'].slice();\n      result.selecting['chart-timeline-items-row-items'] = currentSelect.selecting[\n        'chart-timeline-items-row-items'\n      ].slice();\n      result.selected = { ...currentSelect.selected };\n      result.selected['chart-timeline-grid-rows'] = currentSelect.selected['chart-timeline-grid-rows'].slice();\n      result.selected['chart-timeline-grid-row-blocks'] = currentSelect.selected[\n        'chart-timeline-grid-row-blocks'\n      ].slice();\n      result.selected['chart-timeline-items-rows'] = currentSelect.selected['chart-timeline-items-rows'].slice();\n      result.selected['chart-timeline-items-row-items'] = currentSelect.selected[\n        'chart-timeline-items-row-items'\n      ].slice();\n      return result;\n    }\n\n    /**\n     * Save and swap coordinates if needed\n     * @param {Event} ev\n     */\n    function saveAndSwapIfNeeded(ev) {\n      // @ts-ignore\n      const currentX = ev.x - left;\n      // @ts-ignore\n      const currentY = ev.y - top;\n      if (currentX <= selecting.startX) {\n        selecting.fromX = currentX;\n        selecting.toX = selecting.startX;\n      } else {\n        selecting.fromX = selecting.startX;\n        selecting.toX = currentX;\n      }\n      if (currentY <= selecting.startY) {\n        selecting.fromY = currentY;\n        selecting.toY = selecting.startY;\n      } else {\n        selecting.fromY = selecting.startY;\n        selecting.toY = currentY;\n      }\n    }\n\n    /**\n     * Is rectangle inside other rectangle ?\n     * @param {DOMRect} boundingRect\n     * @param {DOMRect} rectBoundingRect\n     * @returns {boolean}\n     */\n    function isInside(boundingRect, rectBoundingRect) {\n      let horizontal = false;\n      let vertical = false;\n      if (\n        (boundingRect.left > rectBoundingRect.left && boundingRect.left < rectBoundingRect.right) ||\n        (boundingRect.right > rectBoundingRect.left && boundingRect.right < rectBoundingRect.right) ||\n        (boundingRect.left <= rectBoundingRect.left && boundingRect.right >= rectBoundingRect.right)\n      ) {\n        horizontal = true;\n      }\n      if (\n        (boundingRect.top > rectBoundingRect.top && boundingRect.top < rectBoundingRect.bottom) ||\n        (boundingRect.bottom > rectBoundingRect.top && boundingRect.bottom < rectBoundingRect.bottom) ||\n        (boundingRect.top <= rectBoundingRect.top && boundingRect.bottom >= rectBoundingRect.bottom)\n      ) {\n        vertical = true;\n      }\n      return horizontal && vertical;\n    }\n\n    /**\n     * Get selecting elements\n     * @param {DOMRect} rectBoundingRect\n     * @param {Element[]} elements\n     * @param {string} type\n     * @returns {string[]}\n     */\n    function getSelecting(rectBoundingRect, elements, type, getId) {\n      const selectingResult = [];\n      const currentlySelectingData = [];\n      const all = elements[type + 's'];\n      const currentSelecting = state.get(`${path}.selecting.${type}s`);\n      for (const element of all) {\n        const boundingRect = element.getBoundingClientRect();\n        if (isInside(boundingRect, rectBoundingRect)) {\n          currentlySelectingData.push(element.vido);\n          const canSelect = options.canSelect(type, currentlySelectingData);\n          if (canSelect.includes(element.vido)) {\n            if (!currentSelecting.includes(getId(element.vido))) {\n              options.selecting(element.vido, type);\n            }\n            selectingResult.push(getId(element.vido));\n          } else {\n            currentlySelectingData.unshift();\n          }\n        } else {\n          if (currentSelecting.includes(getId(element.vido))) {\n            options.deselecting(element.vido, type);\n          }\n        }\n      }\n      return selectingResult;\n    }\n\n    /**\n     * Select\n     * @param {Event} ev\n     */\n    function select(ev) {\n      if (!selecting.selecting) {\n        return;\n      }\n      saveAndSwapIfNeeded(ev);\n      rect.style.left = selecting.fromX + 'px';\n      rect.style.top = selecting.fromY + 'px';\n      rect.style.visibility = 'visible';\n      rect.style.width = selecting.toX - selecting.fromX + 'px';\n      rect.style.height = selecting.toY - selecting.fromY + 'px';\n      const rectBoundingRect = rect.getBoundingClientRect();\n      const elements = state.get('_internal.elements');\n      const nowSelecting = {};\n      for (const type in selectionTypesIdGetters) {\n        nowSelecting[type + 's'] = getSelecting(rectBoundingRect, elements, type, selectionTypesIdGetters[type]);\n      }\n      state.update(`${path}.selecting`, nowSelecting);\n      state.update('config.chart.items', function updateItems(items) {\n        const now = nowSelecting['chart-timeline-items-row-items'];\n        for (const itemId in items) {\n          const item = items[itemId];\n          if (now.includes(item.id)) {\n            item.selecting = true;\n          } else {\n            item.selecting = false;\n          }\n        }\n        return items;\n      });\n      state.update('_internal.chart.grid.rowsWithBlocks', function updateRowsWithBlocks(rowsWithBlocks) {\n        const nowBlocks = nowSelecting['chart-timeline-grid-row-blocks'];\n        const nowRows = nowSelecting['chart-timeline-grid-rows'];\n        for (const row of rowsWithBlocks) {\n          if (nowRows.includes(row.id)) {\n            row.selecting = true;\n          } else {\n            row.selecting = false;\n          }\n          for (const block of row.blocks) {\n            if (nowBlocks.includes(block.id)) {\n              block.selecting = true;\n            } else {\n              block.selecting = false;\n            }\n          }\n        }\n        return rowsWithBlocks;\n      });\n    }\n\n    /**\n     * End select\n     * @param {Event} ev\n     */\n    function endSelect(ev) {\n      if (selecting.selecting) {\n        ev.stopPropagation();\n      } else {\n        clearSelection();\n        return;\n      }\n      selecting.selecting = false;\n      rect.style.visibility = 'hidden';\n      const currentSelect = state.get(path);\n      const select: SelectState = {};\n      state.update(path, value => {\n        select.selected = { ...value.selecting };\n        select.selecting = {\n          'chart-timeline-grid-rows': [],\n          'chart-timeline-grid-row-blocks': [],\n          'chart-timeline-items-rows': [],\n          'chart-timeline-items-row-items': []\n        } as Items;\n        return select;\n      });\n      const elements = state.get('_internal.elements');\n      for (const type in selectionTypesIdGetters) {\n        for (const element of elements[type + 's']) {\n          if (currentSelect.selecting[type + 's'].includes(element.vido.id)) {\n            options.deselecting(element.vido, type);\n          }\n        }\n      }\n      state.update('config.chart.items', function updateItems(items) {\n        const now = currentSelect.selecting['chart-timeline-items-row-items'];\n        for (const itemId in items) {\n          const item = items[itemId];\n          if (now.includes(item.id)) {\n            item.selecting = true;\n          } else {\n            item.selecting = false;\n          }\n        }\n        return items;\n      });\n      state.update('_internal.chart.grid.rowsWithBlocks', function updateRowsWithBlocks(rowsWithBlocks) {\n        for (const row of rowsWithBlocks) {\n          for (const block of row.blocks) {\n            if (currentSelect.selecting['chart-timeline-grid-row-blocks'].includes(block.id)) {\n              if (typeof block.selected === 'undefined' || !block.selected) {\n                options.selected(block, 'chart-timeline-grid-row-block');\n              }\n              block.selected = true;\n            } else {\n              if (previousSelect.selected['chart-timeline-grid-row-blocks'].includes(block.id)) {\n                options.deselected(block, 'chart-timeline-grid-row-block');\n              }\n              block.selected = false;\n            }\n          }\n        }\n        return rowsWithBlocks;\n      });\n    }\n\n    /**\n     * Mouse down event handler\n     * @param {MouseEvent} ev\n     */\n    function mouseDown(ev) {\n      if (ev.button !== 0) {\n        return;\n      }\n      selecting.selecting = true;\n      selecting.fromX = ev.x - left;\n      selecting.fromY = ev.y - top;\n      selecting.startX = selecting.fromX;\n      selecting.startY = selecting.fromY;\n      previousSelect = cloneSelection(state.get(path));\n      clearSelection();\n    }\n\n    /**\n     * Mouse move event handler\n     * @param {MouseEvent} ev\n     */\n    function mouseMove(ev) {\n      select(ev);\n    }\n\n    /**\n     * Mouse up event handler\n     * @param {MouseEvent} ev\n     */\n    function mouseUp(ev) {\n      endSelect(ev);\n    }\n\n    element.addEventListener('mousedown', mouseDown);\n    document.addEventListener('mousemove', schedule(mouseMove));\n    document.body.addEventListener('mouseup', mouseUp);\n    return {\n      update() {},\n      destroy() {\n        document.body.removeEventListener('mouseup', mouseUp);\n        document.removeEventListener('mousemove', mouseMove);\n        element.removeEventListener('mousedown', mouseDown);\n      }\n    };\n  }\n\n  /**\n   * Update selection\n   * @param {any} data\n   * @param {Element} element\n   * @param {string} classNameSelecting\n   * @param {string} classNameSelected\n   */\n  function updateSelection(element, selecting, selected, classNameSelecting, classNameSelected) {\n    if (selecting && !element.classList.contains(classNameSelecting)) {\n      element.classList.add(classNameSelecting);\n    } else if (!selecting && element.classList.contains(classNameSelecting)) {\n      element.classList.remove(classNameSelecting);\n    }\n    if (selected && !element.classList.contains(classNameSelected)) {\n      element.classList.add(classNameSelected);\n    } else if (!selected && element.classList.contains(classNameSelected)) {\n      element.classList.remove(classNameSelected);\n    }\n  }\n\n  /**\n   * Grid row block action\n   * @param {Element} element\n   * @param {object} data\n   * @returns {object} with update and destroy functions\n   */\n  class GridBlockAction {\n    classNameSelecting: string;\n    classNameSelected: string;\n\n    constructor(element, data) {\n      this.classNameSelecting = api.getClass('chart-timeline-grid-row-block') + '--selecting';\n      this.classNameSelected = api.getClass('chart-timeline-grid-row-block') + '--selected';\n      updateSelection(element, data.selecting, data.selected, this.classNameSelecting, this.classNameSelected);\n    }\n\n    update(element, data) {\n      updateSelection(element, data.selecting, data.selected, this.classNameSelecting, this.classNameSelected);\n    }\n\n    destroy(element, changedData) {\n      element.classList.remove(this.classNameSelecting);\n      element.classList.remove(this.classNameSelected);\n    }\n  }\n\n  /**\n   * Item action\n   * @param {Element} element\n   * @param {object} data\n   * @returns {object} with update and destroy functions\n   */\n  class ItemAction {\n    classNameSelecting: string;\n    classNameSelected: string;\n\n    constructor(element, data) {\n      this.classNameSelecting = api.getClass('chart-timeline-items-row-item') + '--selecting';\n      this.classNameSelected = api.getClass('chart-timeline-items-row-item') + '--selected';\n      updateSelection(\n        element,\n        data.item.selecting,\n        data.item.selected,\n        this.classNameSelecting,\n        this.classNameSelected\n      );\n    }\n\n    update(element, data) {\n      updateSelection(\n        element,\n        data.item.selecting,\n        data.item.selected,\n        this.classNameSelecting,\n        this.classNameSelected\n      );\n    }\n\n    destroy(element, data) {\n      element.classList.remove(this.classNameSelecting);\n      element.classList.remove(this.classNameSelected);\n    }\n  }\n\n  /**\n   * On block create handler\n   * @param {object} block\n   * @returns {object} block\n   */\n  function onBlockCreate(block) {\n    const selectedBlocks = state.get('config.plugin.selection.selected.chart-timeline-grid-row-blocks');\n    for (const selectedBlock of selectedBlocks) {\n      if (selectedBlock === block.id) {\n        block.selected = true;\n        return block;\n      }\n    }\n    block.selected = false;\n    return block;\n  }\n\n  return function initialize(mainVido) {\n    vido = mainVido;\n    state = vido.state;\n    api = vido.api;\n    schedule = vido.schedule;\n    if (typeof state.get(path) === 'undefined') {\n      state.update(path, {\n        selecting: {\n          'chart-timeline-grid-rows': [],\n          'chart-timeline-grid-row-blocks': [],\n          'chart-timeline-items-rows': [],\n          'chart-timeline-items-row-items': []\n        },\n        selected: {\n          'chart-timeline-grid-rows': [],\n          'chart-timeline-grid-row-blocks': [],\n          'chart-timeline-items-rows': [],\n          'chart-timeline-items-row-items': []\n        }\n      });\n    }\n    state.update('config.chart.items', items => {\n      for (const itemId in items) {\n        const item = items[itemId];\n        if (typeof item.selecting === 'undefined') {\n          item.selecting = false;\n        }\n        if (typeof item.selected === 'undefined') {\n          item.selected = false;\n        }\n      }\n      return items;\n    });\n    state.update('config.actions.chart-timeline', actions => {\n      actions.push(selectionAction);\n      return actions;\n    });\n    state.update('config.actions.chart-timeline-grid-row-block', actions => {\n      actions.push(GridBlockAction);\n      return actions;\n    });\n    state.update('config.actions.chart-timeline-items-row-item', actions => {\n      actions.push(ItemAction);\n      return actions;\n    });\n    state.update('config.chart.grid.block.onCreate', onCreate => {\n      onCreate.push(onBlockCreate);\n      return onCreate;\n    });\n  };\n}\n"],"names":["Selection","options","vido","state","api","schedule","defaultOptions","grid","items","rows","horizontal","vertical","rectStyle","[object Object]","canSelect","type","currently","chartTimeline","top","left","Object","selecting","fromX","fromY","toX","toY","startX","startY","startCell","selectionTypesIdGetters","chart-timeline-grid-row","props","row","id","chart-timeline-grid-row-block","chart-timeline-items-row","chart-timeline-items-row-item","item","path","rectClassName","rect","document","createElement","classList","add","style","visibility","width","height","background","border","position","styleProp","selectionAction","element","data","previousSelect","get","querySelector","insertAdjacentElement","bounding","getBoundingClientRect","clearSelection","update","chart-timeline-grid-rows","chart-timeline-grid-row-blocks","chart-timeline-items-rows","chart-timeline-items-row-items","selected","clearRowsWithBlocks","rowsWithBlocks","block","blocks","isInside","boundingRect","rectBoundingRect","right","bottom","getSelecting","elements","getId","selectingResult","currentlySelectingData","all","currentSelecting","push","includes","unshift","deselecting","select","ev","saveAndSwapIfNeeded","currentX","x","currentY","y","nowSelecting","updateItems","now","itemId","updateRowsWithBlocks","nowBlocks","nowRows","mouseDown","button","cloneSelection","currentSelect","result","slice","mouseMove","mouseUp","endSelect","stopPropagation","value","deselected","addEventListener","body","removeEventListener","updateSelection","classNameSelecting","classNameSelected","contains","remove","GridBlockAction","this","getClass","changedData","ItemAction","onBlockCreate","selectedBlocks","selectedBlock","initialize","mainVido","actions","onCreate"],"mappings":"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"}