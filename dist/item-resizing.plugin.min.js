!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t=t||self).ItemResizing={})}(this,(function(t){"use strict";class i{constructor(t,i){this.spacing=1,this.unsubs=[],this.vido=t,this.state=t.state,this.api=t.api,this.data=function(t={}){const i=Object.assign({enabled:!0,handle:{width:18,horizontalMargin:1,verticalMargin:1,outside:!1,onlyWhenSelected:!0},initialPosition:{x:0,y:0},currentPosition:{x:0,y:0},movement:0,itemsInitial:[],leftIsMoving:!1,rightIsMoving:!1},t);return t.handle&&(i.handle=Object.assign(Object.assign({},i.handle),t.handle)),i}(i),this.html=t.html,this.wrapper=this.wrapper.bind(this),this.onRightPointerDown=this.onRightPointerDown.bind(this),this.onRightPointerMove=this.onRightPointerMove.bind(this),this.onRightPointerUp=this.onRightPointerUp.bind(this),this.onLeftPointerDown=this.onLeftPointerDown.bind(this),this.onLeftPointerMove=this.onLeftPointerMove.bind(this),this.onLeftPointerUp=this.onLeftPointerUp.bind(this),this.updateData(),this.unsubs.push(this.state.subscribe("config.plugin.ItemResizing",t=>this.data=t)),document.addEventListener("pointermove",this.onLeftPointerMove),document.addEventListener("pointerup",this.onLeftPointerUp),document.addEventListener("pointermove",this.onRightPointerMove),document.addEventListener("pointerup",this.onRightPointerUp)}destroy(){this.unsubs.forEach(t=>t()),document.removeEventListener("pointermove",this.onLeftPointerMove),document.removeEventListener("pointerup",this.onLeftPointerUp),document.removeEventListener("pointermove",this.onRightPointerMove),document.removeEventListener("pointerup",this.onRightPointerUp)}updateData(){this.state.update("config.plugin.ItemResizing",this.data)}initializeWrapper(){this.leftClassName=this.api.getClass("chart-timeline-items-row-item-resizing-handle"),this.leftClassName+=" "+this.leftClassName+"--left",this.rightClassName=this.api.getClass("chart-timeline-items-row-item-resizing-handle"),this.rightClassName+=" "+this.rightClassName+"--right",this.spacing=this.state.get("config.chart.spacing")}getSelectedItems(){return this.state.get("config.plugin.Selection.selected.chart-timeline-items-row-item")}getRightStyleMap(t,i){const e=new this.vido.StyleMap({});return e.style.display=i?"block":"none",e.style.top=t.$data.position.actualTop+this.data.handle.verticalMargin+"px",this.data.handle.outside?e.style.left=t.$data.position.right+this.data.handle.horizontalMargin-this.spacing+"px":e.style.left=t.$data.position.right-this.data.handle.width-this.data.handle.horizontalMargin-this.spacing+"px",e.style.width=this.data.handle.width+"px",e.style.height=t.$data.actualHeight-2*this.data.handle.verticalMargin+"px",e}getLeftStyleMap(t,i){const e=new this.vido.StyleMap({});return e.style.display=i?"block":"none",e.style.top=t.$data.position.actualTop+this.data.handle.verticalMargin+"px",this.data.handle.outside?e.style.left=t.$data.position.left-this.data.handle.width-this.data.handle.horizontalMargin+"px":e.style.left=t.$data.position.left+this.data.handle.horizontalMargin+"px",e.style.width=this.data.handle.width+"px",e.style.height=t.$data.actualHeight-2*this.data.handle.verticalMargin+"px",e}onPointerDown(t){t.preventDefault(),t.stopPropagation(),this.data.itemsInitial=this.getSelectedItems().map(t=>({id:t.id,left:t.$data.position.left,width:t.$data.width})),this.data.initialPosition={x:t.screenX,y:t.screenY},this.data.currentPosition=Object.assign({},this.data.initialPosition)}onLeftPointerDown(t){}onRightPointerDown(t){this.data.enabled&&(this.data.rightIsMoving=!0,this.onPointerDown(t),this.updateData())}onPointerMove(t){t.stopPropagation(),t.preventDefault(),this.data.currentPosition.x=t.screenX,this.data.currentPosition.y=t.screenY,this.data.movement=this.data.currentPosition.x-this.data.initialPosition.x}onLeftPointerMove(t){if(!this.data.enabled||!this.data.leftIsMoving)return;this.onPointerMove(t);const i=this.getSelectedItems(),e=this.data.movement,a=this.state.get("$data.chart.time");let n=this.state.multi();for(let t=0,s=i.length;t<s;t++){const s=i[t];s.$data.position.left=this.data.itemsInitial[t].left+e,s.$data.position.left>s.$data.position.right&&(s.$data.position.left=s.$data.position.right),s.$data.position.actualLeft=s.$data.position.left,s.$data.width=s.$data.position.right-s.$data.position.left,s.$data.actualWidth=s.$data.width;const o=this.api.time.getTimeFromViewOffsetPx(s.$data.position.left,a);s.time.start=o,s.$data.time.startDate=this.api.time.date(o),n=n.update(`config.chart.items.${s.id}`,s)}n.done(),this.updateData()}onRightPointerMove(t){if(!this.data.enabled||!this.data.rightIsMoving)return;this.onPointerMove(t);const i=this.getSelectedItems(),e=this.data.movement,a=this.state.get("$data.chart.time");let n=this.state.multi();for(let t=0,s=i.length;t<s;t++){const s=i[t];s.$data.width=this.data.itemsInitial[t].width+e,s.$data.width<0&&(s.$data.width=0),s.$data.actualWidth=s.$data.width;const o=s.$data.position.left+s.$data.width;s.$data.position.right=o,s.$data.position.actualRight=o;const h=this.api.time.getTimeFromViewOffsetPx(o,a);s.time.end=h,s.$data.time.endDate=this.api.time.date(h),n=n.update(`config.chart.items.${s.id}`,s)}n.done(),this.updateData()}onPointerUp(t){t.preventDefault(),t.stopPropagation()}onLeftPointerUp(t){this.data.enabled&&this.data.leftIsMoving&&(this.onPointerUp(t),this.data.leftIsMoving=!1,this.updateData())}onRightPointerUp(t){this.data.enabled&&this.data.rightIsMoving&&(this.onPointerUp(t),this.data.rightIsMoving=!1,this.updateData())}wrapper(t,i){const e=this.oldWrapper(t,i),a=i.props.item;let n=!a.$data.detached;this.data.handle.onlyWhenSelected&&(n=n&&a.selected);const s=this.getRightStyleMap(a,n),o=this.getLeftStyleMap(a,n),h={handleEvent:this.onLeftPointerDown},d={handleEvent:this.onRightPointerDown},r=(this.html`<div class=${this.leftClassName} style=${o} @pointerdown=${h}></div>`,this.html`<div class=${this.rightClassName} style=${s} @pointerdown=${d}></div>`);return this.html`${e}${r}`}getWrapper(t){return this.oldWrapper||(this.oldWrapper=t),this.initializeWrapper(),this.wrapper}}t.Plugin=function(t={}){return function(e){const a=new i(e,t);e.state.update("config.wrappers.ChartTimelineItemsRowItem",t=>a.getWrapper(t))}},Object.defineProperty(t,"__esModule",{value:!0})}));
