!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Selection=t()}(this,(function(){"use strict";
/**
   * Selection plugin
   *
   * @copyright Rafal Pospiech <https://neuronet.io>
   * @author    Rafal Pospiech <neuronet.io@gmail.com>
   * @package   gantt-schedule-timeline-calendar
   * @license   GPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
   * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar
   */return function Selection(e={}){let t,i,s,c;const n={grid:!1,items:!0,rows:!1,horizontal:!0,vertical:!0,rectStyle:{},selecting(){},deselecting(){},selected(){},deselected(){},canSelect:(e,t)=>t};let o,l,r;e=Object.assign(Object.assign({},n),e);let d={fromX:-1,fromY:-1,toX:-1,toY:-1,startX:-1,startY:-1,startCell:!1,selecting:!1};const a={"chart-timeline-grid-row":e=>e.row.id,"chart-timeline-grid-row-block":e=>e.id,"chart-timeline-items-row":e=>e.row.id,"chart-timeline-items-row-item":e=>e.item.id},m="config.plugin.selection",g="gantt-schedule-timeline-caledar__plugin-selection-rect",u=document.createElement("div");u.classList.add(g),u.style.visibility="hidden",u.style.left="0px",u.style.top="0px",u.style.width="0px",u.style.height="0px",u.style.background="rgba(0, 119, 192, 0.2)",u.style.border="2px dashed rgba(0, 119, 192, 0.75)",u.style.position="absolute",u.style["user-select"]="none",u.style["pointer-events"]="none";for(const t in e.rectStyle)u.style[t]=e.rectStyle[t];function selectionAction(t,s){let n;if(!(o=i.get("_internal.elements.chart-timeline")).querySelector("."+g)){o.insertAdjacentElement("beforeend",u);const e=o.getBoundingClientRect();r=e.left,l=e.top}function clearSelection(){i.update(m,{selecting:{"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]},selected:{"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]}}),i.update("_internal.chart.grid.rowsWithBlocks",(function clearRowsWithBlocks(e){for(const t of e)for(const e of t.blocks)e.selected=!1,e.selecting=!1;return e}))}function isInside(e,t){let i=!1,s=!1;return(e.left>t.left&&e.left<t.right||e.right>t.left&&e.right<t.right||e.left<=t.left&&e.right>=t.right)&&(i=!0),(e.top>t.top&&e.top<t.bottom||e.bottom>t.top&&e.bottom<t.bottom||e.top<=t.top&&e.bottom>=t.bottom)&&(s=!0),i&&s}function getSelecting(t,s,c,n){const o=[],l=[],r=s[c+"s"],d=i.get(`${m}.selecting.${c}s`);for(const i of r){if(isInside(i.getBoundingClientRect(),t)){l.push(i.vido),e.canSelect(c,l).includes(i.vido)?(d.includes(n(i.vido))||e.selecting(i.vido,c),o.push(n(i.vido))):l.unshift()}else d.includes(n(i.vido))&&e.deselecting(i.vido,c)}return o}function select(e){if(!d.selecting)return;!function saveAndSwapIfNeeded(e){const t=e.x-r,i=e.y-l;t<=d.startX?(d.fromX=t,d.toX=d.startX):(d.fromX=d.startX,d.toX=t),i<=d.startY?(d.fromY=i,d.toY=d.startY):(d.fromY=d.startY,d.toY=i)}(e),u.style.left=d.fromX+"px",u.style.top=d.fromY+"px",u.style.visibility="visible",u.style.width=d.toX-d.fromX+"px",u.style.height=d.toY-d.fromY+"px";const t=u.getBoundingClientRect(),s=i.get("_internal.elements"),c={};for(const e in a)c[e+"s"]=getSelecting(t,s,e,a[e]);i.update(`${m}.selecting`,c),i.update("config.chart.items",(function updateItems(e){const t=c["chart-timeline-items-row-items"];for(const i in e){const s=e[i];t.includes(s.id)?s.selecting=!0:s.selecting=!1}return e})),i.update("_internal.chart.grid.rowsWithBlocks",(function updateRowsWithBlocks(e){const t=c["chart-timeline-grid-row-blocks"],i=c["chart-timeline-grid-rows"];for(const s of e){i.includes(s.id)?s.selecting=!0:s.selecting=!1;for(const e of s.blocks)t.includes(e.id)?e.selecting=!0:e.selecting=!1}return e}))}function mouseDown(e){0===e.button&&(d.selecting=!0,d.fromX=e.x-r,d.fromY=e.y-l,d.startX=d.fromX,d.startY=d.fromY,n=function cloneSelection(e){const t={};return t.selecting=Object.assign({},e.selecting),t.selecting["chart-timeline-grid-rows"]=e.selecting["chart-timeline-grid-rows"].slice(),t.selecting["chart-timeline-grid-row-blocks"]=e.selecting["chart-timeline-grid-row-blocks"].slice(),t.selecting["chart-timeline-items-rows"]=e.selecting["chart-timeline-items-rows"].slice(),t.selecting["chart-timeline-items-row-items"]=e.selecting["chart-timeline-items-row-items"].slice(),t.selected=Object.assign({},e.selected),t.selected["chart-timeline-grid-rows"]=e.selected["chart-timeline-grid-rows"].slice(),t.selected["chart-timeline-grid-row-blocks"]=e.selected["chart-timeline-grid-row-blocks"].slice(),t.selected["chart-timeline-items-rows"]=e.selected["chart-timeline-items-rows"].slice(),t.selected["chart-timeline-items-row-items"]=e.selected["chart-timeline-items-row-items"].slice(),t}(i.get(m)),clearSelection())}function mouseMove(e){select(e)}function mouseUp(t){!function endSelect(t){if(!d.selecting)return void clearSelection();t.stopPropagation(),d.selecting=!1,u.style.visibility="hidden";const s=i.get(m),c={};i.update(m,e=>(c.selected=Object.assign({},e.selecting),c.selecting={"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]},c));const o=i.get("_internal.elements");for(const t in a)for(const i of o[t+"s"])s.selecting[t+"s"].includes(i.vido.id)&&e.deselecting(i.vido,t);i.update("config.chart.items",(function updateItems(e){const t=s.selecting["chart-timeline-items-row-items"];for(const i in e){const s=e[i];t.includes(s.id)?s.selecting=!0:s.selecting=!1}return e})),i.update("_internal.chart.grid.rowsWithBlocks",(function updateRowsWithBlocks(t){for(const i of t)for(const t of i.blocks)s.selecting["chart-timeline-grid-row-blocks"].includes(t.id)?(void 0!==t.selected&&t.selected||e.selected(t,"chart-timeline-grid-row-block"),t.selected=!0):(n.selected["chart-timeline-grid-row-blocks"].includes(t.id)&&e.deselected(t,"chart-timeline-grid-row-block"),t.selected=!1);return t}))}(t)}return t.addEventListener("mousedown",mouseDown),document.addEventListener("mousemove",c(mouseMove)),document.body.addEventListener("mouseup",mouseUp),{update(){},destroy(){document.body.removeEventListener("mouseup",mouseUp),document.removeEventListener("mousemove",mouseMove),t.removeEventListener("mousedown",mouseDown)}}}function gridBlockAction(e,t){const i=s.getClass("chart-timeline-grid-row-block")+"--selecting",c=s.getClass("chart-timeline-grid-row-block")+"--selected";return t.selecting?e.classList.add(i):e.classList.remove(i),t.selected?e.classList.add(c):e.classList.remove(c),{update(e,t){t.selecting?e.classList.add(i):e.classList.remove(i),t.selected?e.classList.add(c):e.classList.remove(c)},destroy(e,t){e.classList.remove(i),e.classList.remove(c)}}}function itemAction(e,t){const i=s.getClass("chart-timeline-items-row-item")+"--selecting",c=s.getClass("chart-timeline-items-row-item")+"--selected";return t.item.selecting?e.classList.contains(i)||e.classList.add(i):e.classList.contains(i)&&e.classList.remove(i),t.item.selected?e.classList.contains(c)||e.classList.add(c):e.classList.contains(c)&&e.classList.remove(c),{update(e,t){t.item.selecting?e.classList.contains(i)||e.classList.add(i):e.classList.contains(i)&&e.classList.remove(i),t.item.selected?e.classList.contains(c)||e.classList.add(c):e.classList.contains(c)&&e.classList.remove(c)},destroy(e,t){e.classList.remove(i),e.classList.remove(c)}}}function onBlockCreate(e){return i.get("config.plugin.selection").selected["chart-timeline-grid-row-blocks"].find(t=>t===e.id)?e.selected=!0:e.selected=!1,e}return function initialize(e){i=(t=e).state,s=t.api,c=t.schedule,void 0===i.get(m)&&i.update(m,{selecting:{"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]},selected:{"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]}}),i.update("config.chart.items",e=>{for(const t in e){const i=e[t];void 0===i.selecting&&(i.selecting=!1),void 0===i.selected&&(i.selected=!1)}return e}),i.update("config.actions.chart-timeline",e=>(e.push(selectionAction),e)),i.update("config.actions.chart-timeline-grid-row-block",e=>(e.push(gridBlockAction),e)),i.update("config.actions.chart-timeline-items-row-item",e=>(e.push(itemAction),e)),i.update("config.chart.grid.block.onCreate",e=>(e.push(onBlockCreate),e))}}}));
//# sourceMappingURL=Selection.plugin.min.js.map
