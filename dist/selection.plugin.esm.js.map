{"version":3,"file":"selection.plugin.esm.js","sources":["../node_modules/@neuronet.io/vido/src/helpers.ts","../src/plugins/timeline-pointer.plugin.ts","../src/plugins/selection.plugin.ts"],"sourcesContent":["/**\n * Schedule - a throttle function that uses requestAnimationFrame to limit the rate at which a function is called.\n *\n * @param {function} fn\n * @returns {function}\n */\nexport function schedule(fn: (argument) => void | any) {\n  let frameId = 0;\n  function wrapperFn(argument) {\n    if (frameId) {\n      return;\n    }\n    function executeFrame() {\n      frameId = 0;\n      fn.apply(undefined, [argument]);\n    }\n    frameId = requestAnimationFrame(executeFrame);\n  }\n  return wrapperFn;\n}\n\n/**\n * Is object - helper function to determine if specified variable is an object\n *\n * @param {any} item\n * @returns {boolean}\n */\nfunction isObject(item) {\n  return item && typeof item === 'object' && item.constructor && item.constructor.name === 'Object';\n}\n\n/**\n * Merge deep - helper function which will merge objects recursively - creating brand new one - like clone\n *\n * @param {object} target\n * @params {[object]} sources\n * @returns {object}\n */\nexport function mergeDeep(target, ...sources) {\n  const source = sources.shift();\n  if (isObject(target) && isObject(source)) {\n    for (const key in source) {\n      if (isObject(source[key])) {\n        if (typeof source[key].clone === 'function') {\n          target[key] = source[key].clone();\n        } else {\n          if (typeof target[key] === 'undefined') {\n            target[key] = {};\n          }\n          target[key] = mergeDeep(target[key], source[key]);\n        }\n      } else if (Array.isArray(source[key])) {\n        target[key] = new Array(source[key].length);\n        let index = 0;\n        for (let item of source[key]) {\n          if (isObject(item)) {\n            if (typeof item.clone === 'function') {\n              target[key][index] = item.clone();\n            } else {\n              target[key][index] = mergeDeep({}, item);\n            }\n          } else {\n            target[key][index] = item;\n          }\n          index++;\n        }\n      } else {\n        target[key] = source[key];\n      }\n    }\n  }\n  if (!sources.length) {\n    return target;\n  }\n  return mergeDeep(target, ...sources);\n}\n\n/**\n * Clone helper function\n *\n * @param source\n * @returns {object} cloned source\n */\nexport function clone(source) {\n  if (typeof source.actions !== 'undefined') {\n    const actns = source.actions.map((action) => {\n      const result = { ...action };\n      const props = { ...result.props };\n      delete props.state;\n      delete props.api;\n      delete result.element;\n      result.props = props;\n      return result;\n    });\n    source.actions = actns;\n  }\n  return mergeDeep({}, source);\n}\n\nexport default {\n  mergeDeep,\n  clone,\n  schedule,\n};\n","/**\n * TimelinePointer plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   AGPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nimport DeepState from 'deep-state-observer';\nimport { Api } from '../api/api';\nimport { Vido } from '../gstc';\nimport { mergeDeep } from '@neuronet.io/vido/src/helpers';\n\nexport const CELL = 'chart-timeline-grid-row-cell';\nexport type CELL_TYPE = 'chart-timeline-grid-row-cell';\nexport const ITEM = 'chart-timeline-items-row-item';\nexport type ITEM_TYPE = 'chart-timeline-items-row-item';\n\nexport interface PointerEvents {\n  down: PointerEvent | null;\n  move: PointerEvent | null;\n  up: PointerEvent | null;\n}\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type PointerState = 'up' | 'down' | 'move';\n\nexport interface CaptureEvents {\n  up?: boolean;\n  down?: boolean;\n  move?: boolean;\n}\n\nexport interface Options {\n  enabled?: boolean;\n  captureEvents?: CaptureEvents;\n}\n\nexport interface Offset {\n  top: number;\n  left: number;\n}\n\nexport interface PluginData extends Options {\n  isMoving: boolean;\n  pointerState: PointerState;\n  currentTarget: HTMLElement | null;\n  realTarget: HTMLElement | null;\n  targetType: ITEM_TYPE | CELL_TYPE | '';\n  targetData: any | null;\n  events: PointerEvents;\n  offset: Offset;\n  initialPosition: Point;\n  currentPosition: Point;\n}\n\nfunction generateEmptyData(options: Options = {}): PluginData {\n  const result: PluginData = {\n    enabled: true,\n    isMoving: false,\n    pointerState: 'up',\n    currentTarget: null,\n    realTarget: null,\n    targetType: '',\n    targetData: null,\n    offset: { top: 0, left: 0 },\n    captureEvents: {\n      down: false,\n      up: false,\n      move: false,\n    },\n    initialPosition: { x: 0, y: 0 },\n    currentPosition: { x: 0, y: 0 },\n    events: {\n      down: null,\n      move: null,\n      up: null,\n    },\n  };\n  if (options.captureEvents) {\n    result.captureEvents = {\n      ...result.captureEvents,\n      ...options.captureEvents,\n    };\n  }\n  return result;\n}\n\nconst pluginPath = 'config.plugin.TimelinePointer';\n\nclass TimelinePointer {\n  private element: HTMLElement;\n  private vido: Vido;\n  private api: Api;\n  private state: DeepState;\n  private data: PluginData;\n  private unsub = [];\n  private classNames = {\n    cell: '',\n    item: '',\n  };\n\n  constructor(options: Options, vido: Vido) {\n    this.vido = vido;\n    this.api = vido.api;\n    this.state = vido.state;\n    this.element = this.state.get(`$data.elements.chart-timeline`);\n    this.pointerDown = this.pointerDown.bind(this);\n    this.pointerMove = this.pointerMove.bind(this);\n    this.pointerUp = this.pointerUp.bind(this);\n    this.data = generateEmptyData(options);\n    this.classNames.cell = this.api.getClass(CELL);\n    this.classNames.item = this.api.getClass(ITEM);\n    this.destroy = this.destroy.bind(this);\n    this.element.addEventListener('pointerdown', this.pointerDown /*, this.data.captureEvents.down*/);\n    document.addEventListener('pointerup', this.pointerUp /*, this.data.captureEvents.up*/);\n    document.addEventListener('pointermove', this.pointerMove /*, this.data.captureEvents.move*/);\n    this.unsub.push(this.state.subscribe(pluginPath, (value) => (this.data = value)));\n    this.unsub.push(\n      this.state.subscribe('config.scroll.vertical.offset', (offset) => {\n        this.data.offset.left = offset;\n        this.updateData();\n      })\n    );\n  }\n\n  public destroy() {\n    this.element.removeEventListener('pointerdown', this.pointerDown);\n    document.removeEventListener('pointerup', this.pointerUp);\n    document.removeEventListener('pointermove', this.pointerMove);\n  }\n\n  private updateData() {\n    this.state.update(pluginPath, () => ({ ...this.data }));\n  }\n\n  private getRealTarget(ev: PointerEvent) {\n    let realTarget: HTMLElement = (ev.target as HTMLElement).closest('.' + this.classNames.item) as HTMLElement;\n    if (realTarget) {\n      return realTarget;\n    }\n    realTarget = (ev.target as HTMLElement).closest('.' + this.classNames.cell) as HTMLElement;\n    if (realTarget) {\n      return realTarget;\n    }\n    return null;\n  }\n\n  private getRealPosition(ev: PointerEvent): Point {\n    const pos = { x: 0, y: 0 };\n    if (this.element) {\n      const bounding = this.element.getBoundingClientRect();\n      pos.x = ev.x - bounding.x;\n      pos.y = ev.y - bounding.y;\n      const scrollOffsetTop = this.state.get('config.scroll.vertical.offset') || 0;\n      pos.y += scrollOffsetTop;\n    }\n    return pos;\n  }\n\n  private pointerDown(ev: PointerEvent) {\n    if (!this.data.enabled) return;\n    this.data.pointerState = 'down';\n    this.data.currentTarget = ev.target as HTMLElement;\n    this.data.realTarget = this.getRealTarget(ev);\n    if (this.data.realTarget) {\n      if (this.data.realTarget.classList.contains(this.classNames.item)) {\n        this.data.targetType = ITEM;\n        // @ts-ignore\n        this.data.targetData = this.data.realTarget.vido.item;\n      } else if (this.data.realTarget.classList.contains(this.classNames.cell)) {\n        this.data.targetType = CELL;\n        // @ts-ignore\n        this.data.targetData = this.data.realTarget.vido;\n      } else {\n        this.data.targetType = '';\n      }\n    } else {\n      this.data.targetType = '';\n      this.data.targetData = null;\n    }\n    this.data.isMoving = !!this.data.realTarget;\n    this.data.events.down = ev;\n    this.data.events.move = ev;\n    const realPosition = this.getRealPosition(ev);\n    this.data.initialPosition = realPosition;\n    this.data.currentPosition = realPosition;\n    this.updateData();\n  }\n\n  private pointerUp(ev: PointerEvent) {\n    if (!this.data.enabled) return;\n    this.data.pointerState = 'up';\n    this.data.isMoving = false;\n    this.data.events.up = ev;\n    this.data.currentPosition = this.getRealPosition(ev);\n    this.updateData();\n  }\n\n  private pointerMove(ev: PointerEvent) {\n    if (!this.data.enabled || !this.data.isMoving) return;\n    this.data.pointerState = 'move';\n    this.data.events.move = ev;\n    this.data.currentPosition = this.getRealPosition(ev);\n    this.updateData();\n  }\n}\n\nexport function Plugin(options: Options) {\n  return function initialize(vidoInstance: Vido) {\n    const currentOptions = vidoInstance.state.get(pluginPath);\n    if (currentOptions) {\n      options = mergeDeep(mergeDeep({}, options), currentOptions);\n    }\n    const subs = [];\n    const defaultData = generateEmptyData(options);\n    // for other plugins that are initialized before elements are saved\n    vidoInstance.state.update(pluginPath, defaultData);\n\n    // initialize only if chart element is mounted\n    let timelinePointerDestroy;\n    subs.push(\n      vidoInstance.state.subscribe('$data.elements.chart-timeline', (timelineElement: HTMLElement) => {\n        if (timelineElement) {\n          if (timelinePointerDestroy) timelinePointerDestroy();\n          const timelinePointer = new TimelinePointer(options, vidoInstance);\n          timelinePointerDestroy = timelinePointer.destroy;\n        }\n      })\n    );\n    return function destroy() {\n      subs.forEach((unsub) => unsub());\n      if (timelinePointerDestroy) timelinePointerDestroy();\n    };\n  };\n}\n","/**\n * Selection plugin\n *\n * @copyright Rafal Pospiech <https://neuronet.io>\n * @author    Rafal Pospiech <neuronet.io@gmail.com>\n * @package   gantt-schedule-timeline-calendar\n * @license   AGPL-3.0 (https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)\n * @link      https://github.com/neuronetio/gantt-schedule-timeline-calendar\n */\n\nimport {\n  PluginData as TimelinePointerPluginData,\n  ITEM,\n  ITEM_TYPE,\n  CELL,\n  CELL_TYPE,\n  Point,\n  PointerState,\n} from './timeline-pointer.plugin';\n\nimport { Item, GridCell, Items, Vido, htmlResult, Wrapper, ItemData, GridRow, GridRows, GridCells } from '../gstc';\nimport DeepState from 'deep-state-observer';\nimport { Api } from '../api/api';\nimport { StyleMap, lithtml } from '@neuronet.io/vido/src/vido';\nimport { mergeDeep } from '@neuronet.io/vido/src/helpers';\n\nexport type ModKey = 'shift' | 'ctrl' | 'alt' | '';\n\nexport interface Options {\n  enabled?: boolean;\n  cells?: boolean;\n  items?: boolean;\n  rows?: boolean;\n  showOverlay?: boolean;\n  rectangularSelection?: boolean;\n  multipleSelection?: boolean;\n  selectKey?: ModKey;\n  multiKey?: ModKey;\n  selectedClassName?: string;\n  selectingClassName?: string;\n  canSelect?: (type, state, all) => any[];\n  canDeselect?: (type, state, all) => any[];\n}\n\nexport interface SelectionItems {\n  [key: string]: Item[];\n}\n\nexport interface SelectState {\n  selecting?: SelectionItems;\n  selected?: SelectionItems;\n}\n\nfunction prepareOptions(options: Options) {\n  const defaultOptions: Options = {\n    enabled: true,\n    cells: true,\n    items: true,\n    rows: false,\n    showOverlay: true,\n    rectangularSelection: true,\n    multipleSelection: true,\n    selectedClassName: 'gstc__cell-selected',\n    selectingClassName: 'gstc__cell-selecting',\n    canSelect(type, currently /*, all*/) {\n      return currently;\n    },\n    canDeselect(/*type, currently, all*/) {\n      return [];\n    },\n  };\n  options = { ...defaultOptions, ...options } as Options;\n  return options;\n}\n\nconst pluginPath = 'config.plugin.Selection';\n\nexport interface Area {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\nexport interface Selection {\n  [ITEM]: string[];\n  [CELL]: string[];\n}\n\nexport interface SelectedCell {\n  rowId: string;\n  cellId: string;\n}\n\nexport interface PointerEvents {\n  down: PointerEvent | null;\n  move: PointerEvent | null;\n  up: PointerEvent | null;\n}\n\nexport interface PluginData extends Options {\n  enabled: boolean;\n  isSelecting: boolean;\n  showOverlay: boolean;\n  pointerState: PointerState;\n  initialPosition: Point;\n  currentPosition: Point;\n  selectionAreaLocal: Area;\n  selectionAreaGlobal: Area;\n  selected: Selection;\n  selecting: Selection;\n  automaticallySelected: Selection;\n  previouslyAutomaticallySelected: Selection;\n  events: PointerEvents;\n  targetType: ITEM_TYPE | CELL_TYPE | '';\n  targetData: any;\n}\n\nfunction generateEmptyData(options: Options): PluginData {\n  return {\n    enabled: true,\n    showOverlay: true,\n    isSelecting: false,\n    pointerState: 'up',\n    selectKey: '',\n    multiKey: 'shift',\n    multipleSelection: true,\n    targetType: '',\n    targetData: null,\n    initialPosition: { x: 0, y: 0 },\n    currentPosition: { x: 0, y: 0 },\n    selectionAreaLocal: { x: 0, y: 0, width: 0, height: 0 },\n    selectionAreaGlobal: { x: 0, y: 0, width: 0, height: 0 },\n    selecting: {\n      [ITEM]: [],\n      [CELL]: [],\n    },\n    selected: {\n      [ITEM]: [],\n      [CELL]: [],\n    },\n    automaticallySelected: {\n      [ITEM]: [],\n      [CELL]: [],\n    },\n    previouslyAutomaticallySelected: {\n      [ITEM]: [],\n      [CELL]: [],\n    },\n    events: {\n      down: null,\n      move: null,\n      up: null,\n    },\n    ...options,\n  };\n}\n\nclass SelectionPlugin {\n  private data: PluginData;\n  private poitnerData: TimelinePointerPluginData;\n  private vido: Vido;\n  private state: DeepState;\n  private api: Api;\n  private onDestroy = [];\n  private oldWrapper: Wrapper;\n  private html: typeof lithtml.html;\n  private wrapperClassName: string;\n  private wrapperStyleMap: StyleMap;\n  private merge: (target: object, source: object) => object;\n\n  constructor(vido: Vido, options: Options) {\n    this.vido = vido;\n    this.state = vido.state;\n    this.api = vido.api;\n    this.merge = this.state.get('config.merge');\n    this.state.update(pluginPath, generateEmptyData(options));\n    this.data = generateEmptyData(options);\n    this.wrapperClassName = this.api.getClass('chart-selection');\n    this.wrapperStyleMap = new vido.StyleMap({ display: 'none' });\n    this.html = vido.html;\n    this.wrapper = this.wrapper.bind(this);\n    this.destroy = this.destroy.bind(this);\n    this.setWrapper();\n    this.onCellCreate = this.onCellCreate.bind(this);\n    this.state.update('config.chart.grid.cell.onCreate', (onCreate) => {\n      if (!onCreate.includes(this.onCellCreate)) onCreate.push(this.onCellCreate);\n      return onCreate;\n    });\n    this.onDestroy.push(\n      this.state.subscribe('config.plugin.TimelinePointer', (timelinePointerData) => {\n        this.poitnerData = timelinePointerData;\n        this.onPointerData();\n      })\n    );\n    this.updateData();\n    this.onDestroy.push(\n      this.state.subscribe(pluginPath, (value) => {\n        this.data = value;\n      })\n    );\n    this.updateCellSelectionClassName = this.updateCellSelectionClassName.bind(this);\n    this.selectedCellAction = this.selectedCellAction.bind(this);\n    this.state.update('config.actions.chart-timeline-grid-row-cell', (actions) => {\n      if (!actions.includes(this.selectedCellAction)) actions.push(this.selectedCellAction);\n      return actions;\n    });\n    // watch and update items/cells that are inside selection\n    // remove ones that no longer exist\n    // for cells we cannot do that because cells are created dynamically\n    this.onDestroy.push(\n      this.state.subscribe(\n        'config.chart.items',\n        (items: Items) => {\n          this.data.selected[ITEM] = this.data.selected[ITEM].filter((itemId) => !!items[itemId]);\n          this.data.selecting[ITEM] = this.data.selecting[ITEM].filter((itemId) => !!items[itemId]);\n        },\n        {\n          ignore: ['$data.chart.items.*.detached', 'config.chart.items.*.selected', 'config.chart.items.*.selecting'],\n        }\n      )\n    );\n  }\n\n  private setWrapper() {\n    this.state.update('config.wrappers.ChartTimelineItems', (oldWrapper: Wrapper) => {\n      if (!this.oldWrapper) this.oldWrapper = oldWrapper;\n      return this.wrapper;\n    });\n  }\n\n  public destroy() {\n    this.state.update('config.wrappers.ChartTimelineItems', this.oldWrapper);\n    this.state.update('config.actions.chart-timeline-grid-row-cell', (actions) => {\n      return actions.filter((action) => action !== this.selectedCellAction);\n    });\n    this.state.update('config.chart.grid.cell.onCreate', (onCreate) => {\n      return onCreate.filter((onCreateFn) => onCreateFn !== this.onCellCreate);\n    });\n    this.oldWrapper = null;\n    this.onDestroy.forEach((unsub) => unsub());\n  }\n\n  private updateData() {\n    this.state.update(pluginPath, { ...this.data });\n    this.vido.update(); // draw selection area overlay\n  }\n\n  private modKeyPressed(modKey: ModKey, ev: PointerEvent): boolean {\n    switch (modKey) {\n      case 'shift':\n        return ev.shiftKey;\n      case 'alt':\n        return ev.altKey;\n      case 'ctrl':\n        return ev.ctrlKey;\n    }\n  }\n\n  private canSelect(): boolean {\n    let result = this.data.enabled;\n    const downEvent = this.poitnerData.events.down;\n    if (downEvent && this.data.selectKey) result = result && this.modKeyPressed(this.data.selectKey, downEvent);\n    return result;\n  }\n\n  private getSelectionAreaLocal(): Area {\n    const area = { x: 0, y: 0, width: 0, height: 0 };\n    const initial = { ...this.poitnerData.initialPosition };\n    const current = { ...this.poitnerData.currentPosition };\n    const width = current.x - initial.x;\n    const height = current.y - initial.y;\n    if (width >= 0) {\n      area.x = initial.x;\n      area.width = width;\n    } else {\n      area.x = current.x;\n      area.width = Math.abs(width);\n    }\n    if (height >= 0) {\n      area.y = initial.y;\n      area.height = height;\n    } else {\n      area.y = current.y;\n      area.height = Math.abs(height);\n    }\n    return area;\n  }\n\n  private translateAreaLocalToGlobal(localArea: Area): Area {\n    const leftPx: number = this.state.get('$data.chart.time.leftPx');\n    const topPx: number = this.state.get('config.scroll.vertical.posPx');\n    return { ...localArea, x: localArea.x + leftPx, y: localArea.y + topPx };\n  }\n\n  private collectLinkedItems(item: Item, current: string[] = []): string[] {\n    if (item.linkedWith && item.linkedWith.length) {\n      const items: Items = this.api.getAllItems();\n      for (const linkedItemId of item.linkedWith) {\n        const linkedItem: Item = items[linkedItemId];\n        if (!current.includes(linkedItem.id)) {\n          current.push(linkedItem.id);\n          // we don't need to go further because linkedWith property already contains all we need\n        }\n      }\n    }\n    return current;\n  }\n\n  private getSelected(item: Item): { selected: string[]; automaticallySelected: string[] } {\n    let selected: string[];\n    let automaticallySelected: string[] = this.data.automaticallySelected[ITEM].slice();\n    const linked = this.collectLinkedItems(item, [item.id]);\n    if (this.data.selected[ITEM].find((selectedItemId) => selectedItemId === item.id)) {\n      // if we want to start movement or something - just return currently selected\n      selected = this.data.selected[ITEM];\n      if (automaticallySelected.find((autoId) => autoId === item.id)) {\n        // item under the pointer was automaticallySelected so we must remove it from here\n        // - it is not automaticallySelected right now\n        // we need to replace current item with one that is linked but doesn't lay down\n        // in automaticallySelected currently - we need to switch them\n        // first of all we need to find out which item is linked with current but\n        // not inside automaticallySelected\n        const actualAutoIds = automaticallySelected;\n        const replaceWith = selected.find((selId) => item.linkedWith.includes(selId) && !actualAutoIds.includes(selId));\n        automaticallySelected = automaticallySelected.filter((currentItemId) => currentItemId !== item.id);\n        automaticallySelected.push(replaceWith);\n      } else {\n        automaticallySelected = this.data.automaticallySelected[ITEM];\n      }\n    } else {\n      if (this.isMulti()) {\n        selected = Array.from(new Set([...this.data.selected[ITEM], ...linked]));\n      } else {\n        selected = linked;\n      }\n      automaticallySelected = linked.filter((currentItemId) => currentItemId !== item.id);\n    }\n    selected = selected.map((itemId) => {\n      item = this.api.getItem(itemId);\n      item.selected = true;\n      return itemId;\n    });\n    return { selected, automaticallySelected };\n  }\n\n  private isItemVerticallyInsideArea(itemData: ItemData, area: Area): boolean {\n    if (!area.width || !area.height) return false;\n    const areaBottom = area.y + area.height;\n    const itemTop = itemData.position.viewTop;\n    const itemBottom = itemTop + itemData.actualHeight;\n    return (\n      (itemTop >= area.y && itemTop <= areaBottom) ||\n      (itemBottom >= area.y && itemBottom <= areaBottom) ||\n      (itemTop >= area.y && itemBottom <= areaBottom) ||\n      (itemTop <= area.y && itemBottom >= areaBottom)\n    );\n  }\n\n  private isItemHorizontallyInsideArea(itemData: ItemData, area: Area): boolean {\n    if (!area.width || !area.height) return false;\n    const areaRight = area.x + area.width;\n    return (\n      (itemData.position.actualLeft >= area.x && itemData.position.actualLeft <= areaRight) ||\n      (itemData.position.actualRight >= area.x && itemData.position.actualRight <= areaRight) ||\n      (itemData.position.actualLeft <= area.x && itemData.position.actualRight >= areaRight) ||\n      (itemData.position.actualLeft >= area.x && itemData.position.actualRight <= areaRight)\n    );\n  }\n\n  private isMulti(): boolean {\n    const move = this.poitnerData.events.move;\n    return move && this.data.multiKey && this.modKeyPressed(this.data.multiKey, move);\n  }\n\n  private getItemsUnderSelectionArea(\n    areaLocal: Area\n  ): { selectedItems: string[]; automaticallySelectedItems: string[] } {\n    const visibleItemsId: string[] = this.state.get('$data.chart.visibleItems');\n    const visibleItems: Item[] = this.api.getItems(visibleItemsId);\n    let selectedItems = [];\n    const automaticallySelectedItems = [];\n    for (let item of visibleItems) {\n      item = this.merge({}, item) as Item;\n      const itemData = this.api.getItemData(item.id);\n      if (\n        this.isItemVerticallyInsideArea(itemData, areaLocal) &&\n        this.isItemHorizontallyInsideArea(itemData, areaLocal)\n      ) {\n        if (!selectedItems.find((selectedItemId) => selectedItemId === item.id)) selectedItems.push(item.id);\n        const linked = this.collectLinkedItems(item, [item.id]);\n        for (let linkedItemId of linked) {\n          const linkedItem = this.api.getItem(linkedItemId);\n          if (!selectedItems.find((selectedItemId) => selectedItemId === linkedItem.id)) {\n            selectedItems.push(linkedItem.id);\n            automaticallySelectedItems.push(linkedItem.id);\n          }\n        }\n      }\n    }\n    selectedItems = selectedItems.map((itemId) => {\n      const item = this.api.getItem(itemId);\n      item.selected = true;\n      return itemId;\n    });\n    return { selectedItems, automaticallySelectedItems };\n  }\n\n  private isCellVerticallyInsideArea(cell: GridCell, area: Area): boolean {\n    if (!area.width || !area.height) return false;\n    const areaBottom = area.y + area.height;\n    const top = cell.top;\n    const bottom = top + cell.row.$data.actualHeight;\n    return (\n      (top >= area.y && top <= areaBottom) ||\n      (bottom >= area.y && bottom <= areaBottom) ||\n      (top >= area.y && bottom <= areaBottom) ||\n      (top <= area.y && bottom >= areaBottom)\n    );\n  }\n\n  private isCellHorizontallyInsideArea(cell: GridCell, area: Area): boolean {\n    if (!area.width || !area.height) return false;\n    const areaRight = area.x + area.width;\n    const left = cell.time.currentView.leftPx;\n    const right = cell.time.currentView.rightPx;\n    return (\n      (left >= area.x && left <= areaRight) ||\n      (right >= area.x && right <= areaRight) ||\n      (left <= area.x && right >= areaRight) ||\n      (left >= area.x && right <= areaRight)\n    );\n  }\n\n  private getCellsUnderSelectionArea(areaLocal: Area): { selectedCells: string[] } {\n    const cells: GridCells = this.state.get('$data.chart.grid.cells');\n    const selectedCells = [];\n    for (const cellId in cells) {\n      const cell = cells[cellId];\n      if (this.isCellVerticallyInsideArea(cell, areaLocal) && this.isCellHorizontallyInsideArea(cell, areaLocal)) {\n        if (!selectedCells.find((selectedCell: string) => selectedCell === cell.id)) selectedCells.push(cell.id);\n      }\n    }\n    return { selectedCells };\n  }\n\n  private updateItems(multi = undefined) {\n    if (!multi) multi = this.state.multi();\n    multi = multi.update('config.chart.items.*.selected', false);\n    multi = multi.update('config.chart.items.*.selecting', false);\n    const itemsId = Array.from(new Set([...this.data.selecting[ITEM], ...this.data.selected[ITEM]]));\n    for (const itemId of itemsId) {\n      const selecting = this.data.selecting[ITEM].includes(itemId);\n      const selected = this.data.selected[ITEM].includes(itemId);\n      multi = multi.update(`config.chart.items.${itemId}.selecting`, selecting);\n      multi = multi.update(`config.chart.items.${itemId}.selected`, selected);\n    }\n    return multi;\n  }\n\n  private updateCells(multi = undefined) {\n    if (!multi) multi = this.state.multi();\n    multi.update('$data.chart.grid.cells', (cells: GridCells) => {\n      for (const cellId in cells) {\n        const cell = cells[cellId];\n        cell.selected = this.data.selected[CELL].includes(cell.id);\n        cell.selecting = this.data.selecting[CELL].includes(cell.id);\n      }\n      return cells;\n    });\n    return multi;\n  }\n\n  private deselectItems() {\n    this.data.selected[ITEM].length = 0;\n    this.data.selecting[ITEM].length = 0;\n    this.updateItems();\n  }\n\n  private deselectCells() {\n    this.data.selecting[CELL].length = 0;\n    this.data.selected[CELL].length = 0;\n    this.updateCells();\n  }\n\n  private selectMultipleCells(multi) {\n    const { selectedCells } = this.getCellsUnderSelectionArea(this.data.selectionAreaLocal);\n    if (selectedCells.length === 0) {\n      this.data.selecting[CELL].length = 0;\n      if (!this.isMulti()) this.data.selected[CELL].length = 0;\n    } else {\n      this.data.selecting[CELL] = selectedCells;\n    }\n    const allCells: GridCell[] = this.api.getGridCells();\n    const currentlySelectingCellsStr = allCells\n      .filter((cell) => cell.selecting)\n      .map((cell) => cell.id)\n      .join('|');\n    const selectingCellsStr = this.data.selecting[CELL].join('|');\n    if (currentlySelectingCellsStr !== selectingCellsStr) multi = this.updateCells(multi);\n    return multi;\n  }\n\n  private selectMultipleItems(multi) {\n    const { selectedItems, automaticallySelectedItems } = this.getItemsUnderSelectionArea(this.data.selectionAreaLocal);\n    this.data.automaticallySelected[ITEM] = automaticallySelectedItems;\n    if (selectedItems.length === 0) {\n      this.data.selecting[ITEM].length = 0;\n      if (this.isMulti()) this.data.selected[ITEM].length = 0;\n    } else {\n      this.data.selecting[ITEM] = selectedItems;\n    }\n    const allItems: Item[] = this.api.getItems();\n    const currentlySelectingItemsStr = allItems\n      .filter((item) => item.selecting)\n      .map((item) => item.id)\n      .join('|');\n    const selectingItemsStr = this.data.selecting[ITEM].join('|');\n    if (currentlySelectingItemsStr !== selectingItemsStr) multi = this.updateItems(multi);\n    return multi;\n  }\n\n  private selectMultipleCellsAndItems() {\n    if (!this.canSelect()) return;\n    if (!this.data.multipleSelection) {\n      this.deselectItems();\n      this.deselectCells();\n      return;\n    }\n    this.data.isSelecting = true;\n    this.data.selectionAreaLocal = this.getSelectionAreaLocal();\n    this.data.selectionAreaGlobal = this.translateAreaLocalToGlobal(this.data.selectionAreaLocal);\n    let multi = this.state.multi();\n    multi = this.selectMultipleItems(multi);\n    multi = this.selectMultipleCells(multi);\n    multi.done();\n  }\n\n  private selectItemsIndividually() {\n    this.data.isSelecting = false;\n    this.data.selectionAreaLocal = this.getSelectionAreaLocal();\n    this.data.currentPosition = this.poitnerData.currentPosition;\n    this.data.initialPosition = this.poitnerData.initialPosition;\n    if (!this.canSelect()) return;\n    const item: Item = this.merge({}, this.poitnerData.targetData) as Item;\n    let { selected, automaticallySelected } = this.getSelected(item);\n    if (selected.length > 1 && !this.data.multipleSelection) {\n      selected = [item.id];\n      automaticallySelected = [];\n    }\n    this.data.selected[ITEM] = selected;\n    this.data.automaticallySelected[ITEM] = automaticallySelected;\n    let multi = this.state.multi();\n    multi = this.updateItems(multi);\n    multi.done();\n  }\n\n  private finishSelection() {\n    if (this.isMulti()) {\n      this.data.selected[CELL] = Array.from(new Set([...this.data.selected[CELL], ...this.data.selecting[CELL]]));\n      this.data.selected[ITEM] = Array.from(new Set([...this.data.selected[ITEM], ...this.data.selecting[ITEM]]));\n      this.data.selecting[CELL].length = 0;\n      this.data.selecting[ITEM].length = 0;\n      let multi = this.state.multi();\n      multi = this.updateItems(multi);\n      multi = this.updateCells(multi);\n      multi.done();\n      return;\n    }\n    this.data.selected[CELL] = [...this.data.selecting[CELL]];\n    this.data.selected[ITEM] = [...this.data.selecting[ITEM]];\n    this.data.selecting[CELL].length = 0;\n    this.data.selecting[ITEM].length = 0;\n    let multi = this.state.multi();\n    multi = this.updateItems(multi);\n    multi = this.updateCells(multi);\n    multi.done();\n  }\n\n  private onPointerData() {\n    if (this.poitnerData.isMoving && this.poitnerData.targetType === CELL && this.data.rectangularSelection) {\n      this.selectMultipleCellsAndItems();\n    } else if (this.poitnerData.isMoving && this.poitnerData.targetType === CELL && !this.data.rectangularSelection) {\n      this.deselectItems();\n    } else if (this.poitnerData.isMoving && this.poitnerData.targetType === ITEM) {\n      this.selectItemsIndividually();\n    } else if (!this.poitnerData.isMoving) {\n      if (this.data.isSelecting) this.finishSelection();\n      this.data.isSelecting = false;\n    }\n    if (this.poitnerData.isMoving && this.poitnerData.targetType !== CELL && this.poitnerData.targetType !== ITEM) {\n      this.deselectItems();\n    }\n    this.data.events = this.poitnerData.events;\n    this.data.pointerState = this.poitnerData.pointerState;\n    this.data.targetType = this.poitnerData.targetType;\n    this.data.targetData = this.poitnerData.targetData;\n    this.updateData();\n  }\n\n  private wrapper(input: htmlResult, props?: any) {\n    if (!this.oldWrapper) return input;\n    const oldContent = this.oldWrapper(input, props);\n    let shouldDetach = true;\n    if (\n      this.canSelect() &&\n      this.data.isSelecting &&\n      this.data.showOverlay &&\n      this.data.multipleSelection &&\n      this.data.rectangularSelection\n    ) {\n      this.wrapperStyleMap.style.display = 'block';\n      this.wrapperStyleMap.style.left = this.data.selectionAreaLocal.x + 'px';\n      this.wrapperStyleMap.style.top = this.data.selectionAreaLocal.y + 'px';\n      this.wrapperStyleMap.style.width = this.data.selectionAreaLocal.width + 'px';\n      this.wrapperStyleMap.style.height = this.data.selectionAreaLocal.height + 'px';\n      shouldDetach = false;\n    }\n    const area = this.html`<div class=${this.wrapperClassName} style=${this.wrapperStyleMap}></div>`;\n    return this.html`${oldContent}${shouldDetach ? null : area}`;\n  }\n\n  private updateCellSelectionClassName(element: HTMLElement, cell: GridCell) {\n    if (cell.selected) {\n      element.classList.add(this.data.selectedClassName);\n      element.classList.remove(this.data.selectingClassName);\n    } else {\n      element.classList.remove(this.data.selectedClassName);\n    }\n    if (cell.selecting) {\n      element.classList.add(this.data.selectingClassName);\n      element.classList.remove(this.data.selectedClassName);\n    } else {\n      element.classList.remove(this.data.selectingClassName);\n    }\n  }\n\n  private selectedCellAction(element: HTMLElement, data: GridCell) {\n    this.updateCellSelectionClassName(element, data);\n    return {\n      update: this.updateCellSelectionClassName,\n      destroy: this.updateCellSelectionClassName,\n    };\n  }\n\n  private onCellCreate(cell: GridCell) {\n    cell.selected = !!this.data.selected[CELL].find((selectedCellId) => selectedCellId === cell.id);\n    cell.selecting = !!this.data.selecting[CELL].find((selectedCellId) => selectedCellId === cell.id);\n    return cell;\n  }\n}\n\nexport function Plugin(options: Options = {}) {\n  options = prepareOptions(options);\n  return function initialize(vidoInstance: Vido) {\n    const currentOptions = vidoInstance.state.get(pluginPath);\n    if (currentOptions) {\n      options = mergeDeep({}, options, currentOptions);\n    }\n    const selectionPlugin = new SelectionPlugin(vidoInstance, options);\n    return selectionPlugin.destroy;\n  };\n}\n"],"names":[],"mappings":"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"}